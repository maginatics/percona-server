------------------------------------------------------------
revno: 3917
committer: Joerg Bruehe <joerg.bruehe@oracle.com>
branch nick: clone-5.6
timestamp: Tue 2012-07-17 17:43:47 +0200
message:
  Add the man page for the "mysql_config_editor" to the RPM spec file.
------------------------------------------------------------
revno: 3916
committer: Iggy Galarza <iggy.galarza@oracle.com>
branch nick: mysql-5.6.6-m9-release_msi_fix
timestamp: Mon 2012-07-16 18:41:31 -0400
message:
  Bug 14333093 - MYSQL 5.6 - WINDOWS INSTALLER DOES PROPERLY INSTALL DEFAULT DATABASE FILES
  - Ensure that the User Configuration data directory WiX resource is produced before duplicate features are removed by CMake
------------------------------------------------------------
revno: 3915
committer: Roy Lyseng <roy.lyseng@oracle.com>
branch nick: mysql-5.6.6-m9-release
timestamp: Wed 2012-07-11 12:25:23 +0200
message:
  Remove support for semi-join with multi-table UPDATE and DELETE
  
  mysql-test/r/innodb_explain_json_non_select_all.result
  mysql-test/r/innodb_explain_non_select_all.result
  mysql-test/r/myisam_explain_json_non_select_all.result
  mysql-test/r/myisam_explain_non_select_all.result
  mysql-test/r/subquery_mat_all.result
    Modified test results with removed semi-join
        
  sql/sql_resolver.cc
    Check that command is SELECT or based on a SELECT  when transforming
    subqueries into semi-join.
------------------------------------------------------------
revno: 3914
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-5.6.6-m9-release
timestamp: Fri 2012-06-29 16:38:56 +0200
message:
  Bug#14248833: UPDATE ON INNODB TABLE ENTERS RECURSION
        
  Introduction of cost based decision on filesort vs index for UPDATE
  statements changed detection of the fact that the index used to scan the
  table is being updated. The new design missed the case of index merge
  when there is no single index to check. That was worked until a recent
  change in InnoDB after which it went into infinite recursion if update of
  the used index wasn't properly detected.
        
  The fix consists of 'used key being updated' detection code from 5.1.
  
  Fix by Evgeny, manually applied to MySQL 5.6.6
------------------------------------------------------------
revno: 3913
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-5.6.6-m9-release
timestamp: Fri 2012-06-29 16:30:16 +0200
message:
  BUG#14208922 followup: fix valgrind warning in PB and make 
  printout of SEL_TREEs more readable.
------------------------------------------------------------
revno: 3912
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-5.6.6-m9-release
timestamp: Thu 2012-06-28 14:46:30 +0200
message:
  Bug#14208922 - RANGE OPTIMIZER SHOULD CONSIDER INDEX UNION 
                 FOR DISJUNCTIONS INSIDE CONJUNCTIONS
  
  When we have a condition of the form "WHERE (p1 or p2)"
  where px is a predicate of the form indexed_col=const, 
  the range optimizer calculates the cost of doing index merge 
  union of the three indexes that covers px. However, if a 
  simple range scan would have been an alternative to this 
  index merge union, i.e. if the condition had been of the form 
  "WHERE p0 AND (p1 or p2)", heuristics would be used to always
  prefer a single-index range scan over the index covering p0.
  
  The assumption that a single-index range is always cheaper 
  than index merge union does not hold. If the selectivity of 
  p0 is much lower than that of p1 and p2, index merge union 
  should be chosen.
  
  This changeset removes the heuristic and makes the range 
  optimizer calculate both costs to be able to reach a cost based
  decision of which range access method to pick.
------------------------------------------------------------
revno: 3911
tags: clone-5.6.6-m9-build
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: t
timestamp: Wed 2012-06-27 14:54:14 +0300
message:
  Eliminate nondeterminism in innodb-system-table-view.test caused
  by varying order of rows in the output of some SELECTS.
  
  Use mtr's --sorted_result to always have the output in the same order.
  
  This patch is based on a patch which Sunny posted on IM, but uses
  --sorted_result instead of ORDER BY.
------------------------------------------------------------
revno: 3910
committer: Olav Sandstaa <olav.sandstaa@oracle.com>
branch nick: wl6082-bug
timestamp: Wed 2012-06-27 12:56:34 +0200
message:
  Fix for Bug#14185642 - WL#6082: FAILURES ON TRUNK
  
  Test failures occurring when running the tests with the non-default 4K
  page size for InnoDB. The tests fail due to changes in the "disk sweep
  cost model" for reading data from disk introduced in WL#6082. The disk
  sweep cost is influenced by the number of blocks used for storing the
  table which can be different when using 4K page size compared to 16K
  page size.
  
  opt_trace.bugs_no_prot_all:
  ===========================
  
  Cause: this test fails due to the cost estimate in the optimizer trace
         is slightly different due to change in "file size" when using
         4K blocks instead of 16K blocks.
  
  Fix: This is an optimizer trace test. Fixes this problem by only running
       it with the default 16K block size for InnoDB.
  
  innodb_explain_json_non_select_all, innodb_explain_non_select_none,
  innodb_explain_json_non_select_none, nnodb_explain_non_select_all:
  ==================================================================
  
  Cause: These tests fail due to change in execution plan between 16K
  and 4K InnoDB page sizes. For 16 page size the failing query is done
  as a table scan while for 4K page size it is done as an index-merge.
  Before WL#6082 it would use a table scan in both cases. The reason for
  the change to do index-merge for the 4K case is that the size of the
  table is smaller when using 4K pages compared to using 16K pages and
  thus the cost for doing index merge is now lower.
  
  Fix: We need to have the same query plan for both 4K and 16K pages
  (since the test has the same result file). For the same tests when run
  with MyISAM the queries are done using index-merge. So instead of
  "forcing" the 4K InnoDB test to run as a "table scan", we change the
  default/16K InnoDB test to run using index-merge by adding more
  records to the table. This increases the cost of doing a full table
  scan and makes index-merge cheaper than a table scan in both 16K and
  4K test case.
------------------------------------------------------------
revno: 3909
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-06-26 11:21:27 +0200
message:
  BUG#11752097: SELECT ... WHERE (col1, col2) IN ((const, const))
                is optimized, non-SELECT not
  
  Post-push fix: record one more result file.
------------------------------------------------------------
revno: 3908
committer: Sunny Bains <Sunny.Bains@Oracle.Com>
branch nick: trunk
timestamp: Wed 2012-06-27 19:35:06 +1000
message:
  Fix test case so that we compare the file size and not dump the absolute size
  of the ibdata1 file. The absolute size can change due to different page
  size configuration.
------------------------------------------------------------
revno: 3907
committer: Sunny Bains <Sunny.Bains@Oracle.Com>
branch nick: trunk
timestamp: Wed 2012-06-27 14:10:22 +1000
message:
  Fix failing tests. We no longer move the .ibd file to a .ibt file.
------------------------------------------------------------
revno: 3906
committer: kevin.lewis@oracle.com
branch nick: mysql-trunk
timestamp: Tue 2012-06-26 09:30:44 -0500
message:
  Clean up test cases that use information_schema tables
  to display InnoDB tablespaces and datafiles so that they
  are have a deterministic output.
------------------------------------------------------------
revno: 3905
committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-06-26 15:02:52 +0530
message:
  Following changes included- Sunny's fix for to fix the timeout and assertion failure, added "eits-tests-innodb-engine-debug" to default.push, added rpl_max_allowed_packet_stress to disabled.def under i_rpl
------------------------------------------------------------
revno: 3904
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-push
timestamp: Mon 2012-06-25 16:33:46 +0400
message:
  Fixed more tests affected by sql-mode and binlog-row-event-max-size
  default change (WL#6216).
------------------------------------------------------------
revno: 3903
committer: Marc Alff <marc.alff@oracle.com>
branch nick: mysql-trunk-cleanup
timestamp: Mon 2012-06-25 11:50:31 +0200
message:
  Test suite cleanup after last merges.
  
  Performance schema autosizing: adjusted the mutex_per_share heuristic to follow the server behavior.
------------------------------------------------------------
revno: 3902
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-push
timestamp: Mon 2012-06-25 12:09:16 +0400
message:
  Fixed innodb-wl5980-discard failure detected after push of WL#6216.
------------------------------------------------------------
revno: 3901
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-push
timestamp: Mon 2012-06-25 12:05:05 +0400
message:
  Fixed innodb-wl5980-discard failure detected after push of WL#6216.
------------------------------------------------------------
revno: 3900
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-push
timestamp: Mon 2012-06-25 11:17:37 +0400
message:
  Fixed innodb-restart failure detected after push of WL#6216.
------------------------------------------------------------
revno: 3899
committer: Gopal Shankar <gopal.shankar@oracle.com>
branch nick: mysql-trunk-wl6292-postmergefixes
timestamp: Sun 2012-06-24 15:08:18 +0530
message:
  WL#6292 - Make TIMESTAMP columns nullable by default.
  
  This patch represents post-push fixes to address following issues:
  
  Change1) The following is done as part of Bug#14162406.
  #1: one valgrind issue visible with e.g rpl_udf,
  #2: rpl_wl6292 failed with mismatch in MTS mode.
  
  Fixed avoiding read deleted but not-nullified
  Slave_worker::info_thd (#1),
  correcting Slave_worker::set_rli_description_event() to match
  the Coordinator's branch logic (#2).
  
  Change2)
  * Do not show deprecation warning with --help option.
    This avoids extra warning displayed on every MTR run.
------------------------------------------------------------
revno: 3898 [merge]
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Sun 2012-06-24 11:07:58 +0400
message:
  Merge.
    ------------------------------------------------------------
    revno: 3690.68.49
    committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
    branch nick: mysql-trunk-push
    timestamp: Sat 2012-06-23 15:01:17 +0400
    message:
      WL6336
      
      Fixed field_long-t.
------------------------------------------------------------
revno: 3897
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Sat 2012-06-23 14:27:18 +0400
message:
  WL6336
  
  Fixed field_long-t.
------------------------------------------------------------
revno: 3896
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Sat 2012-06-23 10:10:16 +0400
message:
  WL#6216 - Changes to Server defaults in 5.6
  
  Fixed parts.partition-dml-1-11-innodb.
------------------------------------------------------------
revno: 3895 [merge]
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk-wl6216
timestamp: Fri 2012-06-22 15:28:15 +0400
message:
  Auto-merge from mysql-trunk.
    ------------------------------------------------------------
    revno: 3690.68.48 [merge]
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: trunk-wl6336.2
    timestamp: Fri 2012-06-22 15:24:19 +0400
    message:
      Auto-merge from trunk.
        ------------------------------------------------------------
        revno: 3690.71.1
        committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-22 16:45:37 +0530
        message:
          Disabling rpl_max_allowed_packet_stress test on all platforms.
------------------------------------------------------------
revno: 3894 [merge]
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk-wl6216
timestamp: Fri 2012-06-22 15:27:55 +0400
message:
  Auto-merge from mysql-trunk (WL#6336).
    ------------------------------------------------------------
    revno: 3690.68.47
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: trunk-wl6336.2
    timestamp: Fri 2012-06-22 14:15:43 +0400
    message:
      WL#6336: Code refactoring to change the way of checking for field's
      nullability.
      
      Follow-up patch: remove redundant static function
      field_in_record_is_null() from ha_federated.cc, ha_innodb.cc.
      Use Field::is_null_in_record() instead.
    ------------------------------------------------------------
    revno: 3690.68.46
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: trunk-wl6336.2
    timestamp: Fri 2012-06-22 14:11:31 +0400
    message:
      WL#6336: Code refactoring to change the way of checking for field's
      nullability.
      
      This patch hides access to the data member Field::null_ptr and replaces
      its references by the corresponding method calls.
------------------------------------------------------------
revno: 3893
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Fri 2012-06-22 14:10:42 +0400
message:
  Fix test cases after merging trunk to wl6216.
------------------------------------------------------------
revno: 3892 [merge]
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Thu 2012-06-21 18:22:07 +0400
message:
  Merge.
    ------------------------------------------------------------
    revno: 3690.68.45 [merge]
    committer: magnus.blaudd@oracle.com
    branch nick: trunk
    timestamp: Thu 2012-06-21 12:14:38 +0200
    message:
      Merge trunk-wl6004 -> trunk
        ------------------------------------------------------------
        revno: 3690.70.1
        committer: magnus.blaudd@oracle.com
        branch nick: trunk-wl6004
        timestamp: Wed 2012-06-20 11:19:32 +0200
        message:
          WL#6004 Server extension for allowing user tables to be put into transactional
          SE
           - Add new utility function close_acl_tables() used to commit and close
             the acl tables after reading
           - Add new utility function acl_trans_commit_and_close_tables() used to commit
             and close the acl tables after writing. The function will always try to
             commit since in memory structures have been modified. If the commit fails
             and writes are rollbacked, the memory structures are reloaded from tables
           - Pass flag to write_bin_log() telling if the changes are transactional or
             not and thus the binlog should wait for commit/rollback
           - Remove unused function check_acl_user()
    ------------------------------------------------------------
    revno: 3690.68.44
    committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
    branch nick: mysql-trunk-14156617
    timestamp: Thu 2012-06-21 13:50:01 +0400
    message:
      Fix for bug #14156617 "INPLACE ALTER: NOT SUPPORTED ALTER TABLE ...
      ADD PARTITION CAUSES CRASH".
      
      Attempt to add a new partition to a partitioned NDB table led to crash
      due to debug assertion in server built from mysql-trunk-cluster tree.
      This also caused ndb_partition_range test failures in this tree.
      
      The assertion failure occurred due to fact that prep_alter_part_table() 
      has added new partition partition_info object for TABLE instance 
      representing old version of table. Since NDB tables do not support 
      "fast" changes of partitioning, after that we tried to carry out 
      ALTER TABLE by copying data from old version of table to the new 
      version. As in the process we tried to use TABLE object with modified
      partition_info for reading data, which resulted in assertion failure 
      due to discrepancy between real table structure and its description
      in partition_info.
      
      This patch solves the problem by ensuring that we don't modify 
      partition_info object for TABLE instances representing old version
      of table in cases when "fast" changes of partitioning is not going 
      to be used. Instead we create a copy of partition_info, adjust it
      and use for .FRM/.PAR files creation. Unfortunately we can't easily 
      use this copy in all cases, since current "fast" partitioning API 
      assumes that changes to partitioning are communicated to it through 
      TABLE::part_info object.
      
      There is no test case as bug is not repeatable without NDB (and
      thus not repeatable in trunk) and mysql-trunk-cluster tree already 
      contains ndb_partition_range.test which provides test coverage for 
      this bug.
    ------------------------------------------------------------
    revno: 3690.68.43
    committer: viswanatham gudipati <viswanatham.gudipati@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-21 14:24:47 +0530
    message:
      WL5980: Added a perl for copying the zip file
    ------------------------------------------------------------
    revno: 3690.68.42 [merge]
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-21 11:47:56 +0300
    message:
      Merge mysql-trunk-wl6255 to mysql-trunk.
        ------------------------------------------------------------
        revno: 3829.1.184
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-21 08:16:34 +0300
        message:
          WL#6255 review fixes.
          
          Adjust the comments of row_merge_dup_t when it is not being used for
          detecting and reporting duplicates, but rather as a collection of
          data structures related to creating an index or rebuilding a table.
        ------------------------------------------------------------
        revno: 3829.1.183
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-21 00:15:14 +0300
        message:
          WL#6255 dead code removal.
          
          row_rec_to_index_entry(): Remove the constant parameter type=ROW_COPY_DATA.
        ------------------------------------------------------------
        revno: 3829.1.182
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-21 00:08:15 +0300
        message:
          WL#6255 dead code removal.
          
          prepare_inplace_alter_table_dict(): Remove the unreachable check for
          get_innobase_type_from_mysql_type() returning 0. It would do
          ut_error (abort) before doing that.
        ------------------------------------------------------------
        revno: 3829.1.181
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-21 00:05:50 +0300
        message:
          WL#6255 dead code removal.
          
          row_build(): When rebuilding a table, we always pass col_map[].
          Dropping columns requires a table rebuild, so it will suffice to check
          the col_map[] for any dropped columns.
        ------------------------------------------------------------
        revno: 3829.1.180
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-20 15:09:26 +0300
        message:
          Adjust index cardinality statistics calculation for WL#6255.
          
          Do not skip statistics calculation if the table is being rebuilt online.
          The outcome of the function dict_index_is_online_ddl() changes a bit in
          WL#6255. Before WL#6255, it could only hold for secondary indexes.
          After WL#6255, if dict_index_is_online_ddl() holds for a clustered index,
          it means that the table is fully accessible, but it is merely being rebuilt
          online and all changes to the table must be logged.
          
          Index cardinality statistics calculation does not modify the table.
          Therefore, it must continue "business as usual" for tables that happen
          to be subjected to online rebuild.
          
          This might have caused Valgrind warnings about reading uninitialized memory
          in main.innodb_icp_all.
        ------------------------------------------------------------
        revno: 3829.1.179
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-20 13:02:21 +0300
        message:
          WL#6255: Add a test case suggested by Jimmy Yang.
        ------------------------------------------------------------
        revno: 3829.1.178
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-20 12:32:24 +0300
        message:
          WL#6255 review fix: Clarify a comment.
        ------------------------------------------------------------
        revno: 3829.1.177
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-20 12:28:49 +0300
        message:
          Fix typos in comments.
        ------------------------------------------------------------
        revno: 3829.1.176
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-20 12:17:20 +0300
        message:
          WL#6255 review fix.
          
          innobase_table_flags(): Rename a local variable.
        ------------------------------------------------------------
        revno: 3829.1.175
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-20 12:14:45 +0300
        message:
          WL#6255 review fixes.
          
          btr_cur_pessimistic_delete(): Remove UNIV_LIKELY.
        ------------------------------------------------------------
        revno: 3829.1.174
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-20 11:31:57 +0300
        message:
          WL#6255 rb:1105 Problem 26 fix.
          
          trx_undo_prev_version_build(): Replace the assertion on table_id
          mismatch with a check. On table_id mismatch, assert that the table has
          been rebuilt by a transaction that started after the record version
          was written.
          
          This should be repeateable by a single connection thread, with enough
          purge lag:
          
          create table;
          lots_of_updates;
          alter table;
          begin;
          do_something;
          rollback; -- crashes
          
          Before WL#6255, we rebuilt the table using a DB_ROLL_PTR that looks
          like an insert. Those result in a DB_SUCCESS return from
          trx_undo_prev_version_build().
          
          WL#6255 is copying the DB_TRX_ID,DB_ROLL_PTR from the old table as is,
          so that it can detect which changes were already applied from the
          online rebuild log.
          
          The problem occurs when DB_ROLL_PTR is an update_undo record, and when
          the purge view has not yet advanced to the DB_TRX_ID that is stamped
          on the record. The undo log record is still valid, but it is pointing
          to the old table. Because the rebuild did not copy any history, and
          because the rolling-back transaction started after the rebuild, it is
          safe to pretend that the history was already purged. The purge will
          eventually happen. It will read the undo log records, figure out that
          the table_id has been dropped, and remove the undo log records without
          touching any tables.
          
          Approved by Jimmy Yang on IM.
        ------------------------------------------------------------
        revno: 3829.1.173
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 22:34:26 +0300
        message:
          WL#6255: Adjust innodb-multiple-tablespaces.test.
          
          In WL#6255, we do not attempt to remove a tablespace file if it is
          known to be missing. Adjust the test accordingly.
          
          Patch provided by Kevin Lewis.
        ------------------------------------------------------------
        revno: 3829.1.172 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 22:30:36 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.171
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 22:10:32 +0300
        message:
          WL#6255 rb:1105 Problem 34. Remove a bogus assertion.
          
          row_ins_duplicate_error_in_clust(): When applying the online rebuild log,
          this function can be invoked on a non-unique clustered index
          (after rb:1105 Problem 30 was fixed).
          Remove the now-bogus assertion.
        ------------------------------------------------------------
        revno: 3829.1.170
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 16:55:05 +0300
        message:
          WL#6255 memory leak fix.
          
          Free the indexed_table if a column is of incorrect name or type.
        ------------------------------------------------------------
        revno: 3829.1.169
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 16:08:58 +0300
        message:
          WL#6255: Re-enable online secondary index creation.
          
          If a table contained fulltext indexes, we did not allow online operation.
          We should only deny online rebuild in the presence of fulltext indexes.
          In secondary B-tree index creation, the fulltext indexes are not affected.
        ------------------------------------------------------------
        revno: 3829.1.168
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 14:46:43 +0300
        message:
          WL#6255 rb:1105 Problem 30.
          
          When rebuilding a table that has a generated clustered index (DB_ROW_ID),
          treat the DB_ROW_ID as a unique column when applying merged rows.
          
          row_ins_clust_index_entry_low(): Add the parameter n_uniq.
        ------------------------------------------------------------
        revno: 3829.1.167
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 13:56:28 +0300
        message:
          WL#6255 rb:1105 Problem 32.
          
          row_log_table_apply_update(): Do not pass col_map[] and friends to
          row_build(), because the record is already in the rebuilt table.
        ------------------------------------------------------------
        revno: 3829.1.166 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 12:39:04 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.165 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 11:38:47 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.164
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 11:06:57 +0300
        message:
          Do not trigger Bug#14213568 ASSERTION FAILURE IN RENAME TABLE
          AFTER DISCARD TABLESPACE
          
          This is needed so that an upcoming merge from mysql-trunk will pass tests.
        ------------------------------------------------------------
        revno: 3829.1.163
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-19 10:18:57 +0300
        message:
          Disable a test that triggers Bug#14213236.
        ------------------------------------------------------------
        revno: 3829.1.162
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-18 23:49:01 +0300
        message:
          Fix indentation.
        ------------------------------------------------------------
        revno: 3829.1.161
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-18 23:34:13 +0300
        message:
          WL#6255 review fixes. Adjust comments and simplify an #ifdef.
        ------------------------------------------------------------
        revno: 3829.1.160
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-18 23:32:06 +0300
        message:
          WL#6255 review fix: Correct a typo in a comment.
        ------------------------------------------------------------
        revno: 3829.1.159
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-18 23:29:16 +0300
        message:
          WL#6255 review fix: Adjust a comment.
        ------------------------------------------------------------
        revno: 3829.1.158
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-18 15:24:50 +0300
        message:
          WL#6255 rb:1105 Problem 28 fix.
          
          innobase_build_col_map(): Do not overwrite the FTS_DOC_ID mapping.
        ------------------------------------------------------------
        revno: 3829.1.157
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-15 15:37:19 +0300
        message:
          WL#6255: Avoid possible memory corruption.
          
          Ignore auto_increment_offset when adding an AUTO_INCREMENT column.
          
          innobase_build_col_map(): Do not write to altered_table->s->field[].
          This means that we will use the default value of the column as the
          initial value for the AUTO_INCREMENT counter.
        ------------------------------------------------------------
        revno: 3829.1.156
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-15 15:34:58 +0300
        message:
          WL#6255 FULLTEXT fix.
          
          Adjust the test case to the change of innobase_fts_check_doc_id_index().
          Now we do support renaming a column to FTS_DOC_ID together with
          creating a fulltext index.
          
          fts_get_max_doc_id(): Remove a now-bogus debug assertion that
          the column name must be FTS_DOC_ID. It can be different in the internal
          dictionary during ALTER TABLE.
        ------------------------------------------------------------
        revno: 3829.1.155
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-15 15:17:49 +0300
        message:
          WL#6255 FULLTEXT fixes.
          
          Disallow online table rebuild if the table contains fulltext indexes.
          Fix a bug where we would create a duplicate hidden FTS_DOC_ID_INDEX.
          
          innobase_fts_check_doc_id_index(): Use altered_table instead of
          ha_alter_info. We need to consider all keys of the new table,
          including ones that were not added in the rebuild operation.
          
          prepare_inplace_alter_table_dict(): Require locked operation if
          innobase_fulltext_exist().
        ------------------------------------------------------------
        revno: 3829.1.154
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-15 14:09:30 +0300
        message:
          WL#6255 rb:1105 Problem 2 (fts_parallel_tokenization).
          
          ha_innobase::check_if_supported_inplace_alter(): Disable online creation
          of full-text indexes.
        ------------------------------------------------------------
        revno: 3829.1.153 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-15 12:50:56 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.152
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-15 12:44:11 +0300
        message:
          WL#6255 memory leak fix.
          
          row_fts_psort_info_init(): Note that "dup" changes ownership.
          
          row_fts_psort_info_destroy(): Free "dup".
        ------------------------------------------------------------
        revno: 3829.1.151
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-14 23:12:35 +0300
        message:
          WL#6255 rb:1105 Problem 18 ut_a(prebuilt->table->n_ref_count == 1)
          
          row_purge_record_func(): Even if the record cannot be purged,
          close the table handle.
        ------------------------------------------------------------
        revno: 3829.1.150
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-14 11:09:06 +0300
        message:
          WL#6255 cleanup: Remove dict_table_is_online_rebuild().
        ------------------------------------------------------------
        revno: 3829.1.149
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-14 09:49:28 +0300
        message:
          WL#6255 rb:1105 Problem 25 (memory corruption) fix.
          
          row_ins_sec_index_entry_low(): Pass offsets_heap to the B-tree functions.
          Otherwise, the dtuple_t* entry could be freed and overwritten in
          btr_page_split_and_insert(), which invokes mem_heap_empty().
        ------------------------------------------------------------
        revno: 3829.1.148
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-13 23:22:44 +0300
        message:
          WL#5526 rb:1105 Problem 24 fix.
          
          innobase_rec_to_mysql(): If col_map[] maps a column outside 0..n_fields-1,
          skip the column.
        ------------------------------------------------------------
        revno: 3829.1.147
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-13 23:05:21 +0300
        message:
          row_log_table_delete(): Check errors from row_log_table_get_pk().
        ------------------------------------------------------------
        revno: 3829.1.146
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-13 23:03:45 +0300
        message:
          row_merge_insert_index_tuples(): Add ut_ad(trx_id),
          in an attemp to track down why there was a secondary index with
          only one record in the only (root) page, with PAGE_MAX_TRX_ID=0.
        ------------------------------------------------------------
        revno: 3829.1.145
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-13 16:24:13 +0300
        message:
          WL#6255 race condition fix.
          
          rollback_inplace_alter_table(): Free the online log before
          dropping the table that was being rebuilt. Otherwise, DML threads
          could access the freed table object in row_log_table_get_pk()
          and possibly elsewhere.
        ------------------------------------------------------------
        revno: 3829.1.144 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-13 15:15:15 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.143
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-13 15:04:14 +0300
        message:
          WL#6255: Bug fix for ADD PRIMARY KEY error reporting.
          
          row_log_table_get_pk(): When flagging the error, use the online_log
          of the clustered index of the old table. We used to dereference the
          NULL pointer new_index->online_log.
        ------------------------------------------------------------
        revno: 3829.1.142
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-13 14:52:27 +0300
        message:
          WL#6255 Fix mtr --embedded innodb.innodb-alter-autoinc failure.
          
          thd_get_autoinc(): New THD accessor function.
          
          ha_innobase_inplace_ctx: Add autoinc_inc.
          
          prepare_inplace_alter_table_dict(): Do not access THD::variables directly,
          but use thd_get_autoinc() instead. Some fields in THD are not present
          in the embedded library. This caused the embedded test failure.
        ------------------------------------------------------------
        revno: 3829.1.141
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-13 00:03:41 +0300
        message:
          WL#6255 assertion failure fix
          
          innobase_rec_to_mysql(): In the assertion about n_fields, subtract
          one from index->table->n_cols when the table contains a hidden
          FTS_DOC_ID column.
        ------------------------------------------------------------
        revno: 3829.1.140
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-12 23:36:14 +0300
        message:
          WL#6255 rb:1105 Problem 20,21 fix.
          
          Check the maximum column prefix length when changing ROW_FORMAT or
          KEY_BLOCK_SIZE.
          
          innobase_check_column_length(): Replace table with max_col_len.
          
          ha_innobase::prepare_inplace_alter_table(): Compute max_col_len
          by invoking innobase_table_flags() when needed. Enforce the max_col_len
          also in existing indexes of the table.
          
          innobase_table_flags(): Remove the parameter name. Do not complain
          about badly formed FTS_DOC_ID_INDEX, unless the table is also to have
          FULLTEXT indexes. When complaining, use the dedicated error code
          ER_INNODB_FT_WRONG_DOCID_INDEX instead of the generic and misleading
          ER_WRONG_NAME_FOR_INDEX.
          
          prepare_inplace_alter_table_dict(): Add the parameters flags, flags2,
          so that innobase_table_flags() does not need to be invoked again. Its
          outcome can change if innodb_file_format is changed between calls.
        ------------------------------------------------------------
        revno: 3829.1.139
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-12 22:01:48 +0300
        message:
          row_log_table_apply_convert_mrec(): The clustered index tree of the
          source table should already be X-latched in row_log_table_apply().
        ------------------------------------------------------------
        revno: 3829.1.138
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-12 21:44:03 +0300
        message:
          innobase_create_index_field_def(): Remove unused parameter heap.
        ------------------------------------------------------------
        revno: 3829.1.137
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-12 12:49:48 +0300
        message:
          WL#6255 Portability fix. Use ut_snprintf instead of my_snprintf(),
          so that UINT64PF will work as desired on Windows platforms.
        ------------------------------------------------------------
        revno: 3829.1.136
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-12 12:01:32 +0300
        message:
          WL#6255 BLOB bug fix (part 1 of 2).
          
          When rebuilding a table online, check if the creating transaction of the
          record was rolled back, while holding an S-latch on the original clustered
          index tree of the table. Holding the tree latch will prevent other threads
          from freeing any off-page columns.
          
          TODO: When creating a secondary index online, prevent purge from freeing
          externally stored columns, and keep track on rolled-back inserts.
          
          row_log_table_apply_convert_mrec(): Add the parameter trx_id for performing
          the row_log_table_is_rollback() check. Return NULL and *error=DB_SUCCESS
          if the record has been rolled back. If the record contains off-page columns,
          S-latch the clustered index of the original table.
          
          row_log_table_apply_insert(), row_log_table_apply_update(): Add the
          parameter trx_id for performing the row_log_table_is_rollback() check.
          Allow row_log_table_apply_convert_mrec() to return NULL when there is
          no error, but the transaction has been rolled back.
          
          row_log_table_apply_op(): Remove the row_log_table_is_rollback() calls.
          
          row_merge_insert_index_tuples(): When the record contains off-page columns,
          protect the BLOB fetch by clustered index S-latch when rebuilding table,
          and by re-checking if the transaction was rolled back.
        ------------------------------------------------------------
        revno: 3829.1.135
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-12 10:23:40 +0300
        message:
          Fix WL#6255 rb:1105 Problem 15.
          
          innobase_col_to_mysql(): Skip DATA_BLOB fields.
          The pointer can become invalid by the time it is dereferenced
          in handler::print_keydup_error().
          
          innobase_rec_to_mysql(): Skip externally stored fields.
        ------------------------------------------------------------
        revno: 3829.1.134
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-11 23:00:51 +0300
        message:
          Fix WL#6255 rb:1105 Problem 14.
          
          row_log_table_apply_op(): Invoke rec_offs_set_n_fields() before
          recomputing offsets. This omission caused offsets to be computed on
          an index prefix only.
          
          row_log_table_apply_ops(): Allocate enough space for offsets, in case
          new_index->n_uniq + 2 exceeds index->n_fields.
        ------------------------------------------------------------
        revno: 3829.1.133
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-11 15:40:23 +0300
        message:
          WL#6255 bug fix for applying buffered delete with ADD PRIMARY KEY.
          
          row_log_table_apply_delete(): Remove the parameter trx_id_col.
          Rename new_trx_id_col to trx_id_col. In the buffered record, we have
          the PRIMARY KEY columns as they appear in the new table.
          Thus, the structure of the old clustered index records is irrelevant.
          
          This addresses rb:1105 Problem 12.
        ------------------------------------------------------------
        revno: 3829.1.132
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-11 15:15:03 +0300
        message:
          Attempt to fix WL#6255 rb:1105 Problem 9,11,13.
          
          row_log_table_apply_update(): Add a missing mtr_commit() call.
        ------------------------------------------------------------
        revno: 3829.1.131
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-11 14:29:27 +0300
        message:
          Silence some compiler warnings.
        ------------------------------------------------------------
        revno: 3829.1.130 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-11 14:23:25 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.129
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-11 13:56:08 +0300
        message:
          WL#6255 fixes for ADD COLUMN...AUTO_INCREMENT
          
          ha_innobase::check_if_supported_inplace_alter(): Add a local variable
          for checking if the operation can be performed online (LOCK=NONE) or not.
          An AUTO_INCREMENT column or a FTS_DOC_ID column can only be added while
          the table is being locked.
          
          ha_innobase_inplace_ctx: Add the member add_autoinc, to indicate the
          position of an added AUTO_INCREMENT column.
          
          innobase_build_col_map(): Add the parameter autoinc_val, for specifying the
          default value of an auto-increment column.
          
          prepare_inplace_alter_table_dict(): Add the parameter add_autoinc_col,
          to identify an added AUTO_INCREMENT column.
          
          row_merge_build_indexes(), row_merge_read_clustered_index(): Add the
          parameters add_autoinc, autoinc_inc.
        ------------------------------------------------------------
        revno: 3829.1.128
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-08 11:44:56 +0300
        message:
          innobase_create_temporary_tablename(): Use table_id as the unique part.
        ------------------------------------------------------------
        revno: 3829.1.127 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-08 11:20:05 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.126
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-08 00:13:06 +0300
        message:
          Adjust test results for duplicate key error reporting on rebuilt table.
        ------------------------------------------------------------
        revno: 3829.1.125
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-07 17:31:32 +0300
        message:
          WL#6255: Adjust main.mdl_sync, now that ADD COLUMN is in-place by default.
        ------------------------------------------------------------
        revno: 3829.1.124
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-07 17:27:19 +0300
        message:
          WL#6255: Fix error reporting for ADD/DROP/reorder column.
          
          cmp_rec_rec_simple(), innobase_rec_to_mysql(): Add an optional col_map
          parameter.
          
          ha_innobase::inplace_alter_table(): When reporting a duplicate key
          error while rebuilding the table, use the primary key of the old table
          for reporting the duplicate row.
          
          row_merge_dup_t: Add an optional col_map[] member.
          
          fts_psort_common_t, row_fts_psort_info_init(), row_merge_sort(),
          row_merge_blocks(), row_merge(): Replace dict_index_t*, TABLE* with
          row_merge_dup_t*, which contains these and col_map[].
          
          innodb-alter-autoinc.test: Trigger duplicate key errors on table
          rebuild, both with and without an existing PRIMARY KEY.
        ------------------------------------------------------------
        revno: 3829.1.123
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-07 17:02:31 +0300
        message:
          Use ALGORITHM=COPY for adding an AUTO_INCREMENT column,
          because InnoDB does not assign AUTO_INCREMENT values
          when rebuilding table. (We could theoretically do that,
          and refuse online rebuild, that is, LOCK=NONE.)
        ------------------------------------------------------------
        revno: 3829.1.122 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-06-07 08:26:31 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.121
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-06 19:39:22 +0300
        message:
          WL#6255 rb:1105 Problem 6:
          
          Skip online rebuild log apply on fulltext indexes.
        ------------------------------------------------------------
        revno: 3829.1.120
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-06 19:05:45 +0300
        message:
          WL#6255 FTS_DOC_ID safety changes.
          
          ha_innobase::check_if_supported_inplace_alter(): Do not support inplace
          DDL operations that involve dropping or renaming FTS_DOC_ID or dropping
          FTS_DOC_ID_INDEX when FULLTEXT indexes are supposed to survive the operation.
        ------------------------------------------------------------
        revno: 3829.1.119
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-06 15:07:50 +0300
        message:
          WL#5534 extension: Add FIELD_IS_DROPPED for indicating DROP COLUMN.
          
          fill_alter_inplace_info(): Initialize FIELD_IS_DROPPED in the same
          loop as FIELD_IS_RENAMED.
          
          Approved by Jon Olav Hauglid on IM.
        ------------------------------------------------------------
        revno: 3829.1.118
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-06 12:35:01 +0300
        message:
          WL#5526 bug fixes.
          
          prepare_inplace_alter_table_dict(),
          ha_innobase::prepare_inplace_alter_table(): Do not invoke fts_create()
          until it is really needed.
          
          rollback_inplace_alter_table(): If a full-text index does not survive the
          rollback, invoke fts_free().
        ------------------------------------------------------------
        revno: 3829.1.117
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-06-06 00:39:21 +0300
        message:
          WL#6255 cleanup and fix for ADD COLUMN b, ADD PRIMARY KEY (a, c)
          
          row_log_t: Add add_cols, col_map.
          
          row_log_allocate(): Add the parameters add_cols, col_map.
          
          row_log_table_apply(), row_log_table_apply_ops(): Remove the
          parameters add_cols, col_map.
          
          row_log_table_apply_convert_mrec(), row_log_table_apply_insert(),
          row_log_table_apply_update(): Replace the parameters add_cols,
          col_map, new_table with row_log_t log.
          
          row_log_table_apply_op(): Remove the parameters new_table, add_cols,
          col_map.
          
          row_log_table_get_pk(): Map added and reordered columns.
          
          ha_innobase::check_if_supported_inplace_alter(): Initialize key_part->field
          to table->field[], or to altered_table->field[] for ADD COLUMN.
        ------------------------------------------------------------
        revno: 3829.1.116
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-05 17:36:08 +0300
        message:
          Adjust main.alter_table for ADD COLUMN.
        ------------------------------------------------------------
        revno: 3829.1.115
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-05 17:32:32 +0300
        message:
          WL#6255 ALTER_ADD_COLUMN (ALTER TABLE ... ADD COLUMN)
          
          innobase_build_col_map_add(): Convert a default value of an ADD COLUMN
          to the InnoDB format.
          
          ha_innobase_inplace_ctx(): Add add_cols.
          
          innobase_build_col_map(), row_merge_build_indexes(),
          row_log_table_apply(), row_build(), row_log_table_apply_convert_mrec(),
          row_log_table_apply_insert(), row_log_table_apply_update(),
          row_log_table_apply_op(), row_log_table_apply_ops(),
          row_merge_read_clustered_index(): Add the parameter add_cols.
          
          prepare_inplace_alter_table_dict(): When rebuilding a table, make it a
          *.ibd file if the original table was in an *.ibd file, or if
          innodb_file_per_table=1.
        ------------------------------------------------------------
        revno: 3829.1.114
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-05 14:52:59 +0300
        message:
          Add some const qualifiers to Field::is_null methods.
        ------------------------------------------------------------
        revno: 3829.1.113
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-05 11:55:18 +0300
        message:
          Fix a typo in a test name.
        ------------------------------------------------------------
        revno: 3829.1.112
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-05 10:57:31 +0300
        message:
          mem_heap_free_heap_top(): Enable validation checks in UNIV_DEBUG.
        ------------------------------------------------------------
        revno: 3829.1.111
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-05 10:28:28 +0300
        message:
          WL#6255 DROP COLUMN: Test FOREIGN KEY checks.
        ------------------------------------------------------------
        revno: 3829.1.110
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-05 10:24:15 +0300
        message:
          WL#5526 bug fix for failed DROP INDEX
          
          When an ALTER TABLE that involves DROP INDEX fails, clear the
          index->to_be_dropped flags. This bug was mostly affecting failed
          table rebuild (before WL#6255, ADD PRIMARY KEY) that also involved
          dropping indexes.
          
          prepare_inplace_alter_table_dict(),
          ha_innobase::prepare_inplace_alter_table(): On failure, clear the
          to_be_dropped flags.
          
          rollback_inplace_alter_table(): Always clear the to_be_dropped flags.
          Allow the function to be invoked in every case, not only to roll back
          secondary index creation.
          
          ha_innobase::commit_inplace_alter_table(): Always invoke
          rollback_inplace_alter_table() to roll back changes. Clear the
          index->to_be_dropped flags on the old table when the table was
          rebuilt. Assert at the end that no index->to_be_dropped flag is set.
        ------------------------------------------------------------
        revno: 3829.1.109
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-05 07:48:00 +0300
        message:
          Add some debug assertions.
        ------------------------------------------------------------
        revno: 3829.1.108
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-06-05 00:47:44 +0300
        message:
          WL#6255 ALTER_COLUMN_ORDER and DROP_COLUMN (DROP COLUMN and column reorder)
          
          ha_innobase_inplace_ctx(): Add col_map for mapping old column numbers
          to new ones when rebuilding a table.
          
          innobase_build_col_map(): Map old column numbers to new ones. Dropped
          columns are indicated by ULINT_UNDEFINED.
          
          prepare_inplace_alter_table_dict(): Invoke innobase_build_col_map()
          whenever rebuilding the table.
          
          row_log_table_apply(), row_merge_build_indexes(), row_build(),
          row_log_table_apply_convert_mrec(), row_log_table_apply_insert(),
          row_log_table_apply_update(), row_log_table_apply_op(),
          row_log_table_apply_ops(), row_merge_build_indexes(): Add the
          parameter col_map.
          
          row_merge_buf_add(): Remove the tweaks for FTS_DOC_ID. They will now
          be handled by the col_map.
          
          row_merge_read_clustered_index(): Add the parameter col_map.  Remove
          the array nullable[]. No longer tweak the DATA_NOT_NULL field of the
          row tuple, because it will have been set up in row_build().
        ------------------------------------------------------------
        revno: 3829.1.107
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-04 23:57:17 +0300
        message:
          fts_get_doc_id_from_rec(): Remove an unnecessary cast and add assertions.
        ------------------------------------------------------------
        revno: 3829.1.106
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-04 14:19:47 +0300
        message:
          Crank up Valgrind instrumentation.
          
          dtuple_create_from_mem(): Add Valgrind instrumentation for tuple->fields.
          dtuple_create(): Remove the Valgrind instrumentation.
        ------------------------------------------------------------
        revno: 3829.1.105
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-04 13:53:43 +0300
        message:
          WL#6255 bug fix: Disallow online addition of a hidden FTS_DOC_ID.
          
          If FTS_DOC_ID is being explicitly added or renamed by the user,
          that is OK, because the column is supposed to be unique already.
        ------------------------------------------------------------
        revno: 3829.1.104
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-06-04 13:47:06 +0300
        message:
          Remove a test demonstrating Bug#14145138,
          because the inconsistency breaks other tests.
        ------------------------------------------------------------
        revno: 3829.1.103
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Sun 2012-06-03 19:46:12 +0300
        message:
          WL#6255 cleanup in row0*.cc: Remove unused parameter altered_table.
        ------------------------------------------------------------
        revno: 3829.1.102
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Sat 2012-06-02 23:02:51 +0300
        message:
          WL#6255 clean-up.
          
          innobase_convert_tablename(): Replace with innobase_convert_name().
        ------------------------------------------------------------
        revno: 3829.1.101
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Sat 2012-06-02 22:49:05 +0300
        message:
          WL#6255 cleanup.
          
          innobase_create_temporary_tablename(): Generate MySQL-style temporary names
          when rebuilding a table, instead of the #1 and #2 table-name suffixes.
          Remove innobase_convert_tablename() conversions for the temporary names.
          
          Pass the error code instead of trx->error_state (which would be DB_SUCCESS)
          to my_error_innodb().
          
          row_merge_rename_tables(): Add DBUG_EXECUTE_IF error injection.
        ------------------------------------------------------------
        revno: 3829.1.100
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-01 23:14:22 +0300
        message:
          Fix innodb.innodb-index failure on the embedded server.
        ------------------------------------------------------------
        revno: 3829.1.99 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-01 22:17:00 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.98
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-01 14:37:55 +0300
        message:
          Remove duplicate DROP_INDEX flag.
        ------------------------------------------------------------
        revno: 3829.1.97
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-01 14:34:20 +0300
        message:
          WL#6255 ALTER_COLUMN_NOT_NULLABLE (MODIFY a column to be NOT NULL)
          
          Rename DB_PRIMARY_KEY_IS_NULL to DB_INVALID_NULL, mapped to
          ER_INVALID_USE_OF_NULL.
          
          innobase_check_foreigns_low(), innobase_check_foreigns(): Check if a
          column that is beind dropped (not yet implemented) or set to NOT NULL
          is needed by a FOREIGN KEY constraint, or by a FOREIGN KEY constraint
          that includes a SET NULL action.
          
          prepare_inplace_alter_table_dict(): Add the parameter old_table.
          
          row_log_table_apply_convert_mrec(): Return an error if the conversion
          fails. Currently, the only error is DB_INVALID_NULL.
        ------------------------------------------------------------
        revno: 3829.1.96
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-01 12:15:26 +0300
        message:
          Bug#14145138 work-around for WL#5545 ALTER_COLUMN_NAME (rename column).
          
          When a table contains or is referenced by FOREIGN KEY constraints, and
          the table is rebuilt (ADD PRIMARY KEY or otherwise) while renaming
          columns, the columns were not renamed in the FOREIGN KEY constraints.
          This would cause an implicit DROP TABLE (Bug#14145138), because the
          dict_load_foreigns() call in row_merge_rename_tables() would fail.
          
          This fix does not address Bug#14145138, it just prevents one scenario
          leading to it.
          
          innobase_rename_column(): Add the parameter new_clustered, so that
          column names in FOREIGN KEY constraints can be renamed when rebuilding
          a table. Previously, we only renamed columns if the table was not being
          rebuilt.
          
          innobase_rename_columns(): New function, to invoke
          innobase_rename_column() on all renamed columns. Invoke this also when
          rebuilding a table (new_clustered==true).
        ------------------------------------------------------------
        revno: 3829.1.95
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-01 12:13:44 +0300
        message:
          Remove dependence on TABLE_ID in innodb-alter-nullable.test.
        ------------------------------------------------------------
        revno: 3829.1.94
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-01 11:03:46 +0300
        message:
          Enable ALTER TABLE info in a test.
          
          Add a test case that demonstrates an inconsistency in WL#6251.
        ------------------------------------------------------------
        revno: 3829.1.93
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-06-01 10:21:22 +0300
        message:
          WL#6255 test for ALTER_COLUMN_NULLABLE (MODIFY...NULL)
        ------------------------------------------------------------
        revno: 3829.1.92
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-31 22:22:36 +0300
        message:
          WL#6255 On-line ALTER TABLE...MODIFY...NULL
          
          Support Alter_inplace_info::ALTER_COLUMN_NULLABLE.
          
          row_log_table_apply_convert_mrec(): Convert the DATA_NOT_NULL flag.
          Add a TODO comment for MODIFY...NOT NULL.
          
          row_merge_read_clustered_index(): Add an nullable[] array in addition
          to nonnull[]. Adjust the DATA_NOT_NULL flag as needed.
        ------------------------------------------------------------
        revno: 3829.1.91
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-31 21:22:12 +0300
        message:
          Fix race condition in InnoDB transaction commit flushing.
          
          trx_flush_log_if_needed_low(), trx_flush_log_if_needed():
          Refactored common code. Read srv_flush_log_at_trx_commit only once.
          Previously, a race condition could occur if srv_flush_log_at_trx_commit
          changed during the checks.
          
          trx_commit(), trx_prepare(), trx_commit_complete_for_mysql():
          Invoke trx_flush_log_if_needed() instead of duplicating the code.
        ------------------------------------------------------------
        revno: 3829.1.90
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-31 16:27:23 +0300
        message:
          WL#6255: Fix a bug that affected ROW_FORMAT conversions
          of tables that contain fulltext indexes.
          
          innobase_create_key_defs(): Test for "rebuild" instead of "new_primary".
        ------------------------------------------------------------
        revno: 3829.1.89
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-31 16:11:55 +0300
        message:
          WL#5223 bug fix.
          
          trx_commit_complete_for_mysql(): Read srv_flush_log_at_trx_commit only once
          in the function, because it may change while the function is executing.
        ------------------------------------------------------------
        revno: 3829.1.88
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-31 15:42:40 +0300
        message:
          WL#6255 duplicate key error reporting
          
          When an error occurs during online rebuild apply, convert the buffered row
          into the MySQL record buffer, so that it can be used in error messages,
          such as duplicate key error.
          
          row_log_table_apply_insert(), row_log_table_apply_update(): Invoke
          innobase_rec_to_mysql() on error.
          
          When delete fails, we will not invoke the conversion, because the buffered
          record contains the PRIMARY KEY in the new table, which could differ from
          the old table (different columns).
        ------------------------------------------------------------
        revno: 3829.1.87 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-31 13:24:47 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.86
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-31 13:05:50 +0300
        message:
          WL#6255 latching order bug fix.
          
          row_ins_sec_index_entry_low(): Move the log_free_check() to the caller,
          row_ins_sec_index_entry(). In online rebuild log apply, we are holding
          an X-latch on the clustered index tree of the old table most of the time,
          and must do the log_free_check() when not holding the latch.
        ------------------------------------------------------------
        revno: 3829.1.85
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-31 13:03:13 +0300
        message:
          WL#6255: Remove nondeterminism from innodb-table-online.test.
        ------------------------------------------------------------
        revno: 3829.1.84 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-31 11:55:37 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl6255.
        ------------------------------------------------------------
        revno: 3829.1.83
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 23:09:51 +0300
        message:
          WL#6255 bogus assertion fix.
          
          row_log_table_apply_update() can specify BTR_KEEP_POS_FLAG with all the
          usual online flags. Allow it in the assertions in btr0cur.cc.
        ------------------------------------------------------------
        revno: 3829.1.82
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 22:48:37 +0300
        message:
          WL#6255 MVCC bug fix: Ensure that older transactions are denied access
          to a table that has been rebuilt, whether or not it happened in-place
          (ALGORITHM=INPLACE) or in the old way (ALGORITHM=COPY).
          
          When a table is created, we record the trx_id of the creating data
          dictionary transaction in each index of the table in the data dictionary
          cache. In this way, transactions that were started before the table
          creation (or copying) can be denied access to the new table.
          
          To be exact, there are two transactions involved in DDL. One is the
          user transaction associated with the MySQL client connection. For
          InnoDB data dictionary operations, we create a data dictionary transaction.
          Theoretically, other transactions could start between the prebuilt->trx
          and the dictionary trx. However, the table cannot be modified during this
          time frame, thanks to a meta-data lock (MDL). In CREATE TABLE, the table
          does not exist before InnoDB returns, and in ALTER TABLE, other transactions
          are blocked from accessing the table while the table copy is being set up.
          
          dict_create_index_step(): Initialize index->trx_id, so that older
          transactions will be denied access to a newly created table.
          
          ha_innobase::commit_inplace_alter_table(): Remove the adjustment of
          index->trx_id for ALGORITHM=INPLACE.
        ------------------------------------------------------------
        revno: 3829.1.81
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 22:44:34 +0300
        message:
          WL#6255 bug fix: Relax a bogus debug assertion.
          
          btr_page_split_and_insert(): This function can be invoked during
          online secondary index creation when loading the created index.
        ------------------------------------------------------------
        revno: 3829.1.80
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 15:54:44 +0300
        message:
          WL#6255: Fix the online rebuild logging of ROW_FORMAT=REDUNDANT tables.
          
          Move some accessor function prototypes and #defines from rem0rec.ic
          to rem0rec.h.
          
          rec_2_is_field_extern(): Determine if a field is stored externally.
          
          row_log_table_low_redundant(): Like row_log_table_low(), but for
          ROW_FORMAT=REDUNDANT records. Convert the rec_t to a dtuple_t and
          then to the rebuild log format. Add some assertions.
        ------------------------------------------------------------
        revno: 3829.1.79
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 15:40:40 +0300
        message:
          btr_page_split_and_insert(): Do not release the index tree X-latch
          when the table is being rebuilt online.
        ------------------------------------------------------------
        revno: 3829.1.78
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 14:23:26 +0300
        message:
          WL#6255 refactoring (non-functional change):
          
          row_log_table_low(): Common function for row_log_table_update()
          and row_log_table_insert().
        ------------------------------------------------------------
        revno: 3829.1.77
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 13:32:17 +0300
        message:
          WL#6255 online table rebuild.
          
          Enable the functionality, add and adjust tests.
          
          TODO: Correct the online logging for ROW_FORMAT=REDUNDANT records.
          TODO: Properly report duplicate key values when applying the online log.
          
          ha_innobase::check_if_supported_inplace(): Remove the return value
          HA_ALTER_INPLACE_SHARED_LOCK.
        ------------------------------------------------------------
        revno: 3829.1.76
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 13:13:37 +0300
        message:
          WL#6255: Silence a Valgrind warning.
          
          row_log_allocate(): Initialize log->trx_rb.
        ------------------------------------------------------------
        revno: 3829.1.75
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 12:56:43 +0300
        message:
          WL#6255: When rebuilding a table, tolerate discarded or missing tablespaces.
          
          dict_table_rename_in_cache(): Do not attempt to rename missing
          tablespace files.
          
          row_drop_table_for_mysql(): Do not attempt to drop missing files.
        ------------------------------------------------------------
        revno: 3829.1.74
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 11:21:21 +0300
        message:
          WL#6255 refactoring.
          
          row_ins_duplicate_error_in_clust(): In online table rebuild,
          if the PRIMARY KEY,DB_TRX_ID,DB_ROLL_PTR match with the record,
          return the special status code DB_SUCCESS_LOCKED_REC.
          
          row_log_table_apply_insert_low(): If the record already existed
          in the clustered index, return DB_SUCCESS.
        ------------------------------------------------------------
        revno: 3829.1.73
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 11:18:06 +0300
        message:
          WL#6255 refactoring of record comparison.
          
          cmp_dtuple_rec_with_match_low(): Renamed from cmp_dtuple_rec_with_match().
          Add the parameter n_cmp, to override dtuple->n_fields_cmp.
          
          cmp_dtuple_rec_with_match(): A macro wrapper for the above.
          
          cmp_debug_dtuple_rec_with_match(): Add the parameter n_cmp.
        ------------------------------------------------------------
        revno: 3829.1.72
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-30 09:52:48 +0300
        message:
          WL#6255 bug fix.
          
          row_tab_op: Use more distinguishable values for the operation codes,
          so that it is easier to inspect the buffered data.
          
          row_log_table_apply_op(): Fix a bug in ROW_T_UPDATE parsing when
          the definition of the PRIMARY KEY is changed.
        ------------------------------------------------------------
        revno: 3829.1.71
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 23:05:44 +0300
        message:
          WL#6255: Remove one more bogus assertion on table->n_ref_count.
        ------------------------------------------------------------
        revno: 3829.1.70
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 22:59:10 +0300
        message:
          WL#6255 bug fixes.
          
          row_log_table_delete(), row_log_table_update(): Interpret new_pk in
          new_index, not in the clustered index of the old table definition.
          
          row_log_table_apply_delete(), row_log_table_apply_update(),
          row_log_table_apply_op(): Add the parameter new_trx_id_col.
        ------------------------------------------------------------
        revno: 3829.1.69
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 22:05:13 +0300
        message:
          WL#6255 bug fix.
          
          ha_innobase::inplace_alter_table(): Remove a bogus debug assertion on
          prebuilt->table->n_ref_count and explain why it became bogus.
        ------------------------------------------------------------
        revno: 3829.1.68
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 22:03:06 +0300
        message:
          WL#6255 bug fixes.
          
          row_log_table_apply_update(): Correct assertions and documentation on old_pk.
          
          row_log_table_apply_op(): Parse and initialize old_pk in the same way as in
          row_log_table_update().
        ------------------------------------------------------------
        revno: 3829.1.67
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 21:36:27 +0300
        message:
          WL#6255 bug fixes.
          
          prepare_inplace_alter_table_dict(): Pass the same_pk flag correctly to
          row_log_allocate().
          
          ha_innobase::inplace_alter_table(): Relax an assertion on
          table->n_ref_count. A table that is being rebuilt online can be accessed.
        ------------------------------------------------------------
        revno: 3829.1.66
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 21:18:03 +0300
        message:
          WL#6255 bug fixes
          
          row_log_table_update(): Correct debug assertions about old_pk.
          Fix logging errors.
          
          row_log_table_get_pk(): Initialize the return value.
        ------------------------------------------------------------
        revno: 3829.1.65
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 17:24:19 +0300
        message:
          WL#6255 bug fix
          
          row_ins_clust_index_entry_low(): Initialize rec for online logging.
        ------------------------------------------------------------
        revno: 3829.1.64
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 17:16:08 +0300
        message:
          WL#6255 online table rebuild: Online log apply.
          
          The online table rebuild will be enabled in the interface in a
          subsequent commit.
          
          prepare_inplace_alter_table_dict(): Allocate the online rebuild log if
          needed.
          
          ha_innobase::inplace_alter_table(): Apply the bulk of the online
          rebuild log while not holding (m)any locks.
          
          innobase_online_rebuild_log_free(): New function, for freeing the
          online rebuild log. Called from rollback_inplace_alter_table()
          and ha_innobase::commit_inplace_alter_table().
          
          ha_innobase::commit_inplace_alter_table(): Apply and free the online
          rebuild log. Prevent old transactions from accessing the rebuilt
          table, because the history is missing. (This bug has been present
          since the InnoDB Plugin in MySQL 5.1.)
          
          row_log_table_apply_convert_mrec(): Auxiliary function for converting
          a log record on the clustered index record of the old table into a row
          tuple of the rebuilt table. (TODO: implement ADD COLUMN, DROP COLUMN
          and others.)
          
          row_log_table_apply(), row_log_table_apply_ops(), row_log_table_apply_op(),
          row_log_table_apply_insert_low(), row_log_table_apply_insert(),
          row_log_table_apply_delete_low(), row_log_table_apply_delete(),
          row_log_table_apply_update(): Apply the online rebuild log.
          
          row_merge_skip_rec(): Determine if a row should be skipped during
          online table rebuild. Rolled-back records will be skipped.
          
          row_merge_read_clustered_index(): Relax assertions. Check if an error
          has occurred during online table rebuild.
          
          row_merge_copy_blobs(): Non-functional changes.
          
          row_merge_insert_index_tuples(): Replace zip_size with old_table,
          so that row_merge_skip_rec() can be called.
          
          row_merge_drop_indexes(): Add debug assertions. This function should
          not be called during online table rebuild (the entire table should be
          dropped instead).
          
          row_merge_build_indexes(): Add the parameter altered_table, so that
          rows can be converted for dropping, adding or reordering columns (not
          implemented yet). Adjust assertions and conditions.
        ------------------------------------------------------------
        revno: 3829.1.63
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 16:33:30 +0300
        message:
          WL#6255 DML logging. This does not yet enable online table rebuild.
          The functions for applying the log are part of a separate change.
          
          In online table rebuild, we will not copy any delete-marked rows or
          any history to the new table. Anything that is delete-marked will be
          purged immediately from the new table.
          
          Because the DML log will contain BLOB pointers of the original table,
          the purge thread must not free any BLOBs of a table that is being
          rebuilt.
          
          Because we cannot easily block the ROLLBACK of an INSERT, we will keep
          track of transactions that have been rolled back, and skip any rows
          written by transactions that have been rolled back. In this way, we
          will not dereference any BLOBs that would be freed as part of a
          rollback.
          
          row_log_table_insert(): Logging function for inserting a new row,
          whether or not a fresh insert or an update of a delete-marked row.
          
          row_log_table_delete(): Logging function for delete-marking a row.
          The row will be identified by PRIMARY KEY (in the new table
          definition) and the DB_TRX_ID before the delete-marking (purging).
          
          row_log_table_update(): Logging function for an update of a row that
          was not delete-marked. The new value of the row will be logged, not
          dereferencing any BLOB pointers. If the PRIMARY KEY is redefined, the
          update record will also contain the new PRIMARY KEY and the DB_TRX_ID,
          DB_ROLL_PTR value of the old row.
          
          row_log_table_get_pk(): Constructs the old PRIMARY KEY and
          DB_TRX_ID,DB_ROLL_PTR for row_log_table_update(). If the PRIMARY KEY
          is not being redefined, returns NULL. This conversion has to be done
          at logging time while holding the clustered index leaf page latch, in
          case the new PRIMARY KEY includes column prefixes of externally stored
          columns.
          
          row_log_table_open(), row_log_table_close_func(): Common code for
          table DML logging.
          
          row_ins_clust_index_entry_by_modify(), row_ins_clust_index_entry_low(),
          row_ins_index_entry_big_rec_func(): Add row_log_table_insert() logging.
          
          row_undo_ins_remove_clust_rec(): Add row_log_table_delete() logging.
          
          row_undo_mod_clust_low(): Add an output parameter rebuilt_old_pk for
          row_log_table_update() logging.
          
          row_undo_mod_clust(): Add insert, update, delete logging.
          
          row_upd_clust_rec_by_insert(): Note that no logging is necessary for
          BLOB ownership changes.
          
          row_upd_clust_rec(): Add the parameters offsets, offsets_heap.  Add
          row_log_table_update() logging.
        ------------------------------------------------------------
        revno: 3829.1.62
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 15:48:55 +0300
        message:
          WL#6255 and WL#5526 performance tweak:
          
          btr_cur_pessimistic_delete(): Skip locking when flags are set.
        ------------------------------------------------------------
        revno: 3829.1.61
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 15:39:53 +0300
        message:
          WL#6255 refactoring:
          
          row_ins_clust_index_entry_low(): Move the log_free_check() call
          to the callers, because during online table rebuild, the clustered index
          tree of the new copy of the table could be X-latched while calling
          this function.
        ------------------------------------------------------------
        revno: 3829.1.60
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 15:29:45 +0300
        message:
          WL#6255 refactoring.
          
          row_upd_build_difference_binary(): Add the parameters offsets and no_sys.
          When applying logged rows in online table rebuild, we do need to include
          DB_TRX_ID and DB_ROLL_PTR in the update vector.
        ------------------------------------------------------------
        revno: 3829.1.59
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-29 00:00:08 +0300
        message:
          WL#6255 debug assertion relaxation
          
          rec_init_offsets_comp_ordinary():
          Allow n_null < index->n_nullable. Assert that of the processed fields,
          no more than n_null are NULLable.
        ------------------------------------------------------------
        revno: 3829.1.58
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 23:19:08 +0300
        message:
          WL#6255 debug assertion relaxation
          
          rec_get_converted_size_comp_prefix(), rec_convert_dtuple_to_rec_comp():
          Allow n_null < index->n_nullable. Assert that of the processed fields,
          no more than n_null are NULLable.
        ------------------------------------------------------------
        revno: 3829.1.57
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 17:09:00 +0300
        message:
          WL#6255: Logging of rolled-back transactions.
          
          To avoid dereferencing freed BLOB pages during online table rebuild,
          we must keep track on rollbacks of inserts to the table that is
          being rebuilt, and skip any records that were inserted by such a
          transaction. As an optimization, we also keep track of rolled-back updates,
          so that we can copy less data during online table rebuild.
          
          row_log_table_rollback(): Report a rolled-back transaction. Called by
          row_undo_ins() and row_undo_mod().
          
          row_log_table_is_rollback(): Determine if a given transaction was
          rolled back after it modified the table that is being rebuilt.
        ------------------------------------------------------------
        revno: 3829.1.56
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 16:56:48 +0300
        message:
          WL#6255 preparation: Add row_log_t fields for online table rebuild.
          
          row_log_allocate(): Add the parameters table, same_pk.
          
          row_log_table_get_error(): Accessor to index->online_log->error.
          
          row_log_t: Online table rebuild log record types
        ------------------------------------------------------------
        revno: 3829.1.55
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 16:56:24 +0300
        message:
          Replace ibool with bool.
        ------------------------------------------------------------
        revno: 3829.1.54
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 16:48:01 +0300
        message:
          WL#6255 preparation: Add dummy query graph to ha_innobase_inplace_ctx,
          for applying the online table rebuild log.
        ------------------------------------------------------------
        revno: 3829.1.53
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 16:45:36 +0300
        message:
          WL#6255 preparation: Simplify the INNOBASE_ONLINE_OPERATIONS.
        ------------------------------------------------------------
        revno: 3829.1.52
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 16:38:24 +0300
        message:
          WL#6255 preparation: Simplify the index->online_status for rebuilding table.
          
          dict_index_is_online_ddl(): On clustered index, assert that online_status
          is either ONLINE_INDEX_CREATION or ONLINE_INDEX_COMPLETE.
          
          dict_table_is_online_rebuild(): Invoke dict_index_is_online_ddl().
        ------------------------------------------------------------
        revno: 3829.1.51
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 16:33:30 +0300
        message:
          WL#6255 preparation: Fix a bug in the rec_get_offsets() elimination.
          
          btr_cur_optimistic_update(): Create *heap when needed.
        ------------------------------------------------------------
        revno: 3829.1.50
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 13:09:50 +0300
        message:
          Convert ibool to bool.
        ------------------------------------------------------------
        revno: 3829.1.49
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 13:07:12 +0300
        message:
          Adjust function attributes and return type.
        ------------------------------------------------------------
        revno: 3829.1.48
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 12:39:34 +0300
        message:
          WL#6255 preparation: row_ins_duplicate_error_in_clust():
          Initialize err when suppressing locking.
        ------------------------------------------------------------
        revno: 3829.1.47
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 11:57:24 +0300
        message:
          WL#6255: Implement in-place DROP PRIMARY KEY (DROP_PK_INDEX)
          when ADD PRIMARY KEY is specified at the same time.
          
          innobase_fts_check_doc_id_index_in_def(): Add an optional output parameter
          for the FTS_DOC_ID column number.
          
          ha_innobase::check_if_supported_inplace_alter(): Allow DROP_PK_INDEX
          only if ADD_PK_INDEX is specified at the same time.
          
          ha_innobase::prepare_inplace_alter_table(): For DROP_PK_INDEX, do not
          collect the clustered index in drop_index[].
        ------------------------------------------------------------
        revno: 3829.1.46
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 11:39:00 +0300
        message:
          row_merge_read_clustered_index(): Narrow the scope of a loop variable.
        ------------------------------------------------------------
        revno: 3829.1.45
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-28 11:35:00 +0300
        message:
          Replace ibool with bool.
        ------------------------------------------------------------
        revno: 3829.1.44
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Sun 2012-05-27 23:10:04 +0300
        message:
          Non-functional changes.
          
          Rename row_log_struct to row_log_t. Remove an unnecessary cast.
        ------------------------------------------------------------
        revno: 3829.1.43
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Sun 2012-05-27 21:34:55 +0300
        message:
          WL#6255 preparation: Suspend the purge if it would free BLOBs.
          
          We cannot free BLOBs during online table rebuild, because we do not write
          the BLOBs to the online log. Online log apply assumes that the BLOBs are
          accessible.
          
          row_purge_upd_exist_or_extern_func(), row_purge_record_func(): Return true
          if the record was purged, false if it would free BLOBs of a table that is
          being rebuilt online.
          
          row_purge(): If a record is not purgeable, retry in 1 second, until the
          server is shut down is initiated. TODO: move the record aside, and continue
          with the rest of the purge.
        ------------------------------------------------------------
        revno: 3829.1.42
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Sat 2012-05-26 07:34:45 +0300
        message:
          WL#6255 preparation: Allow flags to be specified on row insert.
          
          row_ins_clust_index_entry_low(), row_ins_sec_index_entry_low():
          Make the functions public, and add a flags parameter, so that
          online rebuild log apply can skip locking and undo logging.
        ------------------------------------------------------------
        revno: 3829.1.41
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Sat 2012-05-26 07:25:45 +0300
        message:
          WL#6255 preparation: Add assertions to purge code.
          
          row_purge_remove_clust_if_poss_low(), row_purge_upd_exist_or_extern_func():
          Assert that dict_operation_lock is being S-latched. Narrow the scope
          of some variable declarations.
          
          In online table rebuild, there is a potential problem in BLOB retrieval.
          The planned solution is that we will have a lookup table of trx_id_t of
          rolled-back transactions. Any rows inserted or updated by such transactions
          will be ignored. A delete-mark operation will be buffered as a delete+purge
          in the online log, with the new PRIMARY KEY and the DB_TRX_ID of the record,
          and applied by looking up the fields in the rebuilt table.
          This (and the fact that the log apply will hold an S-latch or X-latch on
          the clustered index tree of the old table) should guarantee that the
          log apply will never dereference freed BLOBs in the old table.
        ------------------------------------------------------------
        revno: 3829.1.40
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-05-25 23:40:32 +0300
        message:
          WL#6255 preparation: Relax some assertions and adjust functions
          for online table rebuild.
          
          For indicating that an online table rebuild is in progress, we will
          flag the online_status of the clustered index in the old table, and
          allocate index->online_log on the clustered index of the old table.
          This is different from the modification logging on secondary index
          creation. In secondary index creation, if the index is being built
          online, we will write all changes only to the log. In online table
          rebuild, we will log the changes in addition to changing the original
          table directly.
          
          Relax many assertions on dict_index_is_online_ddl().
          
          dict_index_set_online_status(): Remove the qualifier "secondary" index.
          
          dict_index_is_online_ddl(): Adjust the function comment.
          
          index->to_be_dropped, index->online_status: Refine the latching rules.
          
          online_index_status: Update the comment of ONLINE_INDEX_ABORTED.
          
          row_merge_is_index_usable(): Do not deny access to the clustered index
          of a table that is being rebuilt.
        ------------------------------------------------------------
        revno: 3829.1.39
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-05-25 23:21:02 +0300
        message:
          WL#6255 preparation: Allow BTR_ALREADY_S_LATCHED
          to be specified with BTR_MODIFY_LEAF, not only with BTR_SEARCH_LEAF.
        ------------------------------------------------------------
        revno: 3829.1.38
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-05-25 23:00:45 +0300
        message:
          prepare_inplace_alter_table_dict(): Do not acquire lock on the new table.
          We skip all record locking when populating the indexes.
          The table locking on the target (rebuilt) table is unnecessary too.
        ------------------------------------------------------------
        revno: 3829.1.37
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-05-25 22:53:34 +0300
        message:
          WL#6255 preparation: Add LOCK=SHARED to main.innodb_mysql_sync.test
          so that it will pass when ADD PRIMARY KEY can be done online.
        ------------------------------------------------------------
        revno: 3829.1.36
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Fri 2012-05-25 14:39:24 +0300
        message:
          Bug#14117641 (possible fix) and a WL#6255 optimization
          
          Allow the non-online InnoDB in-place DDL operations with LOCK=SHARED.
          
          prepare_inplace_alter_table_dict(): When creating indexes and
          an online operation has not been requested, acquire S-lock on the table.
          Previously, we acquired an X-lock, and only when the table was being rebuilt.
          Failure to lock the table might explain Bug#14117641 if there was a
          foreign key CASCADE or SET NULL constraint referencing the table.
        ------------------------------------------------------------
        revno: 3829.1.35
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-24 15:38:50 +0300
        message:
          row_undo_mod_remove_clust_low(): Enable a debug assertion and
          add comments on DB_TRX_ID and the delete-mark flag.
        ------------------------------------------------------------
        revno: 3829.1.34
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-24 15:12:28 +0300
        message:
          WL#6255 preparation, to allow creation of a dummy que_thr_t object.
          
          pars_complete_graph_for_exec(): Allow node=NULL.
        ------------------------------------------------------------
        revno: 3829.1.33
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-24 14:12:23 +0300
        message:
          Fix errors in the rec_get_offsets() elimination.
          
          btr_root_raise_and_insert(), btr_page_split_and_insert(),
          btr_cur_pessimistic_insert(): Note that the memory heap for offsets
          can be emptied.
          
          btr_cur_pessimistic_update(), row_ins_sec_index_entry_by_modify(),
          row_ins_sec_index_entry_low(), row_log_apply_op_low(),
          row_log_apply_op(), row_undo_mod_clust_low(): Add offsets_heap for
          allocating offsets only. Note that it can be emptied.
        ------------------------------------------------------------
        revno: 3829.1.32
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-24 12:56:08 +0300
        message:
          Fix a bug in rec_get_offsets() elimination.
          
          btr_cur_pessimistic_update(): Allocate new_entry from a separate heap,
          because the heap for offsets can be emptied.
        ------------------------------------------------------------
        revno: 3829.1.31
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-23 23:22:47 +0300
        message:
          btr_cur_pessimistic_update(): Fix a bug in the rec_get_offsets() elimination.
          
          When the page is compressed and we need to keep the cursor position,
          adjust the offsets as well.
        ------------------------------------------------------------
        revno: 3829.1.30
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-23 23:08:25 +0300
        message:
          row_rec_to_index_entry(): Make offsets const,
          which it is except in debug builds.
        ------------------------------------------------------------
        revno: 3829.1.29
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-23 22:55:32 +0300
        message:
          Simplify rec_offs_make_valid() calls.
        ------------------------------------------------------------
        revno: 3829.1.28
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-23 16:42:14 +0300
        message:
          WL#6255 preparation: Add the accessor trx_undo_trx_id_is_insert().
        ------------------------------------------------------------
        revno: 3829.1.27
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-23 14:45:30 +0300
        message:
          Remove bogus __attribute__((pure)) on indexes.
          
          An index can become corrupted between calls or its online_status may
          change between calls.
        ------------------------------------------------------------
        revno: 3829.1.26
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-23 11:48:04 +0300
        message:
          WL#6255 preparation: Do not recompute offsets after B-tree insert.
          
          btr_root_raise_and_insert(), btr_page_insert_fits(),
          btr_page_tuple_smaller(), btr_page_split_and_insert(),
          btr_cur_insert_if_possible(), btr_cur_optimistic_insert(),
          btr_cur_pessimistic_insert(), ibuf_insert_to_index_page_low(),
          page_cur_tuple_insert(), row_ins_sec_index_entry_by_modify():
          Add in/out parameters for offsets and heap.
          
          row_ins_sec_index_entry_low(): Add a parameter for heap.
        ------------------------------------------------------------
        revno: 3829.1.25
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-23 11:45:33 +0300
        message:
          Add function attributes. Replace btr_page_get_level() with a macro.
        ------------------------------------------------------------
        revno: 3829.1.24
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-23 11:39:37 +0300
        message:
          WL#5526 optimization cleanup:
          
          row_log_online_op(): Fix a bogus warning on uninitialized mrec_size,
          and do a little less work while holding index->online_log->mutex.
        ------------------------------------------------------------
        revno: 3829.1.23
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-22 11:28:45 +0300
        message:
          Add function attributes.
        ------------------------------------------------------------
        revno: 3829.1.22
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-22 10:58:32 +0300
        message:
          Remove a stale comment.
        ------------------------------------------------------------
        revno: 3829.1.21
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-22 10:53:10 +0300
        message:
          Remove a stale comment.
        ------------------------------------------------------------
        revno: 3829.1.20
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-22 10:47:51 +0300
        message:
          WL#5526 optimization: Do not log trx_id for ROW_OP_PURGE.
        ------------------------------------------------------------
        revno: 3829.1.19
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-22 10:23:37 +0300
        message:
          rec_get_trx_id(): Use trx_read_trx_id().
        ------------------------------------------------------------
        revno: 3829.1.18
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-21 11:34:07 +0300
        message:
          WL#6255 preparations to avoid adding rec_get_offsets() calls.
          
          The function rec_get_offsets() was added for MySQL 5.0.3 in a hurry.
          InnoDB reallocates and recomputes the offsets a few times per B-tree
          operation. We should really allocate the space for the offsets on
          page_cur creation, and we should keep the offsets up to date with
          page_cur.rec. This is not a complete fix, but it will avoid some cases
          of recomputing, so that WL#6255 will not add any rec_get_offsets()
          calls.
          
          btr_cur_upd_lock_and_undo(), btr_cur_update_in_place():
          Add the parameter offsets.
          
          btr_cur_update_in_place_log(): Add const qualifiers.
          
          btr_cur_optimistic_update(): Add the parameters offsets, heap, for
          keeping the result from rec_get_offsets(). TODO: Take the offsets from
          the caller.
          
          btr_cur_pessimistic_update(): Add the parameter offsets for keeping
          the result from rec_get_offsets(). TODO: Take the offsets from the
          caller.
          
          row_ins_index_entry_big_rec_func(): Declare the parameter offsets nonnull.
          
          row_ins_clust_index_entry_by_modify(): Add the parameter offsets for
          keeping the result from rec_get_offsets().
          
          row_undo_mod_clust_low(): Add the parameters offsets, heap, for
          keeping the result from rec_get_offsets(). TODO: Take the offsets from
          the caller.
        ------------------------------------------------------------
        revno: 3829.1.17
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-21 11:32:52 +0300
        message:
          row_upd_clust_step(): Remove a local variable.
        ------------------------------------------------------------
        revno: 3829.1.16
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-21 10:08:52 +0300
        message:
          row_rec_to_index_entry(): Re-validate offsets after the copying.
        ------------------------------------------------------------
        revno: 3829.1.15
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-21 09:18:58 +0300
        message:
          Add __attribute__.
        ------------------------------------------------------------
        revno: 3829.1.14
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-17 23:41:33 +0300
        message:
          btr_cur_add_path_info(): Add const qualifiers.
        ------------------------------------------------------------
        revno: 3829.1.13
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-17 23:38:03 +0300
        message:
          Remove unused function row_upd_changes_fts_columns().
        ------------------------------------------------------------
        revno: 3829.1.12
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Thu 2012-05-17 23:31:54 +0300
        message:
          WL#6255 optimization: Remove duplicate rec_get_offsets() call.
          
          trx_undo_report_row_operation(): Add the parameter offsets.
        ------------------------------------------------------------
        revno: 3829.1.11
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-16 16:57:28 +0300
        message:
          row_log_apply(): Assert that the index is a secondary index.
        ------------------------------------------------------------
        revno: 3829.1.10
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-16 16:27:23 +0300
        message:
          row_undo_mod_remove_clust_low(): Temporarily disable
          the failing assertions on rec_get_trx_id().
        ------------------------------------------------------------
        revno: 3829.1.9
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Wed 2012-05-16 14:21:19 +0300
        message:
          WL#6255 preparation: Add rollback assertions on DB_TRX_ID == trx->id.
          
          rec_get_trx_id(): New function, available in debug builds.
          
          row_undo_ins_remove_clust_rec(), row_undo_mod_clust_low(): Assert that
          rec_get_trx_id() matches trx->id.
          
          row_undo_mod_remove_clust_low(): Assert that rec_get_trx_id() matches
          trx->id and the record is not delete-marked, or the transaction is
          TRX_DICT_OP_TABLE.  For some reason, these assertions would fail during
          a rollback in ADD FOREIGN KEY (innodb-index.test, innodb_16k.test).
        ------------------------------------------------------------
        revno: 3829.1.8
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-15 22:46:11 +0300
        message:
          dict_index_set_online_status(): Assert that it is not a fulltext index.
        ------------------------------------------------------------
        revno: 3829.1.7
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-15 16:06:11 +0300
        message:
          Add a debug assertion that could have been added in WL#5526.
        ------------------------------------------------------------
        revno: 3829.1.6
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-15 13:43:10 +0300
        message:
          WL#6255 preparation. Separate index->search_info and index->online_log.
          
          In an attempt to reduce memory usage, WL#5526 piggy-backed the online_log
          pointer in place of the index->search_info. It was thought that the
          adaptive hash index would not be used while building an index online.
          
          With WL#6255, this no longer holds. The adaptive hash index for the
          clustered index must remain accessible while the table is being rebuilt.
          
          BTR_MODIFY_LEAF_APPLY_LOG: Replace with BTR_MODIFY_LEAF.
          BTR_MODIFY_TREE_APPLY_LOG: Replace with BTR_MODIFY_TREE.
          
          btr_search_get_info(): Do not assert that the index is not being built
          online.
          
          btr_cur_search_to_nth_level(): Always use the adaptive hash index.
        ------------------------------------------------------------
        revno: 3829.1.5
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-15 12:41:19 +0300
        message:
          WL#6255 prepareation: Simplify row_ins_clust_index_entry_low().
        ------------------------------------------------------------
        revno: 3829.1.4
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-15 10:19:32 +0300
        message:
          WL#6255 preparation: Split row_ins_index_entry(), row_ins_index_entry_low().
          
          row_ins_clust_index_entry(): Insert a clustered index entry.
          row_ins_sec_index_entry(): Insert a secondary index entry.
          
          row_ins_clust_index_entry_low(): Insert a clustered index entry.
          row_ins_sec_index_entry_low(): Insert a secondary index entry.
          
          Remove the parameter foreign=TRUE from all functions and n_ext=0
          from the insert into secondary index.
        ------------------------------------------------------------
        revno: 3829.1.3
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Tue 2012-05-15 10:05:25 +0300
        message:
          Add function attributes.
        ------------------------------------------------------------
        revno: 3829.1.2
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-14 13:30:37 +0300
        message:
          WL#6255: Allow ROW_FORMAT and KEY_BLOCK_SIZE to be changed in-place.
          
          create_options_are_valid(): Rename to create_options_are_invalid(), and
          change the return type from ibool to const char*.
          
          INNOBASE_ONLINE_CREATE, INNOBASE_INPLACE_REBUILD: New sets of
          supported in-place ALTER TABLE operations.
          
          innobase_need_rebuild(): Determine if ALTER TABLE needs to rebuild the
          table. We ignore other CHANGE_CREATE_OPTION flags than KEY_BLOCK_SIZE
          and ROW_FORMAT.
          
          ha_innobase::check_if_supported_inplace_alter(): Allow all
          INNOBASE_INPLACE_REBUILD operations. Replace ADD_PK_INDEX with
          INNOBASE_INPLACE_REBUILD.
          
          innobase_create_key_defs(): Rebuild the clustered index for
          INNOBASE_INPLACE_REBUILD.
          
          ha_innobase::prepare_inplace_alter_table(): Call
          create_options_are_invalid().
          
          ha_innobase::inplace_alter_table(): If no other operations than
          CHANGE_CREATE_OPTION are being performed and !innobase_need_rebuild(),
          do nothing.
        ------------------------------------------------------------
        revno: 3829.1.1
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl6255
        timestamp: Mon 2012-05-14 12:58:37 +0300
        message:
          Branch mysql-trunk-wl6255 from mysql-trunk.
    ------------------------------------------------------------
    revno: 3690.68.41
    committer: Nirbhay Choubey <nirbhay.choubey@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-21 13:46:24 +0530
    message:
      Bug#14136939 : Post-fix for failing tests.
    ------------------------------------------------------------
    revno: 3690.68.40
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Thu 2012-06-21 17:02:21 +1000
    message:
      BUG#13016100 - ASSERTION FAILURE IN FILE TRX0PURGE.C LINE 698: PURGE_SYS->RSEG->SPACE <= SRV_UN
      
      We need to distinguish between the number of UNDO tables available
      (opened) and the number of UNDO tablespaces to use for UNDO logging.
      The failing check should be against the number of UNDO tablespaces
      that are open.
      
      The previous commit was incomplete.
      
      rb://1121 Approved by Jimmy Yang.
    ------------------------------------------------------------
    revno: 3690.68.39
    committer: Alexander Barkov <alexander.barkov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-21 10:09:18 +0400
    message:
      Bug#13358363 - ASSERTION: N > 0 && N < SINUSES_CALCULATED*2+1 | GET_N_SINCOS/ADD_EDGE_BUFFER
      
      This bug was fixed by the fix joint for 13832749 and 13833019.
      Only adding test cases reported in 13358363.
    ------------------------------------------------------------
    revno: 3690.68.38
    committer: Jimmy Yang <jimmy.yang@oracle.com>
    branch nick: trunk2
    timestamp: Thu 2012-06-21 12:52:53 +0800
    message:
      Fix for Bug #14119690 - REPRODUCABLE CRASH IN FTS_PARALLEL_MERGE()
            
      rb://1118 approved by Sunny Bains
    ------------------------------------------------------------
    revno: 3690.68.37
    committer: Gopal Shankar <gopal.shankar@oracle.com>
    branch nick: mysql-trunk-wl6292-push
    timestamp: Thu 2012-06-21 08:27:40 +0530
    message:
      WL#6292 - Make TIMESTAMP columns nullable by default.
      
      This worklog implements new behavior for TIMESTAMP columns,
      defined by CREATE TABLE, ALTER TABLE and CREATE SELECT commands.
      This is in effort to make TIMESTAMP columns behavior to be
      more closer to SQL standard. The change in behavior is as
      described below,
      
      Current behavior:
      =================
        1) Unlike all the other types, TIMESTAMP columns which are not
           explicitly specified as NULLable automatically get NOT NULL
           as attribute.
        2) If the first TIMESTAMP column in table is not specified as
           NULLable and doesn't have explicit DEFAULT or ON UPDATE
           value specified it automatically gets DEFAULT NOW()
           ON UPDATE NOW() as attributes.
        3) All other TIMESTAMP columns which are not NULLable and
           don't have explicit default specified get '0' as default
           value and treated as having explicit default value after
           that (i.e. if you don't provide explicit value for such
           a column when inserting into table no warning or error
           is emitted).
      
      New behavior:
      =============
        1) TIMESTAMP columns which are not explicitly specified as
           NOT NULL become NULLable.
        2) No TIMESTAMP columns get DEFAULT NOW() or ON UPDATE NOW()
           attributes automatically, without them being explicitly
           specified.
        3) Non-NULLable TIMESTAMP columns without explicit default
           value treated as having no default value. I.e. warning
           or error is emitted (depends on sql_mode) if we insert
           a row without providing and explicit value for such a
           column. In case when warning is emitted and not an
           error such a column will still get '0' if no explicit
           value was specified for it.
      
      A new command line option '--explicit_defaults_for_timestamp'
      is introduced for MySQL server to enable new behavior. The old
      behavior is kept as default, so that the existing applications
      assuming old semantics work without any changes.
      
      Replication slave applier thread is extended with new interface,
      such that the slave applies the logs with old behavior, if the
      logs are generated by master with older version than slave.
      
      MySQL system table definitions at scripts/* were updated,
      such that they work fine with old and new behavior with
      any change. MTR tests which use TIMESTAMP columns are also
      updated, such that the test works both in old and new
      behavior. This should help easy transition to new behavior
      going forward.
      
      This worklog addresses Bug#11762529 and Bug#13344629.
    ------------------------------------------------------------
    revno: 3690.68.36
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-trunk-bf
    timestamp: Wed 2012-06-20 22:31:12 +0100
    message:
      BUG#14136654: ASSERTION FAILED ON BINLOG.WRITE_ONE_EMPTY_GROUP_TO_CACHE()
      
      Removed server and binlog versions from SHOW BINLOG EVENTS output.
    ------------------------------------------------------------
    revno: 3690.68.35
    committer: oystein.grovlen@oracle.com
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-20 23:02:13 +0200
    message:
      Bug#11766758: MATERIALIZATION=ON/OFF LEADS TO DIFFERENT RESULT SET 
        WHEN USING IN & VAR_POP
      
      Addendum:  Update result files of Windows-specific tests.
    ------------------------------------------------------------
    revno: 3690.68.34
    committer: Nirbhay Choubey <nirbhay.choubey@oracle.com>
    branch nick: B14136939-trunk
    timestamp: Wed 2012-06-20 21:12:30 +0530
    message:
      Bug#14136939 65461: MYSQL_UPGRADE SHOULD WARN WHEN
                          PRE-4.1 PASSWORDS FOUND
      
      mysql_upgrade throws no warning while upgrading the
      user table that contains 'pre-4.1 password hash'.
      
      Fixed by modifying the condition used for searching
      'warnings' produced duing the upgrade and added a
      statement in mysql_system_tables_fix.sql script to
      get warning(s) if any.
    ------------------------------------------------------------
    revno: 3690.68.33
    committer: Alexander Barkov <alexander.barkov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-20 19:24:15 +0400
    message:
      Fixing test failures.
    ------------------------------------------------------------
    revno: 3690.68.32
    committer: Guilhem Bichot <guilhem.bichot@oracle.com>
    branch nick: 14219273
    timestamp: Wed 2012-06-20 11:55:12 +0200
    message:
      Bug #14219273 CRASH IN JOIN_CACHE::WRITE_RECORD_DATA AFTER WL6071
      The merge of WL6071 accidentally removed the fix for BUG13956813.
      Patch provided by Evgeny.
    ------------------------------------------------------------
    revno: 3690.68.31
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-20 17:35:01 +0530
    message:
      Considering the time taken for this test on slow solaris platforms making these a big test-engines/funcs.tc_multicolumn_different,engines/funcs.ta_add_column_first,engines/funcs.ta_add_column,engines/funcs.ta_add_column_middle
    ------------------------------------------------------------
    revno: 3690.68.30
    committer: Oystein Grovlen <oystein.grovlen@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-20 12:37:14 +0200
    message:
      Bug#11766758: MATERIALIZATION=ON/OFF LEADS TO DIFFERENT RESULT SET 
      WHEN USING IN & VAR_POP
      
      This bug is caused by the fact that number of decimals in VAR_POP
      result, was calculated as the number of decimals in the argument 
      (here int => 0) plus 4.
      
      Hence, in the example in the bug report, 3.5556 is stored in t2.X.
      
      When materialization is off, result of inner query is compared using
      Arg_comparator::compare_real_fixed() which takes number of decimals into
      account.
      
      When inner query is materialized, no truncation happens and the materialized
      column contains 3.555555555...
      The IN-expression is evaluated by doing hash-lookup into the materialized
      table, and since no record matches 3.5556, the result set is empty.
      
      According to the SQL standard the result of VAR_POP should be a 
      floating point number. Hence, the result should not be truncated to 
      a certain number of decimals.  This patch changes VAR_POP() and similar
      functions (VAR_SAMP(), VARIANCE(), STD(), STDDEV_POP(), STDDEV_SAMP(), and
      STDDEV())
      
      By changing this, results for these functions will never be truncated
      Hence, materialization should no longer give a different value from 
      what is normally returned to users.
    ------------------------------------------------------------
    revno: 3690.68.29
    committer: Olav Sandstaa <olav.sandstaa@oracle.com>
    branch nick: year2-bug
    timestamp: Wed 2012-06-20 11:35:32 +0200
    message:
      Fix for Bug#14167585 - LOTS OF TEST FAILURES ON TRUNK ON SOLARIS11/SPARC64
      
      The test failures are caused by the YEAR(X) deprecation message not
      being correctly printed when running on SPARC with 32 bit MySQL binaries.
      Instead of printing "YEAR(X)" where X is the width of the YEAR column,
      "YEAR(0)" is printed in the deprecation warning.
      
      This is caused by that we store the width/length of the YEAR(X) in an
      ulonglong variable in sql_yacc.yy. This will occupy 8 bytes on 32 bit
      SPARC. But in the deprecation message (ER_INVALID_YEAR_COLUMN_LENGTH
      in errmsg-utf8.txt) this is printed as "%lu" (ie. a 4 byte integer on
      32 bit SPARC). Since SPARC is big-endian, this will cause the upper 4
      bytes of the length variable to be printed. This will always be zero.
      
      The fix for this problem is to replace ulonglong with ulong for
      storing the length variable (in sql_yacc.yy). It is ok to do this
      change since the length variable gets its value from the call to
      strtoul() which returns an unsigned long.
    ------------------------------------------------------------
    revno: 3690.68.28
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-bug14171740string
    timestamp: Wed 2012-06-20 11:31:36 +0200
    message:
      Bug#14171740 65562: STRING::SHRINK SHOULD BE A NO-OP WHEN ALLOCED=0
      
      Fixed both String implementations, and added unit tests.
    ------------------------------------------------------------
    revno: 3690.68.27
    committer: Alexander Barkov <alexander.barkov@oracle.com>
    branch nick: mysql-trunk.14197426
    timestamp: Wed 2012-06-20 13:10:58 +0400
    message:
      Bug#14197426 parse errors in loadable UCA / LDML collations are silently ignored
           
      Problem: character set and collation errors in a running mysqld
      were erroneously sent to buffered_log, which is intended to
      be used only at earlier mysqld initialization step and should not
      be used after initialization.
      
      Fix: send character set and collation errors in a initialized
      server directly to error log instead of buffered_logs.
    ------------------------------------------------------------
    revno: 3690.68.26
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: trunk
    timestamp: Wed 2012-06-20 13:14:59 +0400
    message:
      Patch for WL#6301 (Change default value for the 'bind-address' option).
      
      The patch consists of two parts:
      
        - the patch introduces a new special value for the bind-address
          option: * (a star). This value means, the server should listen to
          all network addresses, both IPv6 (if available) and IPv4.
      
        - the patch changes the bind-address default value to star (*).
    ------------------------------------------------------------
    revno: 3690.68.25
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-bug14100495killrace
    timestamp: Wed 2012-06-20 09:39:11 +0200
    message:
      Bug#14100495 VALGRIND: INVALID READ OF SIZE 4 IN CLOSECON_HANDLERTON AND THD_HA_DATA
      
      Disconnect THD from global resources (handlers etc.) before
      signalling that the thread is done.
      This is done to avoid possible race conditions during shutdown of the server.
    ------------------------------------------------------------
    revno: 3690.68.24
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Wed 2012-06-20 17:46:26 +1000
    message:
      Bug#14146981 - AT STARTUP: INNODB: ERROR: A RECORD LOCK WAIT HAPPENS IN A DICTIONARY OPERATION!
      
      The transaction that updates the system tables needs to be tagged as
      TRX_DICT_OP_TABLE.
      
      Approved by Inaam Rana rb://1104
    ------------------------------------------------------------
    revno: 3690.68.23
    committer: kevin.lewis@oracle.com
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-20 02:37:46 -0500
    message:
      PB2 failure on some Windows platforms.  This patch was initiated by me
      and improved by Sunny. Approved to commit by Sunny over email.
------------------------------------------------------------
revno: 3891 [merge]
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Wed 2012-06-20 16:13:52 +0400
message:
  Merge.
    ------------------------------------------------------------
    revno: 3690.68.22
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Wed 2012-06-20 14:57:24 +1000
    message:
      BUG#13016100 - ASSERTION FAILURE IN FILE TRX0PURGE.C LINE 698: PURGE_SYS->RSEG->SPACE <= SRV_UN
      
      Print the number of UNDO tablespaces that were opened successfully.
      
      Approved by Jimmy Yang over IM
    ------------------------------------------------------------
    revno: 3690.68.21
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Wed 2012-06-20 07:21:46 +1000
    message:
      Remove the listing of the temp directory files.
    ------------------------------------------------------------
    revno: 3690.68.20
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-trunk-bf
    timestamp: Tue 2012-06-19 19:36:42 +0100
    message:
      BUG#14136654: ASSERTION FAILED ON BINLOG.WRITE_ONE_EMPTY_GROUP_TO_CACHE()
      
      When a GTID was across multiple relay logs:
       RELAY LOG (X)
         GTID
         (EOF)
       RELAY LOG (X + 1)
         BEGIN
         INSERT
         COMMIT
      it was wrongly interpreted as a empty group.
      This happened when crash slave was used, on which configuration when 
      PURGE logs is executed (on log rotate) a commit is done to ensure
      consistency of relay info, that when presented with only a GTID on group
      cache logged a empty group.
      
      Fixed MYSQL_BIN_LOG::commit() method to correctly handle the case where
      a GTID may start on relay log and end on different relay log file.
    ------------------------------------------------------------
    revno: 3690.68.19
    committer: kevin.lewis@oracle.com
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-19 12:42:36 -0500
    message:
      Attempt to fix testcase innodb-multpile-tablespaces which is failing
      on SLES and Debian systems.  There is an assumption that the readdir()
      command will read a directory in alphabetical order, which does not
      seem to be true for these platforms.  So the test can no longer check
      the condition in which a tablespace being opened has the same space ID
      as a previously opened tablespace.  The script must now test a crash on
      recovery for each file that exists in two places.
    ------------------------------------------------------------
    revno: 3690.68.18
    committer: Ole John Aske <ole.john.aske@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-19 15:13:19 +0200
    message:
      Fix for Bug#14053325 DUPLICATED RESULTS ROWS WHEN SEMIJOIN USE LOOSESCAN STRATEGY
            
      'Semijoin LooseScan strategy' is based on skiping key duplicates after the
      'first match' for each key is found. Thus reading of the tables has to return
      the result in sorted order as defined by the index being used.
            
      Such 'sorted' read is specified with the 'sorted' argument to handler::ha_index_init().
      As we failed to enforce 'sorted=true' for SJ_OPT_LOOSE_SCAN, it is left to each SE-handler
      to return the rows sorted or unsorted. 
            
      Partitioned tables and ndbcluster tables will not be sorted without 'sorted' being
      set to 'true'. The skipreading in LooseScan will therefore fail to correctly eliminate
      duplicates, and we get to many rows in the result set.
    ------------------------------------------------------------
    revno: 3690.68.17
    committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
    branch nick: mysql-trunk-test
    timestamp: Tue 2012-06-19 14:20:30 +0200
    message:
      Bug#14031353 LOCK/ALGORITHM CLAUSES MISSING FROM CREATE/DROP 
                   INDEX STATEMENTS
      
      Follow-up patch.
      
      Renamed parser rule lock_option to alter_lock_option
      to avoid name conflict with existing lock_option rule.
      (Also renamed algorithm_option for consistency)
    ------------------------------------------------------------
    revno: 3690.68.16
    committer: Alexander Barkov <alexander.barkov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-19 15:29:53 +0400
    message:
      Bug#13833019
      Bug#13832749
      Adding files forgotten in the previous push.
    ------------------------------------------------------------
    revno: 3690.68.15
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-19 13:22:08 +0300
    message:
      Non-functional change - use bool instead of ibool in dict0stats.cc
    ------------------------------------------------------------
    revno: 3690.68.14
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-19 13:00:57 +0300
    message:
      Fix Bug#14172780 CRASH OBSERVED ININNODB.INNODB-WL5522-DEBUG* TEST ON PB2 ON
      MULTIPLE PLATFORMS.
      
      In dict_stats_analyze_index_level(), when we traverse the level we take care
      to copy the rec into prev_rec when we are about to jump on the next page but
      we forgot to do this in the case when the last rec on a page is delete-marked.
      In this case we just "continue;", leaving prev_rec pointing somewhere inside
      the old page which is going to be released by btr_pcur_move_to_next_user_rec()
      when it jumps on the next page.
      
      The fix is to also copy rec into prev_rec before "continue;"ing when a
      delete-marked record is found and it is last on page and prev_rec is not
      already copied (ie we may have this cond twice if a whole page is filled
      with delete-marked records and prev_rec is (copied) from pageN where rec
      jumps into pageN+1, which contains only delete-marked records and then rec
      jumps into pageN+2 - no need to copy prev_rec again in this case).
    ------------------------------------------------------------
    revno: 3690.68.13
    committer: Alexander Barkov <alexander.barkov@oracle.com>
    branch nick: mysql-trunk.gis-merge
    timestamp: Tue 2012-06-19 13:26:13 +0400
    message:
      Bug#13833019 ASSERTION `T1->RESULT_RANGE' FAILED IN GCALC_OPERATION_R
      Bug#13832749 HANDLE_FATAL_SIGNAL IN GCALC_FUNCTION::COUNT_INTERNAL
      
      1. ST_Buffer() did not work well due to a few bugs in the
        buffer transporter implementation.
      
      a. The sequence of:
      
        func.get_next_operation_pos();
        ...
        func.add_operands_to_op(union_pos, trn.m_nshapes);
      
        did not work in case of collection geometries
        (MultiPoint, MultiLineString, MultiPolygon, GeometryCollection),
        which already create a union of m_nshapes items themself.
        In this case the caller should have generated a union1 operation
        instead of unionN operation, i.e. the above add_operands_to_op()
        call should have passed 1 instead of trn.m_nshapes,
        to get this function execution plan:
      
          union1(unionN(shape1,shape2,...,shapeN))
      
        instead of bad:
      
          unionN(unionN(shape1,shape2,..,shapeN))
      
        The fix moves the code generating the upper-most union command
        *inside* store_shape() for all geometry types.
      
      b. The next problem after moving union generating inside store_shapes()
         was that the Item_func_buffer::Transporter::m_nshapes member was
         erroneously shared by both collection itself and its items, e.g.:
      
        - lines of multilinestring and the multiline itself
        - items of a geometry collection and the collection itself
      
        The fix removes the m_nshapes member from Item_func_buffer::Transporter
        and passes the current shape transformation status as a parameter
        to all tranformation methods line stat_xxx/complete_xxx/add_point, etc.
      
        This simplifies simultanious access to the transformation statistics
        of the collection itself and of the current item.
        A new class Gcalc_shape_status was introduces to store transformation status.
        Before a collection processing code enters an item, a new transformation
        status variable is created on stack and passed to the item processing
        routine.
      
      c. ST_Buffer did not include the very last edge of a polygon with 4+ points
      due to the bug in the point comparison code in
      Item_func_buffer::Transporter::complete:
      
      - if (x2 != x00 && y2 != y00)
      + if (x2 != x00 || y2 != y00)
      
      
      2. Area() of a geometry collection consisting of polygons mistakenly
        returned NULL, because Gis_geometry_collection::area was not implemented.
        Area() of Points and LineStrings also returned NULL. Fixing to return 0.
      
      
      3. Negative buffer values worked wrong:
      
      - ST_Buffer(GeomFromText('POINT(0 0)',-1));
      
        Returned similar value to 
      
        ST_Buffer(GeomFromText('POINT(0 0)',1));
      
      - ST_Buffer(GeomFromText('LineString(0 0)'),-1)
      
        returned similar value to
      
        ST_Buffer(GeomFromText('LineString(0 0)'),1)
      
      Fixing negative buffers to return empty sets for Points and LineStrings,
      according to the OCG specifications.
      
      4. Zero buffer made server crash:
      
        ST_Buffer(<polygon>, 0)
      
        because of division-by-zero-alike problem.
        Changing zero buffer to return the original geometry itself,
        instead of going through the zero-unsafe buffer generating code.
      
      5. Adding GIS debug output functionality, to print debug information
      into server log and into client side warnings. The latter is very useful
      for mtr purposes. GIS debug output is available only in debug builds
      and does not exist in production builds.
      
      6. Adding ST_GIS_DEBUG() function to turn client-side GIS debug warnings on/off:
      
      SELECT ST_GIS_DEBUG(1); -- turn debug output on
      SELECT ST_GIS_DEBUG(0); -- turn debug output off
      
      Client side debug warnings are off by default.
      
      
      Per file comments:
      
      added:
        @ mysql-test/include/gis_debug.inc
          - Adding a shared file to test various GIS functions
      
        @ mysql-test/r/gis-debug.result
        @ mysql-test/t/gis-debug.test
          - Adding a debug test with client-side GIS debug warnings.
      
      modified:
        @ mysql-test/r/gis-precise.result
        @ mysql-test/t/gis-precise.test
          - Including gis_debug.inc,
            to make sure the results are correct in non-debugs.
      
        @ sql/gcalc_slicescan.h.diff
          - Introducing a new class Gcalc_shape_status and passing
            a parameter of Gcalc_shape_status type into transformation methods.
          - Adding prototypes for collection_add_item() and complete_collection()
            transformation methods. Previously these methods did not exist
            because Item_func_buffer::val_str() tried to process the upper-most
            union itself (incorrectly).
      
          - Adding skip_xxx() methods, to exclude certain geometries during
            transformation. For example, negative buffer does not need Points
            and LineStrings.
      
        @ sql/gcalc_tools.cc.diff
          - Adding debug routines
          - Adding Gcalc_shape_status parameter into the transformation methods
          - Adding the default implementation of start_collection(),
            collection_add_item() and complete_collection() routines.
      
        @ sql/gcalc_tools.h.diff
          - Adding prototype for the debug routine
          - Adding an Gcalc_shape_status parameter to transformation routines
      
        @ sql/item_create.cc.diff
          - Adding a code to create ST_GIS_DEBUG() SQL function in debug builds
      
        @ sql/item_geofunc.cc.diff
      
          - Adding Gcalc_shape_status parameter into the transformation methods
          - Adding a new code to catch zero distance
          - Adding a new code to catch empty buffer set after transformation
          - Removing the top-level union generating code
          - Adding Item_func_gis_debug::val_int() implementation
          - Adding calls for debug_print_function_buffer() near all store_shapes()
            calls.
      
        @ sql/item_geofunc.h.diff
          - Removing the m_nshapes member
          - Adding Gcalc_shape_status parameter to the transformation methods
          - Adding prototype for Item_func_gis_debug,
            the item behind the new ST_GIS_DEBUG() SQL function.
      
        @ sql/spatial.cc.diff
          - Implementing Geometry::collection_store_shapes() and
            Geometry::collection_area() methods, which are shared between
            collection geometry types:
            GeometryCollection, MultiPoint, MultiLineString,MultiPolygon
          - Adding Gcalc_shape_status parameter to the transformation methods
          - Implementing the missing Gis_geometry_collection::area().
      
        @ sql/spatial.h.diff
          - Adding prototypes for collection_store_shapes() and collection_area().
          - Adding prototype for the missing Gis_geometry_collection::area().
          - Adding the default implementation for area(), for the geometry
            types who have empty area.
          - Adding Gcalc_shape_status parameter to the transformation methods
        @ sql/sql_class.cc.diff
          - Adding gis_debug initialization into THD constructor
      
        @ sql/sql_class.h.diff
          - Introducing gis_debug member and related methods.
    ------------------------------------------------------------
    revno: 3690.68.12
    committer: Jorgen Loland <jorgen.loland@oracle.com>
    branch nick: mysql-trunk-11752097
    timestamp: Tue 2012-06-19 09:12:13 +0200
    message:
      BUG#11752097: SELECT ... WHERE (col1, col2) IN ((const, const))
                    is optimized, non-SELECT not
      
      SELECT statements go through JOIN::optimize(). UPDATE/DELETE
      statements do not call JOIN::optimize(), which means that a lot
      of query optimizations available for SELECTs are not available
      for these.
      
      However, UPDATE/DELETE makes some attempts to do low-hanging
      optimizations, e.g. some condition optimizations and range 
      optimization. Range access offers pretty good performance
      even in cases where a SELECT statement could have done eq-ref.
      
      In the bug, we have:
      SELECT * FROM t1 WHERE (c1, c2) IN ((const, const))
      DELETE FROM t1 WHERE (c1, c2) IN ((const, const))
      UPDATE t1 SET c1=const WHERE (c1, c2) IN ((const, const))
      
      The SELECT uses index lookup using the const values while the 
      UPDATE/DELETE statements do table scan. Making these use 
      lookup like the SELECT is an big task. However, if the 
      queries had used range access the performance would be close 
      to index lookup.
      
      A predicate of the form "(c1, c2) IN ((const, const))" is 
      initially created as 
      
            Item_func_eq(Item_row(Item_field c1, Item_field c2),
                         Item_row(const, const))
      
      For SELECT queries, this predicate is transformed into 
      
            Item_cond_and(Item_func_eq(Item_field c1, const), 
                          Item_func_eq(Item_field c2, const))
      
      by optimize_cond() before the range optimizer is invoked. The
      range optimizer is not prepared to process Item_rows and
      simply ignores them. That's why the UPDATE/DELETE statements
      do not use the range access method.
      
      The fix is to do some more condition processing for 
      UPDATE/DELETE so that the Item_rows are transformed into 
      something the range optimizer can handle.
    ------------------------------------------------------------
    revno: 3690.68.11
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-19 12:25:03 +0300
    message:
      ib_senderrf(): Remove InnoDB: prefix from client error messages.
      
      Approved by Sunny Bains on IM.
    ------------------------------------------------------------
    revno: 3690.68.10 [merge]
    committer: Harin Vadodaria<harin.vadodaria@oracle.com>
    branch nick: trunk_bug11753779
    timestamp: Tue 2012-06-19 14:47:50 +0530
    message:
      Bug#11753779: MAX_CONNECT_ERRORS WORKS ONLY WHEN 1ST
                    INC_HOST_ERRORS() IS CALLED.
                  
      Description: Null merge from MySQL 5.5 to MySQL Trunk
        ------------------------------------------------------------
        revno: 2875.391.1 [merge]
        committer: Harin Vadodaria<harin.vadodaria@oracle.com>
        branch nick: 55_bug11753779
        timestamp: Tue 2012-06-19 13:54:31 +0530
        message:
          Bug#11753779: MAX_CONNECT_ERRORS WORKS ONLY WHEN 1ST
                        INC_HOST_ERRORS() IS CALLED.
                
          Description: Merge from MySQL 5.1 to MySQL 5.5
                       Reverting patch 3869 for bug#11753779
            ------------------------------------------------------------
            revno: 2661.850.1
            committer: Harin Vadodaria<harin.vadodaria@oracle.com>
            branch nick: 51_bug11753779
            timestamp: Tue 2012-06-19 12:56:40 +0530
            message:
              Bug#11753779: MAX_CONNECT_ERRORS WORKS ONLY WHEN 1ST
                            INC_HOST_ERRORS() IS CALLED.
              
              Description: Reverting patch 3755 for bug#11753779
    ------------------------------------------------------------
    revno: 3690.68.9
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Tue 2012-06-19 19:01:20 +1000
    message:
      Update result file.
    ------------------------------------------------------------
    revno: 3690.68.8
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-cleanup
    timestamp: Tue 2012-06-19 10:28:27 +0200
    message:
      Bug#13915200 SET GLOBAL DEBUG CAUSES CRASHES IN DBUG.C, RACE CONDITIONS
      
      Removal patch.
      
      The proposed solution hangs for Windows platforms,
      more analysis is needed.
    ------------------------------------------------------------
    revno: 3690.68.7
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Tue 2012-06-19 17:32:16 +1000
    message:
      Bug#14172439 - INNODB.INNODB-ALTER-DISCARD TEST FAILS ON PB2 SPORADICALLY
      
      Add a suppression message to the test.
      
      Approved by Marko over IM.
    ------------------------------------------------------------
    revno: 3690.68.6
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Tue 2012-06-19 16:35:20 +1000
    message:
      Bug#14212131 - ALTER DISCARD SHOULD NOT RENAME .IBD FILE TO .IBT
      
      ALTER TABLE T DISCARD TABLESPACE; will rename the .ibd file to a .ibt file. 
      This is really unnecessary. Secondly, we don't guarantee that the file is 
      usable if renamed back to .ibd. 
      
      rb://1117 Approved by Jimmy Yang.
    ------------------------------------------------------------
    revno: 3690.68.5
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-cleanup
    timestamp: Mon 2012-06-18 23:32:59 +0200
    message:
      Fixed windows build breaks, used wrapper APIs for pthread_rwlock
    ------------------------------------------------------------
    revno: 3690.68.4
    committer: kevin.lewis@oracle.com
    branch nick: mysql-trunk
    timestamp: Mon 2012-06-18 12:53:54 -0500
    message:
      Attempt to fix several intermittent and platform specific PB2
      failures from the wl 5980 push.
      
      innodb-multiple-tablespaces;  This test causes a code path where
      InnoDB will not start up because there are two versions of a
      tablespace available during recovery.  This path should exit with
      exit(1) instead of ut_a() since MTR will stop the test if it finds
      a call stack on some platforms.
      
      This test had a very rare timing related error where a --remove-file 
      command in MTR did not work. This patch replaces --copy_file followed
      by --remove_file with just a single --move-file.
      
      innodb-wl5980-discard;  One failure on one platform  out of over a
      dozen runs involves a pre-existing entry in the InnoDB tablespace
      cache for 'test/t1' when a new 'test/t1' is being added.  In case
      this is  a conflict with another test run in parallel, the tablename
      is changed to 'test/t5980'.
    ------------------------------------------------------------
    revno: 3690.68.3
    committer: Guilhem Bichot <guilhem.bichot@oracle.com>
    branch nick: trunk3
    timestamp: Mon 2012-06-18 18:37:52 +0200
    message:
      Fix for Bug#14145442 'INSERT IGNORE .. SELECT : PROTOCOL::END_STATEMENT(): ASSERTION `0' FAILED.'
    ------------------------------------------------------------
    revno: 3690.68.2 [merge]
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-bug13915200
    timestamp: Mon 2012-06-18 17:47:35 +0200
    message:
      Local merge
        ------------------------------------------------------------
        revno: 3690.34.138
        committer: Alfranio Correia <alfranio.correia@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-18 15:03:38 +0100
        message:
          Mats Kindahl	2012-05-29
          
          Bug#14123372: SEMI-SYNC REPLICATION GETS WRONG NOTIFICATIONS AFTER A ROTATION
                
          The set_trans_pos and get_trans_pos interface does not copy the file name and
          just keep the pointer into the file name. The reason for this is to avoid the
          overhead of managing memory for the copy. This causes a problem if a rotate is
          executed between the set_trans_pos and the corresponding get_trans_pos.
                
          This patch solves the problem by moving the replication hooks, which are the
          users of this information, to before the rotation is executed. The commit hook
          is placed inside ha_commit_low, which is called from all transation
          coordinators, and the rollback hook is called from inside ha_rollback_low.
          Since rotation cannot occur until all written transactions have been committed
          in the engine, no rotation will occur before any transaction that is written to
          the current binlog file have been committed or rolled back.
        ------------------------------------------------------------
        revno: 3690.34.137
        committer: Guilhem Bichot <guilhem.bichot@oracle.com>
        branch nick: trunk6
        timestamp: Mon 2012-06-18 15:26:42 +0200
        message:
          BUG#14168371 - OPTIMIZER TRACING: CRASH WITH SELECT .. LIKE
          (SELECT .. GROUP BY .. ORDER BY )
          Only adding testcase.
          This bug does not exist anymore because since the push of WL 4443,
          a subquery will not be considered constant until tables are locked,
          and tables won't be locked until top JOIN's prepare() is finished.
          Thus a subquery will not be evaluated in the top JOIN's prepare().
          Before WL 4443, this did happen. The evaluation created some items
          (pointing to a tmp table for execution of GROUP BY) which were freed
          at end of subquery's execution; back to top JOIN's prepare(), we
          wanted to print top query to opt trace, which printed subquery too,
          which printed freed items => crash.
        ------------------------------------------------------------
        revno: 3690.34.136
        committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-18 17:37:40 +0530
        message:
          Disabling rpl_max_allowed_packet_stress test on Solaris and Darwin,because it require around 6GB of free space and causing other tests to fail.
        ------------------------------------------------------------
        revno: 3690.34.135
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-18 13:41:54 +0300
        message:
          Bug#14198766 (followup) row_drop_table_for_mysql releases dict latch
          while holding dict locks
          
          The original patch had a problem: it could release the dictionary latch
          after waiting that the background statistics thread had stopped using
          the table. Fix that.
          
          ha_innobase::commit_inplace_alter_table(): Invoke fts_optimize_remove_table()
          first, before acquiring the data dictionary latch.
          
          Approved by Jimmy Yang on IM.
        ------------------------------------------------------------
        revno: 3690.34.134
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-18 09:52:23 +0300
        message:
          Followup to vasil.dimov@oracle.com-20120614104303-4jif0349u564y5np
          
          Also skip corrupted, to be dropped and online ddl indexes during
          stats snapshot create.
        ------------------------------------------------------------
        revno: 3690.34.133 [merge]
        committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
        branch nick: mysql-trunk-merge
        timestamp: Mon 2012-06-18 10:23:44 +0200
        message:
          Merge 5.5->trunk.
            ------------------------------------------------------------
            revno: 2875.388.17 [merge]
            committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
            branch nick: mysql-5.5-merge
            timestamp: Mon 2012-06-18 09:45:42 +0200
            message:
              Merge 5.1->5.5.
                ------------------------------------------------------------
                revno: 2661.840.33
                committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
                branch nick: mysql-5.1-13003736
                timestamp: Mon 2012-06-18 09:20:12 +0200
                message:
                  Bug#13003736 CRASH IN ITEM_REF::WALK WITH SUBQUERIES
                  
                  Problem: Some queries with subqueries and a HAVING clause that
                  consists only of a column not in the select or grouping lists causes
                  the server to crash.
                  
                  During parsing, an Item_ref is constructed for the HAVING column. The
                  name of the column is resolved when JOIN::prepare calls fix_fields()
                  on its having clause. Since the column is not mentioned in the select
                  or grouping lists, a ref pointer is not found and a new Item_field is
                  created instead. The Item_ref is replaced by the Item_field in the
                  tree of HAVING clauses. Since the tree consists only of this item, the
                  pointer that is updated is JOIN::having. However,
                  st_select_lex::having still points to the Item_ref as the root of the
                  tree of HAVING clauses.
                  
                  The bug is triggered when doing filesort for create_sort_index(). When
                  find_all_keys() calls select->cond->walk() it eventually reaches
                  Item_subselect::walk() where it continues to walk the having clauses
                  from lex->having. This means that it finds the Item_ref instead of the
                  new Item_field, and Item_ref::walk() tries to dereference the ref
                  pointer, which is still null.
                  
                  The crash is reproducible only in 5.5, but the problem lies latent in
                  5.1 and trunk as well.
                  
                  Fix: After calling fix_fields on the having clause in JOIN::prepare(),
                  set select_lex::having to point to the same item as JOIN::having.
                  
                  This patch also fixes a bug in 5.1 and 5.5 that is triggered if the
                  query is executed as a prepared statement. The Item_field is created
                  in the runtime arena when the query is prepared, and the pointer to
                  the item is saved by st_select_lex::fix_prepare_information() and
                  brought back as a dangling pointer when the query is executed, after
                  the runtime arena has been reclaimed.
                  
                  Fix: Backport fix from trunk that switches to the permanent arena
                  before calling Item_ref::fix_fields() in JOIN::prepare().
                ------------------------------------------------------------
                revno: 2661.840.32
                author: kent.boortz@oracle.com
                committer: Kent Boortz <kent.boortz@oracle.com>
                branch nick: mysql-5.1
                timestamp: Fri 2012-06-15 13:31:27 +0200
                message:
                  Raise version number after cloning 5.1.64
            ------------------------------------------------------------
            revno: 2875.388.16
            committer: Sunanda Menon <sunanda.menon@oracle.com>
            branch nick: mysql-5.5
            timestamp: Fri 2012-06-15 10:34:18 +0200
            message:
              Raising the VERSION number after 5.5.26 clone-off
        ------------------------------------------------------------
        revno: 3690.34.132
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-15 19:05:12 +0300
        message:
          Extend the check on sanity of mysql.innodb_table_stats and
          mysql.innodb_index_stats wrt the number of FKs there are pointing to
          and out of each of the two tables.
          
          If there is a FK between those two tables, InnoDB may assert.
        ------------------------------------------------------------
        revno: 3690.34.131
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-15 17:53:59 +0300
        message:
          Remove unused struct dict_stats_struct
        ------------------------------------------------------------
        revno: 3690.34.130
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: trunk
        timestamp: Mon 2012-06-18 05:11:21 +1000
        message:
          Bug#14139728 - STLPORT NAME CLASH WITH MUTEX_T
          
          Rename mutex_struct to ib_mutex_t. Get rid of the #define from mutex_t to
          ib_mutex_t.
          
          rb://1100 Approved by Marko Makela
        ------------------------------------------------------------
        revno: 3690.34.129
        committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
        branch nick: 56-1
        timestamp: Sat 2012-06-16 09:49:31 +0100
        message:
          post-merge fixies
        ------------------------------------------------------------
        revno: 3690.34.128
        committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
        branch nick: 56-1
        timestamp: Fri 2012-06-15 22:11:49 +0100
        message:
          aftermath of Bug#13431369: MAIN.VARIABLES-NOTEMBEDDED CRASHES THE SERVER SPORADICALLY ON WINDOWS
          
          turn test case back on.
        ------------------------------------------------------------
        revno: 3690.34.127
        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-15 17:37:59 +0100
        message:
          BUG#13635612: VALGRIND ERRORS IN REPLICATION
          
          There was a possible memory leak when multi thread slave coordinator is
          waiting for successful job enqueue on worker queue and slave is stopped 
          (3rd error on bug report).
          
          Ensure that when job enqueue on worker is interrupted the current event
          is deleted and the error propagated to coordinator.
          
          @ sql/rpl_info_factory.cc
             Slave_worker::end_info() now is private.
          @ sql/rpl_rli_pdb.h
             Removal of unused code and make Slave_worker::end_info() private, now
             it is implicitly called by Slave_worker destructor.
          @ sql/rpl_rli_pdb.cc
             Refactored Slave_worker destructor to call end_info() and free worker
             jobs queues.
             Changed append_item_to_jobs() in order to inform caller when it is 
             interrupted.
          @ sql/rpl_slave.cc
             Ensure that slave_start_workers() and slave_stop_workers() have proper
             mutex locked.
             Changed apply_event_and_update_pos() in order to take in account 
             possible append_item_to_jobs() interruptions.
        ------------------------------------------------------------
        revno: 3690.34.126
        committer: kevin.lewis@oracle.com
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-15 10:58:39 -0500
        message:
          Compiler warning, unused variable.
        ------------------------------------------------------------
        revno: 3690.34.125 [merge]
        committer: kevin.lewis@oracle.com
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-15 10:34:22 -0500
        message:
          Merge with mysql-trunk
            ------------------------------------------------------------
            revno: 3690.69.1
            committer: Iggy Galarza <iggy.galarza@oracle.com>
            branch nick: mysql-trunk_no_icw
            timestamp: Fri 2012-06-15 10:47:32 -0400
            message:
              Remove Instance Config Wizard and it's associated UI elements from the Windows MSI package.
        ------------------------------------------------------------
        revno: 3690.34.124
        committer: kevin.lewis@oracle.com
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-15 10:32:44 -0500
        message:
          WL#5980  - Allow remote tablespaces
          
          This patch implements the following;
          1)  Two new system tables, SYS_TABLESPACES & SYS_DATAFILES.
          Code to create them, add and delete records when tablespaces are created
          and dropped, and code to read them.
          2)  Two new INFORMATION_SCHEMA tables;
          INNODB_SYS_TABLESPACES & INNODB_SYS_DATAFILES
          3)  New columns to INFORMATION_SCHEMA.INNODB_SYS_TABLES so that the
          FLAGS field is interpreted like it is in INNODB_SYS_TABLESPACES.
          4)  Code to use and display the DATA DIRECTORY clause of a CREATE TABLE
          statement.
          5)  Recovery mechanisms to find remote tablespaces.
          6)  Changes to handle TRUNCATE TABLE, RENAME TABLE, DISCARD/IMPORT and
          inplace alter.
          7)  Code to allow a tablespace to be relocated.  When the engine starts up,
          it reads the new location from an ISL file.
          8)  Changes to several test cases and many new tests.
          
          See worklog 5980 for a full description of the design.
        ------------------------------------------------------------
        revno: 3690.34.123
        committer: kevin.lewis@oracle.com
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-15 09:01:42 -0500
        message:
          Bug #14169459 INNODB; DROP TABLE DOES NOT DELETE THE IBD FILE
          FOR A TEMPORARY TABLE.
          
          This patch has a number of changes. The main one to fix this problem
          is an extra test in row_drop_table_for_mysql() for '!temp' before
          calling fil_space_for_table_exists_in_mem() to check for 'unknown or
          discarded' tablespaces.
          
          The patch also adds the ibd extension to the temporary tablespace path
          before creating a fil_space_t.  This is how 5.5 does it.  
          
          Another change is in fil_delete_file(), a new function associated with
          the worklog 5522, where fil_make_cfg_name() and fil_make_ibt_name() are
          called with a tablename instead of a path as they should.
          This caused the function to not work at all for cfg and ibt files.
          Because of this, innodb-index-online.test was leaving a 't1.ibt' file
          behind in the data directory.  
          
          Also, in fil_delete_tablespace(), where it is called with rename=true,
          the logic was slightly wrong so that if an ibt file already existed, the
          code would fail to rename the ibd tablespace to the ibt extention.
          
          The function os_file_delete_if_exists() is improved so that if a directory
          does not exist on Windows, it behaves just a s if the file does not exist.
          
          Some related functions were changed to use bool instead of ibool.
          And row_drop_table_for_mysql() was cleaned up in its use of multiple
          tablename variables.
        ------------------------------------------------------------
        revno: 3690.34.122
        committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
        branch nick: mysql-trunk-14096759
        timestamp: Fri 2012-06-15 15:29:52 +0400
        message:
          Fix for bug#14096759 "INPLACE ALTER, FIELD_FLAG FIELD_IN_ADD_INDEX HAS 
          BEEN REMOVED FROM SERVER".
          
          After WL@5534 "Online ALTER, Phase 1" has introduced new in-place ALTER
          TABLE API semantics of FIELD_IN_ADD_INDEX flag became unclear and thus
          this flag was removed from the code.
          
          It turns out that Cluster's implementation of Online ALTER still needs
          this flag as it allows to avoid extra iterations through keys list.
          
          This patch re-introduces this flag with a new, clearly defined 
          semantics:
          - it is now set for fields in TABLE object which correspond to 
            new version of altered table.
          - it is set for all fields which participate in newly added keys,
            including fields that exist in old version of table and fields 
            that were added by the same ALTER TABLE.
        ------------------------------------------------------------
        revno: 3690.34.121
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-15 12:35:09 +0300
        message:
          Bug#14198766 row_drop_table_for_mysql() releases dict_operation_lock latch
          while holding record locks on data dictionary tables
          
          This bug mostly affects a table rebuild, such as ADD PRIMARY KEY.
          
          ha_innobase::commit_inplace_alter_table(): Invoke
          dict_stats_wait_bg_to_stop_using_tables() on both tables upfront.
          
          row_drop_table_for_mysql(): Do not invoke
          dict_stats_wait_bg_to_stop_using_tables() if data dictionary locks
          were already acquired by the caller (signalled by a new parameter,
          nonatomic=false). Remove the code that waits for the full-text-search
          related background threads to exit. According to Jimmy, this is stale
          code that should be removed. Add a debug assertion to enforce
          !table->fts->add_wq.
          
          row_merge_drop_table(): Add the parameter nonatomic.
          
          rb:1112 approved by Jimmy Yang
        ------------------------------------------------------------
        revno: 3690.34.120
        committer: Yasufumi Kinoshita <yasufumi.kinoshita@oracle.com>
        branch nick: mysql-trunk_test
        timestamp: Fri 2012-06-15 16:56:17 +0900
        message:
          reorder sql/share/errmsg-utf8.txt about Japanese support
           removed 'jps' entries (because not used at all);
           translated/re-translated major 'jpn' entries accurately;
          
          * reviewed among Japanese-native technical members.
        ------------------------------------------------------------
        revno: 3690.34.119
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Thu 2012-06-14 13:43:03 +0300
        message:
          In dict_stats_snapshot_create() also copy
          dict_table_t::corrupted
          dict_index_t::to_be_dropped
          dict_index_t::online_status
          because we will look at those flags during dict_stats_save() in order to
          determine whether to skip the index.
          
          Do skip the corrupted, online ddl or to be dropped indexes from stats save.
        ------------------------------------------------------------
        revno: 3690.34.118
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Thu 2012-06-14 13:37:31 +0300
        message:
          Add assertions that we never encounter an universal index
          (dict_index_is_univ()) during stats processing.
          
          Move the code for emptying an index's stats into a new dedicated function
          dict_stats_empty_index() and call it from dict_stats_empty_table() (non
          functional change).
          
          Skip FTS indexes from dict_stats_empty_table().
          
          In dict_stats_update_persistent() empty the stats for indexes that we are
          skipping and that may be picked up later by dict_stats_save(). This way
          we make sure that we do not leave uninitialized stats in some index during
          stats update which may later be picked up by stats save. For example if
          the online status of that index changes. FTS indexes should always be skipped
          from both stats update and save.
        ------------------------------------------------------------
        revno: 3690.34.117 [merge]
        committer: sayantan.dutta@oracle.com
        branch nick: mysql-trunk
        timestamp: Thu 2012-06-14 17:26:32 +0530
        message:
          null merge 13946716
            ------------------------------------------------------------
            revno: 2875.388.15 [merge]
            tags: clone-5.5.26-build
            committer: sayantan.dutta@oracle.com
            branch nick: mysql-5.5
            timestamp: Thu 2012-06-14 17:18:08 +0530
            message:
              null merge 13946716
                ------------------------------------------------------------
                revno: 2661.840.31
                tags: clone-5.1.64-build
                committer: sayantan.dutta@oracle.com
                branch nick: mysql-5.1
                timestamp: Thu 2012-06-14 17:07:49 +0530
                message:
                  BUG #13946716: FEDERATED_PLUGIN TEST CASE FAIL ON 64BIT ARCHITECTURES
        ------------------------------------------------------------
        revno: 3690.34.116
        committer: sayantan.dutta@oracle.com
        branch nick: mysql-trunk
        timestamp: Thu 2012-06-14 17:21:32 +0530
        message:
          Bug #14112682 : MYSQLTEST: PROVIDE ACCESS TO ERROR NAMES THROUGH NUMERIC CODES AND VICE VERSA
    ------------------------------------------------------------
    revno: 3690.68.1
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-bug13915200
    timestamp: Fri 2012-06-15 18:35:44 +0200
    message:
      Bug#13915200 SET GLOBAL DEBUG CAUSES CRASHES IN DBUG.C, RACE CONDITIONS
      
      (version 2, implemented review comments)
      
      Before this fix,
      numerous test scripts such as performance_schema.hostcache_*.test
      would fail with random crashes in the dbug code.
      
      These tests are very recent, and use SET GLOBAL DEBUG.
      
      SET GLOBAL DEBUG is implemented by calling Sys_var_dbug::global_update(),
      which calls DBUG_SET_INITIAL() in the dbug code.
      
      DBUG_SET_INITIAL modifies the global variable init_settings,
      and does this without any protection for race conditions.
      
      Other threads executing dbug code will read data from this global variable,
      while it is being changed concurrently, and crash.
      
      For example, DBUG_PRINT() very often crash while using memory from
      cs->stack->keywords, while the init_settings.keywords list is being
      manipulated to either free the list, add items or remove items.
      
      The fix for this bug is to actually protect init_settings against race
      conditions.
      
      Given that almost all the dbug code uses various members from
      cs->stack->xxxx, and that stack may well be the init_settings global stack
      bottom, all the dbug code is sensitive to race conditions.
      
      Given that SET GLOBAL DEBUG is a very rarely used statement,
      the solution implemented is as follows:
      
      - use a read lock when executing most dbug apis,
        and acquire the read lock at the top level.
      - the read lock is shared, so that many threads can still execute
        DBUG_XXX apis concurrently.
      - use a write lock when modifying the content of init_settings,
        which in practice is done only on DBUG_SET_INITIAL() and DBUG_END().
      
      When a thread in the server executes SET GLOBAL DEBUG,
      this thread will block and wait for every other thread to exit the various
      DBUG_XXX apis called, if any, before proceeding (safely) to change the
      global debugging settings.
------------------------------------------------------------
revno: 3890 [merge]
committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Thu 2012-06-14 16:18:40 +0400
message:
  Auto merge from mysql-trunk.
    ------------------------------------------------------------
    revno: 3690.34.115
    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
    branch nick: b13783690-t
    timestamp: Thu 2012-06-14 12:49:21 +0200
    message:
      bug#13783690
      
      Requiring --big-test for some of the long running tests in the parts test suite.
    ------------------------------------------------------------
    revno: 3690.34.114 [merge]
    committer: magnus.blaudd@oracle.com
    branch nick: trunk
    timestamp: Thu 2012-06-14 10:10:07 +0200
    message:
      Merge in patch for bug#14192728
        ------------------------------------------------------------
        revno: 3690.67.1
        committer: magnus.blaudd@oracle.com
        branch nick: trunk-bug14192728
        timestamp: Wed 2012-06-13 21:34:19 +0200
        message:
          Bug#14192728 WL#5597 LEFTOVERS? AFFECTING MYSQL CLUSTER REPLICATION
           - Remove temporary "fix-up"
    ------------------------------------------------------------
    revno: 3690.34.113
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-14 13:03:14 +0530
    message:
      Considering the time taken for this test on slow solaris platforms making it a big test
    ------------------------------------------------------------
    revno: 3690.34.112
    committer: Manish Kumar<manish.4.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-14 11:26:01 +0530
    message:
      BUG#12400221 - 60926: BINARY LOG EVENTS LARGER THAN MAX_ALLOWED_PACKET
      
      Description: fixing some failing tests on PB2.
    ------------------------------------------------------------
    revno: 3690.34.111 [merge]
    committer: Harin Vadodaria<harin.vadodaria@oracle.com>
    branch nick: trunk_bug11753779_merge2
    timestamp: Thu 2012-06-14 10:47:51 +0530
    message:
      Bug#11753779: MAX_CONNECT_ERRORS WORKS ONLY WHEN 1ST
                    INC_HOST_ERRORS() IS CALLED.
      
      Description: Null merge from MySQL-5.5 to MySQL-Trunk
        ------------------------------------------------------------
        revno: 2875.388.14 [merge]
        committer: Harin Vadodaria<harin.vadodaria@oracle.com>
        branch nick: 55_bug11753779_merge2
        timestamp: Wed 2012-06-13 17:00:55 +0530
        message:
          Bug#11753779: MAX_CONNECT_ERRORS WORKS ONLY WHEN 1ST
                        INC_HOST_ERRORS() IS CALLED.
          
          Description: Merge from MySQL-5.1 to MySQL-5.5
            ------------------------------------------------------------
            revno: 2661.840.30
            committer: Harin Vadodaria<harin.vadodaria@oracle.com>
            branch nick: 51_bug11753779
            timestamp: Wed 2012-06-13 16:03:58 +0530
            message:
              Bug#11753779: MAX_CONNECT_ERRORS WORKS ONLY WHEN 1ST
                            INC_HOST_ERRORS() IS CALLED.
              
              Issue       : Sequence of calling inc_host_errors()
                            and reset_host_errors() required some
                            changes in order to maintain correct
                            connection error count.
              
              Solution    : Call to reset_host_errors() is shifted
                            to a location after which no calls to
                            inc_host_errors() are made.
    ------------------------------------------------------------
    revno: 3690.34.110
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-14 10:37:46 +0530
    message:
      fixing the rpl_packet test by updating the result file.
    ------------------------------------------------------------
    revno: 3690.34.109
    committer: Serge Kozlov <Serge.Kozlov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-13 21:01:04 +0400
    message:
      BUG#13854078. Fix the race condition for concurrent tests:
      Concurrent tests require two or more connections and at least one connection sends the statements in async mode (via send/reap command). We need to make sure that SET GTID_NEXT is completed for all connections before getting values of GTID variables and if COMMIT/ROLLBACK executed for any connection.
    ------------------------------------------------------------
    revno: 3690.34.108 [merge]
    committer: Manish Kumar<manish.4.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-13 16:46:44 +0530
    message:
      BUG#12400221 - 60926: BINARY LOG EVENTS LARGER THAN MAX_ALLOWED_PACKET
      
      Null merge from mysql-5.5->mysql-trunk
        ------------------------------------------------------------
        revno: 2875.388.13 [merge]
        committer: Manish Kumar<manish.4.kumar@oracle.com>
        branch nick: mysql-5.5
        timestamp: Wed 2012-06-13 16:40:54 +0530
        message:
          BUG#12400221 - 60926: BINARY LOG EVENTS LARGER THAN MAX_ALLOWED_PACKET
          
          Null merge from mysql-5.1->mysql-5.5
            ------------------------------------------------------------
            revno: 2661.840.29 [merge]
            committer: Manish Kumar<manish.4.kumar@oracle.com>
            branch nick: mysql-5.1
            timestamp: Tue 2012-06-12 12:59:13 +0530
            message:
              BUG#12400221 - 60926: BINARY LOG EVENTS LARGER THAN MAX_ALLOWED_PACKET
              
              Problem
              ========
                          
              Replication breaks in the cases if the event length exceeds 
              the size of master Dump thread's max_allowed_packet.
                            
              The reason why this failure is occuring is because the event length is
              more than the total size of the max_allowed_packet, on addition of the  
              max_event_header length exceeds the max_allowed_packet of the DUMP thread.
              This causes the Dump thread to break replication and throw an error.
                                    
              That can happen e.g with row-based replication in Update_rows event.
                          
              Fix
              ====
                        
              The problem is fixed in 2 steps:
              
              1.) The Dump thread limit to read event is increased to the upper limit
                  i.e. Dump thread reads whatever gets logged in the binary log.
              
              2.) On the slave side we increase the the max_allowed_packet for the
                  slave's threads (IO/SQL) by increasing it to 1GB.
              
                  This is done using the new server option (slave_max_allowed_packet)
                  included, is used to regulate the max_allowed_packet of the  
                  slave thread (IO/SQL) by the DBA, and facilitates the sending of
                  large packets from the master to the slave.
              
                  This causes the large packets to be received by the slave and apply
                  it successfully.
    ------------------------------------------------------------
    revno: 3690.34.107
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-13 14:09:07 +0300
    message:
      Non-functional change: Remove redundant casts to THD*.
    ------------------------------------------------------------
    revno: 3690.34.106 [merge]
    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
    branch nick: wl4443-trunk_23
    timestamp: Wed 2012-06-13 12:12:13 +0200
    message:
      WL#4443: Remove scalability problem with many lock's
      and external lock's on partitioned tables with many partitions.
      
      merge with latest mysql-trunk
        ------------------------------------------------------------
        revno: 3690.66.1 [merge]
        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
        branch nick: wl4443-trunk_22
        timestamp: Mon 2012-06-11 13:30:25 +0200
        message:
          WL#4443: Remove scalability problem with many lock's
          and external lock's on partitioned tables with many partitions.
          
          Manual merge with latest mysql-trunk
            ------------------------------------------------------------
            revno: 3690.65.3
            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
            branch nick: wl4443-trunk_21
            timestamp: Tue 2012-06-05 12:11:30 +0200
            message:
              WL#4443: Remove scalability problem with many lock's
              and external lock's on partitioned tables with many partitions.
              
              Minor test cleanup.
              Removed is_pruning_completed= true when tree type was
              not KEY/KEY_SMALLER, since it was not covered and possibly
              not true.
            ------------------------------------------------------------
            revno: 3690.65.2
            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
            branch nick: wl4443-trunk_21
            timestamp: Fri 2012-06-01 22:31:34 +0200
            message:
              WL#4443: Remove scalability problem with many lock's
              and external lock's on partitioned tables with many partitions.
              
              Updated test.
              
              - Turned off innodb persistent stats.
              - Removed some duplicate tests.
              - Filtered estimated rows in EXPLAIN to get more stable results.
            ------------------------------------------------------------
            revno: 3690.65.1 [merge]
            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
            branch nick: wl4443-trunk_21
            timestamp: Fri 2012-06-01 16:02:36 +0200
            message:
              WL#4443: Remove scalability problem with many lock's
              and external lock's on partitioned tables with many partitions.
              
              Merge with latest mysql-trunk.
                ------------------------------------------------------------
                revno: 3690.64.2
                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                branch nick: wl4443-trunk_20
                timestamp: Fri 2012-06-01 14:19:39 +0200
                message:
                  WL#4443: Remove scalability problem with many lock's
                  and external lock's on partitioned tables with many partitions.
                  
                  Fixed code in partition_info.cc to be easier to cover.
                  
                  Removed extra parentheses in ha_ndbcluster.cc.
                  
                  Removed the feature specific push test collection.
                ------------------------------------------------------------
                revno: 3690.64.1 [merge]
                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                branch nick: wl4443-trunk_20
                timestamp: Fri 2012-06-01 02:04:28 +0200
                message:
                  WL#4443: Remove scalability problem with many lock's
                  and external lock's on partitioned tables with many partitions.
                  
                  Manual merge with latest mysql-trunk.
                    ------------------------------------------------------------
                    revno: 3690.63.8
                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                    branch nick: wl4443-trunk_19
                    timestamp: Fri 2012-06-01 01:23:37 +0200
                    message:
                      WL#4443: Remove scalability problem with many lock's
                      and external lock's on partitioned tables with many partitions.
                      
                      - Added coverage tests.
                      - Added second prune_partitions call in mysql_update,
                        to prune after subqueries and stored programs after
                        locking.
                      - Fixed the problem with avoiding the second SEL_TREE creation,
                        in the second prune_partitions() call, for conditions that did not
                        have any subqueries or stored functions.
                      - Updated copyright year.
                      - some minor cleanup.
                    ------------------------------------------------------------
                    revno: 3690.63.7
                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                    branch nick: wl4443-trunk_19
                    timestamp: Thu 2012-05-31 01:26:54 +0200
                    message:
                      WL#4443: Remove scalability problem with many lock's
                      and external lock's on partitioned tables with many partitions.
                      
                      Fixed partition_info::is_full_part_expr_in_fields which
                      always returned false. Found during gcov analysis.
                    ------------------------------------------------------------
                    revno: 3690.63.6
                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                    branch nick: wl4443-trunk_19
                    timestamp: Wed 2012-05-30 22:57:02 +0200
                    message:
                      WL#4443: Remove scalability problem with many lock's
                      and external lock's on partitioned tables with many partitions.
                      
                      Minor cleanup, spelling and added one extra test for coverage.
                    ------------------------------------------------------------
                    revno: 3690.63.5
                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                    branch nick: wl4443-trunk_19
                    timestamp: Wed 2012-05-30 20:52:53 +0200
                    message:
                      WL#4443: Remove scalability problem with many lock's
                      and external lock's on partitioned tables with many partitions
                      
                      A stored program can not be constant until it is locked.
                      
                      Fixed by always setting const_item_cache to false
                      during fix_fields if tables are not locked.
                    ------------------------------------------------------------
                    revno: 3690.63.4
                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                    branch nick: wl4443-trunk_19
                    timestamp: Wed 2012-05-30 18:17:11 +0200
                    message:
                      WL#4443:
                      Reverted clearing the Item_func_sp::const_item_cache.
                      which caused re-evaluation instead of using the cached
                      value for deterministic functions.
                    ------------------------------------------------------------
                    revno: 3690.63.3
                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                    branch nick: wl4443-trunk_19
                    timestamp: Wed 2012-05-30 17:57:51 +0200
                    message:
                      WL#4443:
                      Implemented has_stored_program() (like has_subquery()).
                      Added tests for subqueries and stored functions in the WHERE
                      clause for select, update and delete.
                    ------------------------------------------------------------
                    revno: 3690.63.2
                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                    branch nick: wl4443-trunk_19
                    timestamp: Wed 2012-05-30 00:14:39 +0200
                    message:
                      WL#4443:
                      final code change for dlenevs review.
                      - Don't use pruning in lock_count().
                      - Don't use pruning in store_lock() if not owning thd.
                      - Renamed is_fields_used_in_trigger to
                        is_fields_updated_in_trigger() and check if they
                        may be updated.
                      - moved out mark_fields_used(TRG_EVENT_UPDATE)
                        from mark_columns_needed_for_update().
                        And reverted the changed call order. And call
                        mark_fields_used(TRG_EVENT_UPDATE) instead.
                    ------------------------------------------------------------
                    revno: 3690.63.1 [merge]
                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                    branch nick: wl4443-trunk_19
                    timestamp: Tue 2012-05-29 21:18:45 +0200
                    message:
                      WL#4443:
                      Manual merge into latest mysql-trunk.
                      
                      also fixed the HA_OPEN_NO_PSI_CALL check.
                        ------------------------------------------------------------
                        revno: 3873.8.3
                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                        branch nick: wl4443-trunk_18
                        timestamp: Tue 2012-05-29 19:39:36 +0200
                        message:
                          WL#4443:
                          Replaced check for partitioned handler with
                          HA_OPEN_NO_PSI_CALL, to avoid using
                          psi for partitions.
                          
                          Changed using read_partitions to lock_partitions for pruning
                          of start_stmt.
                          
                          Now sets m_partitions_to_reset also in ::extra() calls.
                          
                          Use is_query_tables_locked() in prune_partitions() instead
                          of checking get_lock_type().
                        ------------------------------------------------------------
                        revno: 3873.8.2
                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                        branch nick: wl4443-trunk_18
                        timestamp: Tue 2012-05-29 14:52:32 +0200
                        message:
                          WL#4443
                          Addressed some minor review comments from dlenev:
                          - Removed get_timestamp_field from ndb code.
                          - Added comments.
                          - Removed Item_func_sp::can_be_evaluated_now, since
                            it was the same as the default implementation.
                          - Removed unneccesary check of has_subquery when
                            is_const_item_pruned was set.
                          - Reverted refactor of default_record function.
                        ------------------------------------------------------------
                        revno: 3873.8.1 [merge]
                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                        branch nick: wl4443-trunk_18
                        timestamp: Tue 2012-05-22 15:35:37 +0200
                        message:
                          WL#4443: Remove scalability problem with many lock's
                          and external lock's on partitioned tables with many partitions
                          
                          Merged into the latest mysql-trunk.
                            ------------------------------------------------------------
                            revno: 3828.1.9
                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                            branch nick: wl4443-trunk_17
                            timestamp: Tue 2012-05-22 11:57:00 +0200
                            message:
                              WL4443:
                              test/result fixes
                            ------------------------------------------------------------
                            revno: 3828.1.8
                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                            branch nick: wl4443-trunk_17
                            timestamp: Tue 2012-05-22 00:08:35 +0200
                            message:
                              WL4443:
                              Verified that tbl->embedding must be checked in ::optimize(),
                              and must not be checked in ::prepare().
                              
                              Added tests for const propagations (does not work for locks).
                              
                              Fixed rpl_auto_increment.test to avoid leaving files behind.
                            ------------------------------------------------------------
                            revno: 3828.1.7
                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                            branch nick: wl4443-trunk_17
                            timestamp: Sat 2012-05-19 01:11:36 +0200
                            message:
                              WL#4443
                              Fix for CREATE SELECT and delayed locking.
                              
                              To be consistent with the protocol for locking
                              and THD::decide_logging_format(), we postpone
                              locking of target table to after all locks has been
                              taken on the source tables.
                              
                              i.e. we create the table in create_select::prepare()
                              and lock it in create_select::prepare2().
                              prepare() is called from JOIN::prepare() and
                              prepare2() from JOIN::exec().
                            ------------------------------------------------------------
                            revno: 3828.1.6
                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                            branch nick: wl4443-trunk_17
                            timestamp: Thu 2012-05-17 00:27:00 +0200
                            message:
                              WL#4443
                              Fix + test for multi UPDATE with BEFORE UPDATE triggers.
                            ------------------------------------------------------------
                            revno: 3828.1.5
                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                            branch nick: wl4443-trunk_17
                            timestamp: Wed 2012-05-16 12:47:27 +0200
                            message:
                              WL4443:
                              fixed test to work on non default innodb-page-size
                              removed unused variable.
                            ------------------------------------------------------------
                            revno: 3828.1.4
                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                            branch nick: wl4443-trunk_17
                            timestamp: Wed 2012-05-16 12:34:02 +0200
                            message:
                              WL4443:
                              Updated DBUG_ASSERT in
                              open_normal_and_derived_tables
                              to better work with stored procedures without
                              prelocking.
                            ------------------------------------------------------------
                            revno: 3828.1.3
                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                            branch nick: wl4443-trunk_17
                            timestamp: Wed 2012-05-16 01:28:23 +0200
                            message:
                              WL#4443:
                              Added check of trigger columns vs
                              partitioning columns to see if possible to do
                              lock pruning.
                              
                              TODO: Fix multi update with triggers on two tables.
                            ------------------------------------------------------------
                            revno: 3828.1.2
                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                            branch nick: wl4443-trunk_17
                            timestamp: Tue 2012-05-15 16:30:09 +0200
                            message:
                              WL#4443:
                              Fix for crashes when failing during opening trigger tables.
                              
                              May need more work, but this fixes at least some crashes
                              found in RQG.
                            ------------------------------------------------------------
                            revno: 3828.1.1 [merge]
                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                            branch nick: wl4443-trunk_17
                            timestamp: Mon 2012-05-14 12:47:36 +0200
                            message:
                              WL#4443:
                              Merge into updated mysql-trunk.
                                ------------------------------------------------------------
                                revno: 3797.2.5
                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                branch nick: wl4443-trunk_16
                                timestamp: Sun 2012-05-13 22:50:05 +0200
                                message:
                                  WL#4443:
                                  Fixed result file.
                                  
                                  Removed DBUG_ASSERT:
                                  DBUG_ASSERT(bitmap_is_subset(&m_partitions_to_reset,
                                                           &m_part_info->lock_partitions));
                                  
                                  This fails for the first PREPARE call after LOCK TABLES.
                                ------------------------------------------------------------
                                revno: 3797.2.4
                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                branch nick: wl4443-trunk_16
                                timestamp: Sun 2012-05-13 03:57:16 +0200
                                message:
                                  WL#4443:
                                  Changes for the second 1/3 of dlenevs review comments chunk 2.
                                  
                                  Test fixes in partition_locking (including in moving out tests to
                                  partition_default_functions.inc)
                                  
                                  Removed duplicate warnings from insert pruning.
                                  
                                  warns if PARTITION () clause is used on temporary tables.
                                  
                                  Fixed default functions in insert pruning.
                                  
                                  + some cleanups
                                ------------------------------------------------------------
                                revno: 3797.2.3
                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                branch nick: wl4443-trunk_16
                                timestamp: Wed 2012-05-09 17:11:24 +0200
                                message:
                                  WL#4443:
                                  Changes for the first 1/3 of dlenevs review comments chunk 2.
                                  
                                  Mostly test/result changes to be more clear about what
                                  is tested.
                                  
                                  Fix for bitmap_get_next_set on big-endian machines.
                                  
                                  Minor cleanups.
                                ------------------------------------------------------------
                                revno: 3797.2.2
                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                branch nick: wl4443-trunk_16
                                timestamp: Tue 2012-05-08 21:20:18 +0200
                                message:
                                  WL#4443
                                  Avoid creating SEL_TREE when not needed in
                                  prune_partitions().
                                ------------------------------------------------------------
                                revno: 3797.2.1 [merge]
                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                branch nick: wl4443-trunk_16
                                timestamp: Tue 2012-05-08 01:28:51 +0200
                                message:
                                  WL#4443
                                  Merge into latest mysql-trunk
                                    ------------------------------------------------------------
                                    revno: 3743.3.2
                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                    branch nick: wl4443-trunk_15
                                    timestamp: Mon 2012-05-07 23:43:48 +0200
                                    message:
                                      WL#4443
                                      Fix for Item_func_sp::const_item.
                                      And one test result fix (same as in trunk)
                                    ------------------------------------------------------------
                                    revno: 3743.3.1 [merge]
                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                    branch nick: wl4443-trunk_15
                                    timestamp: Fri 2012-04-27 16:30:32 +0200
                                    message:
                                      WL#4443
                                      Merged into latest mysql-trunk for getting rid of dependency bug fixes.
                                        ------------------------------------------------------------
                                        revno: 3740.1.4
                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                        branch nick: wl4443-trunk_14
                                        timestamp: Fri 2012-04-27 13:53:19 +0200
                                        message:
                                          wl#4443:
                                          updated three resultsfiles
                                        ------------------------------------------------------------
                                        revno: 3740.1.3
                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                        branch nick: wl4443-trunk_14
                                        timestamp: Thu 2012-04-26 00:01:39 +0200
                                        message:
                                          WL#4443
                                          Fixed some minor reviewers comments:
                                          Removed arguments from prune_partitions.
                                          Added #ifdef WITH_PARTITION...
                                          Added DBUG_ASSERT for locking in JOIN::exec and optimize
                                          Removed join argument from mysql_prepare_select and
                                          mysql_execute_select.
                                        ------------------------------------------------------------
                                        revno: 3740.1.2
                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                        branch nick: wl4443-trunk_14
                                        timestamp: Wed 2012-04-25 22:09:10 +0200
                                        message:
                                          WL#4443:
                                          Make sure Item_func_sp::const_item is false until
                                          the tables are locked.
                                        ------------------------------------------------------------
                                        revno: 3740.1.1 [merge]
                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                        branch nick: wl4443-trunk_14
                                        timestamp: Wed 2012-04-25 15:58:08 +0200
                                        message:
                                          WL#4443
                                          Merged into latest mysql-trunk
                                            ------------------------------------------------------------
                                            revno: 3690.62.2
                                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                            branch nick: wl4443-trunk_13
                                            timestamp: Wed 2012-04-25 15:45:37 +0200
                                            message:
                                              WL#4443
                                              Changed Item according to second reviewers comments.
                                              (checking can_be_evaluated_now in const_item)
                                              
                                              Also fixed a bug found by first reviewer:
                                              INSERT INTO t VALUES ((subselect)) evaluated selects before
                                              locking.
                                            ------------------------------------------------------------
                                            revno: 3690.62.1 [merge]
                                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                            branch nick: wl4443-trunk_13
                                            timestamp: Fri 2012-04-13 12:28:00 +0200
                                            message:
                                              WL#4443 merged into latest mysql-trunk
                                                ------------------------------------------------------------
                                                revno: 3690.61.2 [merge]
                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                branch nick: wl4443-trunk_12
                                                timestamp: Fri 2012-04-13 08:59:54 +0200
                                                message:
                                                  wl#4443 merged in latest mysql-trunk
                                                ------------------------------------------------------------
                                                revno: 3690.61.1 [merge]
                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                branch nick: wl4443-trunk_12
                                                timestamp: Tue 2012-04-10 22:17:48 +0200
                                                message:
                                                  WL#4443 - Merge with updated mysql-trunk
                                                    ------------------------------------------------------------
                                                    revno: 3690.60.5
                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                    branch nick: wl4443_dlenev
                                                    timestamp: Sun 2012-04-08 00:58:11 +0200
                                                    message:
                                                      WL#4443 - Prune partition locks.
                                                      Updated with dlenev's review patch chunk 1.
                                                    ------------------------------------------------------------
                                                    revno: 3690.60.4
                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                    branch nick: wl4443-trunk_10
                                                    timestamp: Fri 2012-03-30 17:00:31 +0200
                                                    message:
                                                      WL#4443:
                                                      Updated some result files.
                                                      removed debug runs from push.
                                                      added fix for preventing stored functions to execute during prepare
                                                      (to avoid using tables before open/lock).
                                                    ------------------------------------------------------------
                                                    revno: 3690.60.3
                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                    branch nick: wl4443-trunk_10
                                                    timestamp: Thu 2012-03-29 22:31:17 +0200
                                                    message:
                                                      update test results.
                                                    ------------------------------------------------------------
                                                    revno: 3690.60.2 [merge]
                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                    branch nick: wl4443-trunk_10
                                                    timestamp: Thu 2012-03-29 21:41:33 +0200
                                                    message:
                                                      Merge of missing updates to wl#4443 updated with recent mysql-trunk
                                                        ------------------------------------------------------------
                                                        revno: 3402.98.4
                                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                        branch nick: wl4443-trunk
                                                        timestamp: Tue 2012-02-07 17:40:18 +0100
                                                        message:
                                                          WL#4443 - Updated test result files + added test collection for this branch.
                                                        ------------------------------------------------------------
                                                        revno: 3402.98.3
                                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                        branch nick: wl4443-trunk
                                                        timestamp: Tue 2012-02-07 15:58:37 +0100
                                                        message:
                                                          WL#4443 - did not compile with gcc, only VC++ due to enum issues.
                                                        ------------------------------------------------------------
                                                        revno: 3402.98.2 [merge]
                                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                        branch nick: wl4443-trunk
                                                        timestamp: Tue 2012-02-07 13:59:38 +0100
                                                        message:
                                                          merge of WL#4443 into more recent mysql-trunk
                                                        ------------------------------------------------------------
                                                        revno: 3402.98.1 [merge]
                                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                        branch nick: wl4443-trunk
                                                        timestamp: Tue 2012-02-07 13:09:07 +0100
                                                        message:
                                                          merge of 13008220 + 11761652, which is needed for WL#4443.
                                                    ------------------------------------------------------------
                                                    revno: 3690.60.1 [merge]
                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                    branch nick: wl4443-trunk_10
                                                    timestamp: Thu 2012-03-29 21:22:02 +0200
                                                    message:
                                                      Manual merge of WL#4443 into a more recent mysql-trunk
                                                        ------------------------------------------------------------
                                                        revno: 3402.97.1 [merge]
                                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                        branch nick: wl4443-trunk_9
                                                        timestamp: Tue 2012-02-07 12:41:21 +0100
                                                        message:
                                                          WL#4443 - Manual merge into updated -trunk tree
                                                          
                                                          Changed check if prunable due to timestamp default handling,
                                                          which was changed in 5874.
                                                            ------------------------------------------------------------
                                                            revno: 3402.92.5
                                                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                            branch nick: wl4443-trunk_8
                                                            timestamp: Fri 2012-02-03 14:55:31 +0100
                                                            message:
                                                              WL#4443 - Updated according to Mikaels review comments.
                                                              
                                                              Removed changes inside rebind/unbind_psi.
                                                              
                                                              Some bad indending fixed.
                                                              
                                                              refactored code into can_evaluate_item_now().
                                                              
                                                              renamed filed_for_view_update to field_for_view_update.
                                                              
                                                              Better comments for bitmap_intersect and bitmap_copy for pruned
                                                              read/lock partitions.
                                                              
                                                              Moved out partition specific code from mysql_insert to partition_info.
                                                              
                                                              Removed dbug prints.
                                                            ------------------------------------------------------------
                                                            revno: 3402.92.4
                                                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                            branch nick: wl4443-trunk_8
                                                            timestamp: Fri 2012-01-27 15:43:13 +0100
                                                            message:
                                                              WL#4443 - Additional boost pack for heavily partitioned tables.
                                                              
                                                              This is the low hanging fruits of performance patches that was discovered
                                                              after WL4443 was completed.
                                                              
                                                              Implemented bitmap_get_next_set and added it to the unittest.
                                                              This makes scanning through empty partitions much faster.
                                                              Very good for primary key/partition key and explicit prune
                                                              operations.
                                                              
                                                              Added m_started_partitions, which tracks which partitions that
                                                              are started for the current statement
                                                              (either in external_lock(!=F_UNLCK) or in start_stmt).
                                                              This prunes ha_partition::reset() to only call partitions
                                                              that where 'started'. Good for prepare statement, which
                                                              calls ha_reset() after prepare, without ever starting anything.
                                                              
                                                              Changed m_num_locks to be number of locks per partition,
                                                              instead of locks for all partitions. This is now used in
                                                              ha_partition::store_lock() to return the number of locks to be
                                                              used after pruning, instead of the old way, which was to return
                                                              the sum of locks needed for all partitions. This uses a bit less
                                                              resources and makes the get_lock_data() faster
                                                              (part of mysql_lock_tables).
                                                              
                                                              Skipping second call to prune_partitions (in the optimize step) if it
                                                              only has constant items and no subqueries, since it will not prune
                                                              anything more than it did in the prepare stage.
                                                              (prune_partitions takes several percent of the time for non complex
                                                              statements, like pk lookups.) One has to do the pruning in the prepare
                                                              stage, since it can prune external_lock/start_stmt.
                                                              So even if it costs more in prepare than it does in optimize,
                                                              the gain of pruning external_lock/start_stmt  is so much bigger.
                                                              
                                                              Disabled PSI_CALL(open_table)() call in ha_open and removed
                                                              rebind_psi/unbind_psi for partitions. Since this is done
                                                              when a table is opened, taken from the table cache or closed
                                                              and cannot be pruned, since pruning is done after open.
                                                              This avoids using too much resources and increase performance
                                                              for heavily partitioned tables, but will not remove the tracing of
                                                              table io for each partition.
                                                              
                                                              Refactored the init/free of the internal bitmaps over which
                                                              partitions that have been locked, started or called bulk_insert.
                                                            ------------------------------------------------------------
                                                            revno: 3402.92.3 [merge]
                                                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                            branch nick: wl4443-trunk_8
                                                            timestamp: Tue 2012-01-10 22:14:00 +0100
                                                            message:
                                                              WL#4443: Remove scalability problem with many lock's
                                                              and external lock's on partitioned tables with many partitions
                                                              
                                                              Merge of completed worklog with updated mysql-trunk and
                                                              13008220 and 11761652.
                                                              
                                                              Replaced calls to open_and_lock_tables with calls to
                                                              new functions open_query_tables and lock_query_tables
                                                              to be able to prepare use of tables including pruning of
                                                              partitions before locking them.
                                                              
                                                              open_query_tables and lock_query_tables only takes
                                                              thd as argument and store its state in thd->lex
                                                              (Query_tables_list).
                                                              
                                                              Implemented pruning of INSERTs by setting all partitions
                                                              of all inserted rows to be locked before locking.
                                                              
                                                              Added lock pruning to EXCHANGE PARTITION and
                                                              TRUNCATE PARTITION.
                                                              
                                                              Disabled some calls which would have evaluated
                                                              subqueries during prepare.
                                                              
                                                              CREATE VIEW no longer lock the tables except for MDL.
                                                              
                                                              Added pruning in JOIN::prepare to be able to prune locks
                                                              for constant conditions.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.13
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Tue 2012-01-10 00:22:56 +0100
                                                                message:
                                                                  WL#4443 cleanup.
                                                                  
                                                                  Added test of LOCK TABLES.
                                                                  
                                                                  Cleaned up some comments.
                                                                  
                                                                  Added second prune after locking/optmize for DELETE.
                                                                  
                                                                  Removed LOCK TABLES condition for INSERTs and UPDATEs.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.12
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Sun 2012-01-08 14:28:03 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  Changed test to avoid hitting bug#13569548.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.11
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Sat 2012-01-07 13:39:41 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  corrected bad DBUG_ASSERT in fill_table(**fields).
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.10
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Sat 2012-01-07 02:26:07 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  Fixed the check for insert fields in partitioning
                                                                  expressions.
                                                                  
                                                                  Added copy of default values if needed.
                                                                  
                                                                  Added checks and test for TIMESTAMP.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.9
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Thu 2012-01-05 23:02:00 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  Improved pruning of inserts, now only copying the fields
                                                                  belonging to the partitioning expressions when checking
                                                                  for used partiitons.
                                                                  
                                                                  Using bitmap instead of looping through all fields when
                                                                  checking if given fields are used in the partitioning
                                                                  expressions.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.8
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Thu 2012-01-05 16:54:31 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  Updated test results after removing locking in create view.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.7
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Thu 2012-01-05 10:53:25 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  sql_view.cc:
                                                                  no need of locking tables during create view.
                                                                  
                                                                  Updated results files after derived handling was removed
                                                                  from update (now the explain and execution is the same
                                                                  as for the same select).
                                                                  
                                                                  updated results files affected by bug#13559657.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.6
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Thu 2012-01-05 01:39:14 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  sql_lex.cc:
                                                                  Added fix for bug#13559657
                                                                  (explicit partiton selection not included in views)
                                                                  
                                                                  sql_update.cc:
                                                                  removed derived handling (cleanup)
                                                                  
                                                                  sql_view.cc:
                                                                  added delayed locking to be able to prune locks during create.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.5
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Wed 2012-01-04 18:49:09 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  Added test for TRUNCATE PARTITION
                                                                  
                                                                  Removed estimated rows for EXPLAIN DELETE on secondary
                                                                  index, due to unstable results.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.4
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Tue 2012-01-03 21:41:51 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  Added handling of insert/update with triggers.
                                                                  
                                                                  Cannot prune INSERT/REPLACE when having BEFORE INSERT trigger.
                                                                  
                                                                  Cannot prune UPDATE(locks)/INSERT ON DUPLICATE KEY UPDATE
                                                                  when having BEFORE UPDATE trigger.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.3
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_7
                                                                timestamp: Mon 2012-01-02 22:51:57 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  Removed bad DBUG_ASSERT, it is possible to have a locked
                                                                  table, without any partitions locked, like when all partitions
                                                                  are pruned away.
                                                                  
                                                                  Also modified the project name change in cmake.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.2 [merge]
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_6
                                                                timestamp: Mon 2012-01-02 16:00:49 +0100
                                                                message:
                                                                  WL#4443
                                                                  
                                                                  Rebase on latest -trunk
                                                                  Split out handler fixes to merge of 13008220 and 11761652.
                                                                  
                                                                  Fix for ha_partition::table_flags().
                                                                    ------------------------------------------------------------
                                                                    revno: 3402.96.8
                                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                    branch nick: wl4443-trunk_5
                                                                    timestamp: Sat 2011-12-31 03:24:23 +0100
                                                                    message:
                                                                      WL#4443 work in progress.
                                                                      
                                                                      fixed a bug in insert pruning.
                                                                    ------------------------------------------------------------
                                                                    revno: 3402.96.7
                                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                    branch nick: wl4443-trunk_5
                                                                    timestamp: Sat 2011-12-31 03:00:44 +0100
                                                                    message:
                                                                      WL#4443 work in progress
                                                                      
                                                                      Fix for bug in insert pruning for auto_increment fields.
                                                                    ------------------------------------------------------------
                                                                    revno: 3402.96.6
                                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                    branch nick: wl4443-trunk_5
                                                                    timestamp: Sat 2011-12-31 02:29:03 +0100
                                                                    message:
                                                                      WL#4443 work in progress
                                                                      
                                                                      Implemented insert pruning.
                                                                    ------------------------------------------------------------
                                                                    revno: 3402.96.5
                                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                    branch nick: wl4443-trunk_5
                                                                    timestamp: Sat 2011-12-17 00:44:33 +0100
                                                                    message:
                                                                      WL#4443
                                                                      
                                                                      cleanups
                                                                    ------------------------------------------------------------
                                                                    revno: 3402.96.4
                                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                    branch nick: wl4443-trunk_5
                                                                    timestamp: Fri 2011-12-16 23:18:36 +0100
                                                                    message:
                                                                      WL#4443 fixing query cache tests
                                                                      
                                                                      Reverted back to storing queries in the query cache after
                                                                      the tables was locked.
                                                                      
                                                                      This makes transactional storage engines work with the query cache
                                                                      since they can use the lock as signal to start a new transaktion.
                                                                      
                                                                      This also means that queries that fails (like on access control) before
                                                                      the tables are locked is not registered and is not included in
                                                                      Qcache_not_cached status variable.
                                                                    ------------------------------------------------------------
                                                                    revno: 3402.96.3
                                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                    branch nick: wl4443-trunk_5
                                                                    timestamp: Fri 2011-12-16 22:46:26 +0100
                                                                    message:
                                                                      WL#4443 test fixes
                                                                      
                                                                      main.type_date had bad result, changed
                                                                      
                                                                      opt_trace.bugs_no_prot_none changed trace due to no
                                                                      subquery executions during prepare phase.
                                                                      
                                                                      removed unused variables store_in_query_cache.
                                                                    ------------------------------------------------------------
                                                                    revno: 3402.96.2
                                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                    branch nick: wl4443-trunk_5
                                                                    timestamp: Fri 2011-12-16 21:28:07 +0100
                                                                    message:
                                                                      WL#4443
                                                                      
                                                                      Revertet non relevant plugin.test changes and ha_example changes
                                                                      (reported as 13511529).
                                                                      
                                                                      Moved query cache registration to be as before this patch
                                                                      
                                                                      Disabled DBUG_ASSERT(inited == INDEX) in ha_index_first since
                                                                      ha_index_init return value is not always checked.
                                                                      (11746399, 11746275)
                                                                    ------------------------------------------------------------
                                                                    revno: 3402.96.1 [merge]
                                                                    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                    branch nick: wl4443-trunk_5
                                                                    timestamp: Fri 2011-12-16 13:58:27 +0100
                                                                    message:
                                                                      Merge of WL#4443 with latest -trunk, due to moved code in sql_select.cc was pushed to -trunk
                                                                        ------------------------------------------------------------
                                                                        revno: 3402.95.2
                                                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                        branch nick: wl4443-trunk_4
                                                                        timestamp: Fri 2011-12-16 10:48:48 +0100
                                                                        message:
                                                                          WL#4443 - Minor update before merging with updated mysql-trunk
                                                                        ------------------------------------------------------------
                                                                        revno: 3402.95.1
                                                                        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                        branch nick: wl4443-trunk_4
                                                                        timestamp: Tue 2011-12-06 01:37:19 +0100
                                                                        message:
                                                                          WL#4443 - Remove scalability problem with many lock's and external lock's
                                                                          on partitioned tables with many partitions.
                                                                          
                                                                          
                                                                          Work In Progress!
                                                                          
                                                                          Splitted open_and_lock_tables() into open_query_tables() and
                                                                          lock_query_tables().
                                                                          
                                                                          Refactored mysql_select so that open_query_tables could be done
                                                                          before the prepare step, so that prune_partitions could be done
                                                                          before lock_query_tables() was called. lock_query_tables() is now
                                                                          called before the optimize step.
                                                                          
                                                                          Not yet done:
                                                                          Implement pruning for INSERT.
                                                                          Fix the last failing tests.
                                                                ------------------------------------------------------------
                                                                revno: 3402.94.1 [merge]
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: wl4443-trunk_6
                                                                timestamp: Sat 2011-12-31 13:39:35 +0100
                                                                message:
                                                                  merge of 13008220 and 11761652
                                                            ------------------------------------------------------------
                                                            revno: 3402.92.2 [merge]
                                                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                            branch nick: wl4443-trunk_8
                                                            timestamp: Tue 2012-01-10 16:08:49 +0100
                                                            message:
                                                              Bug#11761652: 54166: HA_RND_INIT() RESULT CODE NOT CHECKED
                                                              Bug#11746399: 26040: RETURN VALUES OF HA_INDEX_INIT() AND INDEX_INIT() IGNORED
                                                              
                                                              
                                                              This fix is based on the proposed patch for bug#13008220.
                                                              
                                                              Added checks for ha_rnd_init and ha_index_init return codes.
                                                              
                                                              Also added DBUG_ASSERT's to spot SE API violations.
                                                              
                                                              Changed InnoDB to return a more correct error in index_init.
                                                              
                                                              All this changes are done to enforce correct locking and cursor/handler
                                                              usage by the server in debug mode.
                                                              
                                                              Merge with updated mysql-trunk and updated 13008220.
                                                                ------------------------------------------------------------
                                                                revno: 3402.93.3
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: b11761652-b13008220-trunk
                                                                timestamp: Tue 2012-01-10 12:10:21 +0100
                                                                message:
                                                                  Bug#11761652: 54166: HA_RND_INIT() RESULT CODE NOT CHECKED
                                                                  
                                                                  Minor update of error handling for
                                                                  create_myisam_from_heap.
                                                                ------------------------------------------------------------
                                                                revno: 3402.93.2
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: b11761652-b13008220-trunk
                                                                timestamp: Sat 2011-12-31 00:20:42 +0100
                                                                message:
                                                                  Bug#11761652: 54166: HA_RND_INIT() RESULT CODE NOT CHECKED
                                                                  Bug#11746399: 26040: RETURN VALUES OF HA_INDEX_INIT() AND INDEX_INIT() IGNORED
                                                                  
                                                                  This fix is based on the proposed patch for bug#13008220.
                                                                  
                                                                  Added checks for ha_rnd_init and ha_index_init return codes.
                                                                  
                                                                  Also added DBUG_ASSERT's to spot SE API violations.
                                                                  
                                                                  Changed InnoDB to return a more correct error in index_init.
                                                                  
                                                                  All this changes are done to enforce correct locking and cursor/handler
                                                                  usage by the server in debug mode.
                                                                ------------------------------------------------------------
                                                                revno: 3402.93.1 [merge]
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: b11761652-b13008220-trunk
                                                                timestamp: Tue 2011-12-27 20:04:54 +0100
                                                                message:
                                                                  merge
                                                            ------------------------------------------------------------
                                                            revno: 3402.92.1 [merge]
                                                            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                            branch nick: wl4443-trunk_8
                                                            timestamp: Tue 2012-01-10 12:15:51 +0100
                                                            message:
                                                              merge of 13008220
                                                                ------------------------------------------------------------
                                                                revno: 3402.91.2
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: b13008220-trunk
                                                                timestamp: Tue 2012-01-10 12:05:52 +0100
                                                                message:
                                                                  bug#13008220: HANDLER SQL STATEMENT CAN MISS TO INITIALIZE FOR RANDOM READ
                                                                  
                                                                  Updated CMakeLists.txt to remember
                                                                  MYSQL_PROJECT_NAME
                                                                  
                                                                  Added test of full scan.
                                                                ------------------------------------------------------------
                                                                revno: 3402.91.1
                                                                committer: Mattias Jonsson <mattias.jonsson@oracle.com>
                                                                branch nick: b13008220-trunk
                                                                timestamp: Tue 2011-12-27 19:57:04 +0100
                                                                message:
                                                                  Bug#13008220: HANDLER SQL STATEMENT CAN MISS TO
                                                                  INITIALIZE FOR RANDOM READ
                                                                  
                                                                  When doing index scans and then swithing to
                                                                  random scans, without restart, ha_rnd_init
                                                                  is not called, when using the HANDLER SQL
                                                                  interface.
                                                                  
                                                                  Fixed by ensuring that when switching between
                                                                  index and random scans there will always be a call to
                                                                  ha_index/rnd_end and then ha_index/rnd_init.
                                                                  
                                                                  Also checking return values from ha_index/rnd_init/end.
    ------------------------------------------------------------
    revno: 3690.34.105
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-13 13:06:03 +0300
    message:
      Fix UNIV_BLOB_DEBUG, needed for tracking down Bug#13249921.
------------------------------------------------------------
revno: 3889 [merge]
committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Wed 2012-06-13 17:55:55 +0400
message:
  Manual merge from mysql-trunk.
  Note: failing i_rpl.rpl_row_max_allowed_packet test.
    ------------------------------------------------------------
    revno: 3690.34.104 [merge]
    committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
    branch nick: mysql-trunk-test
    timestamp: Tue 2012-06-12 15:38:57 +0200
    message:
      Merge from mysql-5.5 to mysql-trunk
      No conflicts
        ------------------------------------------------------------
        revno: 2875.388.12
        committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
        branch nick: mysql-5.5-test
        timestamp: Tue 2012-06-12 15:04:57 +0200
        message:
          Bug#13586591 RQG GRAMMAR CONF/ENGINES/ENGINE_STRESS.YY
                       CRASHES INNODB | TRX_STATE_NOT_STARTED
          
          The problem was that if DELETE with subselect caused a
          deadlock inside InnoDB, this deadlock was not properly
          handled by the SQL layer. This meant that the SQL layer
          would try to unlock the row after InnoDB had rolled
          back the transaction. This caused an assertion inside
          InnoDB.
          
          This patch fixes the problem by checking for errors
          reported by SQL_SELECT::skip_record() and not calling
          unlock_row() if any errors have been reported.
    ------------------------------------------------------------
    revno: 3690.34.103 [merge]
    committer: Manish Kumar<manish.4.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-12 19:01:36 +0530
    message:
      BUG#12400221 - 60926: BINARY LOG EVENTS LARGER THAN MAX_ALLOWED_PACKET
      
      Null merge from mysql-5.5 -> mysql-trunk
        ------------------------------------------------------------
        revno: 2875.388.11 [merge]
        committer: Manish Kumar<manish.4.kumar@oracle.com>
        branch nick: mysql-5.5
        timestamp: Tue 2012-06-12 12:59:56 +0530
        message:
          BUG#12400221 - 60926: BINARY LOG EVENTS LARGER THAN MAX_ALLOWED_PACKET
          
          Upmerge from mysql-5.1 -> mysql-5.5
    ------------------------------------------------------------
    revno: 3690.34.102
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-12 18:36:39 +0530
    message:
      Making certain tests experimantal as per Bug 14185642 - WL#6082: FAILURES ON TRUNK
    ------------------------------------------------------------
    revno: 3690.34.101
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-12 17:37:35 +0530
    message:
      Updating the result file also for rpl_packet test, after discussion it with Joro.
    ------------------------------------------------------------
    revno: 3690.34.100
    committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
    branch nick: mysql-trunk-bug14031353
    timestamp: Tue 2012-06-12 13:10:27 +0200
    message:
      Bug#14031353 LOCK/ALGORITHM CLAUSES MISSING FROM
                   CREATE/DROP INDEX STATEMENTS
      
      In WL#5534, ALTER TABLE statement was extended with a
      LOCK clause (which controls concurrency) and an ALGORITHM
      clause (which selects between in-place and copy ALTER).
      
      The problem was that these two clauses, which are currently
      most useful for index creation, were not also added to the
      CREATE INDEX and DROP INDEX statments.
      
      This patch corrects this oversight, by allowing the LOCK
      and ALGORITHM clauses (comma separated) to be used for CREATE
      and DROP INDEX as well.
      
      The syntax is changed by adding
        [lock_algorithm_clause [lock_algorithm_clause]]
      to the end of the current CREATE/DROP INDEX syntaxes.
      
      lock_algorithm_clause:
          LOCK [=] {DEFAULT | NONE | SHARED | EXCLUSIVE}
        | ALGORITHM [=] {DEFAULT | INPLACE | COPY}
      
      Test case added to alter_table.test.
    ------------------------------------------------------------
    revno: 3690.34.99
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-12 12:27:19 +0300
    message:
      Followup to WL#6189 Turn InnoDB persistent statistics ON by default
      
      Adjust mtr tests, part 30.
      
      Persistent stats use a different sampling algorithm so it is possible
      that the stats numbers differ from transient stats.
      
      Also, persistent stats are updated less frequently or with a delay, so
      it is possible that persistent stats are not up to date as transient were
      even if both algorithms would return the same results.
      
      The order of the returned rows by a SELECT query depends on the stats and
      thus, if possible, we fix tests by prepending "-- sorted_result" to SELECTs
      that happen to return rows in different order.
      
      If possible, each failing test was fixed by manually running ANALYZE TABLE.
      This is doable if both transient and persistent sampling algorithms end up
      with the same numbers for the given table and its data.
      
      If persistent stats result in different stats, then test failures were fixed
      by forcing the usage of transient stats for the table by using
      CREATE TABLE ... STATS_PERSISTENT=0.
      
      Intentionally do not fix the tests by using persistent stats and adjustin
      the output of EXPLAIN in .result files because a different execution plan
      may cause a different code path to be executed, than the one originally
      intended in the test.
    ------------------------------------------------------------
    revno: 3690.34.98
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-12 12:10:38 +0300
    message:
      Add assertions in dict_stats_deinit() that it is called under
      dict_sys->mutex and that table->n_ref_count is 0. Deinitializing
      stats of a table that is being used (table->n_ref_count > 0) may
      lead to reading uninitialized memory.
      
      Also assert in dict_stats_snapshot_create() that the table stats are
      initialized. Copying uninitialized stats does not make sense.
    ------------------------------------------------------------
    revno: 3690.34.97
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-12 16:03:42 +0530
    message:
      Fixing rpl_packet test failure after discussing it with Joro.
    ------------------------------------------------------------
    revno: 3690.34.96
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-12 11:29:24 +0200
    message:
      Fixed unit test after removal of 1 alloc.
    ------------------------------------------------------------
    revno: 3690.34.95 [merge]
    committer: Manish Kumar<manish.4.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-06-12 13:01:04 +0530
    message:
      BUG#12400221 - 60926: BINARY LOG EVENTS LARGER THAN MAX_ALLOWED_PACKET
      
      Upmerge from mysql-5.5 -> mysql-trunk.
        ------------------------------------------------------------
        revno: 2875.390.1 [merge]
        committer: Manish Kumar<manish.4.kumar@oracle.com>
        branch nick: mysql-5.5
        timestamp: Wed 2012-06-06 11:51:20 +0530
        message:
          BUG#12400221 - 60926: BINARY LOG EVENTS LARGER THAN MAX_ALLOWED_PACKET
          
          Upmerge from mysql-5.1 -> mysql-5.5
            ------------------------------------------------------------
            revno: 2661.849.1 [merge]
            committer: Manish Kumar<manish.4.kumar@oracle.com>
            branch nick: mysql-5.1
            timestamp: Wed 2012-05-30 10:10:52 +0530
            message:
              BUG#12400221 - 60926: BINARY LOG EVENTS LARGER THAN MAX_ALLOWED_PACKET
              
              Problem
              ========
                          
              Replication breaks in the cases if the event length exceeds 
              the size of master Dump thread's max_allowed_packet.
                            
              The reason why this failure is occuring is because the event length is
              more than the total size of the max_allowed_packet, on addition of the  
              max_event_header length exceeds the max_allowed_packet of the DUMP thread.
              This causes the Dump thread to break replication and throw an error.
                                    
              That can happen e.g with row-based replication in Update_rows event.
                          
              Fix
              ====
                        
              The problem is fixed in 2 steps:
              
              1.) The Dump thread limit to read event is increased to the upper limit
                  i.e. Dump thread reads whatever gets logged in the binary log.
              
              2.) On the slave side we increase the the max_allowed_packet for the
                  slave's threads (IO/SQL) by increasing it to 1GB.
              
                  This is done using the new server option (slave_max_allowed_packet)
                  included, is used to regulate the max_allowed_packet of the  
                  slave thread (IO/SQL) by the DBA, and facilitates the sending of
                  large packets from the master to the slave.
              
                  This causes the large packets to be received by the slave and apply
                  it successfully.
                ------------------------------------------------------------
                revno: 2661.848.1
                committer: Manish Kumar<manish.4.kumar@oracle.com>
                branch nick: mysql-5.1
                timestamp: Mon 2012-05-21 12:57:39 +0530
                message:
                  BUG#12400221 - 60926: BINARY LOG EVENTS LARGER THAN MAX_ALLOWED_PACKET
                  
                  Problem
                  ========
                              
                  SQL statements close to the size of max_allowed_packet produce binary
                  log events larger than max_allowed_packet.
                                
                  The reason why this failure is occuring is because the event length is
                  more than the total size of the max_allowed_packet + max_event_header
                  length. Now since the event length exceeds this size master Dump
                  thread is unable to send the packet on to the slave.
                                        
                  That can happen e.g with row-based replication in Update_rows event.
                              
                  Fix
                  ====
                            
                  The problem was fixed by increasing the max_allowed_packet for the
                  slave's threads (IO/SQL) by increasing it to 1GB.
                  This is done using the new server option included which is used to
                  regulate the max_allowed_packet of the slave thread (IO/SQL).
                  This causes the large packets to be received by the slave and apply
                  it successfully.
    ------------------------------------------------------------
    revno: 3690.34.94 [merge]
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-bug14111678
    timestamp: Tue 2012-06-12 09:04:22 +0200
    message:
      Local merge
        ------------------------------------------------------------
        revno: 3690.59.2
        committer: Nirbhay Choubey <nirbhay.choubey@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-11 21:03:10 +0530
        message:
          WL#5602, WL#5603
          
          * Fix for a generic-linux build failure. (#5602)
          * Fix for a warning on OS X (#5603)
          * Restoration of permissions for mysql.cc (rev#3075)
        ------------------------------------------------------------
        revno: 3690.59.1
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-11 15:50:44 +0300
        message:
          Add a debug-only printout to help track down Bug#14172780
    ------------------------------------------------------------
    revno: 3690.34.93
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-bug14111678
    timestamp: Mon 2012-06-11 16:36:24 +0200
    message:
      Bug#14111678 PERFSCHEMA.SOCKET_SUMMARY_BY_EVENT_NAME_FUNC FAILS ON PB2 SPORADICALLY
      
      (a) In Mysql 5.5, the performance schema keeps global statistics in a generic
      way, keeping only the wait time spent on an instrument, in a global array,
      global_instr_class_waits_array, which supports the table
      EVENTS_WAITS_GLOBAL_BY_EVENT_NAME.
      
      (b) In Mysql 5.6, some (but not all) instruments have been improved to keep more
      details statistics, so that stats are kept in per instrument specific
      structures, such as PFS_file_stat, PFS_socket_stat.
      
      Regardless of where statistics are counted, the implementation of table
      EVENTS_WAITS_GLOBAL_BY_EVENT_NAME must consistent, so that:
      - (c) the memory buffers used to aggregate statistics, whether generic or
        per instrument type, used in ::make_row()
      - (d) the memory buffers reset, when executed TRUNCATE TABLE
        EVENTS_WAITS_GLOBAL_BY_EVENT_NAME, used in ::delete_all_rows()
      must be the same.
      
      As found during the analysis of this bug report, this is not the case for
      socket io:
      - table_ews_global_by_event_name::make_socket_row() uses
        PFS_instance_wait_visitor, which reads from both the
      global_instr_class_waits_array array and PFS_socket_class.m_socket_stat
      - table_ews_global_by_event_name::delete_all_rows() only resets
        global_instr_class_waits_array.
      
      This leads to incoherent statistics reported in table
      EVENTS_WAITS_GLOBAL_BY_EVENT_NAME.
      
      The immediate bug is caused by the discrepancy between (c) and (d),
      but in general there is much confusion in the code created by the current
      mix of the two designs (a) and (b).
      
      Given that the performance schema is likely to maintain detailed statistics
      for each kind of instruments, which are by definition specific to each
      instrument type, the design (a) which is good enough only to keep "wait"
      statistics, is abandonned, to the benefit of (b).
      
      As a result, this patch completely removes the performance schema buffer
      global_instr_class_waits_array.
      Statistics for each sub type of instrument are kept in per instrument
      structures, such as:
      - PFS_mutex_stat
      - PFS_rwlock_stat
      - PFS_cond_stat
      
      For native instruments such as table io and table lock,
      global statistics are already kept in global variables (unchanged).
      
      For the "idle" native instrument, global statistics are now kept in
      global_idle_stat.
      
      With this change:
      - the overall design and code gains more clarity
      - the overall structure is easier to extend for enhancements
      - the memory footprint is decreased, due to unused / duplicate structures
        found in the existing code (PFS_instr::m_wait_stat) that got removed.
      - the performance schema overhead is reduced, since less CPU is needed in
        destroy() functions for instruments, which now only update statistics in 1
      place instead of 2.
      
      The global aggregation is based on the aggregation by instance and class.
      For statistics by thread / account / user / host, the design (a) is
      maintained, as the aggregation by thread is orthogonal to the aggregation by
      instances.
    ------------------------------------------------------------
    revno: 3690.34.92 [merge]
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-cleanup
    timestamp: Mon 2012-06-11 12:02:54 +0200
    message:
      Local merge
        ------------------------------------------------------------
        revno: 3690.58.3
        committer: Raghav Kapoor <raghav.kapoor@oracle.com>
        branch nick: mysql-trunk-bug-14134662
        timestamp: Mon 2012-06-11 14:49:40 +0530
        message:
          BUG#14134662: MUCH OVERHEAD FOR MD5() AND SHA1() ON SHORT STRINGS 
          
          BACKGROUND:
          MySQL's hash functions MD5 and SHA relied on the somewhat slow 
          sprintf function to convert the digests to hex representations.
          This patch replaces the sprintf with a specific and inline hex
          conversion function.
          
          FIX:
          This bug is fixed by using the same solution that was used
          to fix Bug#11757443.
        ------------------------------------------------------------
        revno: 3690.58.2
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-11 11:08:58 +0300
        message:
          Relieve the Valgrind checks when creating a table stats snapshot
          about index->stat_n_diff_key_vals[] and index->stat_n_sample_sizes[]
          since those arrays are indexed [1, n_uniq] and the [0]th member may
          not be initialized. Also skip FTS indexes during snapshot creation (they
          are also skipped during save and stats gathering).
        ------------------------------------------------------------
        revno: 3690.58.1
        committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-11 14:31:15 +0530
        message:
          Updating the command line to reflect "-debug" in comment.
    ------------------------------------------------------------
    revno: 3690.34.91
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-cleanup
    timestamp: Mon 2012-06-11 12:01:37 +0200
    message:
      Bug#14157406 - VALGRIND: DEFINITELY LOST AT MALLOC FROM ADD_PFS_INSTR_TO_ARRAY IN PFS_SERVER.CC
      
      Adjusted the call stack in file valgrind.supp to match the code.
    ------------------------------------------------------------
    revno: 3690.34.90
    committer: Raghav Kapoor <raghav.kapoor@oracle.com>
    branch nick: mysql-trunk-bug-12980522
    timestamp: Mon 2012-06-11 13:39:53 +0530
    message:
      BUG#12980522 - MULTI-UPDATE REFERENCING VIEW IS BLOCKED BY
                     --READ-ONLY WITHOUT GOOD REASON
      
      BACKGROUND:
      Multi-update which references view in its main JOIN but
      doesn't update it, can be blocked by --read-only/@@read_only=1
      mode even though it updates only temporary tables. This should
      not be happening (and is not happening if the view is replaced
      by normal table).
      
      ANALYSIS:
      In mysql_multi_update_prepare() function, updating variable
      is correctly set to 0 for all non-temporary tables that are
      not getting updated. 
      But for view this is not happening. This value is not correctly
      set for views. 
      
      FIX:
      This bug is fixed by correctly setting the updating variable to
      0 if the table is a view as it is correctly set for the tables
      comprising the view.
    ------------------------------------------------------------
    revno: 3690.34.89
    committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
    branch nick: mysql-trunk-bug13974815
    timestamp: Sun 2012-06-10 12:49:24 +0200
    message:
      Bug#13974815 MULTITABLE UPDATE IGNORE WITH FAILING FK CONSTRAINT:
                   ASSERT 0 IN PROTOCOL.CC:518
      
      This bug could be triggered by multi update with ignore
      if there was some kind of handler error (e.g FK constraints).
      The consquence on release builds was that it was possible for
      'OK' to be sent to the client even if the statement had in
      fact failed.
      
      The problem was that ignore caused lex->current_select->no_error
      to be set, which caused the handler error to be converted to
      a warning. So, while the update failed, no error was reported -
      triggering the assert. This should not have been possible since
      the handler error was determined to be fatal (see
      handler::is_fatal_error()), however the flag indicating that the
      error was fatal was not propagated...
      
      This patch fixes the problem by making sure that handler error
      flags (such as ME_FATALERROR) are properly propagated by
      handler::print_error().
      
      Note that this patch adds an extra parameter to two handler API
      functions. However, both functions have already been changed 
      in earlier 5.6 patches (WL#5534).
    ------------------------------------------------------------
    revno: 3690.34.88
    committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
    branch nick: mysql-trunk-bug14001091
    timestamp: Sun 2012-06-10 12:12:50 +0200
    message:
      Bug#14001091 ASSERT IN DIAGNOSTICS_AREA::SET_EOF_STATUS
                   DURING ANALYZE TABLE 
      
      This assertion could happen if internal commits during a table
      administration statement (e.g. ANALYZE TABLE) failed (e.g. due
      to lock timeout). The result of the commit was not checked so
      the failure was not detected. When the statement at the end
      of execution tried to report 'OK' the assertion was triggered.
      The assertion checks that we're not trying to report 'OK'
      after having reported an error earlier. This bug had no
      consequences on release builds, there the error would simply
      be kept.
      
      This patch fixes the problem by checking if the commit has in
      fact completed successfully. If so, the statement won't try
      to report 'OK' to the client.
    ------------------------------------------------------------
    revno: 3690.34.87
    committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
    branch nick: mysql-trunk-test
    timestamp: Sun 2012-06-10 11:28:18 +0200
    message:
      Fix two compilation warnings/errors:
      
      GCC 4.6.3
      /sql/sql_acl.cc: In function 'int replace_user_table(THD*, TABLE*, LEX_USER*, ulong, bool, bool, bool)':
      /sql/sql_acl.cc:2701:8: error: variable 'sha2_plugin' set but not used [-Werror=unused-but-set-variable]
      
      Clang 4.1
      /mysys_ssl/my_default.cc:930:15: warning: equality comparison with extraneous parentheses [-Wparentheses-equality]
    ------------------------------------------------------------
    revno: 3690.34.86
    committer: Nirbhay Choubey <nirbhay.choubey@oracle.com>
    branch nick: mysql-trunk
    timestamp: Sat 2012-06-09 19:41:09 +0530
    message:
      WL#5603 : Revise how we handle passwords on
                the command line
      
      Fix for the following build error :
      "suggest a space before ';' or explicit braces
       around empty body in 'for' statement"
    ------------------------------------------------------------
    revno: 3690.34.85
    committer: Nirbhay Choubey <nirbhay.choubey@oracle.com>
    branch nick: mysql-trunk
    timestamp: Sat 2012-06-09 18:46:21 +0530
    message:
      WL#5603 : Revise how we handle passwords on
                the command line
      
      Addressing additional review comments.
    ------------------------------------------------------------
    revno: 3690.34.84 [merge]
    committer: Olav Sandstaa <olav.sandstaa@oracle.com>
    branch nick: merge
    timestamp: Sat 2012-06-09 09:48:29 +0200
    message:
      Merge WL 6082 from mysql-trunk-wl6082 to mysql-trunk
        ------------------------------------------------------------
        revno: 3873.7.19 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge
        timestamp: Fri 2012-06-08 11:32:14 +0200
        message:
          Merge from mysql-trunk to mysql-trunk-wl6082
        ------------------------------------------------------------
        revno: 3873.7.18 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge
        timestamp: Thu 2012-06-07 12:13:32 +0200
        message:
          Merge from mysql-trunk to mysql-trunk-wl6082
        ------------------------------------------------------------
        revno: 3873.7.17
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: wl6082
        timestamp: Thu 2012-06-07 11:57:30 +0200
        message:
          WL#6082 Improve the Disk-Sweep Multi-Range Read cost model
          
          Fix to make the innodb_mysql test stable when run with 4K InnoDB
          block size.
          
          The following explain in the innodb_mysql test:
          
          EXPLAIN SELECT * FROM t1 WHERE f1 IN
          (3305028,3353871,3772880,3346860,4228206,3336022,
           3470988,3305175,3329875,3817277,3856380,3796193,
           3784744,4180925,4559596,3963734,3856391,4494153)
          AND f5 = 'abcdefghijklmnopwrst' AND f2 = 1221457 AND f4 = 0 ;
          
          started to fail due to changes in the query plan when running
          the test with 4K InnoDB block size. The change was from using index
          merge on (idx2,idx1,PRIMARY) to use index merge on (idx2,PRIMARY). 
          This cause for this change is that the new DS-MRR cost model 
          produces lower cost estimates for reading the table as a "disk sweep".
          The reason for producing different plans when running with 16K versus
          4K InnoDB block size is that for the 4K InnoDB blocksize case the size
          of the table is smaller (32KB vs 48KB) and this influences on the
          cost estimate for reading the data.
          
          In order to get the same query plan when running with 4K and 16K
          block size, the fix for this problem is to:
          -add some extra records to the table
          -enable persistent statistics on the table to get more exact statistical data
          
          Approved by Vasil on IM.
        ------------------------------------------------------------
        revno: 3873.7.16 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge2
        timestamp: Wed 2012-06-06 14:30:55 +0200
        message:
          Merge from mysql-trunk to mysql-trunk-wl6082
        ------------------------------------------------------------
        revno: 3873.7.15
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: wl6082
        timestamp: Wed 2012-06-06 13:44:43 +0200
        message:
          WL#6082 Improve the Disk-Sweep Multi-Range Read cost model
          
          Patch 5: IO cost estimate is too high compared to "standard MRR"
          
          The DS-MRR cost model has two different ways for calculating the
          IO-cost of doing a "disk sweep scan":
          
          a. Disk-sweep model: Used when the data is not stored as a
             clustered index: The model estimates the number of blocks that will
             be accessed and models the time to read these using sequential
             scan/read of a data file. This model is used for MyISAM.
          
          b. If the data is stored as a clustered index: The cost model
             estimates this as having to do one random block access 
             per record. This model does not take into account that
             we actually will be accessing the table as a scan. This
             model is used for InnoDB.
          
          The focus is on improving the model for InnoDB since this does not
          take into account any benefit from sequential access of the table. Due
          to this, the IO-cost estimate will in almost all cases be larger for
          DS-MRR than "standard MRR" (and thus, the cost based DS-MRR will not
          be used for InnoDB).
          
          The fix for this problem is to switch to use the "disk streaming IO
          cost model" (as described as a above) also when the data is stored in
          a clustered index.
        ------------------------------------------------------------
        revno: 3873.7.14 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge
        timestamp: Wed 2012-06-06 12:28:44 +0200
        message:
          Merge from mysql-trunk to mysql-trunk-wl6082
        ------------------------------------------------------------
        revno: 3873.7.13
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: wl6082
        timestamp: Wed 2012-06-06 10:17:11 +0200
        message:
          WL#6082 Improve the Disk-Sweep Multi-Range Read cost model
          
          Patch 4: CPU cost is too high
          
          The cost estimate for sorting the keys in the sort buffer for a large
          scan is too high. It can be higher than the IO cost estimate for
          reading the data from the database and in can be several times higher
          than the CPU cost estimate for the same scan using standard MRR. In
          addition it does not include the normal row processing cost that is
          done in a standard MRR scan. So for scan that read just a few records,
          the CPU cost estimate for DS-MRR can actually be lower than the CPU
          estimate for standard MRR.
          
          This patch fixes the following issues:
                
          -a bug in the formula for calculating the CPU estimate for the sort
           based on quick sort.
          
          -reduces the cost for doing the sort operation by replacing the use of
           ROWID_COMPARE_COST constant (value 0.1) with a new constant
           ROWID_COMPARE_SORT_COST that has the value =0.01.
                
          -add the cost for doing row processing in the same way as it is
           calculated for stand MRR scans.
                
          This patch changes execution plan for several test cases that are run
          with mrr_cost_based off. The cause for these changes is that the cost
          estimate for doing DS-MRR has changed (either increased or decreased).
        ------------------------------------------------------------
        revno: 3873.7.12 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge
        timestamp: Tue 2012-06-05 15:45:56 +0200
        message:
          Merge from mysql-trunk to mysql-trunk-wl6082
        ------------------------------------------------------------
        revno: 3873.7.11 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge
        timestamp: Mon 2012-06-04 19:25:31 +0200
        message:
          Merge from mysql-trunk to mysql-trunk-wl6082
        ------------------------------------------------------------
        revno: 3873.7.10 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge
        timestamp: Sat 2012-06-02 17:53:40 +0200
        message:
          Merge from mysq-trunk to mysql-trunk-wl6082
        ------------------------------------------------------------
        revno: 3873.7.9 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge
        timestamp: Wed 2012-05-30 22:52:18 +0200
        message:
          Merge from mysql-trunk to mysql-trunk-wl6082
        ------------------------------------------------------------
        revno: 3873.7.8
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: wl6082
        timestamp: Wed 2012-05-30 22:05:05 +0200
        message:
          WL#6082 Improve the Disk-Sweep Multi-Range Read cost model
                
          Follow-up fix to patch 3: Join-cache tests failed on some platforms
          due to variations in record estimate in explain output for two range scans.
        ------------------------------------------------------------
        revno: 3873.7.7
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: wl6082
        timestamp: Wed 2012-05-30 13:11:53 +0200
        message:
          WL#6082 Improve the Disk-Sweep Multi-Range Read cost model
          
          Patch 3: Memory cost too large
          
          The cost of using memory for the sort buffer dominates the total cost
          for many queries. Since we do not consider cost of using buffer space
          in other places in the server we should not include it here either.
          
          This patch removes inclusion of memory cost for the sort buffer
          in the cost for doing ds-mrr scans.
          
          This change causes a few changes in plans for existing tests.
        ------------------------------------------------------------
        revno: 3873.7.6
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: wl6082
        timestamp: Wed 2012-05-30 11:33:26 +0200
        message:
          WL#6082 Improve the Disk-Sweep Multi-Range Read cost model
                      
          Patch 6: The DS-MRR model assumes everything on disk
                
          DS-MRR can improve performance when most of the data for the query
          needs to be read from a hard disk. When all data is in memory the
          extra sorting will just add overhead. The relative overhead will be
          largest for small queries reading few records due to the need for
          setting up an extra handler to the storage engine, configure and
          allocate the sort buffer, and sort the records.
                
          With the current cost model we do not know whether data is in memory
          or on disk. So to avoid that DS-MRR is used when it is likely that the
          data is in memory the following heuristic is implemented:
                
          The cost based DS-MRR will not be used when:
          -the size of the table is smaller than the memory buffer of the
           storage engine (or smaller than 100 MB if we do not have information
           about the storage engine buffer).
          -the scan will retrieve less than 50 records.
        ------------------------------------------------------------
        revno: 3873.7.5 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge
        timestamp: Wed 2012-05-30 10:06:49 +0200
        message:
          Merge from mysql-trunk to mysql-trunk-wl6082
        ------------------------------------------------------------
        revno: 3873.7.4
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: wl6082
        timestamp: Tue 2012-05-29 12:17:05 +0200
        message:
          WL#6082 Improve the Disk-Sweep Multi-Range Read cost model
                
          Patch 2: Fix bug in how IO and CPU cost are computed for multi-pass scans. 
                
          When computing the cost for each scan, the record estimate for the
          total number of records is used. This causes the IO cost and CPU cost
          to become too high. Change this to use the number of records that
          will be read per scan.
        ------------------------------------------------------------
        revno: 3873.7.3
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: wl6082
        timestamp: Tue 2012-05-29 11:31:04 +0200
        message:
          WL#6082 Improve the Disk-Sweep Multi-Range Read cost model
          
          Patch 1: Improve estimation of required size of sort buffer.
          
          Fixes the following two issues with how the estimated size of
          needed sort buffer for a single scan DS-MRR is calculated:
          
          a. An early version of the DS-MRR implementation used the sort buffer
             to store the current position of the scan each time it had filled
             the sort buffer. This was needed in order to be able to restart the
             scan next time it should fill the sort buffer. This implementation
             has since been changed to use a second handler object for scanning
             the index. Thus the there is no longer a need for storing the
             current position in the sort buffer. This patch removes the code
             that included space for this in estimation of the buffer size.
                
          b. When a single scan is needed, in most cases the buffer size
             supplied by the optimizer code is too high. To reduce the amount of
             buffer space allocated we should adjust this to what is needed. The
             current code does not adjust the estimated buffer size
             correctly. It will never reduce it, only increase it (which is the
             opposite of the intention). The new code estimates the buffer size
             by:
             a. Estimate of number of keys to sort: Add 20% to the estimated
                number of records. If this estimate is less than 100 keys, then
                adjust it to use 100 keys as the estimate.
             b. Adjusting the sort buffer size: If the estimated buffer space
                is lower than the size of the sort buffer provided by the
                optimizer code, then adjust the buffer space size down to the
                estimated size.
        ------------------------------------------------------------
        revno: 3873.7.2 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge
        timestamp: Tue 2012-05-29 09:44:26 +0200
        message:
          Merge from mysql-trunk to mysql-trunk-wl6082
        ------------------------------------------------------------
        revno: 3873.7.1 [merge]
        committer: Olav Sandstaa <olav.sandstaa@oracle.com>
        branch nick: merge
        timestamp: Mon 2012-05-28 12:36:24 +0200
        message:
          Merging from mysql-trunk to mysql-trunk-wl6082
    ------------------------------------------------------------
    revno: 3690.34.83 [merge]
    committer: Bjorn Munch <bjorn.munch@oracle.com>
    branch nick: main-tr
    timestamp: Fri 2012-06-08 16:32:09 +0200
    message:
      null upmerge
        ------------------------------------------------------------
        revno: 2875.388.10
        committer: Bjorn Munch <bjorn.munch@oracle.com>
        branch nick: main-55
        timestamp: Fri 2012-06-08 16:31:03 +0200
        message:
          Backport SuSE 11 fix to RPM spec file
------------------------------------------------------------
revno: 3888
committer: Guilhem Bichot <guilhem.bichot@oracle.com>
branch nick: trunk-wl6216
timestamp: Mon 2012-06-11 17:02:26 +0200
message:
  *temporary* fix for bug#13949549
  VALGRIND ERRORS IN JOIN_CACHE::WRITE_RECORD_DATA LEAD TO CRASHES
------------------------------------------------------------
revno: 3887 [merge]
committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Fri 2012-06-08 19:08:38 +0400
message:
  Auto-merge from mysql-trunk.
    ------------------------------------------------------------
    revno: 3690.34.82
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-cleanup
    timestamp: Fri 2012-06-08 16:11:10 +0200
    message:
      Improved the test performance_schema.sizing_growth robustness, again.
      Fixed files_per_share to 3
    ------------------------------------------------------------
    revno: 3690.34.81
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-08 15:02:07 +0300
    message:
      Fix Bug#13966453 CONCURRENT DML AND READS FROM I_S TABLES CRASH
      FETCH_DATA_INTO_CACHE_LOW
      
      Traversing the list trx_sys->mysql_trx_list should be done like:
      
        for (trx = UT_LIST_GET_FIRST(trx_sys->mysql_trx_list);
             trx != NULL;
             trx = UT_LIST_GET_NEXT(mysql_trx_list, trx)) {
      
      and not like:
      
        for (trx = UT_LIST_GET_FIRST(trx_sys->mysql_trx_list);
             trx != NULL;
             trx = UT_LIST_GET_NEXT(trx_list, trx)) {
      
      This bug was introduced in:
      
        * revision-id: sunny.bains@oracle.com-20111120202539-tsreibci7v0r92e0
        * committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        * branch nick: trunk
        * timestamp: Mon 2011-11-21 07:25:39 +1100
        * message:
        *   WL#6046 - Special handling of read-only transactions
        * ...
      
      Before that changeset the code only traversed trx_sys->trx_list like:
      
        for (trx = UT_LIST_GET_FIRST(trx_sys->trx_list);
             trx != NULL;
             trx = UT_LIST_GET_NEXT(trx_list, trx)) {
      
      and it did not fiddle with trx_sys->mysql_trx_list.
      
      In WL#6046 the code was changed so that trx_sys->trx_list in the
      initialization of the "for" loop became a parameter
      (trx_sys->mysql_trx_list is passed as that parameter), but the update
      statement of the "for" loop was not adjusted and was left like
      "trx = UT_LIST_GET_NEXT(trx_list, trx)".
    ------------------------------------------------------------
    revno: 3690.34.80
    committer: Bjorn Munch <bjorn.munch@oracle.com>
    branch nick: main-tr
    timestamp: Fri 2012-06-08 15:36:12 +0200
    message:
      Fix RPM spec file so SuSE 11.1 is treated as 11
    ------------------------------------------------------------
    revno: 3690.34.79 [merge]
    committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-08 14:17:12 +0200
    message:
      WL5602 Providing password hashing with appropriate strength
      
      Features:
      * New authentication plugin 'sha256_password' which requires
        either SSL or RSA key exchange.
      * The plugin uses a new password store which uses a salted
        SHA-256 based hash digest.
      * Introduction of default authentication plugin server side option.
      
      Misc:
      * Some refactoring of legacy code related to passwords and 
       the user table.
        ------------------------------------------------------------
        revno: 3402.87.44 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2012-06-08 13:39:00 +0200
        message:
          merge mysql-trunk => wl5602
        ------------------------------------------------------------
        revno: 3402.87.43 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Thu 2012-06-07 13:50:02 +0200
        message:
          merge
            ------------------------------------------------------------
            revno: 3402.90.1
            committer: Bernt M. Johnsen <bernt.johnsen@oracle.com>
            branch nick: wl5602
            timestamp: Wed 2012-06-06 15:33:44 +0200
            message:
              Enables tests which works for openssl 1.0.0 and better but not for 0.9.*
        ------------------------------------------------------------
        revno: 3402.87.42 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Thu 2012-06-07 13:48:13 +0200
        message:
          merge mysql-trunk => wl5602
        ------------------------------------------------------------
        revno: 3402.87.41 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Tue 2012-06-05 09:56:01 +0200
        message:
          Merge mysql-trunk => WL5602
        ------------------------------------------------------------
        revno: 3402.87.40
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Tue 2012-06-05 09:47:55 +0200
        message:
          Post-merge fixes: Declaration of buff_size breaks on windows.
        ------------------------------------------------------------
        revno: 3402.87.39 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Mon 2012-06-04 17:35:18 +0200
        message:
          merge mysql-trunk => wl5602
        ------------------------------------------------------------
        revno: 3402.87.38
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Mon 2012-06-04 12:07:13 +0200
        message:
          (no message)
        ------------------------------------------------------------
        revno: 3402.87.37
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Thu 2012-05-31 13:48:21 +0200
        message:
          WL#5602 Enable partial YaSSL support
          
          Due to lack of functioanlity in YaSSL the RSA pub/priv key authentication
          can't be supported.
        ------------------------------------------------------------
        revno: 3402.87.36 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Tue 2012-05-22 01:23:34 +0200
        message:
          (no message)
            ------------------------------------------------------------
            revno: 3402.89.1
            committer: Bernt M. Johnsen <bernt.johnsen@oracle.com>
            branch nick: wl5602
            timestamp: Thu 2012-05-10 15:23:58 +0200
            message:
              WL5602: Another CRL test needs to be disabled
        ------------------------------------------------------------
        revno: 3402.87.35
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Tue 2012-05-22 01:00:55 +0200
        message:
          * WL5602
        ------------------------------------------------------------
        revno: 3402.87.34 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Wed 2012-05-09 15:23:49 +0200
        message:
          automerge
        ------------------------------------------------------------
        revno: 3402.87.33 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Thu 2012-04-26 14:56:00 +0200
        message:
          automerge
            ------------------------------------------------------------
            revno: 3402.88.3
            committer: Bernt M. Johnsen <bernt.johnsen@oracle.com>
            branch nick: wl5602
            timestamp: Thu 2012-04-26 14:44:56 +0200
            message:
              Include sha256 stuff in the category "Plugins which may or may not be there"
        ------------------------------------------------------------
        revno: 3402.87.32
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Thu 2012-04-26 14:52:56 +0200
        message:
          WL5602
        ------------------------------------------------------------
        revno: 3402.87.31 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Thu 2012-04-26 14:45:08 +0200
        message:
          automerge
            ------------------------------------------------------------
            revno: 3402.88.2
            committer: Bernt M. Johnsen <bernt.johnsen@oracle.com>
            branch nick: wl5602
            timestamp: Thu 2012-04-26 14:06:28 +0200
            message:
              Bug#14006448 Two SSL tests disabled
            ------------------------------------------------------------
            revno: 3402.88.1
            committer: Bernt M. Johnsen <bernt.johnsen@oracle.com>
            branch nick: wl5602
            timestamp: Thu 2012-04-26 13:49:14 +0200
            message:
              Make openssl_1.test working for bot yaSSL and OpenSSL
        ------------------------------------------------------------
        revno: 3402.87.30
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Thu 2012-04-26 14:41:32 +0200
        message:
          WL5602 - fixed test failures due to differences in yassl vs openssl configuration.
        ------------------------------------------------------------
        revno: 3402.87.29 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Mon 2012-04-23 15:11:15 +0200
        message:
          trunk => WL5602 automerge
        ------------------------------------------------------------
        revno: 3402.87.28
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Mon 2012-04-23 10:47:14 +0200
        message:
          #WL5602
        ------------------------------------------------------------
        revno: 3402.87.27 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2012-04-20 17:14:24 +0200
        message:
          trunk => wl5602 automerge
        ------------------------------------------------------------
        revno: 3402.87.26
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2012-04-20 02:14:27 +0200
        message:
          WL5602
        ------------------------------------------------------------
        revno: 3402.87.25
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Wed 2012-04-18 14:30:36 +0200
        message:
          WL5602
          
          * Fixed various merge errors
          * Adjusted test results for non-openssl build policy in main suite.
        ------------------------------------------------------------
        revno: 3402.87.24
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Wed 2012-04-18 10:39:12 +0200
        message:
          WL5602
        ------------------------------------------------------------
        revno: 3402.87.23
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Tue 2012-04-17 23:15:44 +0200
        message:
          WL5602
        ------------------------------------------------------------
        revno: 3402.87.22
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Tue 2012-04-17 17:18:24 +0200
        message:
          WL5602
        ------------------------------------------------------------
        revno: 3402.87.21
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Wed 2012-03-28 15:44:46 +0200
        message:
          WL5602 - Fixed compile error on the Windows platform.
          
          Pre VS2010 compilers doesn't support stdint.h
        ------------------------------------------------------------
        revno: 3402.87.20
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Wed 2012-03-28 15:10:10 +0200
        message:
          WL5602 - Update test cases which depend on legacy old_passwords behavior.
        ------------------------------------------------------------
        revno: 3402.87.19
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Tue 2012-03-27 13:54:21 +0200
        message:
          WL5602 - Fixed bug in an error message which caused the client to crash
           because of a NULL pointer reference.
        ------------------------------------------------------------
        revno: 3402.87.18
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Mon 2012-03-26 19:55:03 +0200
        message:
          WL5602 - fixed merge errors
        ------------------------------------------------------------
        revno: 3402.87.17 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2012-03-23 16:42:27 +0100
        message:
          Merge trunk->wl5602
          + fixed missing mutex initialization issue on the sha256_password client 
        ------------------------------------------------------------
        revno: 3402.87.16
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2012-03-23 16:03:42 +0100
        message:
          WL5602 - moved tests to new test suite as mtr can't detect correct
          prerequisites if sha256_password isn't compiled in.
        ------------------------------------------------------------
        revno: 3402.87.15 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Thu 2012-03-22 19:28:07 +0100
        message:
          merge trunk->wl5602
        ------------------------------------------------------------
        revno: 3402.87.14
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Thu 2012-03-22 16:15:08 +0100
        message:
          WL5602 - Improve error reporting on the server and client.
        ------------------------------------------------------------
        revno: 3402.87.13
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2012-03-16 15:02:39 +0100
        message:
          WL5602 - remove misleading comment. Improve on code readability.
        ------------------------------------------------------------
        revno: 3402.87.12
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2012-03-16 15:00:29 +0100
        message:
          WL#6134 - Add CLIENT_PLUGIN_AUTH_LENENC_CLIENT_DATA
          
          The 55 client-server protocol currently limits the length of the
          auth-data-field sent from client to server to 255 bytes
          (CLIENT_SECURE_CONNECTION). 
          
          In order to support more authentication plugins as default
          choice the auth-data-field is changed into a true length
          encoded field and a new client-server capability is introduced
          (CLIENT_PLUGIN_AUTH_LENENC_CLIENT_DATA).
        ------------------------------------------------------------
        revno: 3402.87.11
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2012-03-16 10:26:14 +0100
        message:
          Wl5602 - Disable query log for connect directives because otherwise the result log will contain platform specific paths.
        ------------------------------------------------------------
        revno: 3402.87.10
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Thu 2012-03-15 16:35:36 +0100
        message:
          WL#5602 - Fixed code standard deviations, adding missing test.
        ------------------------------------------------------------
        revno: 3402.87.9
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2011-12-02 15:51:11 +0100
        message:
          WL5602 - Corrected merge error by adding missing init of plugin flags.
        ------------------------------------------------------------
        revno: 3402.87.8
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2011-12-02 11:45:23 +0100
        message:
          WL5602 - Added missing #ifdef HAVE_OPENSSL
        ------------------------------------------------------------
        revno: 3402.87.7
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Wed 2011-11-30 18:00:19 +0100
        message:
          WL5602 - applied fixed from review round 1
        ------------------------------------------------------------
        revno: 3402.87.6
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Tue 2011-11-29 10:47:34 +0100
        message:
          WL5602 add missing files
        ------------------------------------------------------------
        revno: 3402.87.5
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Tue 2011-11-29 10:35:51 +0100
        message:
          WL5602 add missing file
        ------------------------------------------------------------
        revno: 3402.87.4
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Tue 2011-11-29 09:31:52 +0100
        message:
          WL5602 - missing files
        ------------------------------------------------------------
        revno: 3402.87.3 [merge]
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Mon 2011-11-28 16:46:52 +0100
        message:
          merge
        ------------------------------------------------------------
        revno: 3402.87.2
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Mon 2011-11-28 16:15:21 +0100
        message:
          WL5602
        ------------------------------------------------------------
        revno: 3402.87.1
        committer: Kristofer Pettersson <kristofer.pettersson@oracle.com>
        branch nick: mysql-trunk-wl5602_second
        timestamp: Fri 2011-11-25 20:27:44 +0100
        message:
          WL5602
    ------------------------------------------------------------
    revno: 3690.34.78
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-08 15:50:18 +0530
    message:
      Added "mysql-test/collections/mysql-trunk.release" combination file here,which will be used by mysql-trunk-release branch.
    ------------------------------------------------------------
    revno: 3690.34.77
    committer: Thayumanavar <thayumanavar.x.sachithanantha@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-08 14:55:49 +0530
    message:
      Bug#14101563 - ASSERTION WHEN TABLE CANNOT BE CREATED DUE TO WARNINGS.
      PROBLEM: When table is created under innodb with innodb_file_per_table=0
               and row_format=dynamic, an assertion is triggered under the debug
               build.In the case of release builds, error is returned instead of
               of a warning. 
            	 
      FIX: The root cause for cause of assertion is because the status of
           the diagnostic area is set to DA_ERROR. This happens because
           when sql_mode is set to STRICT_TRANS_TABLES, we set the flag
           thd->abort_on_warning. In ha_innobase::create, the create options
           are validated only when innodb_strict_mode is on and error is
           propagated. When an warning is logged for row_file_format being
           off when row_format is dynamic, the thd->abort_on_warning and sql
           mode being STRICT_TRANS_TABLES causes DA_ERROR to be set in the
           diagnostic area and the innodb table creation continues assuming
           row_format=compact and success is returned.When my_ok is called,
           it asserts under debug builds since DA_ERROR is set in diagnostic
           area. The fix for the bug is to not to set thd->abort_on_warning
           irrespective of whether sql_mode is set to STRICT_TRANS_TABLES or
           not for innodb create. For validation of create option under innodb,
           innodb_strict_mode needs to be set.
    ------------------------------------------------------------
    revno: 3690.34.76
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-08 10:55:46 +0300
    message:
      Followup to vasil.dimov@oracle.com-20120608070526-vi3e0826jhxdkr3v
      do not try to validate bit fields with Valgrind.
    ------------------------------------------------------------
    revno: 3690.34.75
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-08 10:09:43 +0300
    message:
      Non-functional change - remove prototype of the private function
      dict_stats_snapshot_free() from the public dict0stats.h and make it static
      in dict0stats.cc and move it and dict_stats_snapshot_create() before
      their usage in dict0stats.cc.
    ------------------------------------------------------------
    revno: 3690.34.74
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-08 10:05:26 +0300
    message:
      Remove the macro PREPARE_PINFO_FOR_INDEX_SAVE() and use its code in the
      two places where it was used in order to get better line number repors
      about the Valgrind checks.
      
      Also deploy Valgrind checks when creating the table stats snapshot.
    ------------------------------------------------------------
    revno: 3690.34.73
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-08 09:08:13 +0300
    message:
      Followup to WL#6189 Turn InnoDB persistent statistics ON by default
      
      Adjust mtr tests, part 29.
      
      Persistent stats use a different sampling algorithm so it is possible
      that the stats numbers differ from transient stats.
      
      Also, persistent stats are updated less frequently or with a delay, so
      it is possible that persistent stats are not up to date as transient were
      even if both algorithms would return the same results.
      
      The order of the returned rows by a SELECT query depends on the stats and
      thus, if possible, we fix tests by prepending "-- sorted_result" to SELECTs
      that happen to return rows in different order.
      
      If possible, each failing test was fixed by manually running ANALYZE TABLE.
      This is doable if both transient and persistent sampling algorithms end up
      with the same numbers for the given table and its data.
      
      If persistent stats result in different stats, then test failures were fixed
      by forcing the usage of transient stats for the table by using
      CREATE TABLE ... STATS_PERSISTENT=0.
      
      Intentionally do not fix the tests by using persistent stats and adjustin
      the output of EXPLAIN in .result files because a different execution plan
      may cause a different code path to be executed, than the one originally
      intended in the test.
    ------------------------------------------------------------
    revno: 3690.34.72
    committer: Nisha Gopalakrishnan <nisha.gopalakrishnan@oracle.com>
    branch nick: mysql-trunk-13840553_2
    timestamp: Fri 2012-06-08 12:13:16 +0530
    message:
      Bug#13840553:64617: MYSQL MUST IMPROVE ERROR MESSAGES
      
      NOTE: This is a follow up patch to fix test failure:
            innodb.innodb_8k
------------------------------------------------------------
revno: 3886 [merge]
committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Fri 2012-06-08 09:00:32 +0400
message:
  Auto-merge from mysql-trunk.
    ------------------------------------------------------------
    revno: 3690.34.71
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-07 20:46:42 +0300
    message:
      Followup to vasil.dimov@oracle.com-20120607162500-88t54e4fihjj8bd8
      
      Run ANALYZE only for InnoDB tests as it confuses MyISAM tests.
    ------------------------------------------------------------
    revno: 3690.34.70
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-07 19:25:00 +0300
    message:
      Followup to WL#6189 Turn InnoDB persistent statistics ON by default
      
      Adjust mtr tests, part 28.
      
      Persistent stats use a different sampling algorithm so it is possible
      that the stats numbers differ from transient stats.
      
      Also, persistent stats are updated less frequently or with a delay, so
      it is possible that persistent stats are not up to date as transient were
      even if both algorithms would return the same results.
      
      The order of the returned rows by a SELECT query depends on the stats and
      thus, if possible, we fix tests by prepending "-- sorted_result" to SELECTs
      that happen to return rows in different order.
      
      If possible, each failing test was fixed by manually running ANALYZE TABLE.
      This is doable if both transient and persistent sampling algorithms end up
      with the same numbers for the given table and its data.
      
      If persistent stats result in different stats, then test failures were fixed
      by forcing the usage of transient stats for the table by using
      CREATE TABLE ... STATS_PERSISTENT=0.
      
      Intentionally do not fix the tests by using persistent stats and adjustin
      the output of EXPLAIN in .result files because a different execution plan
      may cause a different code path to be executed, than the one originally
      intended in the test.
    ------------------------------------------------------------
    revno: 3690.34.69
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-cleanup
    timestamp: Thu 2012-06-07 17:37:49 +0200
    message:
      Improved the test robustness of performance_schema.sizing_growth, adjusted mutex_per_share heuristic
    ------------------------------------------------------------
    revno: 3690.34.68 [merge]
    committer: Narayanan Venkateswaran <v.narayanan@oracle.com>
    branch nick: mysql-trunk-D-2
    timestamp: Thu 2012-06-07 19:20:48 +0530
    message:
      WL#6161 Integrating with InnoDB codebase in MySQL 5.5
      
      Merging forward changes from mysql-5.5
        ------------------------------------------------------------
        revno: 2875.388.9
        committer: Narayanan Venkateswaran <v.narayanan@oracle.com>
        branch nick: mysql-5.5-D-2
        timestamp: Thu 2012-06-07 19:14:26 +0530
        message:
          WL#6161 Integrating with InnoDB codebase in MySQL 5.5
                
          Changes in the InnoDB codebase required to compile and
          integrate the MEB codebase with MySQL 5.5.
          
          @ storage/innobase/btr/btr0btr.c
            Excluded buffer pool usage from MEB build.
           
            buf_pool_from_bpage calls are in buf0buf.ic, and
            the buffer pool functions from that file are
            disabled in MEB.
          @ storage/innobase/buf/buf0buf.c
            Disabling more buffer pool functions unused in MEB.
          @ storage/innobase/dict/dict0dict.c
            Disabling dict_ind_free that is unused in MEB.
          @ storage/innobase/dict/dict0mem.c
            The include
          
            #include "ha_prototypes.h"
          
            Was causing conflicts with definitions in my_global.h
          
            Linking C executable mysqlbackup
            libinnodb.a(dict0mem.c.o): In function `dict_mem_foreign_table_name_lookup_set':
            dict0mem.c:(.text+0x91c): undefined reference to `innobase_get_lower_case_table_names'
            libinnodb.a(dict0mem.c.o): In function `dict_mem_referenced_table_name_lookup_set':
            dict0mem.c:(.text+0x9fc): undefined reference to `innobase_get_lower_case_table_names'
            libinnodb.a(dict0mem.c.o): In function `dict_mem_foreign_table_name_lookup_set':
            dict0mem.c:(.text+0x96e): undefined reference to `innobase_casedn_str'
            libinnodb.a(dict0mem.c.o): In function `dict_mem_referenced_table_name_lookup_set':
            dict0mem.c:(.text+0xa4e): undefined reference to `innobase_casedn_str'
            collect2: ld returned 1 exit status
            make[2]: *** [mysqlbackup] Error 1
          
            innobase_get_lower_case_table_names
            innobase_casedn_str
            are functions that are part of ha_innodb.cc that is not part of the build
                  
            dict_mem_foreign_table_name_lookup_set
            function is not there in the current codebase, meaning we do not use it in MEB.
          @ storage/innobase/fil/fil0fil.c
            The srv_fast_shutdown variable is declared in
            srv0srv.c that is not compiled in the
            mysqlbackup codebase.
          
            This throws an undeclared error.
          
            From the Manual
            ---------------
          
            innodb_fast_shutdown
            --------------------
          
            The InnoDB shutdown mode. The default value is 1
            as of MySQL 3.23.50, which causes a ???????fast???????? shutdown
            (the normal type of shutdown). If the value is 0,
            InnoDB does a full purge and an insert buffer merge
            before a shutdown. These operations can take minutes,
            or even hours in extreme cases. If the value is 1,
            InnoDB skips these operations at shutdown.
          
            This ideally does not matter from mysqlbackup
            @ storage/innobase/ha/ha0ha.c
            In file included from /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/ha/ha0ha.c:34:0:
            /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/include/btr0sea.h:286:17: error: expected ???????=????????, ???????,????????, ???????;????????, ???????asm???????? or ???????__attribute__???????? before ???????*???????? token
            make[2]: *** [CMakeFiles/innodb.dir/home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/ha/ha0ha.c.o] Error 1
            make[1]: *** [CMakeFiles/innodb.dir/all] Error 2
            make: *** [all] Error 2
          
            # include "sync0rw.h" is excluded from hotbackup compilation in dict0dict.h
          
            This causes extern rw_lock_t*	btr_search_latch_temp; to throw a failure because
            the definition of rw_lock_t is not found.
          @ storage/innobase/include/buf0buf.h
            Excluding buffer pool functions that are unused from the
            MEB codebase.
          @ storage/innobase/include/buf0buf.ic
            replicated the exclusion of
          
            #include "buf0flu.h"
            #include "buf0lru.h"
            #include "buf0rea.h"
          
            by looking at the current codebase in <meb-trunk>/src/innodb
            @ storage/innobase/include/dict0dict.h
            dict_table_x_lock_indexes, dict_table_x_unlock_indexes, dict_table_is_corrupted,
            dict_index_is_corrupted, buf_block_buf_fix_inc_func are unused in MEB and was
            leading to compilation errors and hence excluded.
          @ storage/innobase/include/dict0dict.ic
            dict_table_x_lock_indexes, dict_table_x_unlock_indexes, dict_table_is_corrupted,
            dict_index_is_corrupted, buf_block_buf_fix_inc_func are unused in MEB and was
            leading to compilation errors and hence excluded.
          @ storage/innobase/include/log0log.h
            /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/include/log0log.h: At top level:
            /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/include/log0log.h:767:2: error: expected specifier-qualifier-list before ???  ????mutex_t????????
          
            mutex_t definitions were excluded as seen from ambient code
            hence excluding definition for log_flush_order_mutex also.
          @ storage/innobase/include/os0file.h
            Bug in InnoDB code, create_mode should have been create.
          @ storage/innobase/include/srv0srv.h
            In file included from /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/buf/buf0buf.c:50:0:
            /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/include/srv0srv.h: At top level:
            /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/include/srv0srv.h:120:16: error: expected ???????=????????, ???????,????????, ???????;????????, ???????asm???????? or ???????__attribute__???????? before ???????srv_use_native_aio????????
          
            srv_use_native_aio - we do not use native aio of the OS anyway from MEB. MEB does not compile
            InnoDB with this option. Hence disabling it.
          @ storage/innobase/include/trx0sys.h
            [ 56%] Building C object CMakeFiles/innodb.dir/home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/trx/trx0sys.c.o
            /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/trx/trx0sys.c: In function ???????trx_sys_read_file_format_id????????:
            /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/trx/trx0sys.c:1499:20: error: ???????TRX_SYS_FILE_FORMAT_TAG_MAGIC_N????????   undeclared (first use in this function)
            /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/trx/trx0sys.c:1499:20: note: each undeclared identifier is reported only once for  each function it appears in
            /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/trx/trx0sys.c: At top level:
            /home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/include/buf0buf.h:607:1: warning: ???????buf_block_buf_fix_inc_func???????? declared ???????static???????? but never defined
            make[2]: *** [CMakeFiles/innodb.dir/home/narayanan/mysql-server/mysql-5.5-meb-rel3.8-innodb-integration-1/storage/innobase/trx/trx0sys.c.o] Error 1
          
            unused calls excluded to enable compilation
          @ storage/innobase/mem/mem0dbg.c
              excluding #include "ha_prototypes.h" that lead to definitions in ha_innodb.cc
          @ storage/innobase/os/os0file.c
              InnoDB not compiled with aio support from MEB anyway. Hence excluding this from
              the compilation.
          @ storage/innobase/page/page0zip.c
            page0zip.c:(.text+0x4e9e): undefined reference to `buf_pool_from_block'
            collect2: ld returned 1 exit status
          
            buf_pool_from_block defined in buf0buf.ic, most of the file is excluded for compilation of MEB
          @ storage/innobase/ut/ut0dbg.c
            excluding #include "ha_prototypes.h" since it leads to definitions in ha_innodb.cc
            innobase_basename(file) is defined in ha_innodb.cc. Hence excluding that also.
          @ storage/innobase/ut/ut0ut.c
            cal_tm unused from MEB, was leading to earnings, hence disabling for MEB.
    ------------------------------------------------------------
    revno: 3690.34.67
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-07 15:40:08 +0300
    message:
      Add valgrind checks to help track down this warn:
      
        main.ctype_utf8mb4_innodb                w6 [ fail ]  Found warnings/errors in server log file!
                Test ended at 2012-06-04 18:21:00
        line
        ==2236== Thread 15:
        ==2236== Uninitialised byte(s) found during client check request
        ==2236==    at 0xC52835: dtuple_validate(dtuple_struct const*) (data0data.cc:263)
        ==2236==    by 0xB0B84D: page_cur_search_with_match(buf_block_struct const*, dict_index_struct const*, dtuple_struct const*, unsigned long, unsigned long*, unsigned long*, unsigned long*, unsigned long*, page_cur_struct*) (page0cur.cc:300)
        ==2236==    by 0xC19C08: btr_cur_search_to_nth_level(dict_index_struct*, unsigned long, dtuple_struct const*, unsigned long, unsigned long, btr_cur_struct*, unsigned long, char const*, unsigned long, mtr_struct*) (btr0cur.cc:760)
        ==2236==    by 0xB5365C: row_ins_index_entry_low(unsigned long, dict_index_struct*, dtuple_struct*, unsigned long, que_thr_struct*) (row0ins.cc:2173)
        ==2236==    by 0xB57323: row_ins_index_entry(dict_index_struct*, dtuple_struct*, unsigned long, unsigned long, que_thr_struct*) (row0ins.cc:2445)
        ==2236==    by 0xB57430: row_ins_index_entry_step(ins_node_struct*, que_thr_struct*) (row0ins.cc:2529)
        ==2236==    by 0xB5751E: row_ins(ins_node_struct*, que_thr_struct*) (row0ins.cc:2660)
        ==2236==    by 0xB57800: row_ins_step(que_thr_struct*) (row0ins.cc:2778)
        ==2236==    by 0xB31523: que_thr_step(que_thr_struct*) (que0que.cc:1085)
        ==2236==    by 0xB3180B: que_run_threads_low(que_thr_struct*) (que0que.cc:1167)
        ==2236==    by 0xB319B3: que_run_threads(que_thr_struct*) (que0que.cc:1208)
        ==2236==    by 0xB3245B: que_eval_sql(pars_info_struct*, char const*, unsigned long, trx_struct*) (que0que.cc:1285)
        ==2236==    by 0xC8101E: dict_stats_save_index_stat(dict_index_struct*, long, char const*, unsigned long, unsigned long*, char const*) (dict0stats.cc:1788)
        ==2236==    by 0xC81836: dict_stats_save(dict_table_struct*, unsigned long) (dict0stats.cc:2003)
        ==2236==    by 0xC82B5C: dict_stats_update(dict_table_struct*, dict_stats_upd_option, bool) (dict0stats.cc:2651)
        ==2236==    by 0xC83ACA: pop_from_auto_recalc_list_and_recalc() (dict0stats_background.cc:338)
        ==2236==  Address 0xbbc24d0 is 704 bytes inside a block of size 1,384 alloc'd
        ==2236==    at 0x4C216FB: malloc (vg_replace_malloc.c:236)
        ==2236==    by 0xAF44E4: mem_area_alloc(unsigned long*, mem_pool_struct*) (mem0pool.cc:381)
        ==2236==    by 0xAF29A3: mem_heap_create_block(mem_block_info_struct*, unsigned long, unsigned long, char const*, unsigned long) (mem0mem.cc:334)
        ==2236==    by 0xAF2D38: mem_heap_add_block(mem_block_info_struct*, unsigned long) (mem0mem.cc:448)
        ==2236==    by 0xB2A2AE: mem_heap_alloc(mem_block_info_struct*, unsigned long) (mem0mem.ic:186)
        ==2236==    by 0xB2A3FA: ib_heap_malloc(ib_alloc_struct*, unsigned long) (ut0vec.ic:39)
        ==2236==    by 0xBEDB18: ib_vector_create(ib_alloc_struct*, unsigned long, unsigned long) (ut0vec.cc:56)
        ==2236==    by 0xB2AB56: pars_info_add_literal(pars_info_struct*, char const*, void const*, unsigned long, unsigned long, unsigned long) (pars0pars.cc:2345)
        ==2236==    by 0xC80EE8: dict_stats_save_index_stat(dict_index_struct*, long, char const*, unsigned long, unsigned long*, char const*) (dict0stats.cc:1768)
        ==2236==    by 0xC81836: dict_stats_save(dict_table_struct*, unsigned long) (dict0stats.cc:2003)
        ==2236==    by 0xC82B5C: dict_stats_update(dict_table_struct*, dict_stats_upd_option, bool) (dict0stats.cc:2651)
        ==2236==    by 0xC83ACA: pop_from_auto_recalc_list_and_recalc() (dict0stats_background.cc:338)
        ==2236==    by 0xC83B63: dict_stats_thread (dict0stats_background.cc:380)
        ==2236==    by 0x4E2D73C: start_thread (in /lib64/libpthread-2.5.so)
        ==2236==    by 0x5EEBD1C: clone (in /lib64/libc-2.5.so)
    ------------------------------------------------------------
    revno: 3690.34.66
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-07 15:15:12 +0300
    message:
      Fix a memory leak in dict_stats_exec_sql() - if persistent storage
      does not exist, then pinfo would remain unfreed. So free it explicitly
      in this case.
    ------------------------------------------------------------
    revno: 3690.34.65
    committer: Jorgen Loland <jorgen.loland@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-07 14:05:57 +0200
    message:
      Fixed incorrect test case.
    ------------------------------------------------------------
    revno: 3690.34.64
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-06-07 16:42:50 +0530
    message:
      updated ds_mrr-big @solaris with bug number-14168107.
    ------------------------------------------------------------
    revno: 3690.34.63
    committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
    branch nick: mysql-trunk-11747177
    timestamp: Thu 2012-06-07 12:31:28 +0400
    message:
      Added test case for bug #11747177 - '31149: "SPECIFIED KEY
      WAS TOO LONG" IS PRINTED THREE TIMES.'.
      
      This bug was fixed by changes which were done for WL#5534
      "Online ALTER, Phase 1".
------------------------------------------------------------
revno: 3885 [merge]
committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Thu 2012-06-07 15:48:56 +0400
message:
  Manual merge from mysql-trunk.
  
  Note: failed perfschema.sizing_growth test (legacy problem).
    ------------------------------------------------------------
    revno: 3690.34.62
    committer: Jorgen Loland <jorgen.loland@oracle.com>
    branch nick: mysql-trunk-11765737
    timestamp: Thu 2012-06-07 09:28:02 +0200
    message:
      Bug#11765737: USE_COUNT: WRONG COUNT FOR KEY AT 0X7FFFD423EDE0,
                    0 SHOULD BE 1
      
      SEL_ARG::use_count is used to keep track of the number of 
      times a SEL_ARG is referred. SEL_ARGs are e.g. referred
      from SEL_ARGs with an earlier key part number. This is done so 
      that multiple range predicates with equal subparts can use the
      same SEL_ARG instead of duplicating the effort. If an index is
      created with two keyparts (kp1, kp2) and the query contains the
      predicate "(kp1=1 or kp1=2) and (kp2>3)", two SEL_ARGs needs
      to be created for the kp1 part of the predicate. Both these 
      SEL_ARGs will have use_count=1. Furthermore, both will point 
      to the SEL_ARG for kp2 which will have use_count=2.
      
      The bug was in SEL_ARG::increment_use_count() which is called
      on a SEL_ARG when more SEL_ARGs start referring to it. When
      increment_use_count() was called on a SEL_ARG, the SEL_ARGs
      it referred to was incremented by the input increment multiplied
      by the SEL_ARGs previous use_count. For a predicate
      "(kp1=1 or kp1=2 or kp1=3) and (kp2>3) and kp3>4" that means 
      that when these SEL_ARG trees get merged (use count numbers in
      brackets):
      "(kp1=1[1] or kp1=2[1]) and kp2>3[2] and kp3>4[2]" 
      "kp1=3[1]               and kp2>3[1] and kp3>4[1]",
      increment_use_count() would add 1 to use_count of kp2 and 2 to 
      use_count of kp3, resulting in this SEL_ARG tree:
      "(kp1=1[1] or kp1=2[1] or kp1=2[1]) and kp2>3[3] and kp3>4[4]"
      
      The use_count of kp3 should have been 3. The fix is to remove
      the multiplication of use_count in 
      SEL_ARG::increment_use_count().
    ------------------------------------------------------------
    revno: 3690.34.61
    committer: Nisha Gopalakrishnan <nisha.gopalakrishnan@oracle.com>
    branch nick: mysql-trunk-13840553_2
    timestamp: Thu 2012-06-07 09:12:57 +0530
    message:
      Bug#13840553:64617: MYSQL MUST IMPROVE ERROR MESSAGES
      
      Analysis
      --------
      When an ALTER TABLE operation is performed with an invalid foreign key
      constraint, the error reported is ER_CANT_CREATE_TABLE(Cannot create
      the table). The ALTER TABLE operation is performed on a copy of the
      original table, the original table is later deleted and the copy is
      renamed to the original table name. The error reported contains the
      temporary table name which is of the format
      'database_ name.#sql-[0-9_a-f-]*'.
      
      Fix:
      ---
      print_error() which maps the handler error to a SQL error has been used
      to report the error. This has helped in reporting more specific errors
      instead of the previously reported generic error ER_CANT_CREATE_TABLE
      (Cannot create the table) in most of the error scenarios. For the case
      of invalid foreign key constraint, the error that will be reported is:
      ER_CANNOT_ADD_FOREIGN- Cannot add foreign key constraint.
    ------------------------------------------------------------
    revno: 3690.34.60
    committer: kevin.lewis@oracle.com
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-06 11:29:11 -0500
    message:
      Bug#13809713-SUSPICIOUS CHECK IN HA_INNOBASE::CREATE()
      Approved by Marco on IM
    ------------------------------------------------------------
    revno: 3690.34.59
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-06 16:19:43 +0200
    message:
      Improved the test robustness for performance_schema.sizing_growth
    ------------------------------------------------------------
    revno: 3690.34.58
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-06 19:38:29 +0530
    message:
      Moving memcached tests out from experimental list, since they are not failing anymore.
    ------------------------------------------------------------
    revno: 3690.34.57
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-06 16:30:40 +0300
    message:
      Followup to WL#6189 Turn InnoDB persistent statistics ON by default
      
      Adjust mtr tests, part 27.
      
      Persistent stats use a different sampling algorithm so it is possible
      that the stats numbers differ from transient stats.
      
      Also, persistent stats are updated less frequently or with a delay, so
      it is possible that persistent stats are not up to date as transient were
      even if both algorithms would return the same results.
      
      The order of the returned rows by a SELECT query depends on the stats and
      thus, if possible, we fix tests by prepending "-- sorted_result" to SELECTs
      that happen to return rows in different order.
      
      If possible, each failing test was fixed by manually running ANALYZE TABLE.
      This is doable if both transient and persistent sampling algorithms end up
      with the same numbers for the given table and its data.
      
      If persistent stats result in different stats, then test failures were fixed
      by forcing the usage of transient stats for the table by using
      CREATE TABLE ... STATS_PERSISTENT=0.
      
      Intentionally do not fix the tests by using persistent stats and adjustin
      the output of EXPLAIN in .result files because a different execution plan
      may cause a different code path to be executed, than the one originally
      intended in the test.
    ------------------------------------------------------------
    revno: 3690.34.56
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: trunk
    timestamp: Wed 2012-06-06 16:12:51 +0400
    message:
      Patch for Bug#13431226 (VOID SP_RCONTEXT::POP_HANDLERS(INT):
      ASSERTION `M_HANDLERS.ELEMENTS() >= COUNT').
      
      Background:
      
        - Handlers are resolved using parsing contexts (original information
          about BEGIN..END blocks), in order to activate the resolved handler,
          handler instruction pointer is needed (instruction pointer of the first
          instruction in the handler). That instruction pointer is calculated
          during the execution (part of the runtime information).
      
        - Handler instruction pointers are stored in the sp_rcontext::m_handlers
          stack. It is a stack of potentially visible handlers during
          SP-instruction execution. That stack consists of entries, containing
          handler activation IP (instruction pointer). A new entry is pushed to
          the stack by the hpush instruction when the "DECLARE HANDLER" statement
          is processed. Entries are popped from the stack by the hpop instruction
          at the end of BEGIN..END block.
      
        - Apart from sp_rcontext::m_handlers there is a stack of already
          activated handlers (sp_rcontext::m_handler_call_stack), which keeps the
          continue instruction pointer for CONTINUE-handlers (next instruction to
          be executed after CONTINUE-handler is finished).
      
      The problem: it was implicitly assumed that after handler execution, the
      control flow can go only to the parent scope (one scope up). It could lead
      to a server crash built in the debug mode while executing a stored program
      with complex handler structure.
      
      This patch extends the SP-execution logic so that it is possible to jump
      from the end of the handler up a few scopes. Basically, the patch
      changes the way entries are removed from sp_rcontext::m_handlers and
      sp_rcontext::m_handler_call_stack.
      
      The main ideas of the patch are:
      
        - introduce level index of sp_pcontext instance
          (level of the BEGIN..END block). The topmost scope has 0 level.
      
        - store a pointer to the handler parsing context in sp_handler.
      
        - remove entries from sp_rcontext::m_handlers and
          sp_rcontext::m_handler_call_stack based on the level information:
          remove all the entries which correspond to child scopes.
      
      The patch also changes the hpop instruction -- it does not require
      number of handlers to pop anymore.
    ------------------------------------------------------------
    revno: 3690.34.55
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Wed 2012-06-06 16:48:12 +0530
    message:
      BUG#14150442 - ASSERT NODE->ENTRY == NULL, IN INSERT `
            
      Check if an index has been dropped or a new index has been added that
      prebuilt does not know about. We may need to rebuild the row insert template.
      	          `
      Approved by Mark over IM.
    ------------------------------------------------------------
    revno: 3690.34.54
    committer: Nisha Gopalakrishnan <nisha.gopalakrishnan@oracle.com>
    branch nick: mysql-trunk-11827404
    timestamp: Wed 2012-06-06 16:43:22 +0530
    message:
      Bug#11827404:60114: INSERT DELAYED CAN CALL HA_RELEASE_AUTO_INCREMENT
                          WITHOUT HAVING A LOCK.
      
      Analysis
      -------
      
      Mysqld crashes at times on a debug build, during the execution of
      the INSERT DELAYED statement under error scenarios. When a thread
      executes a DELAYED statement for a table, a handler thread is
      created to process all DELAYED statements for the table. The handler
      thread locks the table and handles the queued up inserts on the table.
      The handler thread updates the auto increment value row prior to
      writing the record. After the handler thread processes the stacked
      inserts, the auto increment value is reset and the table is unlocked.
      In case of simple INSERT, the thread that received INSERT request
      resets the auto increment value after writing the record. But not
      in the case of DELAYED INSERT since the threads share the table
      object.
      
      Under error scenarios, the thread that received the INSERT DELAYED
      request makes a redundant call to reset the auto increment value.
      
      The crash is observed in an error scenario and under a timing window
      where:
      The handler thread resets the auto increment value and unlocks
      the table, then the thread which received the INSERT DELAYED request
      tries to call the redundant release of auto increment value without
      having the lock on the table.
      
      Fix:
      ---
      Since the handler thread ensures the cleanup, removed the redundant
      call to reset the auto increment value in the main thread. Also in
      case of simple INSERT, it was observed that the call to reset auto
      increment value was redundant since the release was performed much
      ahead during the execution.
      
      NOTE:No regression test case has been added because the sync points
      currently does not work for the handler thread. The patch has
      been verified by running the existing test case main.delayed which
      fails sometimes without this patch.
    ------------------------------------------------------------
    revno: 3690.34.53
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Wed 2012-06-06 16:34:54 +0530
    message:
      BUG 14161424 - IMPORT OF COMPRESSED TABLE DOES AN EXTRA CHECKSUM OF NON INDEX PAGES
      
      When converting a page from the to be imported tablespace only checksum up to
      the compressed table page size. 
      
      Approved Marko Makela
    ------------------------------------------------------------
    revno: 3690.34.52 [merge]
    committer: Evgeny Potemkin <evgeny.potemkin@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-06 14:45:35 +0400
    message:
      Auto-merge.
        ------------------------------------------------------------
        revno: 3690.56.27
        committer: Joerg Bruehe <joerg.bruehe@oracle.com>
        branch nick: mysql-trunk
        timestamp: Wed 2012-06-06 12:10:17 +0200
        message:
          Ignore (bzr) the new component "client/mysql_config_editor",
          helpful for those who build within the source tree.
        ------------------------------------------------------------
        revno: 3690.56.26
        committer: Gleb Shchepa <gleb.shchepa@oracle.com>
        branch nick: trunk
        timestamp: Wed 2012-06-06 14:04:10 +0400
        message:
          Minor test update
        ------------------------------------------------------------
        revno: 3690.56.25
        committer: Rohit Kalhans <rohit.kalhans@oracle.com>
        branch nick: mysql-trunk
        timestamp: Wed 2012-06-06 15:22:35 +0530
        message:
          WL#5597: Removed find_row() remnants from the trunk.
          This function was removed as the part of WL#5597. 
        ------------------------------------------------------------
        revno: 3690.56.24
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Wed 2012-06-06 12:27:29 +0300
        message:
          Followup to WL#6189 Turn InnoDB persistent statistics ON by default
          
          Adjust mtr tests, part 26.
          
          Persistent stats use a different sampling algorithm so it is possible
          that the stats numbers differ from transient stats.
          
          Also, persistent stats are updated less frequently or with a delay, so
          it is possible that persistent stats are not up to date as transient were
          even if both algorithms would return the same results.
          
          The order of the returned rows by a SELECT query depends on the stats and
          thus, if possible, we fix tests by prepending "-- sorted_result" to SELECTs
          that happen to return rows in different order.
          
          If possible, each failing test was fixed by manually running ANALYZE TABLE.
          This is doable if both transient and persistent sampling algorithms end up
          with the same numbers for the given table and its data.
          
          If persistent stats result in different stats, then test failures were fixed
          by forcing the usage of transient stats for the table by using
          CREATE TABLE ... STATS_PERSISTENT=0.
          
          Intentionally do not fix the tests by using persistent stats and adjustin
          the output of EXPLAIN in .result files because a different execution plan
          may cause a different code path to be executed, than the one originally
          intended in the test.
        ------------------------------------------------------------
        revno: 3690.56.23
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Wed 2012-06-06 11:05:04 +0300
        message:
          Fix Bug#14156531 DICT_STATS_RENAME_TABLE() DOES AN UNSAFE ROLLBACK
          
          Change the code so that dict_sys->mutex is never held when dict_stats_update()
          is called. This is needed so that we can also lock dict_operation_lock and
          "simulate" row_mysql_lock_data_dictionary() around the access to
          mysql.innodb_(table|index)_stats in dict0stats.cc, so that rollback is happy.
          
          The only codepath where it is not easy to not-hold dict_sys->mutex around
          dict_stats_update() is the "innodb_table_monitor" codepath from dict_print().
          There, if stats are not initialized, we temporarily use
          dict_stats_update_transient() for the purposes of printing and reset back
          the stats to not initialized state.
          
          Do not call dict_stats_update() from
          dict_process_sys_tables_rec_and_mtr_commit(). It was only done in the
          dict_print() codepath and in this case we already take care about the stats
          in dict_table_print_low() as described above. Thus remove the now unneeded
          DICT_TABLE_UPDATE_STATS.
          
          Remove unused functions dict_table_print() and dict_table_print_by_name()
          and rename dict_table_print_low() to dict_table_print().
          
          Remove now unused functions dict_stats_open() and dict_stats_close().
        ------------------------------------------------------------
        revno: 3690.56.22
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Wed 2012-06-06 08:59:18 +0300
        message:
          Followup to WL#6189 Turn InnoDB persistent statistics ON by default
          
          Adjust mtr tests, part 25.
          
          Persistent stats use a different sampling algorithm so it is possible
          that the stats numbers differ from transient stats.
          
          Also, persistent stats are updated less frequently or with a delay, so
          it is possible that persistent stats are not up to date as transient were
          even if both algorithms would return the same results.
          
          The order of the returned rows by a SELECT query depends on the stats and
          thus, if possible, we fix tests by prepending "-- sorted_result" to SELECTs
          that happen to return rows in different order.
          
          If possible, each failing test was fixed by manually running ANALYZE TABLE.
          This is doable if both transient and persistent sampling algorithms end up
          with the same numbers for the given table and its data.
          
          If persistent stats result in different stats, then test failures were fixed
          by forcing the usage of transient stats for the table by using
          CREATE TABLE ... STATS_PERSISTENT=0.
          
          Intentionally do not fix the tests by using persistent stats and adjustin
          the output of EXPLAIN in .result files because a different execution plan
          may cause a different code path to be executed, than the one originally
          intended in the test.
        ------------------------------------------------------------
        revno: 3690.56.21
        committer: Alexander Barkov <alexander.barkov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-06-05 23:22:56 +0400
        message:
          Fixing C++ comments in C code.
        ------------------------------------------------------------
        revno: 3690.56.20
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-06-05 20:05:53 +0300
        message:
          Followup to WL#6189 Turn InnoDB persistent statistics ON by default
          
          Adjust mtr tests, part 24.
          
          Persistent stats use a different sampling algorithm so it is possible
          that the stats numbers differ from transient stats.
          
          Also, persistent stats are updated less frequently or with a delay, so
          it is possible that persistent stats are not up to date as transient were
          even if both algorithms would return the same results.
          
          The order of the returned rows by a SELECT query depends on the stats and
          thus, if possible, we fix tests by prepending "-- sorted_result" to SELECTs
          that happen to return rows in different order.
          
          If possible, each failing test was fixed by manually running ANALYZE TABLE.
          This is doable if both transient and persistent sampling algorithms end up
          with the same numbers for the given table and its data.
          
          If persistent stats result in different stats, then test failures were fixed
          by forcing the usage of transient stats for the table by using
          CREATE TABLE ... STATS_PERSISTENT=0.
          
          Intentionally do not fix the tests by using persistent stats and adjustin
          the output of EXPLAIN in .result files because a different execution plan
          may cause a different code path to be executed, than the one originally
          intended in the test.
        ------------------------------------------------------------
        revno: 3690.56.19 [merge]
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: trunk-merge
        timestamp: Tue 2012-06-05 16:14:03 +0200
        message:
          NULL merge 5.5 => trunk
            ------------------------------------------------------------
            revno: 2875.388.8 [merge]
            committer: Tor Didriksen <tor.didriksen@oracle.com>
            branch nick: 5.5
            timestamp: Tue 2012-06-05 16:12:22 +0200
            message:
              merge 5.1 => 5.5
                ------------------------------------------------------------
                revno: 2661.840.28
                committer: Tor Didriksen <tor.didriksen@oracle.com>
                branch nick: 5.1
                timestamp: Tue 2012-06-05 15:53:39 +0200
                message:
                  Bug#14051002 VALGRIND: CONDITIONAL JUMP OR MOVE IN RR_CMP / MY_QSORT
                  
                  Patch for 5.1 and 5.5: fix typo in byte comparison in rr_cmp()
        ------------------------------------------------------------
        revno: 3690.56.18
        committer: Jorgen Loland <jorgen.loland@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-06-05 14:17:53 +0200
        message:
          Optimizer trace cleanup:
          
          - When the range optimizer decides that an index cannot be used
            it doesn't make sense to print info like whether or not
            DsMRR will be used or if the index is rowid ordered. Remove 
            this info in such cases.
          
          - When the optimizer decides that range access is not possible
            on an index, optimizer trace used to print 
            "chosen: false, cause: cost" even in cases where the cost was
            not the reason. Now print "cause: unkown" in these cases.
        ------------------------------------------------------------
        revno: 3690.56.17
        committer: Nirbhay Choubey <nirbhay.choubey@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-06-05 17:33:10 +0530
        message:
          WL#5603 : Revise how we handle passwords on
                    the command line
          
          Fix for some build failures.
        ------------------------------------------------------------
        revno: 3690.56.16
        committer: Rohit Kalhans <rohit.kalhans@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-06-05 17:01:59 +0530
        message:
          diabling i_binlog.binlog_mysqlbinlog_file_write from daily and weekly runs
        ------------------------------------------------------------
        revno: 3690.56.15 [merge]
        committer: magnus.blaudd@oracle.com
        branch nick: trunk
        timestamp: Tue 2012-06-05 13:06:26 +0200
        message:
          Merge trunk-bug13604447 -> trunk
            ------------------------------------------------------------
            revno: 3690.57.1
            committer: magnus.blaudd@oracle.com
            branch nick: trunk-bug13604447
            timestamp: Fri 2012-06-01 19:27:57 +0200
            message:
              Bug#13604447 61064: SELECT QUERIES USING ESCAPE SYNTAX FAIL
               - Add function to Item_func_like making it possible to determine
                 if the item represents an "expr LIKE pat" or "expr LIKE pat ESCAPE 'escape_char'"
               - The above function is used by ha_ndbcluster to avoid pushing down
                 LIKE queries with non default escape characters(only the default escape
                 character '\' is supported by NDB currently)
        ------------------------------------------------------------
        revno: 3690.56.14 [merge]
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: trunk-bug14051002rrcmp
        timestamp: Tue 2012-06-05 12:31:38 +0200
        message:
          null merge 5.5 => trunk
            ------------------------------------------------------------
            revno: 2875.388.7
            committer: Tor Didriksen <tor.didriksen@oracle.com>
            branch nick: 5.5
            timestamp: Tue 2012-06-05 12:27:20 +0200
            message:
              Bug#13417440 : 63340: ARCHIVE FILE IO NOT INSTRUMENTED
              
              Followup patch: wrong result unless archive storage engine is available.
        ------------------------------------------------------------
        revno: 3690.56.13
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: trunk-bug14051002rrcmp
        timestamp: Tue 2012-06-05 12:27:55 +0200
        message:
          Bug#14051002 VALGRIND: CONDITIONAL JUMP OR MOVE IN RR_CMP / MY_QSORT
          
          The function rr_cmp was reading unused bytes when sorting record references.
          Fix: 
          use my_qsort2 rather than my_qsort, so that rr_cmp knows how many bytes to compare.
          
          There were actually *no* mtr test cases in our test suite
          which used this algorithm (rr_from_cache), so this code has
          been unused for some time ...
        ------------------------------------------------------------
        revno: 3690.56.12
        committer: Martin Hansson <martin.hansson@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-06-05 11:47:03 +0200
        message:
          Removed file wl5874_updown.
        ------------------------------------------------------------
        revno: 3690.56.11
        committer: Alexander Barkov <alexander.barkov@oracle.com>
        branch nick: mysql-trunk.w3
        timestamp: Tue 2012-06-05 13:21:53 +0400
        message:
          Preparatory refactoring for multi-level collations:
          - Introducing MY_UCA_WEIGHT_LEVEL, moving one level related data
            from MY_UCA_INFO to MY_UCA_WEIGHT_LEVEL
          - Splitting big functions into smaller ones
        ------------------------------------------------------------
        revno: 3690.56.10
        committer: Jorgen Loland <jorgen.loland@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-06-05 10:09:11 +0200
        message:
          Bug#14152530: INCORRECT RANGE CONSTRUCTION FOR UNSIGNED
                        BIGINT COLUMNS
          
          The range optimizer did not handle predicates with unsigned 
          bigint correctly because the value ULONGLONG_MAX was interpreted
          as -1. 
        ------------------------------------------------------------
        revno: 3690.56.9 [merge]
        committer: Marc Alff <marc.alff@oracle.com>
        branch nick: mysql-trunk-merge
        timestamp: Tue 2012-06-05 09:25:03 +0200
        message:
          WL#6135 PERFORMANCE_SCHEMA ENABLED BY DEFAULT
          
          Merge mysql-trunk-wl6135 --> mysql-trunk
            ------------------------------------------------------------
            revno: 3768.3.21 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Tue 2012-06-05 09:22:20 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.20 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Tue 2012-06-05 08:42:20 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.19 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Mon 2012-06-04 16:12:37 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.18
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Fri 2012-06-01 12:05:58 +0200
            message:
              Fixed test result
            ------------------------------------------------------------
            revno: 3768.3.17 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Fri 2012-06-01 10:45:46 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.16 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Fri 2012-06-01 10:39:34 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.15
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Thu 2012-05-31 15:12:15 +0200
            message:
              WL#6135 PERFORMANCE_SCHEMA ENABLED BY DEFAULT
              
              Improved the test suite.
              
              Fixed the test sizing_high to be more robust,
              and less platform dependent.
            ------------------------------------------------------------
            revno: 3768.3.14
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Thu 2012-05-31 13:14:10 +0200
            message:
              WL#6135 PERFORMANCE_SCHEMA ENABLED BY DEFAULT
              
              Removed --table-cache, improved tests.
            ------------------------------------------------------------
            revno: 3768.3.13 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Thu 2012-05-31 12:30:16 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.12
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Thu 2012-05-31 01:04:50 +0200
            message:
              Test cleanup, test using platforms with PFS_ALIGN only
            ------------------------------------------------------------
            revno: 3768.3.11 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Thu 2012-05-31 00:33:08 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.10 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Wed 2012-05-30 14:13:20 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.9
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Wed 2012-05-30 13:44:42 +0200
            message:
              WL#6135 PERFORMANCE SCHEMA ENABLED BY DEFAULT
              
              Implementation continued, improved tests.
            ------------------------------------------------------------
            revno: 3768.3.8
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Wed 2012-05-30 01:35:24 +0200
            message:
              Code cleanup for the embedded build, fixed test cases.
            ------------------------------------------------------------
            revno: 3768.3.7 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Tue 2012-05-29 19:39:06 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.6 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Tue 2012-05-29 11:25:25 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.5
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Fri 2012-05-25 18:14:57 +0200
            message:
              Work in progress, continued
            ------------------------------------------------------------
            revno: 3768.3.4 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Fri 2012-05-25 15:51:52 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.3
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Fri 2012-05-25 15:22:34 +0200
            message:
              WL#6135 PERFORMANCE SCHEMA ENABLED BY DEFAULT 
              
              Implemented automated sizing for performance schema parameters
            ------------------------------------------------------------
            revno: 3768.3.2 [merge]
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Fri 2012-05-25 10:32:05 +0200
            message:
              Merge mysql-trunk --> mysql-trunk-wl6135
            ------------------------------------------------------------
            revno: 3768.3.1
            committer: Marc Alff <marc.alff@oracle.com>
            branch nick: mysql-trunk-wl6135
            timestamp: Fri 2012-05-25 09:53:01 +0200
            message:
              WL#6135 PERFORMANCE SCHEMA ENABLED BY DEFAULT
              
              Work in progress
        ------------------------------------------------------------
        revno: 3690.56.8
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-04 18:15:53 +0300
        message:
          Followup to WL#6189 Turn InnoDB persistent statistics ON by default
          
          Adjust mtr tests, part 23.
          
          Persistent stats use a different sampling algorithm so it is possible
          that the stats numbers differ from transient stats.
          
          Also, persistent stats are updated less frequently or with a delay, so
          it is possible that persistent stats are not up to date as transient were
          even if both algorithms would return the same results.
          
          If possible, each failing test was fixed by manually running ANALYZE TABLE.
          This is doable if both transient and persistent sampling algorithms end up
          with the same numbers for the given table and its data.
          
          If persistent stats result in different stats, then test failures were fixed
          by forcing the usage of transient stats for the table by using
          CREATE TABLE ... STATS_PERSISTENT=0.
          
          Intentionally do not fix the tests by using persistent stats and adjustin
          the output of EXPLAIN in .result files because a different execution plan
          may cause a different code path to be executed, than the one originally
          intended in the test.
        ------------------------------------------------------------
        revno: 3690.56.7
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-04 17:29:49 +0300
        message:
          Move common code that allocates a trx object, calls que_eval_sql(),
          commits or rollsback the trx and frees it into a separate function and
          call it from all the places that used the duplicated code.
          
          Do not release the dict_sys->mutex around rollback because this could lead
          to deadlocks. trx->dict_operation_lock_mode needs to be set as a side effect
          of this because otherwise trx_rollback_to_savepoint() may try to freeze
          the dict.
        ------------------------------------------------------------
        revno: 3690.56.6
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-04 13:45:58 +0300
        message:
          Possibly fix the second failure in
          Bug#14151544 MAIN.PARTITION_INNODB TEST FAILS ON PB2 SPORADICALLY.
        ------------------------------------------------------------
        revno: 3690.56.5
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-06-04 10:41:57 +0300
        message:
          Fix Bug#14150317 A RACE RESULTS IN UNINITIALIZED MUTEX USED IN DICT_STATS_REMOVE_TABLE_FROM_AUTO_
          
          Initialize objects used by stats background thread before recovery tooks place
          because even though the thread is not created yet, recovery could call
          dict_stats_remove_table_from_auto_recalc() via row_drop_table_for_mysql().
        ------------------------------------------------------------
        revno: 3690.56.4
        committer: Jorgen Loland <jorgen.loland@oracle.com>
        branch nick: mysql-trunk-14046403
        timestamp: Tue 2012-06-05 09:19:01 +0200
        message:
          Bug#14046403: SEGFAULT IN RESOLVE_SUBQUERY AT SQL/SQL_RESOLVER.CC
                        ON 2ND EXEC OF PREPARED STMT
          
          In Item_in_optimizer::transform(), args[0] is assigned to 
          Item_in_subselect->left_expr. In this bug, args[0] contained
          a replacement item that was rolled back for each PS execution.
          Because this rollback was not done for
          Item_in_subselect->left_expr, it pointed to a deleted item on
          second execution.
          
          The fix is to rollback Item_in_subselect->left_expr as well. This
          works fine because the transformation is done on each execution.
        ------------------------------------------------------------
        revno: 3690.56.3
        committer: Jorgen Loland <jorgen.loland@oracle.com>
        branch nick: mysql-trunk-review
        timestamp: Tue 2012-06-05 09:13:40 +0200
        message:
          Optimizer trace: 
           * Fixed: Wrong cost was printed for table scan in the 
             chosen_range_access_summary section
           * Added: Whether DsMRR is chosen is now printed (like in 
             EXPLAIN it says "using_mrr=true" if DsMRR is chosen,
             "using_mrr=false" otherwise.
        ------------------------------------------------------------
        revno: 3690.56.2
        committer: Anitha Gopi <anitha.gopi@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-06-05 08:31:06 +0200
        message:
          Bug#13418338 : Modify README file to include the same comments as MTR user doc regarding collections
        ------------------------------------------------------------
        revno: 3690.56.1 [merge]
        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
        branch nick: mysql-trunk-merge
        timestamp: Tue 2012-06-05 06:58:05 +0100
        message:
          BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
          Problem:
           Replication locks are poorly implemented. In particular:
           - locks are undocumented
           - there are some missing assertions in some functions that require
             a lock to be taken 
           - some function names are overloaded unnecessarily so that it is 
             hard to grep for places where a particular function is invoked
           - some variable names could be more descriptive
           - we have protocols controlling which locks to hold before invoking
             particular functions (but the protocols are often not spelt out
             explicitly or ensured by assertions).
             change_master breaks the protocol for init_relay_log_pos by not
             taking rli.data_lock. this was not detected previously because of
             missing assertions. one consequence is that there is a race where
             show slave status can read relay log position/file name while 
             change master is modifying them. 
          Fix:
           This solution is divided into 8 parts, each one on its one commit
           with a detailed commit message.
            ------------------------------------------------------------
            revno: 3690.55.1 [merge]
            committer: Nuno Carvalho <nuno.carvalho@oracle.com>
            branch nick: mysql-trunk-merge
            timestamp: Wed 2012-05-30 11:16:29 +0100
            message:
              BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
              Problem:
               Replication locks are poorly implemented. In particular:
               - locks are undocumented
               - there are some missing assertions in some functions that require
                 a lock to be taken
               - some function names are overloaded unnecessarily so that it is
                 hard to grep for places where a particular function is invoked
               - some variable names could be more descriptive
               - we have protocols controlling which locks to hold before invoking
                 particular functions (but the protocols are often not spelt out
                 explicitly or ensured by assertions).
                 change_master breaks the protocol for init_relay_log_pos by not
                 taking rli.data_lock. this was not detected previously because of
                 missing assertions. one consequence is that there is a race where
                 show slave status can read relay log position/file name while
                 change master is modifying them.
              Fix: 
               This solution is divided into 8 parts, each one on its one commit
               with a detailed commit message.
                ------------------------------------------------------------
                revno: 3797.1.3
                committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                branch nick: mysql-trunk-13779291
                timestamp: Wed 2012-05-30 11:07:14 +0100
                message:
                  BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                  
                  Moved new tests to internal tests directory.
                ------------------------------------------------------------
                revno: 3797.1.2 [merge]
                committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                branch nick: mysql-trunk-13779291
                timestamp: Wed 2012-05-30 11:03:45 +0100
                message:
                  Merge from mysql-trunk into local branch.
                ------------------------------------------------------------
                revno: 3797.1.1 [merge]
                committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                branch nick: mysql-trunk-13779291
                timestamp: Tue 2012-05-08 17:42:55 +0100
                message:
                  BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                  Problem:
                   Replication locks are poorly implemented. In particular:
                   - locks are undocumented
                   - there are some missing assertions in some functions that require
                     a lock to be taken 
                   - some function names are overloaded unnecessarily so that it is 
                     hard to grep for places where a particular function is invoked
                   - some variable names could be more descriptive
                   - we have protocols controlling which locks to hold before invoking
                     particular functions (but the protocols are often not spelt out
                     explicitly or ensured by assertions).
                     change_master breaks the protocol for init_relay_log_pos by not
                     taking rli.data_lock. this was not detected previously because of
                     missing assertions. one consequence is that there is a race where 
                     show slave status can read relay log position/file name while 
                     change master is modifying them. 
                  Fix:  
                   This solution is divided into 8 parts, each one on its one commit 
                   with a detailed commit message.
                    ------------------------------------------------------------
                    revno: 3690.54.3
                    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                    branch nick: mysql-trunk-bf
                    timestamp: Tue 2012-05-08 17:33:07 +0100
                    message:
                      BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                      This is part 8 of the patch. Refactored MYSQL_BIN_LOG::write_incident(), added a
                      new argument do_flush_and_sync.
                    ------------------------------------------------------------
                    revno: 3690.54.2 [merge]
                    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                    branch nick: mysql-trunk-bf
                    timestamp: Mon 2012-05-07 09:53:28 +0100
                    message:
                      Merge from mysql-trunk into local branch.
                    ------------------------------------------------------------
                    revno: 3690.54.1 [merge]
                    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                    branch nick: mysql-trunk-bf
                    timestamp: Mon 2012-05-07 09:25:56 +0100
                    message:
                      BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                      This is part 7 of the patch. More need_mutex comments replaced by the correct
                      mutex name. Also added rpl_stress_flush_rotate_relay_log test.
                        ------------------------------------------------------------
                        revno: 3690.53.7
                        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                        branch nick: mysql-trunk
                        timestamp: Tue 2012-04-03 19:06:48 +0100
                        message:
                          BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                          This is part 7 of the patch.
                          Updated rpl_stress_flush_rotate_relay_log.test to only change debug flag
                          when slave is stopped.
                          Updated rpl_stress_flush_rotate_relay_log.result in order to 
                          ignore warnings id.
                          Added missing lock/unlock to rpl_slave.wait_for_relay_log_space().
                          Only rotate log when slave is configured in
                          sql_reload.reload_acl_and_cache() like past behaviour.
                        ------------------------------------------------------------
                        revno: 3690.53.6 [merge]
                        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                        branch nick: mysql-trunk
                        timestamp: Mon 2012-04-02 19:30:08 +0100
                        message:
                          BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                          This is part 6 of the patch. It only cleans up redundant junk
                          from the source files.
                          The parameter log_type_arg in MYSQL_BIN_LOG::open_binlog(char*,...)
                          is always equal to LOG_BIN. So it can be removed.
                            ------------------------------------------------------------
                            revno: 3690.52.6
                            committer: Sven Sandberg <sven.sandberg@oracle.com>
                            branch nick: trunk-wl3584-1
                            timestamp: Fri 2012-03-02 21:18:31 +0100
                            message:
                              BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                              This is part 6 of the patch. It only cleans up redundant junk
                              from the source files.
                              The parameter log_type_arg in MYSQL_BIN_LOG::open_binlog(char*,...)
                              is always equal to LOG_BIN. So it can be removed.
                        ------------------------------------------------------------
                        revno: 3690.53.5 [merge]
                        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                        branch nick: mysql-trunk
                        timestamp: Mon 2012-04-02 19:26:40 +0100
                        message:
                          BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                          This is part 5 of the patch. It only cleans up redundant junk
                          from the source files.
                          The member variable MYSQL_BIN_LOG::no_auto_events and the 
                          parameter no_auto_events in MYSQL_BIN_LOG::open_binlog(char*,...)
                          are always false. So they can be removed.
                          As a result MYSQL_BIN_LOG::init, which is called in only one 
                          place, contains only a single assignment.
                          So we remove it and replace the call by the assignment.
                            ------------------------------------------------------------
                            revno: 3690.52.5
                            committer: Sven Sandberg <sven.sandberg@oracle.com>
                            branch nick: trunk-wl3584-1
                            timestamp: Fri 2012-03-02 21:12:56 +0100
                            message:
                              BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                              This is part 5 of the patch. It only cleans up redundant junk
                              from the source files.
                              The member variable MYSQL_BIN_LOG::no_auto_events and the
                              parameter no_auto_events in MYSQL_BIN_LOG::open_binlog(char*,...)
                              are always false. So they can be removed.
                              As a result MYSQL_BIN_LOG::init, which is called in only one
                              place, contains only a single assignment.
                              So we remove it and replace the call by the assignment.
                        ------------------------------------------------------------
                        revno: 3690.53.4 [merge]
                        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                        branch nick: mysql-trunk
                        timestamp: Mon 2012-04-02 19:11:48 +0100
                        message:
                          BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                          This is part 4 of the patch. It fixes the actual bug.
                          Problem:
                          Master_info::mi_description_event was accessed by concurrent
                          threads without a lock. This caused random crashes.
                          Fix:
                          Protect Master_info::mi_description_event by Master_info::data_lock.
                          (Why this lock and not any other? 1. Master_info::data_lock is, in
                          general, the correct lock to use for data that belongs to
                          Master_info. 2. the lock is already held in all time-critical
                          places where mi_description_event is used, so this should not degrade
                          performance.)
                          The fix has two parts:
                           1. Add assertion in Master_info::[set|get]_mi_description_event
                              to ensure the lock is held.
                           2. Acquire the lock in all places that need it.
                               @ mysql-test/suite/rpl/r/rpl_stress_flush_rotate_relay_log.result
                            new result file
                               @ mysql-test/suite/rpl/t/rpl_stress_flush_rotate_relay_log.test
                            new test case
                               @ sql/binlog.cc
                             - Refactor MYSQL_BIN_LOG::append_[event|buffer] so that they
                               hold mi->data_lock before accessing mi->mi_description_event.
                             - Also make them take Master_info as parameter instead of
                               reading active_mi.
                               @ sql/binlog.h
                             - MYSQL_BIN_LOG::append_[buffer|event] need a new parameters
                               in order to acquire mi->data_lock correctly.
                             - Added MYSQL_BIN_LOG::after_append_to_relay_log
                               @ sql/rpl_mi.h
                            Assert that the correct mutex is held before accessing
                            mi_description_event
                               @ sql/rpl_slave.cc
                            Acquire mi->data_lock before using mi->mi_description_event:
                             - In get_master_version_and_clock. This fixes a race between
                               the startup code for the IO thread and FLUSH RELAY LOGS.
                             - In write_ignored_events_to_relay_log. This fixes a race
                               between the shutdown code for the IO thread and
                               FLUSH RELAY LOGS.
                             - In the startup code for the IO thread. This fixes a race
                               between the startup code and FLUSH RELAY LOGS.
                             - In the shutdown code for the IO thread. This fixes a race
                               between the shutdown code and FLUSH RELAY LOGS.
                             - Before invoking queue_old_event. This fixes races between
                               the IO thread that reads old events and FLUSH RELAY LOGS.
                             - In the beginning of queue_event, when it reads a START_EVENT_V3
                               and accesses mi->mi_description_event. This fixes a race between
                               the IO thread an FLUSH RELAY LOGS.
                            Also:
                             - remove obsolete LINT_INIT code.
                               @ sql/sql_reload.cc
                            Acquire the correct lock before rotating the relay log.
                            ------------------------------------------------------------
                            revno: 3690.52.4
                            committer: Sven Sandberg <sven.sandberg@oracle.com>
                            branch nick: trunk-wl3584-1
                            timestamp: Fri 2012-03-02 20:49:01 +0100
                            message:
                              BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                              This is part 4 of the patch. It fixes the actual bug.
                              Problem:
                              Master_info::mi_description_event was accessed by concurrent
                              threads without a lock. This caused random crashes.
                              Fix:
                              Protect Master_info::mi_description_event by Master_info::data_lock.
                              (Why this lock and not any other? 1. Master_info::data_lock is, in
                              general, the correct lock to use for data that belongs to
                              Master_info. 2. the lock is already held in all time-critical
                              places where mi_description_event is used, so this should not degrade
                              performance.)
                              The fix has two parts:
                               1. Add assertion in Master_info::[set|get]_mi_description_event
                                  to ensure the lock is held.
                               2. Acquire the lock in all places that need it.
                        ------------------------------------------------------------
                        revno: 3690.53.3 [merge]
                        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                        branch nick: mysql-trunk
                        timestamp: Mon 2012-04-02 18:51:50 +0100
                        message:
                          BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                          This is part 3 of the patch. It only makes a small refactoring
                          to make the code more maintainable.
                          Problem:
                          Objects that are used by any binary or relay log are supposed to
                          be stored in MYSQL_BIN_LOG. Objects that are used by the IO
                          thread are supposed to be stored in Master_info.
                          The Format_description_log_event that is used by the IO thread
                          to read events was incorrectly a member of MYSQL_BIN_LOG.
                          One result of this wrong design was that the correct lock was
                          not held in all places that use the event.
                          Fix:
                           - Move the format_description_log_event to Master_info.
                           - Make it a private member and encapsulate any use of it in
                             setter/getter functions, so that we can later add
                             assertions ensuring the correct lock is held before using
                             it.
                           - Add a couple of other assertions.
                               @ sql/binlog.cc
                             - Move MYSQL_BIN_LOG::description_event_for_queue to
                               Master_info::mi_description_event.
                             - Add assertion that no_auto_events is always 0.
                             - open_binlog(char*, ...) and new_file* do not have access
                               to MYSQL_BIN_LOG::description_event_for_queue now that we
                               moved it to Master_info. So we need to pass this as a
                               parameter to these functions.
                             - Add assertion that open_binlog(char*) is not used for relay logs
                               (if this was not true, it would not be correct to pass NULL
                               as the last argument to open_binlog(char*...)).
                               @ sql/binlog.h
                             - Make a couple of internal functions private
                             - Add some comments
                             - Move MYSQL_BIN_LOG::description_event_for_queue to
                               Master_info
                             - Add argument to open_binlog(char*,...) and new_file_*
                               @ sql/mysqld.cc
                            new argument to open_binlog
                               @ sql/rpl_mi.cc
                            create and destroy the new event
                               @ sql/rpl_mi.h
                            Moved MYSQL_BIN_LOG::description_event_for_queue to
                            Master_info::mi_description_event.
                               @ sql/rpl_rli.cc
                            use getter to read IO thread's description event
                               @ sql/rpl_slave.cc
                             - use getter/setter to access IO thread's description event
                            ------------------------------------------------------------
                            revno: 3690.52.3
                            committer: Sven Sandberg <sven.sandberg@oracle.com>
                            branch nick: trunk-wl3584-1
                            timestamp: Fri 2012-03-02 20:42:17 +0100
                            message:
                              BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                              This is part 3 of the patch. It only makes a small refactoring
                              to make the code more maintainable.
                              Problem:
                              Objects that are used by any binary or relay log are supposed to
                              be stored in MYSQL_BIN_LOG. Objects that are used by the IO
                              thread are supposed to be stored in Master_info.
                              The Format_description_log_event that is used by the IO thread
                              to read events was incorrectly a member of MYSQL_BIN_LOG.
                              One result of this wrong design was that the correct lock was
                              not held in all places that use the event.
                              Fix:
                               - Move the format_description_log_event to Master_info.
                               - Make it a private member and encapsulate any use of it in
                                 setter/getter functions, so that we can later add
                                 assertions ensuring the correct lock is held before using
                                 it.
                               - Add a couple of other assertions.
                        ------------------------------------------------------------
                        revno: 3690.53.2 [merge]
                        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                        branch nick: mysql-trunk
                        timestamp: Mon 2012-04-02 17:40:34 +0100
                        message:
                          BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                          This is part 2 of the patch. It only makes one small refactoring
                          to make the code more maintainable.
                          Problem:
                          Objects that are used by any binary or relay log are supposed to
                          be stored in MYSQL_BIN_LOG. Objects that are used by only the SQL
                          thread are supposed to be stored in Relay_log_info.
                          The Format_description_log_event that is used by the SQL thread
                          to read events was incorrectly a member of MYSQL_BIN_LOG.
                          Fix:  
                          Move the format_description_log_event to Relay_log_info. Also, 
                          make it a private member and encapsulate any use of it in 
                          setter/getter functions.
                               @ sql/binlog.cc
                            - move MYSQL_BIN_LOG::description_event_to_queue
                              to Relay_log_info::rli_description_event
                            - add assertions to ensure that members of MYSQL_BIN_LOG
                              are not used by the wrong thread
                               @ sql/binlog.h
                            - move MYSQL_BIN_LOG::description_event_to_queue
                              to Relay_log_info::rli_description_event
                               @ sql/log_event.cc
                            - move MYSQL_BIN_LOG::description_event_to_queue
                              to Relay_log_info::rli_description_event
                               @ sql/rpl_rli.cc
                            - move MYSQL_BIN_LOG::description_event_to_queue
                              to Relay_log_info::rli_description_event
                              and encapsulate it using setter/getter member functions
                               @ sql/rpl_rli.h
                            - move MYSQL_BIN_LOG::description_event_to_queue
                              to Relay_log_info::rli_description_event
                              and encapsulate it using setter/getter member functions
                               @ sql/rpl_slave.cc
                            - move MYSQL_BIN_LOG::description_event_to_queue
                              to Relay_log_info::rli_description_event
                            - fix some indentation
                               @ sql/sql_binlog.cc
                            - move MYSQL_BIN_LOG::description_event_to_queue
                              to Relay_log_info::rli_description_event
                            - remove check for NULL return value from new
                            ------------------------------------------------------------
                            revno: 3690.52.2
                            committer: Sven Sandberg <sven.sandberg@oracle.com>
                            branch nick: trunk-wl3584-1
                            timestamp: Fri 2012-03-02 20:36:33 +0100
                            message:
                              BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                              This is part 2 of the patch. It only makes one small refactoring
                              to make the code more maintainable.
                              Problem:
                              Objects that are used by any binary or relay log are supposed to
                              be stored in MYSQL_BIN_LOG. Objects that are used by only the SQL
                              thread are supposed to be stored in Relay_log_info.
                              The Format_description_log_event that is used by the SQL thread
                              to read events was incorrectly a member of MYSQL_BIN_LOG.
                              Fix:
                              Move the format_description_log_event to Relay_log_info. Also,
                              make it a private member and encapsulate any use of it in
                              setter/getter functions.
                        ------------------------------------------------------------
                        revno: 3690.53.1 [merge]
                        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                        branch nick: mysql-trunk
                        timestamp: Mon 2012-04-02 17:22:48 +0100
                        message:
                          BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                          This is part 1 of the patch. It only makes small refactorings
                          to make the code more maintainable.
                          Problem:
                          Replication locks are poorly implemented. In particular:
                           - locks are undocumented
                           - there are some missing assertions in some functions that require
                             a lock to be taken
                           - some function names are overloaded unnecessarily so that it is
                             hard to grep for places where a particular function is invoked
                           - some variable names could be more descriptive
                           - we have protocols controlling which locks to hold before invoking
                             particular functions (but the protocols are often not spelt out
                             explicitly or ensured by assertions).
                             change_master breaks the protocol for init_relay_log_pos by not
                             taking rli.data_lock. this was not detected previously because of
                             missing assertions. one consequence is that there is a race where
                             show slave status can read relay log position/file name while
                             change master is modifying them.
                          Fix:
                           - improve the comment at the top of rpl_slave.h to incorporate an
                             analysis of the locking order
                           - add assertions to functions that require a lock to be held by
                             the caller
                           - there are a lot of functions called init_info, making it hard to
                             track which particular function is called at a given place. rename:
                              - the global init_info -> global_init_info
                              - Master_info::init_info -> Master_info::mi_init_info
                              - Relay_log_info::init_info -> Relay_log_info::rli_init_info
                           - make change_master follow the protocol for init_relay_log_pos.
                             this also fixes the race.
                               @ sql/binlog.cc
                             - a few functions take a parameter called 'need_lock' or 'need_mutex'
                               but it is hard to keep track of *which* mutex each of them refers
                               to. renamed the parameters to reflect the relevant mutex they control
                             - add assertion to ensure that open_binlog does not acquire
                               lock_index after global_sid_lock.wrlock.
                             - no need to assert that LOCK_index is held just after it was acquired.
                             - purge_first_log should only be invoked from the sql thread, when
                               the log is a relay log. added two assertions
                             - MYSQL_BIN_LOG::rotate requires the caller to hold LOCK_log.
                               so add an assertion.
                             - MYSQL_BIN_LOG::write_incident requires the caller to hold LOCK_log
                               if need_lock_log is false. so add an assertion.
                               @ sql/rpl_mi.cc
                            rename
                               @ sql/rpl_mi.h
                            rename
                               @ sql/rpl_rli.cc
                             - Relay_log_info::init_relay_log_pos requires data_lock to be held
                               by the caller if need_data_lock is false. add an assertion.
                             - Relay_log_info::init_info requires data_lock to be held by the
                               caller. add an assertion.
                               @ sql/rpl_slave.cc
                            renames
                               @ sql/rpl_slave.h
                             - added comment analyzing the order of lock acquisition for the
                               replication locks
                             - rename init_info
                            ------------------------------------------------------------
                            revno: 3690.52.1
                            committer: Sven Sandberg <sven.sandberg@oracle.com>
                            branch nick: trunk-wl3584-1
                            timestamp: Fri 2012-03-02 20:30:53 +0100
                            message:
                              BUG#13779291: RACE CONDITION AROUND ROTATE RELAY LOGS & FLUSH LOGS
                              This is part 1 of the patch. It only makes small refactorings
                              to make the code more maintainable.
                              Problem:
                              Replication locks are poorly implemented. In particular:
                               - locks are undocumented
                               - there are some missing assertions in some functions that require
                                 a lock to be taken
                               - some function names are overloaded unnecessarily so that it is
                                 hard to grep for places where a particular function is invoked
                               - some variable names could be more descriptive
                               - we have protocols controlling which locks to hold before invoking
                                 particular functions (but the protocols are often not spelt out
                                 explicitly or ensured by assertions).
                                 change_master breaks the protocol for init_relay_log_pos by not
                                 taking rli.data_lock. this was not detected previously because of
                                 missing assertions. one consequence is that there is a race where
                                 show slave status can read relay log position/file name while
                                 change master is modifying them.
                              Fix:
                               - improve the comment at the top of rpl_slave.h to incorporate an
                                 analysis of the locking order
                               - add assertions to functions that require a lock to be held by
                                 the caller
                               - there are a lot of functions called init_info, making it hard to
                                 track which particular function is called at a given place. rename:
                                  - the global init_info -> global_init_info
                                  - Master_info::init_info -> Master_info::mi_init_info
                                  - Relay_log_info::init_info -> Relay_log_info::rli_init_info
                               - make change_master follow the protocol for init_relay_log_pos.
                                 this also fixes the race.
    ------------------------------------------------------------
    revno: 3690.34.51
    committer: Evgeny Potemkin <evgeny.potemkin@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-06-06 13:42:30 +0400
    message:
      Bug#14152665 - VALGRIND: DEFINITELY LOST AT MALLOC FROM FILESORT_BUFFER::ALLOC_SORT_BUFFER
      Fixed a memory leak that was introduced by WL#6071.
      The leak was visible on the main.server_uuid and main.key tests
      with the --valgrind flag.
    ------------------------------------------------------------
    revno: 3690.34.50
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-trunk
    timestamp: Mon 2012-06-04 12:41:25 +0100
    message:
      WL#5223: Binary Log Group Commit
      
      MYSQL_BIN_LOG::flush_and_sync(bool force) was ignoring "force" argument
      and always flushing binlog to disk.
      Fix flush_and_sync(bool force) implementation by taking "force" into
      account.
    ------------------------------------------------------------
    revno: 3690.34.49
    committer: prabakaran thirumalai <prabakaran.thirumalai@oracle.com>
    branch nick: mysql-trunk-queryid
    timestamp: Mon 2012-06-04 10:20:38 +0530
    message:
      Bug#11765785 	58785: TWO THREADS MAY END UP WITH THE SAME QUERY_ID
            
      Description:
      ------------
      Global Query ID (global_query_id ) is not incremented for PING and 
      statistics command. These two query types are filtered before 
      incrementing the global query id. This causes race condition and 
      results in duplicate query id for different queries originating from 
      different connections.
            
      Analysis:
      ---------
      sqlparse.cc::dispath_command() is the only place in code which sets 
      thd->query_ id to global_query_id and then increments it based on the 
      query type. In all other places it is incremented first and then 
      assigned to thd->query_id.
            
      This is done such that global_query_id is not incremented for PING 
      and statistics commands in dispatch_command() function.
            
      Fix:
      ----
      As per suggestion from Serg, "There is no reason to skip query_id for 
      the PING and STATISTICS command.", removing the check which filters 
      PING and statistics commands.
            
      Instead of using get_query_id() and next_query_id() which can still 
      cause race condition if context switch happens soon after executing 
      get_query_id(), changing the code to use next_query_id() instead of 
      get_query_id() as it is done in other parts of code which deals with 
      global_query_id.
            
      Removed get_query_id() function and forced next_query_id() caller 
      to use the return value by specifying warn_unused_result attribute.
    ------------------------------------------------------------
    revno: 3690.34.48
    committer: Jimmy Yang <jimmy.yang@oracle.com>
    branch nick: trunk2
    timestamp: Fri 2012-06-01 23:24:42 +0800
    message:
      Fix Bug #14135611 and Bug #14079609
            
      Bug #14135611 - VALGRIND ERROR ON FTS_CREATE() IN HA_INNOBASE::
      PREPARE_INPLACE_ALTER_TABLE
            
      rb://1102 approved by Sunny
            
      Bug #14079609  - FTS: CRASH IN FTS_TRX_TABLE_CMP WITH SAVEPOINTS, XA
            
      rb://1095 approved by Sunny
    ------------------------------------------------------------
    revno: 3690.34.47 [merge]
    committer: Evgeny Potemkin <evgeny.potemkin@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-01 19:21:41 +0400
    message:
      Auto-merge.
        ------------------------------------------------------------
        revno: 3690.50.6
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-01 16:39:23 +0300
        message:
          Followup to WL#6189 Turn InnoDB persistent statistics ON by default
          
          Adjust mtr tests, part 22.
          
          Persistent stats use a different sampling algorithm so it is possible
          that the stats numbers differ from transient stats.
          
          Also, persistent stats are updated less frequently or with a delay, so
          it is possible that persistent stats are not up to date as transient were
          even if both algorithms would return the same results.
          
          If possible, each failing test was fixed by manually running ANALYZE TABLE.
          This is doable if both transient and persistent sampling algorithms end up
          with the same numbers for the given table and its data.
          
          If persistent stats result in different stats, then test failures were fixed
          by forcing the usage of transient stats for the table by using
          CREATE TABLE ... STATS_PERSISTENT=0.
          
          Intentionally do not fix the tests by using persistent stats and adjustin
          the output of EXPLAIN in .result files because a different execution plan
          may cause a different code path to be executed, than the one originally
          intended in the test.
        ------------------------------------------------------------
        revno: 3690.50.5
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-01 15:57:36 +0300
        message:
          Followup to WL#6189 Turn InnoDB persistent statistics ON by default
          
          During DROP TABLE we should do the following wrt stats:
          
          * Remove the table from the background thread's auto recalc list
          * Wait for background stats to finish working on the table
          * Delete rows from mysql.innodb_table_stats and mysql.innodb_index_stats
          
          and we should do all this under row_mysql_lock_data_dictionary() to prevent
          the following scenario:
          
          CREATE TABLE t (i INT) ENGINE=InnoDB;
          INSERT INTO t VALUES (1), (2); // adds the table id to autorecalc list
          DROP TABLE t;
          
          stats could be saved by background thread after DROP has deleted the
          same rows and then they will remain after the table has gone - some
          extra rows in mysql.innodb_table_stats and mysql.innodb_index_stats
          without a corresponding table. They would not hurt, but this behavior
          should be fixed.
           
          So we fix this by doing all of the above 3 steps under
          row_mysql_lock_data_dictionary() in row_drop_table_for_mysql():
          
          Call dict_stats_drop_table() inside dict_sys->mutex, so no need to protect
          stats tables from being DROPped with dict_stats_open(), only check that
          they exist at the beginning.
          
          Change dict_stats_remove_table_from_auto_recalc() to take table->id instead
          of table name since we know the id when we are calling it from
          dict_stats_drop_table(). This simplifies
          dict_stats_remove_table_from_auto_recalc() and dict_stats_remove_table_id()
          can be removed.
          
          In dict_stats_wait_bg_to_stop_using_tables() also tell the bg stats thread
          to quit using the table soonish (BG_STAT_SHOULD_QUIT). The other callers of
          dict_stats_wait_bg_to_stop_using_tables() (ALTER TABLE) would not mind that.
          So dict_stats_wait_bg_to_stop_using_tables() can be used during DROP TABLE
          instead of a manual loop.
          
          Given that we now fiddle with auto_recalc_list and its mutex after
          row_mysql_lock_data_dictionary() we have to change the mutex level. Describe
          the new rules and introduce SYNC_STATS_AUTO_RECALC.
        ------------------------------------------------------------
        revno: 3690.50.4 [merge]
        committer: magnus.blaudd@oracle.com
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-01 13:33:03 +0200
        message:
          Merge
            ------------------------------------------------------------
            revno: 3690.51.1
            committer: magnus.blaudd@oracle.com
            branch nick: trunk
            timestamp: Fri 2012-06-01 13:03:09 +0200
            message:
              WL#5223 follow up
               - transaction.on renamed to transaction.flags.enabled
               - fix usage in ha_ndbcluster.cc
        ------------------------------------------------------------
        revno: 3690.50.3 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-01 14:15:17 +0530
        message:
          Null merge from mysql-5.5 to mysql-trunk. 
            ------------------------------------------------------------
            revno: 2875.388.6 [merge]
            committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
            branch nick: mysql-5.5
            timestamp: Fri 2012-06-01 14:14:10 +0530
            message:
              Null merge from mysql-5.1 to mysql-5.5. 
                ------------------------------------------------------------
                revno: 2661.840.27
                committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
                branch nick: mysql-5.1
                timestamp: Fri 2012-06-01 14:12:57 +0530
                message:
                  Bug #13933132: [ERROR] GOT ERROR -1 WHEN READING TABLE APPEARED
                  WHEN KILLING
                  
                  Suppose there is a query waiting for a lock.  If the user kills
                  this query, then "Got error -1 when reading table" error message
                  must not be logged in the server log file.  Since this is a user
                  requested interruption, no spurious error message must be logged
                  in the server log.  This patch will remove the error message from
                  the log.
                  
                  approved by joh and tatjana
        ------------------------------------------------------------
        revno: 3690.50.2
        committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
        branch nick: trunk
        timestamp: Fri 2012-06-01 12:26:25 +0400
        message:
          WL#6301: Change default value for the 'bind-address' option.
          
          The patch temporarily reverts the default value to 0.0.0.0.
        ------------------------------------------------------------
        revno: 3690.50.1
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-01 10:55:20 +0300
        message:
          Relax the error messages suppression in
          innodb_stats_create_on_corrupted.test and
          innodb_stats_fetch_corrupted.test
          MySQL may try to read from mysql.slave_worker_info while we have temporarily
          "corrupted" ther innodb stats tables.
    ------------------------------------------------------------
    revno: 3690.34.46
    committer: Evgeny Potemkin <evgeny.potemkin@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-01 19:17:26 +0400
    message:
      Fixed failed assertion after pushing WL#6071.
      The JOIN::group flag wasn't restored after plan creation.
    ------------------------------------------------------------
    revno: 3690.34.45 [merge]
    committer: Evgeny Potemkin <evgeny.potemkin@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-01 11:40:54 +0400
    message:
      Auto merged.
        ------------------------------------------------------------
        revno: 3690.49.3 [merge]
        committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
        branch nick: mysql-trunk-test
        timestamp: Fri 2012-06-01 09:33:02 +0200
        message:
          Null merge from mysql-5.5 to mysql-trunk
            ------------------------------------------------------------
            revno: 2875.388.5
            committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
            branch nick: mysql-5.5-bug13982017
            timestamp: Fri 2012-06-01 09:31:24 +0200
            message:
              Bug#13982017: ALTER TABLE RENAME ENDS UP WITH ERROR 1050 (42S01)
              
              Fixed by backport of:
                  ------------------------------------------------------------
                  revno: 3402.50.156
                  committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
                  branch nick: mysql-trunk-test
                  timestamp: Wed 2012-02-08 14:10:23 +0100
                  message:
                    Bug#13417754 ASSERT IN ROW_DROP_DATABASE_FOR_MYSQL DURING DROP SCHEMA
                    
                    This assert could be triggered if an InnoDB table was being moved
                    to a different database using ALTER TABLE ... RENAME, while this
                    database concurrently was being dropped by DROP DATABASE.
                    
                    The reason for the problem was that no metadata lock was taken
                    on the target database by ALTER TABLE ... RENAME.
                    DROP DATABASE was therefore not blocked and could remove
                    the database while ALTER TABLE ... RENAME was executing. This
                    could cause the assert in InnoDB to be triggered.
                    
                    This patch fixes the problem by taking a IX metadata lock on
                    the target database before ALTER TABLE ... RENAME starts
                    moving a table to a different database.
                    
                    Note that this problem did not occur with RENAME TABLE which
                    already takes the correct metadata locks.
                    
                    Also note that this patch slightly changes the behavior of
                    ALTER TABLE ... RENAME. Before, the statement would abort and
                    return an error if a lock on the target table name could not
                    be taken immediately. With this patch, ALTER TABLE ... RENAME
                    will instead block and wait until the lock can be taken 
                    (or until we get a lock timeout). This also means that it is
                    possible to get ER_LOCK_DEADLOCK errors in this situation
                    since we allow ALTER TABLE ... RENAME to wait and not just
                    abort immediately.
        ------------------------------------------------------------
        revno: 3690.49.2
        committer: Sujatha Sivakumar <sujatha.sivakumar@oracle.com>
        branch nick: Bug14033490_trunk
        timestamp: Fri 2012-06-01 12:14:06 +0530
        message:
          Bug #14033490:ASSERT IN DIAGNOSTICS_AREA::SET_ERROR_STATUS 
          FOR FEW EVENT TYPES APPLYING
                            
          Problem:
          Error reporting in certain events like 'Create_file_log_event',
          'Execute_load_log_event' causes a debug assert to fail.
          
          Analysis:
          When an error is reported through my_error() function call,
          the assert expects 'thd->get_stmt_da()->m_status' 
          diagnostic variable to be 'DA_EMPTY'.
          But in the above events (thd->get_stmt_da())->m_status = DA_OK.
          During the start of each command the THD object needs to be
          reset so that the errors, flags and diagnostic variables
          that are set by the previous command are cleared.
          
          Fix: 
          Events like 'Create_file_log_event', 'Execute_load_log_event'
          must invoke 'mysql_reset_thd_for_next_command(thd)' call at
          the beginning of their event execution. This function is 
          responsible for resetting the THD; One of the many things it
          does is cleaning and resetting the Diagnostic area. 
        ------------------------------------------------------------
        revno: 3690.49.1 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-01 11:51:44 +0530
        message:
          Null merge from mysql-5.5 to mysql-5.5. 
            ------------------------------------------------------------
            revno: 2875.388.4 [merge]
            committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
            branch nick: mysql-5.5
            timestamp: Fri 2012-06-01 11:49:07 +0530
            message:
              Merge from mysql-5.1 to mysql-5.5. 
    ------------------------------------------------------------
    revno: 3690.34.44
    committer: Evgeny Potemkin <evgeny.potemkin@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-06-01 11:34:38 +0400
    message:
      Fixed two compiler warnings.
    ------------------------------------------------------------
    revno: 3690.34.43 [merge]
    committer: Evgeny Potemkin <evgeny.potemkin@oracle.com>
    branch nick: tmp
    timestamp: Fri 2012-06-01 09:41:24 +0400
    message:
      auto merge.
        ------------------------------------------------------------
        revno: 3690.46.8
        committer: Vasil Dimov <vasil.dimov@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-01 08:26:17 +0300
        message:
          part of WL#6189 Turn InnoDB persistent statistics ON by default
          
          Adjust mtr tests, part 21.
          
          Persistent stats use a different sampling algorithm so it is possible
          that the stats numbers differ from transient stats.
          
          Also, persistent stats are updated less frequently or with a delay, so
          it is possible that persistent stats are not up to date as transient were
          even if both algorithms would return the same results.
          
          If possible, each failing test was fixed by manually running ANALYZE TABLE.
          This is doable if both transient and persistent sampling algorithms end up
          with the same numbers for the given table and its data.
          
          If persistent stats result in different stats, then test failures were fixed
          by forcing the usage of transient stats for the table by using
          CREATE TABLE ... STATS_PERSISTENT=0.
          
          Intentionally do not fix the tests by using persistent stats and adjustin
          the output of EXPLAIN in .result files because a different execution plan
          may cause a different code path to be executed, than the one originally
          intended in the test.
    ------------------------------------------------------------
    revno: 3690.34.42 [merge]
    committer: Evgeny Potemkin <evgeny.potemkin@oracle.com>
    branch nick: tmp
    timestamp: Fri 2012-06-01 09:12:01 +0400
    message:
      Auto-merged: mysql-trunk => mysql-trunk-wl6071.
        ------------------------------------------------------------
        revno: 3690.46.7 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-trunk
        timestamp: Fri 2012-06-01 10:24:03 +0530
        message:
          Merge from mysql-5.5 to mysql-trunk. 
            ------------------------------------------------------------
            revno: 2875.389.1 [merge]
            committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
            branch nick: mysql-5.5
            timestamp: Wed 2012-05-30 10:23:30 +0530
            message:
              Merge from mysql-5.1 to mysql-5.5. 
                ------------------------------------------------------------
                revno: 2661.847.1
                committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
                branch nick: mysql-5.1
                timestamp: Wed 2012-05-30 10:05:04 +0530
                message:
                  Bug #13933132: [ERROR] GOT ERROR -1 WHEN READING TABLE APPEARED
                  WHEN KILLING
                  
                  Suppose there is a query waiting for a lock.  If the user kills
                  this query, then "Got error -1 when reading table" error message
                  must not be logged in the server log file.  Since this is a user
                  requested interruption, no spurious error message must be logged
                  in the server log.  This patch will remove the error message from
                  the log.
                  
                  approved by joh and tatjana
        ------------------------------------------------------------
        revno: 3690.46.6 [merge]
        committer: Christopher Powers <chris.powers@oracle.com>
        branch nick: mysql-trunk
        timestamp: Thu 2012-05-31 22:46:15 -0500
        message:
          local merge with mysql-trunk
            ------------------------------------------------------------
            revno: 3690.48.80
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk
            timestamp: Fri 2012-06-01 00:43:04 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 20.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.79
            committer: Roy Lyseng <roy.lyseng@oracle.com>
            branch nick: mysql-trunk
            timestamp: Thu 2012-05-31 22:51:27 +0200
            message:
              WL#5561 - Fixing a (bogus) compiler warning.
            ------------------------------------------------------------
            revno: 3690.48.78
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-31 14:50:48 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 19.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.77
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-31 09:46:35 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 18.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.76
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-05-30 21:03:24 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add a mtr test that does background stats gathering and ADD/DROP INDEX
              at the same time.
            ------------------------------------------------------------
            revno: 3690.48.75
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-05-30 07:12:50 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 17.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.74
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-29 20:37:32 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Split the two statements out of "check_stats" in
              innodb_stats_auto_recalc_on_nonexistent.test
              
              It emits this error on linux/gcov only:
              
                innodb.innodb_stats_auto_recalc_on_nonexistent w5 [ fail ]
                        Test ended at 2012-05-29 18:40:37
                
                CURRENT_TEST: innodb.innodb_stats_auto_recalc_on_nonexistent
                mysqltest: At line 16: query '$check_stats' failed: 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'SELECT COUNT(*) FROM mysql.innodb_index_stats WHERE table_name = 't'' at line 1
                
                The result from queries just before the failure was:
                Test with default setting
                CREATE TABLE t (a INT, PRIMARY KEY (a)) ENGINE=INNODB;
                
                 - saving '/ramdisk/mtr-752/var-ps/5/log/innodb.innodb_stats_auto_recalc_on_nonexistent/' to '/ramdisk/mtr-752/var-ps/log/innodb.innodb_stats_auto_recalc_on_nonexistent/'
            ------------------------------------------------------------
            revno: 3690.48.73
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-29 17:59:48 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add a mtr test that resizes the auto_recalc_list
            ------------------------------------------------------------
            revno: 3690.48.72
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-29 17:42:47 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Fix a bug in auto recalc list resize - auto_recalc_size is measured in
              number of elements, not bytes.
            ------------------------------------------------------------
            revno: 3690.48.71
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-29 16:10:41 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Enable innodb_stats_auto_recalc_on_nonexistent on non-16k pages too
              because it does not print any numbers which depend on the page size.
            ------------------------------------------------------------
            revno: 3690.48.70
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-29 16:05:11 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add a mtr test to check that even if stats for a given table do not
              exist they will be created if auto-reclac is enabled.
            ------------------------------------------------------------
            revno: 3690.48.69
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-29 15:34:53 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Replace redundant code with an assert - after recent changes to MySQL
              parsing code, auto_recalc_on and auto_recalc_off cannot be turned on at
              the same time.
            ------------------------------------------------------------
            revno: 3690.48.68
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-29 13:38:33 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Disable rpl_row_binlog_max_cache_size mtr test because it hangs if
              estimated number of rows is 3 instead of 4. With persistent stats the
              estimated number is 3 (which is correct). We could change the test to
              use transient stats (old method, which estimates the number of rows
              incorrectly to 4) and the test will pass, but it is better to have
              this test reviewed by either Optimizer or Replication team and adjusted
              so that it does not hang, depending on the estimated number of rows.
              
              The following bug has been opened to track this issue:
              Bug#14126780 RPL_ROW_BINLOG_MAX_CACHE_SIZE HANGS IF ESTIMATED NUMBER OF
              ROWS IS 3 INSTEADOF 4
            ------------------------------------------------------------
            revno: 3690.48.67
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-29 13:32:32 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Fix a debug assertion which would always evaluate to true.
            ------------------------------------------------------------
            revno: 3690.48.66
            author: Sunny Bains <Sunny.Bains@Oracle.Com>
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: wl6189
            timestamp: Tue 2012-05-29 14:50:13 +1000
            message:
              WL#6189 - Clean up the code
              
               * Remove useless /* else */
               * Make dict_stats_snapshot_create() static
               * Simplify the add table id to array code
               * Hack n_rows returned, need to investigate a stats bug.
               * PREPARE_PINFO_FOR_TABLE_SAVE() macro should work only on args
               * Add C++ style casts
            ------------------------------------------------------------
            revno: 3690.48.65
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-28 17:20:14 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Do not dict_stats_deinit() system tables (e.g. SYS_TABLES) - we do not
              maintain stats for them and also this may cause unnecessary waits if
              GET_TABLE_STATS_LATCH(table) evaluates to the same latch with some other
              real table (dict_stats_deinit() does latch GET_TABLE_STATS_LATCH(table)).
            ------------------------------------------------------------
            revno: 3690.48.64
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-28 17:15:17 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Use the address of the table object for hashing in dict_table_stats_latches[]
              instead of table->id because table->id can change in TRUNCATE TABLE and in
              ALTER TABLE ... DISCARD TABLESPACE. If table->id changes, this may cause
              the background stats thread to try to unlock a rw-lock it has never locked.
            ------------------------------------------------------------
            revno: 3690.48.63
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-28 14:16:14 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Non-functional change: use 1), 2) instead of "+" to mark items in a comment
            ------------------------------------------------------------
            revno: 3690.48.62
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-28 14:12:52 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Non-functional change: move the code which waits for background stats
              thread to stop working on a given table(s) to a dedicated function
              and call that function from handler0alter.cc.
              
              Suggested by:	Sunny
            ------------------------------------------------------------
            revno: 3690.48.61
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-28 12:14:43 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Non-functional changes:
              * add a comment on ut_time()
              * remove /* else */ comments.
              * change stats_bg_flag from char to byte
                
              Suggested by:	Sunny
            ------------------------------------------------------------
            revno: 3690.48.60
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-25 20:25:51 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Synchronize prepare_inplace_alter_table_dict() with the stats
              background thread. Otherwise the asser on line 1647 may fail:
              
              1643         new_clustered_failed:
              1644                 DBUG_ASSERT(trx != user_trx);
              1645                 trx_rollback_to_savepoint(trx, NULL);
              1646
              1647                 ut_ad(user_table->n_ref_count == 1);
              1648
              1649                 online_retry_drop_indexes_with_trx(user_table, trx);
              1650
              1651                 row_mysql_unlock_data_dictionary(trx);
            ------------------------------------------------------------
            revno: 3690.48.59
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-25 18:57:29 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 16.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.58
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-25 18:25:56 +0300
            message:
              Do not save FTS indexes in persistent stats tables.
              
              Those indexes are not being analyzed and trying to save them causes
              us to read uninitialized memory. For example, if we add
              UNIV_MEM_ASSERT_RW(&index->stat_index_size, 8); to dict_stats_snapshot_create(),
              then Valgrind complains like this:
              
                ==12876== Thread 19:
                ==12876== Uninitialised byte(s) found during client check request
                ==12876==    at 0xCDBE6D: dict_stats_snapshot_create(dict_table_struct const*) (dict0stats.cc:3541)
                ==12876==    by 0xCE2A16: dict_stats_update(dict_table_struct*, dict_stats_upd_option, unsigned long) (dict0stats.cc:2621)
                ==12876==    by 0xCE38B5: pop_from_auto_recalc_list_and_recalc() (dict0stats_background.cc:315)
                ==12876==    by 0xCE394F: dict_stats_thread (dict0stats_background.cc:357)
                ==12876==    by 0x3A9A606616: start_thread (in /lib64/libpthread-2.5.so)
                ==12876==    by 0x3A99AD3C2C: clone (in /lib64/libc-2.5.so)
                ==12876==  Address 0x19f3ddc0 is 240 bytes inside a block of size 568 alloc'd
                ==12876==    at 0x4A0776F: malloc (vg_replace_malloc.c:263)
                ==12876==    by 0xB53FDC: mem_area_alloc(unsigned long*, mem_pool_struct*) (mem0pool.cc:381)
                ==12876==    by 0xB524C6: mem_heap_create_block(mem_block_info_struct*, unsigned long, unsigned long, char const*, unsigned long) (mem0mem.cc:334)
                ==12876==    by 0xB5284C: mem_heap_add_block(mem_block_info_struct*, unsigned long) (mem0mem.cc:448)
                ==12876==    by 0xCD64C0: mem_heap_alloc(mem_block_info_struct*, unsigned long) (mem0mem.ic:186)
                ==12876==    by 0xCD67EF: mem_heap_zalloc(mem_block_info_struct*, unsigned long) (mem0mem.ic:154)
                ==12876==    by 0xCD69EA: dict_mem_index_create(char const*, char const*, unsigned long, unsigned long, unsigned long) (dict0mem.cc:450)
                ==12876==    by 0xCC8B77: dict_index_build_internal_fts(dict_table_struct*, dict_index_struct*) (dict0dict.cc:2847)
                ==12876==    by 0xCC924A: dict_index_add_to_cache(dict_table_struct*, dict_index_struct*, unsigned long, unsigned long) (dict0dict.cc:2112)
                ==12876==    by 0xCBA82D: dict_create_index_step(que_thr_struct*) (dict0crea.cc:1157)
                ==12876==    by 0xB91BD9: que_thr_step(que_thr_struct*) (que0que.cc:1115)
                ==12876==    by 0xB91D67: que_run_threads_low(que_thr_struct*) (que0que.cc:1167)
              
              during the last ALTER from below (from main.alter_table test):
              
              CREATE TABLE ti1(a INT NOT NULL, b INT, c INT) engine=InnoDB;
              INSERT INTO ti1 VALUES (1,1,1), (2,2,2);
              ALTER TABLE ti1 ADD COLUMN d VARCHAR(200);
              ALTER TABLE ti1 ADD PRIMARY KEY (a);
              ALTER TABLE ti1 ADD FULLTEXT INDEX ii3 (d);
            ------------------------------------------------------------
            revno: 3690.48.57
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-25 15:02:29 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Non-functional changes, suggested by Jimmy.
            ------------------------------------------------------------
            revno: 3690.48.56
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-24 21:11:12 +0300
            message:
              Pre-initialize all stats in a table before fetching from disk.
              
              mysql.innodb_index_stats may contain less rows than expected in which
              case dict_stats_fetch_from_ps() will leave the corresponding members
              (e.g. index->stat_n_diff_key_vals[]) untouched and we may read
              uninitialized garbage afterwards.
            ------------------------------------------------------------
            revno: 3690.48.55
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-24 19:43:11 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Extend innodb_stats_auto_recalc.test with a DELETE statement.
            ------------------------------------------------------------
            revno: 3690.48.54
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-24 08:42:36 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 15.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.53
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-05-23 22:50:12 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              in ha_innobase::commit_inplace_alter_table() also wait for background
              stats thread to stop using prebuilt->table. Otherwise the CREATE INDEX
              in the following sequence (from innodb-index-debug.test):
              
                CREATE TABLE bug13861218 (c1 INT NOT NULL, c2 INT UNIQUE) ENGINE=InnoDB;
                INSERT INTO bug13861218 VALUES (8, NULL), (4, NULL), (0, NULL);
                SET DEBUG='+d,ib_row_merge_buf_add_two';
                # Force creation of a PRIMARY KEY on c1 to see what happens on the index(c2).
                # assertion failure: ut_ad(cmp_dtuple_rec(dtuple, rec, rec_offsets) > 0)
                CREATE UNIQUE INDEX ui ON bug13861218(c1);
                SET DEBUG='-d,ib_row_merge_buf_add_two';
                DROP TABLE bug13861218;
              
              may cause this assertion to fail a few lines later:
              
                /* n_ref_count must be 1, because purge cannot
                be executing on this very table as we are
                holding dict_operation_lock X-latch. */
                ut_a(prebuilt->table->n_ref_count == 1);
            ------------------------------------------------------------
            revno: 3690.48.52
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-05-23 22:29:32 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 14.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.51
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-05-23 18:46:08 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Also copy the newly added dict_table_t members when making stats
              snapshot in dict_stats_snapshot_create().
            ------------------------------------------------------------
            revno: 3690.48.50
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-05-23 16:34:33 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 14.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.49
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-05-23 15:08:38 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Do not enqueue a table for auto recalc when 10% has been changed if
              auto recalc for this table is disabled.
            ------------------------------------------------------------
            revno: 3690.48.48
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-05-23 13:14:43 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Enforce the max value of 65535 to stats_sample_pages table flag
            ------------------------------------------------------------
            revno: 3690.48.47
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-22 21:07:38 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 13.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.46
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-22 19:57:13 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Apply jon.hauglid@'s suggestions wrt table flags:
              * Move stats_auto_recalc away from db_table_options into a separate
                member of HA_CREATE_INFO and TABLE_SHARE and use enum for it.
              * Store stats_auto_recalc in .frm independently of other flags
              
              As a side effect - innobase_copy_frm_flags_into_innodb() now becomes
              two functions that do the same thing but take input from either
              HA_CREATE_INFO or from TABLE_SHARE.
            ------------------------------------------------------------
            revno: 3690.48.45
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-22 16:52:05 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 12.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.44
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-22 14:00:01 +0300
            message:
              ha_innobase::commit_inplace_alter_table() could eventually
              call dict_stats_update_for_index(index) without index->table being
              opened beforehand and thus index->table->stat* will not be initialized
              and thus the persistent stats on/off flag will be undefined and so
              dict_stats_update_for_index() would not know how to update the index's
              statistics.
              
              To fix this, init the table stats if dict_stats_update_for_index() is to
              be called, looking up the table flags from "altered_table". Export
              copy_frm_flags_into_innodb() from ha_innodb.cc so it can also be used
              in handler0alter.cc and rename it to innobase_copy_frm_flags_into_innodb().
            ------------------------------------------------------------
            revno: 3690.48.43
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-22 13:58:03 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add a comment in sql/sql_yacc.yy that explains why we block
              STATS_SAMPLE_PAGES=0.
            ------------------------------------------------------------
            revno: 3690.48.42
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-21 22:57:40 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 11.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.41
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-21 17:41:24 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 10.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.40
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-21 16:36:20 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 9.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.39
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-18 18:37:37 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 8.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.38
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-18 17:18:03 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Followup to the previous commit:
              
                * committer: Vasil Dimov <vasil.dimov@oracle.com>
                * branch nick: mysql-trunk-wl6189
                * timestamp: Fri 2012-05-18 13:57:53 +0300
                * message:
                *   part of WL#6189 Turn InnoDB persistent statistics ON by default
                *   
                *   Move the creation of innodb_table_stats and innodb_index_stats before
                *   creating any other InnoDB tables in mysql_system_tables.sql because
                *   now those two tables are required by default.
              
              When InnoDB stats tables are created before various other system tables,
              which are also an InnoDB tables (e.g. mysql.slave_relay_log_info), then
              some rows get inserted into the stats tables by default and this causes
              a result mismatch in innodb_bug60049.
            ------------------------------------------------------------
            revno: 3690.48.37
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-18 13:57:53 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Move the creation of innodb_table_stats and innodb_index_stats before
              creating any other InnoDB tables in mysql_system_tables.sql because
              now those two tables are required by default.
            ------------------------------------------------------------
            revno: 3690.48.36
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-18 12:44:26 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 7.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.35
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-17 21:30:03 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 6.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.34
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-17 18:22:06 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Auto-update stats for a table if the table has persistent stats enabled,
              auto recalc enabled and the stats do not exist.
            ------------------------------------------------------------
            revno: 3690.48.33
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-17 15:23:34 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              An optimization - from DROP TABLE instruct the background stats thread
              to quit sooner while waiting for it to quit. This will eventually make
              DROP TABLE quicker sometimes.
              
              Suggested by:	Jimmy
            ------------------------------------------------------------
            revno: 3690.48.32
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-17 12:33:22 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              White-space fixup and comment clarification.
            ------------------------------------------------------------
            revno: 3690.48.31
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-17 11:58:43 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Enable the background stats thread and synchronize with DROP INDEX
              on table->in_bg_stat_processing. Also, as an optimization do not
              analyze an index that has to_be_dropped set.
            ------------------------------------------------------------
            revno: 3690.48.30
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-15 20:05:24 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Initialize table->stat_modified_counter when fetching stats from disk,
              otherwise it is left uninitialized.
            ------------------------------------------------------------
            revno: 3690.48.29
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Tue 2012-05-15 08:30:01 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 5.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.28
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-14 23:15:15 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 4.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.27
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-14 19:08:00 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 3.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.26
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-14 15:15:45 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 2.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.25
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-14 12:22:35 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Adjust mtr tests, part 1.
              
              Persistent stats use a different sampling algorithm so it is possible
              that the stats numbers differ from transient stats.
              
              Also, persistent stats are updated less frequently or with a delay, so
              it is possible that persistent stats are not up to date as transient were
              even if both algorithms would return the same results.
              
              If possible, each failing test was fixed by manually running ANALYZE TABLE.
              This is doable if both transient and persistent sampling algorithms end up
              with the same numbers for the given table and its data.
              
              If persistent stats result in different stats, then test failures were fixed
              by forcing the usage of transient stats for the table by using
              CREATE TABLE ... STATS_PERSISTENT=0.
              
              Intentionally do not fix the tests by using persistent stats and adjustin
              the output of EXPLAIN in .result files because a different execution plan
              may cause a different code path to be executed, than the one originally
              intended in the test.
            ------------------------------------------------------------
            revno: 3690.48.24
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Sat 2012-05-12 09:43:07 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Remove debugging printouts.
            ------------------------------------------------------------
            revno: 3690.48.23
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Sat 2012-05-12 09:38:28 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Temporarily disable background stats gathering until locking issues are
              resolved. The code is sound as it is and can be pushed in that state.
              
              The disadvantage is that the query which triggers the 10% thresold will
              be blocked until the new stats are gathered. Also, since there is no queue,
              all events that trigger the 10% thresold MIN_RECALC_INTERVAL seconds after
              stats were updated will be ignored insead of queued for later processing.
            ------------------------------------------------------------
            revno: 3690.48.22
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-07 18:24:04 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Use 524288 (1 << 19) for HA_OPTION_NO_STATS_AUTO_RECALC because
              1 << 17 and 1 << 18 are used by HA_OPTION_NO_CHECKSUM and
              HA_OPTION_NO_DELAY_KEY_WRITE which are defined separately in sql/handler.h
            ------------------------------------------------------------
            revno: 3690.48.21
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-07 17:23:08 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add a mtr test for the basic auto-update functionality
            ------------------------------------------------------------
            revno: 3690.48.20
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Mon 2012-05-07 16:38:22 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Synchronize the background stats thread with DROP TABLE. The latter should
              wait for the background stats thread to stop working on the table and close
              it before proceeding. Otherwise the DROP TABLE code may see that the table
              is opened and add it to the background drop queue. This is not acceptable
              because, an immediate CREATE after DROP may fail with a "Table already
              exists" error. For example:
              
              CREATE TABLE
              INSERT 1 row
              INSERT 1 row --> will trigger background stats gathering, which will open
                               the table
              DROP TABLE --> will see the table is opened, will emit a notice in the log
                             that MySQL is trying to drop a table that has opened handles
              	       to it and will add it to the background drop queue
              CREATE TABLE --> fails because the table is not yet removed by the background
                               drop code
            ------------------------------------------------------------
            revno: 3690.48.19
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-04 17:53:06 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Use DEBUG_SYNC_C_IF_THD() instead of DEBUG_SYNC_C() in
              row_ins_check_foreign_constraints(). That function is now also called
              from the background stats gathering thread and DEBUG_SYNC_C() would crash
              there because it calls "_current_thd()" and expects it to be != NULL.
            ------------------------------------------------------------
            revno: 3690.48.18
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-04 17:09:31 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add missing ;
            ------------------------------------------------------------
            revno: 3690.48.17
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-04 17:03:02 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Use mysql_pfs_key_t if HAVE_PSI_INTERFACE is defined, not UNIV_PFS_MUTEX,
              it is defined inside HAVE_PSI_INTERFACE.
            ------------------------------------------------------------
            revno: 3690.48.16
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Fri 2012-05-04 12:14:00 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add a mtr test to confirm that the global innodb_stats_persistent_sample_pages
              or the per-table option STATS_SAMPLE_PAGES is used when expected.
            ------------------------------------------------------------
            revno: 3690.48.15
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-03 12:26:46 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
                  
              Extend innodb_stats_table_flag_auto_recalc.test and
              innodb_stats_table_flag_sample_pages.test to also cover ALTER TABLE.
            ------------------------------------------------------------
            revno: 3690.48.14
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-03 12:03:41 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Extend innodb_stats_table_flag_auto_recalc.test and
              innodb_stats_table_flag_sample_pages.test to also check the expected
              value of information_schema.tables.create_options.
            ------------------------------------------------------------
            revno: 3690.48.13
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-03 11:55:58 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add a test that checks whether the new table option STATS_SAMPLE_PAGES
              is parsed from the command line, saved in .frm, and retrieved from .frm
              as expected.
            ------------------------------------------------------------
            revno: 3690.48.12
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-03 11:35:47 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Non-functional change - obey alphabetical order in sql/lex.h and sql/sql_yacc.yy
            ------------------------------------------------------------
            revno: 3690.48.11
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-03 11:16:50 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Change the default value of --innodb-stats-persistent from 0 to 1
              and adjust the relevant mtr tests.
            ------------------------------------------------------------
            revno: 3690.48.10
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-03 10:57:08 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Use dict_table_t::stats_sample_pages if it is set (!= 0),
              instead of srv_stats_persistent_sample_pages.
            ------------------------------------------------------------
            revno: 3690.48.9
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-03 09:57:32 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Copy stats_sample_pages from MySQL (HA_CREATE_INFO or TABLE_SHARE)
              into InnoDB's dict_table_t object.
            ------------------------------------------------------------
            revno: 3690.48.8
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-03 09:39:03 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Non-functional change:
              
              Copy all the .frm table flags from MySQL into InnoDB in one function:
              copy_frm_flags_into_innodb(). Previously those flags were copied in:
              
              * open table (dict_stats_init(), called from ha_innobase::open())
              * create table (ha_innobase::create())
              * alter table (ha_innobase::check_if_incompatible_data())
            ------------------------------------------------------------
            revno: 3690.48.7
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Thu 2012-05-03 08:46:41 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add a new table option STATS_SAMPLE_PAGES=N|default (where N>0),
              the option has no effect (yet).
            ------------------------------------------------------------
            revno: 3690.48.6
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-05-02 21:56:34 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Implement the background stats gathering thread.
              
              Add a new member dict_table_t::stats_last_recalc to keep track when
              stats were last recalculated in order to avoid too frequent recalc.
            ------------------------------------------------------------
            revno: 3690.48.5
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-05-02 21:55:57 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add basic mtr test for the new global config knob innodb_stats_auto_recalc
            ------------------------------------------------------------
            revno: 3690.48.4
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-04-25 16:06:33 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Record the table option STATS_AUTO_RECALC in dict_table_t and add a basic
              test for that flag.
            ------------------------------------------------------------
            revno: 3690.48.3
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-04-25 16:01:20 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add a new global boolean config setting innodb_stats_auto_recalc with a
              default value ON. The setting has no effect (yet).
            ------------------------------------------------------------
            revno: 3690.48.2
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-04-25 12:27:40 +0300
            message:
              part of WL#6189 Turn InnoDB persistent statistics ON by default
              
              Add a new table option STATS_AUTO_RECALC=0|1|default, the option
              has no effect (yet).
            ------------------------------------------------------------
            revno: 3690.48.1
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk-wl6189
            timestamp: Wed 2012-04-25 12:17:39 +0300
            message:
              Make it possible to add 16 more table options.
              
              From the current table_options only the low 2 bytes are stored. Store the
              high 2 bytes (16 more bits) in an unused fields, that are written as zeros
              since 2006. Those fields were used for RAID support in ancient versions.
        ------------------------------------------------------------
        revno: 3690.46.5
        committer: Christopher Powers <chris.powers@oracle.com>
        branch nick: mysql-trunk
        timestamp: Thu 2012-05-31 22:42:14 -0500
        message:
          WL#5924 - Add connect strings processing to MySQL
            
          Fixed two unit tests
        ------------------------------------------------------------
        revno: 3690.46.4
        committer: Christopher Powers <chris.powers@oracle.com>
        branch nick: mysql-trunk-wl5924
        timestamp: Thu 2012-05-31 13:12:20 -0500
        message:
          WL#5924 - Add connect strings processing to MySQL
          
          Updates sys_vars.all_vars.test
        ------------------------------------------------------------
        revno: 3690.46.3 [merge]
        committer: Christopher Powers <chris.powers@oracle.com>
        branch nick: mysql-trunk-wl5924
        timestamp: Thu 2012-05-31 12:55:44 -0500
        message:
          local merge with mysql-trunk
            ------------------------------------------------------------
            revno: 3690.47.2 [merge]
            committer: Rohit Kalhans <rohit.kalhans@oracle.com>
            branch nick: mysql-trunk
            timestamp: Thu 2012-05-31 23:15:19 +0530
            message:
              upmerge from mysql-5.5 ==> mysql-trunk
                ------------------------------------------------------------
                revno: 2875.388.3 [merge]
                committer: Rohit Kalhans <rohit.kalhans@oracle.com>
                branch nick: mysql-5.5
                timestamp: Thu 2012-05-31 22:34:08 +0530
                message:
                  upmerge mysql-5.1 => mysql-5.5
                    ------------------------------------------------------------
                    revno: 2661.840.26
                    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
                    branch nick: mysql-5.1
                    timestamp: Thu 2012-05-31 22:28:18 +0530
                    message:
                      Fixing the accidental incusion of i_binlog.binlog_suppress_info test. 
                      Fix for i_binlog.binlog_mysqlbinlog_file_write failure on pb2 
        ------------------------------------------------------------
        revno: 3690.46.2 [merge]
        committer: Christopher Powers <chris.powers@oracle.com>
        branch nick: mysql-trunk-wl5924
        timestamp: Thu 2012-05-31 12:07:38 -0500
        message:
          local merge from mysql-trunk
            ------------------------------------------------------------
            revno: 3690.47.1
            committer: Nirbhay Choubey <nirbhay.choubey@oracle.com>
            branch nick: mysql-trunk-wl5603
            timestamp: Thu 2012-05-31 21:03:21 +0530
            message:
              WL#5603 :  Revise how we handle passwords on
                         the command line
        ------------------------------------------------------------
        revno: 3690.46.1
        committer: Christopher Powers <chris.powers@oracle.com>
        branch nick: mysql-trunk-wl5924
        timestamp: Thu 2012-05-31 10:15:33 -0500
        message:
          WL#5924 - Add connect strings processing to MySQL
            
            Changes per code review
            
            1. Updated perfschema.start_server_* tests
            2. Free session connect attrs memory during cleanup
            3. Added perfschema.start_server_no_session_connect_attr.test
            4. Added sys_vars.pfs_session_connect_attrs.test
            5. Updated OOM unit tests
            6. Adjusted SHOW ENGINE STATUS memory count, avoid debug assert
    ------------------------------------------------------------
    revno: 3690.34.41
    committer: Evgeny Potemkin <evgeny.potemkin@oracle.com>
    branch nick: tmp
    timestamp: Thu 2012-05-31 20:21:37 +0400
    message:
      WL#6071: Inline tmp tables into the nested loops algorithm.
    ------------------------------------------------------------
    revno: 3690.34.40 [merge]
    committer: magnus.blaudd@oracle.com
    branch nick: mysql-trunk
    timestamp: Thu 2012-05-31 16:50:10 +0200
    message:
      Merge
        ------------------------------------------------------------
        revno: 3690.45.1 [merge]
        committer: magnus.blaudd@oracle.com
        branch nick: mysql-trunk
        timestamp: Thu 2012-05-31 16:38:11 +0200
        message:
          Merge
            ------------------------------------------------------------
            revno: 3690.44.1
            committer: magnus.blaudd@oracle.com
            branch nick: trunk
            timestamp: Thu 2012-05-31 16:29:44 +0200
            message:
              WL#5881
               - Reapply patch for WL#5881 which was unintentionally removed by simultaneous
                 refactoring work for WL#5597 (where Rows_log_event::find_row()
                 was removed)
                 "- Use HA_RBWR flag to detect in slave thread if it can do
                    the rbwr optimization.
                  - Improve comments describing the optimization."
               - Adapted patch to fit into new Rows_log_event::do_index_scan_and_update()
                 function logic
               - Also added one DBUG_ASSERT to check that primary key is really
                 being used
    ------------------------------------------------------------
    revno: 3690.34.39
    committer: Inaam Rana <inaam.rana@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-05-31 10:45:56 -0400
    message:
      Bug#14141617 - MISSING ASSIGNMENT TO PREV_PAGES VARIABLE IN ADAPTIVE FLUSHING
      
      approved by: Dimitri Kravtchuk
      
      prev_pages is never assigned a value which causes age_factor to be zero
      all the time.
    ------------------------------------------------------------
    revno: 3690.34.38
    committer: Roy Lyseng <roy.lyseng@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-05-31 16:28:35 +0200
    message:
      WL#5561 - Enable semi-join transformation with outer join queries
      
      mysql-test/include/join_cache.inc
        Turned off semi-join to preserve plan for an existing test.
      
      mysql-test/include/subquery_sj.inc
        Added new tests for queries that combine outer join with semi-join.
        See HLS of WL#5561 for a basic description of the new tests.
        The tests are grouped according to the "subquery patterns" defined
        in the WL.
      
      mysql-test/r/derived.result
        Test result changes
      
      mysql-test/r/explain_json_all.result
        Test result changes
      
      mysql-test/r/join_cache_bka.result
      mysql-test/r/join_cache_bka_nixbnl.result
      mysql-test/r/join_cache_bkaunique.result
      mysql-test/r/join_cache_bnl.result
      mysql-test/r/join_cache_nojb.result
        Turned off semi-join to preserve plan for an existing test.
      
      mysql-test/r/join_outer.result
      mysql-test/r/join_outer_bka.result
      mysql-test/r/join_outer_bka_nixbnl.result
        Test result changes
      
      mysql-test/r/subquery_all.result
      mysql-test/r/subquery_all_bka.result
      mysql-test/r/subquery_all_bka_nixbnl.result
      mysql-test/r/subquery_mat.result
      mysql-test/r/subquery_mat_all.result
        Some queries containing inner joins and outer joins that previously
        where executed as "DEPENDENT SUBQUERY" are now transformed
        to semi-joins.
      
      mysql-test/r/subquery_sj_all.result
      mysql-test/r/subquery_sj_all_bka.result
      mysql-test/r/subquery_sj_all_bka_nixbnl.result
      mysql-test/r/subquery_sj_all_bkaunique.result
      mysql-test/r/subquery_sj_dupsweed.result
      mysql-test/r/subquery_sj_dupsweed_bka.result
      mysql-test/r/subquery_sj_dupsweed_bka_nixbnl.result
      mysql-test/r/subquery_sj_dupsweed_bkaunique.result
      mysql-test/r/subquery_sj_firstmatch.result
      mysql-test/r/subquery_sj_firstmatch_bka.result
      mysql-test/r/subquery_sj_firstmatch_bka_nixbnl.result
      mysql-test/r/subquery_sj_firstmatch_bkaunique.result
      mysql-test/r/subquery_sj_loosescan.result
      mysql-test/r/subquery_sj_loosescan_bka.result
      mysql-test/r/subquery_sj_loosescan_bka_nixbnl.result
      mysql-test/r/subquery_sj_loosescan_bkaunique.result
      mysql-test/r/subquery_sj_mat.result
      mysql-test/r/subquery_sj_mat_bka.result
      mysql-test/r/subquery_sj_mat_bka_nixbnl.result
      mysql-test/r/subquery_sj_mat_bkaunique.result
      mysql-test/r/subquery_sj_mat_nosj.result
      mysql-test/r/subquery_sj_none.result
      mysql-test/r/subquery_sj_none_bka.result
      mysql-test/r/subquery_sj_none_bka_nixbnl.result
      mysql-test/r/subquery_sj_none_bkaunique.result
        Contains new results for tests added in WL#5561.
        Some queries containing inner joins and outer joins that previously
        where executed as "DEPENDENT SUBQUERY" are now transformed
        to semi-joins.
        Some results are reordered because of the new plans.
      
      mysql-test/r/subselect_innodb.result
        Some plans changed because of semi-join transformation.
      
      mysql-test/r/type_time.result
        Turned off semi-join to preserve plan for an existing test.
      
      mysql-test/r/user_var.result
        Test case results for bug#14058892.
      
      mysql-test/r/view.result
        One result reordering because plan was changed.
      
      mysql-test/suite/opt_trace/r/general_no_prot_all.result
      mysql-test/suite/opt_trace/r/general_ps_prot_all.result
      mysql-test/suite/opt_trace/r/general_no_prot_all.result
      mysql-test/suite/opt_trace/r/general_ps_prot_all.result
        Changed optimizer trace because plans were changed.
      
      mysql-test/t/join_outer.test
        Test case for bug#13980954.
      
      mysql-test/t/type_time.test
        Turned off semi-join to preserve plan for an existing test.
      
      mysql-test/t/user_var.test
        Test case for bug#14058892.
      
      sql/item_func.cc
        Item_func::fix_fields() was called for a previously fixed item.
        In order to avoid having yet another test in the caller, the
        DBUG_ASSERT(fixed == 0) was removed and fix_fields() will instead
        exit early when the item is already fixed.
        See LLD section 2.1.
      
      sql/item_subselect.cc
        Removed setting of const_item_cache from fix_after_pullout().
        Changed name of materialized subquery table from "materialized subselect"
        to "materialized-subquery".
      
      sql/sql_class.h
        Added field copy_field_count to class Semijoin_mat_exec.
      
      sql/sql_executor.cc
        do_sj_dups_weedout(): Corrected bug in NULL handling when writing
        duplicate weedout row.
        See LLD section 2.7.
        evaluate_null_complemented_join_record(): Made sure that
        duplicate weedout table is properly reset also when we add a
        null complemented row.
        See LLD section 2.6.
      
      sql/sql_optimizer.cc
        record_semijoin_nests() was split out from simplify_joins(), because
        sometimes a semi-join nest was recorded twice.
        Simplifying the complex simplify_joins() (sic) was also reasonable.
        See LLD section 2.9.
        semijoin_types_allow_materialization(): Small interface change.
        optimize_semijoin_nests(): as a short-term measure, disallow
        materialization when there are dependencies to the outer tables.
        See LLD section 2.2.
        build_bitmap_for_nested_join(): Updated to use the new nj_xxx fields.
        Record tables belonging in semi-join nests in the embedding outer join
        nest (if any).
        See LLD section 2.5.
        convert_subquery_to_semijoin(): Removed disabling of semi-join
        transformation when there are outer joins in the outer query.
        See LLD chapter 1.
        convert_subquery_to_semijoin(): Made changes to on_expr to be
        reflected in the permanent data as well (prep_on_expr).
        See LLD section 2.4.
        make_outerjoin_info(): Updated to use the new nj_xxx fields.
        See LLD section 2.5.
      
      sql/sql_optimizer.h
        Added definition of function set_prefix_tables().
      
      sql/sql_planner.cc
        check_interleaving_with_nj(): Updated to ignore join nests without
        nj_map information, and use new nj_xxx fields.
        backout_nj_sj_state(): Updated to use new nj_xxx fields.
      
      sql/sql_select.cc
        setup_semijoin_dups_elimination(): Code that assures that duplicate
        weedout extends across all tables of an outer join operation.
        See LLD section 2.8.
        setup_join_buffering(): Eliminated use of join cache when there
        is an outer join operation and first match strategy is used.
      
      sql/sql_select.h
        Added fields prefix_tables_map and added_tables_map to class
        JOIN_TAB.
      
      sql/table.cc
        When resolving a view, call fix_fields() on the view's WHERE
        condition only once. This fix_fields() call enables some needed
        initial transformations to the condition, and is prerequisite to
        separate out the view check option. However for subsequent
        executions, the view condition is part of complete query condition,
        and will be resolved as part of this. There was a crash because of
        this, because fix_fields() did non-permanent transformations on
        subquery transformed to semi-join on second execution.
      
      sql/table.h
        Replaced fields used to analyze nested joins with new ones:
        nj_total, nj_counter, nj_map.
        See LLD section 2.5.
    ------------------------------------------------------------
    revno: 3690.34.37
    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
    branch nick: trunk1
    timestamp: Thu 2012-05-31 14:00:25 +0200
    message:
      Bug#13737949
      
      Removed DBUG_ASSERT(0) and added error handling
      to call ha_index_end() on the partitions that successfully
      called ha_index_init().
    ------------------------------------------------------------
    revno: 3690.34.36
    committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
    branch nick: mysql-trunk-bug14136866
    timestamp: Thu 2012-05-31 13:11:38 +0200
    message:
      Bug#14136866 A READ ONLY TRANSACTION LETS A NON-SUPER
                   USER DISABLE GENERAL QUERY LOGGING!
      
      The problem was that writing to the general log was disallowed
      in read only transactions since acquiring a write log was
      blocked.
      
      This patch fixes the problem by allowing the acquisition of
      write locks on general and slow logs even in read only
      transactions.
    ------------------------------------------------------------
    revno: 3690.34.35
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-05-31 16:36:04 +0530
    message:
      added debug run to mysql-trunk-stage branch
    ------------------------------------------------------------
    revno: 3690.34.34 [merge]
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-05-31 12:20:18 +0200
    message:
      Null merge mysql-5.5 --> mysql-trunk
        ------------------------------------------------------------
        revno: 2875.388.2 [merge]
        committer: Marc Alff <marc.alff@oracle.com>
        branch nick: mysql-5.5-14116252
        timestamp: Thu 2012-05-31 11:49:03 +0200
        message:
          Local merge
        ------------------------------------------------------------
        revno: 2875.388.1
        committer: Marc Alff <marc.alff@oracle.com>
        branch nick: mysql-5.5-14116252
        timestamp: Thu 2012-05-31 11:47:13 +0200
        message:
          Bug 14116252 - CANNOT BUILD ARCHIVE ENGINE WHEN WITH_PERFSCHEMA_STORAGE_ENGINE=0
          
          Fixed a build break with compiling without the performance schema,
          instrumentation should be protected by HAVE_PSI_INTERFACE
    ------------------------------------------------------------
    revno: 3690.34.33 [merge]
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-05-31 14:58:35 +0530
    message:
      upmerge from mysql-5.5 ==> mysql-trunk
        ------------------------------------------------------------
        revno: 2875.387.7 [merge]
        committer: Rohit Kalhans <rohit.kalhans@oracle.com>
        branch nick: mysql-5.5
        timestamp: Thu 2012-05-31 14:37:23 +0530
        message:
          upmerge from mysql-5.1 => mysql-5.5
            ------------------------------------------------------------
            revno: 2661.840.25
            committer: Rohit Kalhans <rohit.kalhans@oracle.com>
            branch nick: mysql-5.1
            timestamp: Thu 2012-05-31 14:32:29 +0530
            message:
              Fixed the problem in bzr file-id between 5.1 and 5.5 in i_binlog folder.
    ------------------------------------------------------------
    revno: 3690.34.32
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Thu 2012-05-31 19:09:30 +1000
    message:
      Bug#14135054 ASSERT IN BUF_PAGE_IN_FILE(BPAGE) DURING DROP DATABASE
                  
      Needs the buffer pool mutex to be held for the duration of the fetch count
      of pages matching some space id. When we relocate a page, first we change the
      state to remove from hash and then remove the page from the flush list.
      We release the page mutex after changing the state, therefore holding it
      is not sufficient. We must hold the buffer pool mutex while scanning the
      flush list. Note: This is debug code.
      					        
      Approved by Marko over IM
    ------------------------------------------------------------
    revno: 3690.34.31
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: trunk
    timestamp: Thu 2012-05-31 12:58:12 +0400
    message:
      Patch for WL#6301 (Change default value for the 'bind-address' option).
      
      The patch changes the bind-address default value (from '0.0.0.0' to '::') and
      does the following cosmetic changes:
      
        - it adds a startup warning if the server failed to reset the IPV6_V6ONLY
          flag on the server socket;
      
        - it uses vio_getnameinfo() instead of vio_get_normalized_ip_string()
          to print out IP addresses on startup. That's needed in order to output
          IPv4-mapped IPv6 addresses properly
          (vio_get_normalized_ip_string() converts an IPv4-mapped IPv6 address
          to regular IPv4 address).
    ------------------------------------------------------------
    revno: 3690.34.30
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-05-31 11:18:44 +0300
    message:
      Test for Bug#14140038 INCONSISTENT HANDLING OF FULLTEXT INDEXES IN ALTER TABLE
    ------------------------------------------------------------
    revno: 3690.34.29
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Thu 2012-05-31 11:16:59 +1000
    message:
      Bug#13903821 WL#5526 performance regression in row_ins()
      
      Add a trx_id field to row_prebuilt_t and track when the last insert query
      graph was created. If the last index in the list has a higher trx id then
      recreate the insert query graph.
      
      This also fixes a memory leak that was introduced as part of online index
      worklog. The memory leak caused the regression too.
      
      rb://1097 Approved by Marko
    ------------------------------------------------------------
    revno: 3690.34.28
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-30 15:28:52 +0100
    message:
      WL#5223: Binary Log Group Commit
      
      Added waiting conditions to rpl_semi_sync test when semi sync master
      status depend on round trip to slave to avoid test failures (result
      content mismatch) on slow platforms.
    ------------------------------------------------------------
    revno: 3690.34.27 [merge]
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-30 15:12:31 +0100
    message:
      BUG#14135691: MISSING INITIALIZATION OF MYSQL_BIN_LOG::SYNC_COUNTER
      
      Empty merge from mysql-5.5 into mysql-trunk.
        ------------------------------------------------------------
        revno: 2875.387.6
        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
        branch nick: mysql-5.5
        timestamp: Wed 2012-05-30 14:55:13 +0100
        message:
          BUG#14135691: MISSING INITIALIZATION OF MYSQL_BIN_LOG::SYNC_COUNTER
          
          MYSQL_BIN_LOG::sync_counter is not initialized on MYSQL_BIN_LOG object
          creation.
          
          Added missing sync_counter initialization.
    ------------------------------------------------------------
    revno: 3690.34.26
    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
    branch nick: B14134640-trunk
    timestamp: Wed 2012-05-30 15:33:58 +0300
    message:
      Bug #14134640: INCORRECT DEFINITION OF TABLE 
        PERFORMANCE_SCHEMA.SESSION_CONNECT_ATTRS
      
      Changed the expected column name to the one created by the init 
      scripts (PROCESSLIST_ID).
    ------------------------------------------------------------
    revno: 3690.34.25
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-30 12:38:39 +0100
    message:
      BUG#14135691: MISSING INITIALIZATION OF MYSQL_BIN_LOG::SYNC_COUNTER
      
      MYSQL_BIN_LOG::sync_counter is not initialized on MYSQL_BIN_LOG object
      creation.
      
      Added missing sync_counter initialization.
    ------------------------------------------------------------
    revno: 3690.34.24 [merge]
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-merge
    timestamp: Wed 2012-05-30 13:16:45 +0200
    message:
      merge 5.5 => trunk
        ------------------------------------------------------------
        revno: 2875.387.5
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: 5.5-insource
        timestamp: Wed 2012-05-30 12:47:29 +0200
        message:
          Bug#12845091 .EMPTY FILE IN /DATA/TEST PREVENTS USERS FROM DROPPING TEST DB ON 5.5 AND 5.6
          
          For those who build in-source, we need to change .bzrignore:
          s/.empty/dummy.bak/
    ------------------------------------------------------------
    revno: 3690.34.23 [merge]
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk_b11762667
    timestamp: Wed 2012-05-30 16:34:55 +0530
    message:
      Upmerge from mysql-5.5 -> mysql_trunk branch.
        ------------------------------------------------------------
        revno: 2875.387.4 [merge]
        committer: Rohit Kalhans <rohit.kalhans@oracle.com>
        branch nick: mysql-5.5_b11762667
        timestamp: Wed 2012-05-30 14:27:27 +0530
        message:
          upmerge from  mysql-5.1 branch -> mysql-5.5 branch
            ------------------------------------------------------------
            revno: 2661.840.24
            committer: Rohit Kalhans <rohit.kalhans@oracle.com>
            branch nick: mysql-5.1_b11762667
            timestamp: Wed 2012-05-30 14:00:29 +0530
            message:
              Fixing i_binlog.binlog_mysqlbinlog_file_write failure. 
            ------------------------------------------------------------
            revno: 2661.840.23
            committer: Rohit Kalhans <rohit.kalhans@oracle.com>
            branch nick: mysql-5.1_b11762667
            timestamp: Wed 2012-05-30 13:54:15 +0530
            message:
              Fixing the build failure on Windows debug build.
    ------------------------------------------------------------
    revno: 3690.34.22
    committer: Alexander Barkov <alexander.barkov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-30 13:48:49 +0400
    message:
      Removing unused "scan_it" member.
    ------------------------------------------------------------
    revno: 3690.34.21
    committer: Martin Hansson <martin.hansson@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-30 11:18:58 +0200
    message:
      Bug #13485416: CRASH WITH SMALL MAX_SORT_LENGTH AND GROUP BY
      AND LIMIT
      
      Sort keys for e.g. filesort are created by
      Field::sort_string(uchar*,uint), where the uint argument is
      ignored. But the three callers of the function obviously
      assume the opposite: when max_sort_length is less than the
      pack size of the value to be sorted by, there will always be
      a buffer overrun.
      
      The fix is to:
      
      - Rename Field::sort_string() to Field::make_sort_key(),
        because the latter describes what the function does.
      
      - Make sure we always respect the length argument for all
        implementations of the interface Field_*::make_sort_key().
      
      - Test all implementations of make_sort_key with unit
        tests. Some implementations need to be rewritten
        (i.e. code in platform dependent #ifdef's) in order to be
        completely tested.
    ------------------------------------------------------------
    revno: 3690.34.20
    committer: Alfranio Correia <alfranio.correia@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-30 08:57:41 +0100
    message:
      In some platforms, apparently due to a bug in glibc, "getconf
      LEVEL1_DCACHE_LINESIZE" returns 0 thus generating an error
      while compiling, i.e. "requested alignment is not a power of 2".
      
      To fix the problem, we check if "getconf" returns 0 and make
      64 the default value.
    ------------------------------------------------------------
    revno: 3690.34.19
    committer: Gleb Shchepa <gleb.shchepa@oracle.com>
    branch nick: trunk-test-update
    timestamp: Wed 2012-05-30 10:06:29 +0400
    message:
      Minor test update for WL#6129 "Deprecate and remove YEAR(2)"
    ------------------------------------------------------------
    revno: 3690.34.18
    committer: Gleb Shchepa <gleb.shchepa@oracle.com>
    branch nick: trunk-bug13887779
    timestamp: Wed 2012-05-30 10:02:51 +0400
    message:
      Bug #13887779: ASSERTION FAILURE IN EXPLAIN FORMAT=JSON:
                     `SUBQUERY_TYPE == SQ_ORDER_BY
                                                                                                           
      * In debug builds the Server got an assertion failure                                                
      "subquery_type == SQ_ORDER_BY" explaining UNION queries                                              
      with optimized-out subquery in the UNION-wide ORDER BY clause.                                       
      * In production builds that query was shown as a                                                     
      regular ORDER BY subquery. Also a wrong information about                                            
      filesorting of the UNION was there.                                                                  
      Only EXPLAIN FORMAT=JSON is affected.                                                                
                                                                                                           
      The union_result_ctx class has been modified to:                                                     
      * take into account optimized-out subqueries;                                                        
      * don't show "using filesort" for such queries. 
    ------------------------------------------------------------
    revno: 3690.34.17
    committer: Chaithra Gopalareddy <chaithra.gopalareddy@oracle.com>
    branch nick: mysql-5.6
    timestamp: Wed 2012-05-30 10:48:45 +0530
    message:
      Bug #13890837: DEFAULT() CALL MAKES MYSQL SERVER CRASH
      
      PROBLEM:
      We create a item of type DEFAULT_VALUE_ITEM to represent 
      DEFAULT(b) in the query. While creating a temporary 
      table, we do not create any field for this item as it 
      is a const_item. 
      In the call to remove_duplicates(this is where we dump), 
      we check if the field is a const_item. If not, we access 
      the contents of the field item in the temporary table.
      
      In this case,  the call to const_item() inside 
      remove_duplicates() returns false, as we would have 
      changed the type of the item in the call to 
      get_tmp_table_item() inside change_refs_to_tmp_fields(). 
      As a result, we try to check the contents of the field 
      and dump.
      
      As class Item_default_value does not have its own 
      get_tmp_table_item function, it calls 
      Item_field::get_tmp_table_item(). This results in the 
      change of the type of the object created and therefore
      the dump.
      
      FIX:
      Introduce a call to get_tmp_table_item() for class 
      Item_default_value, so that the type of the object 
      remains same.
    ------------------------------------------------------------
    revno: 3690.34.16
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Wed 2012-05-30 13:41:19 +1000
    message:
      Fix compiler warnings on Windows.
      
      Approved by Jimmy Yang over IM.
    ------------------------------------------------------------
    revno: 3690.34.15
    committer: Inaam Rana <inaam.rana@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-05-29 23:28:41 -0400
    message:
      Bug#14037167: OUTPUT ON FLUSHED PAGES IS NOT ACCURATE WITH MULTIPLE
      BUFFER POOL INSTANCES
      
      rb://1070
      approved by: Sunny Bains
      
      When doing flushing buf_flush_list() returns ULINT_UNDEFINED if it
      fails for any buffer pool instance because a batch of same type is
      already running. On success it returns the number of pages
      successfully queued for flushing. When using multiple buffer pool
      instances it is possible that a flush batch was queued for some
      instances in which case the accounting for flushing of these pages
      gets wrong in the callers because ULINT_UNDEFINED is taken to mean
      that no pages have been flushed.
      
      This patch fixes that making return type of buf_flush_list() bool
      and returning the number of pages as a separate parameter.
    ------------------------------------------------------------
    revno: 3690.34.14
    committer: Inaam Rana <inaam.rana@oracle.com>
    branch nick: adaptive_flushing
    timestamp: Tue 2012-05-29 17:49:04 -0400
    message:
      WL#5666: Tuning adaptive flushing
      
      rb://1000
      approved by: Sunny Bains
      
      Changes in adaptive flushing based on work by Dimtri.
      
      New Parameters:
      ===============
      
      innodb_adaptive_flushing_lwm: low water mark in %age of log capacity at
      which adaptive flushing kicks in. Default 10: Range 0 - 70 (note it is
      %age of log_capacity instead of max_async_age for user friendliness)
      
      innodb_max_dirty_pages_pct_lwm: low water mark of dirty pages in %age
      where preflushing to control dirty page ratio kicks in. Default 0
      (which has the special meaning of this value having no effect).
      Range 0 - 99
      
      innodb_max_io_capacity: The limit upto which we are allowed to stretch
      io_capacity in case of emergency. Default: 400 (which is 2X of default
      innodb_io_capacity). Range 100 - ~0
      
      innodb_flushing_avg_loops: Number of iterations for which we keep the
      previously calculated snapshot of the flushing state. This variable is
      roughly a measure of how smooth you want the transition in the
      flushing activity to be. The higher the value the smoother will be the
      transition in flushing in face of rapidly changing workload. A lower
      value implies that the flushing algorithm is more responsive but it
      also means that flushing acitivity can become spiky when confronted
      with a quickly changing workload. Default value is 30 and permissible
      range is 1 ? 1000.
      
      
      All parameters are dynamic.
      
      Existing Parameters:
      ====================
      
      innodb_adaptive_flushing: same as before. Only now it will use the new
      formula.
      
      innodb_io_capacity: same as before. But now tied to
      innodb_max_io_capacity. If user sets innodb_max_io_capacity <
      innodb_io_capacity a warning will be issued and innodb_max_io_capacity
      will be set equal to innodb_io_capacity. If user sets
      innodb_io_capacity > innodb_max_io_capacity a warning will be issued
      and innodb_io_capacity will be set equal to innodb_max_io_capacity.
      
      innodb_max_dirty_pages_pct: same as before. But now tied to
      innodb_max_dirty_pages_pct_lwm.
      If user sets innodb_max_dirty_pct < innodb_max_dirty_pages_pct_lwm
      a warning will be issued and innodb_max_dirty_pages_pct_lwm will be
      lowered to new innodb_max_dirty_pages_pct.
      If user sets innodb_max_dirty_pct_lwm > innodb_max_dirty_pages_pct
      a warning will be issued and innodb_max_dirty_pages_pct_lwm will be set
      equal to innodb_max_dirty_pages_pct.
    ------------------------------------------------------------
    revno: 3690.34.13
    committer: Guilhem Bichot <guilhem.bichot@oracle.com>
    branch nick: trunk5
    timestamp: Tue 2012-05-29 17:56:12 +0200
    message:
      Follow-up after the fix for
      Bug#14005353 COLUMN CANNOT BE NULL ERROR WHEN EXECUTING TRIGGER WITH PK IN SUBQUERY
      We were reading uninitialized memory.
    ------------------------------------------------------------
    revno: 3690.34.12
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-05-29 14:49:39 +0100
    message:
      Added waiting conditions to rpl_semi_sync test when semi sync master 
      status depend on round trip to slave to avoid test failures (result
      content mismatch) on slow platforms.
    ------------------------------------------------------------
    revno: 3690.34.11
    committer: Thayumanavar <thayumanavar.x.sachithanantha@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-05-29 16:52:15 +0530
    message:
      Bug#11752226 - WHEN QUERY IS KILLED, ERROR
                     ER_QUERY_INTERRUPTED IS NOT PROPAGATED.
      PROBLEM:  When alter function query failed by killing, the
                error ER_QUERY_INTERRUPTED in some circumstances
                is not propagated to the upper level, and result
                in ER_SP_CANT_ALTER or ER_SP_DOES_NOT_EXIST error
                sometimes.
      FIX:  When kill query on another connection succeeds before the
            query  alter function, alter function does not return SP_OK.
            The code sets either ER_SP_DOES_NOT_EXIST or ER_SP_CANT_ALTER.
            If thd->killed flag is set, then do not set this errors which
            allow  ER_QUERY_INTERRUPTED when the connection is reaped. 
    ------------------------------------------------------------
    revno: 3690.34.10
    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
    branch nick: B14006448-trunk
    timestamp: Tue 2012-05-22 13:19:55 +0300
    message:
      Bug #14006448: SSL_CRL AND SSL_CRL_CLRPATH ARE NOT RUN FOR YASSL AND DOES NOT 
      WORK FOR OPENSSL
      
      Regenerated the test cryptography files.
      Renamed mysql-client-valid-[cert|key].pem to mysql-client-[cert|key].pem
      Renamed mysql-client-[cert|key].pem to mysql-client-invalid-[cert|key].pem
      Added an instruction on how to regenerate the cryptography files if needed.
    ------------------------------------------------------------
    revno: 3690.34.9 [merge]
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-cleanup
    timestamp: Tue 2012-05-29 12:24:01 +0200
    message:
      Local merge
        ------------------------------------------------------------
        revno: 3690.43.1
        committer: Jimmy Yang <jimmy.yang@oracle.com>
        branch nick: trunk3
        timestamp: Tue 2012-05-29 17:49:15 +0800
        message:
          Implement WL #6251 in-place ALTER TABLE?ADD FOREIGN KEY
          
          rb://1064 approved by Marko
    ------------------------------------------------------------
    revno: 3690.34.8
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-cleanup
    timestamp: Tue 2012-05-29 12:09:25 +0200
    message:
      Tree cleanup after bad merges
    ------------------------------------------------------------
    revno: 3690.34.7 [merge]
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-merge
    timestamp: Tue 2012-05-29 10:56:35 +0200
    message:
      merge 5.5 => trunk
        ------------------------------------------------------------
        revno: 2875.387.3
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: 5.5
        timestamp: Tue 2012-05-29 10:54:57 +0200
        message:
          Bug#12845091 .EMPTY FILE IN /DATA/TEST PREVENTS USERS FROM DROPPING TEST DB ON 5.5 AND 5.6
    ------------------------------------------------------------
    revno: 3690.34.6 [merge]
    committer: Sergey Glukhov <sergey.glukhov@oracle.com>
    branch nick: mysql-trunk-wl6098
    timestamp: Tue 2012-05-29 12:18:37 +0400
    message:
      merge from trunk
        ------------------------------------------------------------
        revno: 3873.5.11
        committer: Jimmy Yang <jimmy.yang@oracle.com>
        branch nick: trunk4
        timestamp: Tue 2012-05-29 15:19:55 +0800
        message:
          Fix Bug #14101706 - CRASH WITH DDL IN ROW_MERGE_BUILD_INDEXES WHEN FULLTEXT
          INDEXES EXIST
          
          rb://1093 approved by Marko
        ------------------------------------------------------------
        revno: 3873.5.10 [merge]
        committer: Rohit Kalhans <rohit.kalhans@oracle.com>
        branch nick: mysql-trunk_b11762667
        timestamp: Tue 2012-05-29 12:37:08 +0530
        message:
          upmerge from mysql-5.5 -> mysql-trunk branch
            ------------------------------------------------------------
            revno: 2875.387.2 [merge]
            committer: Rohit Kalhans <rohit.kalhans@oracle.com>
            branch nick: mysql-5.5_b11762667
            timestamp: Tue 2012-05-29 12:21:17 +0530
            message:
              upmerge from  mysql-5.1 branch -> mysql-5.5 branch
                ------------------------------------------------------------
                revno: 2661.840.22
                committer: Rohit Kalhans <rohit.kalhans@oracle.com>
                branch nick: mysql-5.1_b11762667
                timestamp: Tue 2012-05-29 12:11:30 +0530
                message:
                  Bug#11762667: MYSQLBINLOG IGNORES ERRORS WHILE WRITING OUTPUT
                  
                  Problem: mysqlbinlog exits without any error code in case of
                  file write error. It is because of the fact that the calls
                  to Log_event::print() method does not return a value and the
                  thus any error were being ignored.
                  
                  Resolution: We resolve this problem by checking for the 
                  IO_CACHE::error == -1 after every call to Log_event:: print()
                  and terminating the further execution.
            ------------------------------------------------------------
            revno: 2875.387.1
            committer: Praveenkumar Hulakund <praveenkumar.hulakund@oracle.com>
            branch nick: mysql_5_5
            timestamp: Mon 2012-05-28 11:14:43 +0530
            message:
              Bug#14003080:65104: MAX_USER_CONNECTIONS WITH PROCESSLIST EMPTY
              
              Analysis:
              -------------
              If server is started with limit of MAX_CONNECTIONS and 
              MAX_USER_CONNECTIONS then only MAX_USER_CONNECTIONS of any particular
              users can be connected to server and total MAX_CONNECTIONS of client can
              be connected to server.
              
              Server maintains a counter for total CONNECTIONS and total CONNECTIONS 
              from particular user.
              
              Here, MAX_CONNECTIONS of connections are created to server. Out of this
              MAX_CONNECTIONS, connections from particular user (say USER1) are
              also created. The connections from USER1 is lesser than 
              MAX_USER_CONNECTIONS. After that there was one more connection request from
              USER1. Since USER1 can still create connections as he havent reached
              MAX_USER_CONNECTIONS, server increments counter of CONNECTIONS per user.
              As server already has MAX_CONNECTIONS of connections, next check to total
              CONNECTION count fails. In this case control is returned WITHOUT 
              decrementing the CONNECTIONS per user. So the counter per user CONNECTIONS goes
              on incrementing for each attempt until current connections are closed. 
              And because of this counter per CONNECTIONS reached MAX_USER_CONNECTIONS. 
              So, next connections form USER1 user always returns with MAX_USER_CONNECTION 
              limit error, even when total connection to sever are less than MAX_CONNECTIONS.
              
              Fix:
              -------------
              This issue is occurred because of not handling counters properly in the
              server. Changed the code to handle per user connection counters properly.
        ------------------------------------------------------------
        revno: 3873.5.9
        committer: Jimmy Yang <jimmy.yang@oracle.com>
        branch nick: trunk2
        timestamp: Tue 2012-05-29 09:24:47 +0800
        message:
          Check in two new files that belongs to WL #6218 checkin.
        ------------------------------------------------------------
        revno: 3873.5.8
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: trunk
        timestamp: Tue 2012-05-29 10:04:09 +1000
        message:
          Bug#14122156 - INNODB.INNODB-WL5522-DEBUG FAILURE ON PB2 WITH DIFFERENT SYMPTOMS
          
          Update result file.
        ------------------------------------------------------------
        revno: 3873.5.7
        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-05-28 16:33:34 +0100
        message:
          WL#5223: Binary Log Group Commit
          
          When multi thread slave is ON, at the time when 
          binlog.gtid_empty_group_log_and_cleanup() is called (empty transaction),
          thd.cache_mngr is not yet initialized.
          
          Always try to initialize thd.cache_mngr on
          binlog.gtid_empty_group_log_and_cleanup().
        ------------------------------------------------------------
        revno: 3873.5.6
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-05-28 17:35:06 +0300
        message:
          WL#2392: addendum #1 : 
          - added the new column definition to is_columns_mysql_embedded
        ------------------------------------------------------------
        revno: 3873.5.5 [merge]
        committer: magnus.blaudd@oracle.com
        branch nick: mysql-trunk
        timestamp: Mon 2012-05-28 15:11:17 +0200
        message:
          Merge
            ------------------------------------------------------------
            revno: 3873.6.1
            committer: magnus.blaudd@oracle.com
            branch nick: trunk
            timestamp: Mon 2012-05-28 15:03:41 +0200
            message:
              WL#5940 handler extensions for pushed join
               - Add missing semicolon in traditional_extra_tags array which
                 caused the string for ET_PUSHED_JOIN to be NULL(which is not allowed)
        ------------------------------------------------------------
        revno: 3873.5.4
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: mysql-trunk
        timestamp: Mon 2012-05-28 16:02:03 +0300
        message:
          WL#5924 addendum #1 : fix a pb2 compile problem on bsd
        ------------------------------------------------------------
        revno: 3873.5.3
        committer: Jimmy Yang <jimmy.yang@oracle.com>
        branch nick: trunk3
        timestamp: Mon 2012-05-28 20:33:40 +0800
        message:
          Check in WL #6218 Support multiple table access through InnoDB Memcached
          
          rb://1048 approved by Sunny Bains
        ------------------------------------------------------------
        revno: 3873.5.2 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: push-wl5924-trunk
        timestamp: Mon 2012-05-28 15:08:15 +0300
        message:
          merge
        ------------------------------------------------------------
        revno: 3873.5.1 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: push-wl5924-trunk
        timestamp: Mon 2012-05-28 13:46:55 +0300
        message:
          WL#5924 : merge to mysql-trunk
            ------------------------------------------------------------
            revno: 3690.42.14
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Thu 2012-05-24 16:03:41 +0300
            message:
              wl#5924 : added a test on 8192 input buffer truncation.
            ------------------------------------------------------------
            revno: 3690.42.13 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Mon 2012-05-21 15:00:48 +0300
            message:
              WL#5924 : "Change Password at next login" (initial default for root)
              
               - updated from the latest trunk base
               - removed a stray unused local variable
               - fixed the P_S macros to use the latest version from trunk
            ------------------------------------------------------------
            revno: 3690.42.12
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Fri 2012-05-04 13:54:36 +0300
            message:
              WL#5924 : Add connect string processing to mysql
              
              Applied a class hierarchy separation patch by Chris P.
              Now the iterator is an actual iterator and nothing but.
              All the non-iterator code was moved to an intermediary
              base class for the two P_S tables introduced by this WL.
            ------------------------------------------------------------
            revno: 3690.42.11
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Wed 2012-05-02 18:09:57 +0300
            message:
              WL#5924: Add connect string processing to mysql
              
              impose an artificial 64k length limit for the attributes blob
              to avoid DoS scenarios.
            ------------------------------------------------------------
            revno: 3690.42.10
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Wed 2012-05-02 17:54:35 +0300
            message:
              WL#5924 : Add connect string processing to mysql
              
              Addressed second part of Kristofer's comments:
              1. The overall length of the attributes transferred is 
              encoded as a dynamic length instead of as a fixed 2
              byte string.
              2. Added a write_length_encoded_string() to serialize 
              both name and length for uniformity.
              3. Adjusted some unit test buffer sizes.
            ------------------------------------------------------------
            revno: 3690.42.9
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Wed 2012-05-02 14:32:54 +0300
            message:
              WL#5924 :  Add connect string processing to mysql
              
              wrapped the PSI_CALL into a 
              #ifdef HAVE_PSI_THREAD_INTERFACE (as Chris P suggests)
              for embedded as well.
            ------------------------------------------------------------
            revno: 3690.42.8
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Wed 2012-05-02 14:04:32 +0300
            message:
              WL#5924: Add connect string processing to mysql
              
              Addressed review comments by Chris P and Kristofer.
            ------------------------------------------------------------
            revno: 3690.42.7 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Wed 2012-05-02 12:30:40 +0300
            message:
              auto-merged mysql-trunk->mysql-trunk-wl5924
            ------------------------------------------------------------
            revno: 3690.42.6
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Tue 2012-04-03 11:35:11 +0300
            message:
              WL#5924 : fixed the unit test name
            ------------------------------------------------------------
            revno: 3690.42.5
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Tue 2012-04-03 11:28:58 +0300
            message:
              WL#5924: Fix suite failures #3
              
              Updated the variables.test to not have max_allowed_packet
              set to a non-default value during connects as on some boxes
              running the server using a long command line this may cause
              the login packet to exceed the threshhold set by 
              max_allowed_packet and cause login failures.
            ------------------------------------------------------------
            revno: 3690.42.4
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Mon 2012-04-02 17:48:44 +0300
            message:
              WL#5924 : suite fix #2
              
              Fixed the Windows compilation failures.
            ------------------------------------------------------------
            revno: 3690.42.3 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Mon 2012-04-02 17:37:35 +0300
            message:
              merged mysql-trunk->mysql-trunk-wl5924
            ------------------------------------------------------------
            revno: 3690.42.2
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Mon 2012-04-02 13:45:06 +0300
            message:
              WL#5924 Suite fix commit #1
              
              - Fixed a valgrind bug with mysql_reconnect(). Added a test case.
              - Fixed connect_attrs and mysql_client_test to use proper case
              when quoting the performance_schema database.
            ------------------------------------------------------------
            revno: 3690.42.1
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-trunk-wl5924
            timestamp: Fri 2012-03-30 19:01:10 +0300
            message:
              WL#5924 : Add connect string processing to mysql
              
              Initial implementation.
    ------------------------------------------------------------
    revno: 3690.34.5 [merge]
    committer: Sergey Glukhov <sergey.glukhov@oracle.com>
    branch nick: mysql-trunk-wl6098
    timestamp: Mon 2012-05-28 15:43:27 +0400
    message:
      merge from trunk
        ------------------------------------------------------------
        revno: 3873.3.13 [merge]
        committer: Alfranio Correia <alfranio.correia@oracle.com>
        branch nick: mysql-trunk-merge
        timestamp: Mon 2012-05-28 12:50:49 +0100
        message:
          merge mysql-trunk (local) --> mysql-trunk
            ------------------------------------------------------------
            revno: 3690.41.1
            committer: Alfranio Correia <alfranio.correia@oracle.com>
            branch nick: mysql-trunk
            timestamp: Mon 2012-05-28 11:54:03 +0100
            message:
              rpl_semi_sync started failing with a higher frequency in some
              platforms after the WL#5223. To fix the problem we have toned
              down the test case.
        ------------------------------------------------------------
        revno: 3873.3.12 [merge]
        committer: magnus.blaudd@oracle.com
        branch nick: trunk
        timestamp: Mon 2012-05-28 12:34:09 +0200
        message:
          Merge bug#14058643 into trunk
            ------------------------------------------------------------
            revno: 3876.3.1
            committer: magnus.blaudd@oracle.com
            branch nick: trunk-bug14058643
            timestamp: Wed 2012-05-23 15:17:01 +0200
            message:
              Bug#14058643 SVR4 PACKAGES OF CLUSTER MAY GROW ABOVE 2GB LIMIT AND FAIL TO
              BUILD
               - Don't build mysqltest and mysql_client_test for embedded
                 server on SVR4 in MySQL Cluster builds
               - Moved the ENABLE_EXPORTS for mysql_embedded earlier
                 (still inside IF(UNIX)) 
        ------------------------------------------------------------
        revno: 3873.3.11
        committer: magnus.blaudd@oracle.com
        branch nick: trunk
        timestamp: Mon 2012-05-28 12:20:54 +0200
        message:
          WL#5960 Start memcached from mysql-test-run.pl
           - Follow up patch to fix problem with binary INCR/DECR issues in
           My::Memcache.pm client lib.
    ------------------------------------------------------------
    revno: 3690.34.4 [merge]
    committer: Sergey Glukhov <sergey.glukhov@oracle.com>
    branch nick: mysql-trunk-wl6098
    timestamp: Mon 2012-05-28 15:41:46 +0400
    message:
      merge from trunk
        ------------------------------------------------------------
        revno: 3873.3.10 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: push-wl2392-trunk
        timestamp: Mon 2012-05-28 13:10:17 +0300
        message:
          merge trunk->wl2392
            ------------------------------------------------------------
            revno: 3690.35.29 [merge]
            committer: Mats Kindahl <mats.kindahl@oracle.com>
            branch nick: mysql-trunk
            timestamp: Mon 2012-05-28 11:35:28 +0200
            message:
              Merging with mysql-trunk
                ------------------------------------------------------------
                revno: 3873.4.1 [merge]
                committer: Ashish Agarwal<ashish.y.agarwal@oracle.com>
                branch nick: mysql-trunk
                timestamp: Mon 2012-05-28 14:51:40 +0530
                message:
                  wl#2739: Auditing Password Security
                           merging from mysql-trunk-wl2739
                           to mysql-trunk
                    ------------------------------------------------------------
                    revno: 3876.2.3 [merge]
                    committer: Ashish Agarwal<ashish.y.agarwal@oracle.com>
                    branch nick: mysql-trunk-wl2739
                    timestamp: Thu 2012-05-24 17:44:14 +0530
                    message:
                      wl2739: Auditing Password Security
                              merging mysql-trunk-wl2739 with mysql-trunk
                    ------------------------------------------------------------
                    revno: 3876.2.2
                    committer: Ashish Agarwal<ashish.y.agarwal@oracle.com>
                    branch nick: mysql-trunk-wl2739
                    timestamp: Thu 2012-05-24 16:26:52 +0530
                    message:
                      wl#2739: Auditing Password Security
                               Some changes in the testcase.
                    ------------------------------------------------------------
                    revno: 3876.2.1
                    committer: Ashish Agarwal<ashish.y.agarwal@oracle.com>
                    branch nick: mysql-trunk-wl2739
                    timestamp: Wed 2012-05-23 15:24:40 +0530
                    message:
                      WL#2739: Auditing Password Security
                      ******
                      WL#2739: Failing test case in WL branch.
                      ******
                      WL#2739: Some tests were failing.
                               Unable to compile in windows.
                               patch to correct the test cases and
                               make it compile in windows.
                      ******
                      wl#2739: Changes in the the test case
                               compiling it in windows. 
                      ******
                      WL#2739: Still some problem exsists with compilation in windows.
                               Patch to solve it.
                      ******
                      wl2739: Auditing Password Security
                              Some performance issue.
                      ******
                      WL#2739: some important changes regarding implementation
                               Test fail in windows
                      ******
                      wl#2739: Build problem in solaris/windows
                      ******
                      wl2739: Build failure in windows and some additional changes.
                      ******
                      WL2739: Including password validation on multiple
                              character set. 
                      ******
                      wl2739: Changing the dictionary file
                      ******
                      WL2739: Test failing on windows.
                              Dictionary file is not found in plugin
                              directory.
                      ******
                      wl2739: Test case fails in linux due to dictionary
                              file.
                      ******
                      wl2739: Auditing Password Security
                              Impementing review comments.
                      ******
                      wl2739: Auditing Password Security
                              Build failure in windows.
                      ******
                      wl2739: Auditing Password Security
                              Build failure in windows
                      ******
                      wl2739: Auditing Password Security
                              Build failure in windows.
                      ******
                      WL2739: Auditing Password Security
                              Implementing review comments.
                      ******
                      WL2739: Auditing Password Security
                              Implementing review comment
                      ******
                      wl2739: Auditing Password Security
                              Implementing suggestions.
                      ******
                      wl2739: Auditing Password Security
                              Implementing code review.
                      ******
                      wl2739: Auditing Password Security
                              Implementing code review
                      ******
                      wl2739: Auditing Password Security
                              Compilation error in solaris.
                      ******
                      wl#2739: Auditing Password Security
                               Test failure in windows 
                      ******
                      WL#2739: Auditing Password Security
                               Change in the .cnf file
                      ******
                      wl#2739: Auditing Password Security
                               Test failure on windows and
                               valgrind errors.
            ------------------------------------------------------------
            revno: 3690.35.28 [merge]
            committer: Mats Kindahl <mats.kindahl@oracle.com>
            branch nick: mysql-trunk
            timestamp: Mon 2012-05-28 09:41:17 +0200
            message:
              Merging with mysql-trunk.
            ------------------------------------------------------------
            revno: 3690.35.27
            committer: Mats Kindahl <mats.kindahl@oracle.com>
            branch nick: testing-trunk
            timestamp: Mon 2012-05-28 09:35:47 +0200
            message:
              Patch to fix compiler errors in PB2 under -Werror.
        ------------------------------------------------------------
        revno: 3873.3.9
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: push-wl2392-trunk
        timestamp: Mon 2012-05-28 12:09:33 +0300
        message:
          WL#2392: Change Password at next login
        ------------------------------------------------------------
        revno: 3873.3.8
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: trunk
        timestamp: Mon 2012-05-28 17:30:43 +1000
        message:
          Bug#14122156 - INNODB.INNODB-WL5522-DEBUG FAILURE ON PB2 WITH DIFFERENT SYMPTOMS
          
          Update suppression message.
        ------------------------------------------------------------
        revno: 3873.3.7 [merge]
        committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
        branch nick: mysql-trunk-wl5772
        timestamp: Mon 2012-05-28 11:15:01 +0400
        message:
          Merged latest changes from mysql-trunk into mysql-trunk-wl5772
          tree.
            ------------------------------------------------------------
            revno: 3690.35.26 [merge]
            committer: Praveenkumar Hulakund <praveenkumar.hulakund@oracle.com>
            branch nick: trunk
            timestamp: Mon 2012-05-28 11:16:07 +0530
            message:
              Merge from 5.5 to trunk
                ------------------------------------------------------------
                revno: 2875.386.6
                committer: Praveenkumar Hulakund <praveenkumar.hulakund@oracle.com>
                branch nick: mysql_5_5
                timestamp: Fri 2012-05-25 16:57:30 +0530
                message:
                  Bug#14003080:65104: MAX_USER_CONNECTIONS WITH PROCESSLIST EMPTY
                  
                  Analysis:
                  -------------
                  If server is started with limit of MAX_CONNECTIONS and 
                  MAX_USER_CONNECTIONS then only MAX_USER_CONNECTIONS of any particular
                  users can be connected to server and total MAX_CONNECTIONS of client can
                  be connected to server.
                  
                  Server maintains a counter for total CONNECTIONS and total CONNECTIONS 
                  from particular user.
                  
                  Here, MAX_CONNECTIONS of connections are created to server. Out of this
                  MAX_CONNECTIONS, connections from particular user (say USER1) are
                  also created. The connections from USER1 is lesser than 
                  MAX_USER_CONNECTIONS. After that there was one more connection request from
                  USER1. Since USER1 can still create connections as he havent reached
                  MAX_USER_CONNECTIONS, server increments counter of CONNECTIONS per user.
                  As server already has MAX_CONNECTIONS of connections, next check to total
                  CONNECTION count fails. In this case control is returned WITHOUT 
                  decrementing the CONNECTIONS per user. So the counter per user CONNECTIONS goes
                  on incrementing for each attempt until current connections are closed. 
                  And because of this counter per CONNECTIONS reached MAX_USER_CONNECTIONS. 
                  So, next connections form USER1 user always returns with MAX_USER_CONNECTION 
                  limit error, even when total connection to sever are less than MAX_CONNECTIONS.
                  
                  Fix:
                  -------------
                  This issue is occurred because of not handling counters properly in the
                  server. Changed the code to handle per user connection counters properly.
            ------------------------------------------------------------
            revno: 3690.35.25
            committer: Sunny Bains <Sunny.Bains@Oracle.Com>
            branch nick: trunk
            timestamp: Mon 2012-05-28 11:20:40 +1000
            message:
              Bug#14121576 - SIGSEGV IF TABLE INSTANCE NOT FOUND IN FIL0FIL.CC
              
              Use name instead of table->name, we have already done a check that table is 0.
              
              Approved by Jimmy Yang over IM.
            ------------------------------------------------------------
            revno: 3690.35.24
            committer: Guilhem Bichot <guilhem.bichot@oracle.com>
            branch nick: trunk5
            timestamp: Sun 2012-05-27 20:22:52 +0200
            message:
              result update after previous push
            ------------------------------------------------------------
            revno: 3690.35.23
            committer: Guilhem Bichot <guilhem.bichot@oracle.com>
            branch nick: trunk5
            timestamp: Sun 2012-05-27 18:08:28 +0200
            message:
              Minor improvements to EXPLAIN JSON (details forgotten during implemetation & review):
              for {subquery,semijoin} materialization:
              1) show key_length, like we do for regular-table ref access
              2) both materializations use a post-filter condition which was so far
              only visible in optimizer trace; it is evaluated right
              after reading a row in the tmp table, so it can be seen as attached
              to this tmp table; as we show a node for the tmp table, it makes sense
              to show this condition as "attached_to" in the node; like we do for regular-table
              "attached_to" conditions.
            ------------------------------------------------------------
            revno: 3690.35.22
            committer: Guilhem Bichot <guilhem.bichot@oracle.com>
            branch nick: trunk5
            timestamp: Sun 2012-05-27 18:05:51 +0200
            message:
              Fix for:
              Bug#14005353 COLUMN CANNOT BE NULL ERROR WHEN EXECUTING TRIGGER WITH PK IN SUBQUERY
              Bug#14069810 COLUMN CANNOT BE NULL ERROR WHEN EXECUTING TRIGGER WITH PK IN DERIVED TABLE
              Bug#14069831 'CREATE SELECT' OR DERIVED TABLE DON'T STORE RESULT OF SELECT
            ------------------------------------------------------------
            revno: 3690.35.21
            committer: Sunny Bains <Sunny.Bains@Oracle.Com>
            branch nick: trunk
            timestamp: Sat 2012-05-26 22:17:35 +1000
            message:
              Bug#13641926 - INNODB ASSERTS: ERROR: A RECORD LOCK WAIT HAPPENS IN A DICTIONARY OPERATION!
              
              Followup fix.
            ------------------------------------------------------------
            revno: 3690.35.20
            committer: Sunny Bains <Sunny.Bains@Oracle.Com>
            branch nick: trunk
            timestamp: Sat 2012-05-26 17:46:38 +1000
            message:
              Bug#13641926 - INNODB ASSERTS: ERROR: A RECORD LOCK WAIT HAPPENS IN A DICTIONARY OPERATION!
              
              Follow up fix.
            ------------------------------------------------------------
            revno: 3690.35.19
            committer: Sunny Bains <Sunny.Bains@Oracle.Com>
            branch nick: trunk
            timestamp: Sat 2012-05-26 09:32:52 +1000
            message:
              Bug#13641926 - INNODB ASSERTS: ERROR: A RECORD LOCK WAIT HAPPENS IN A DICTIONARY OPERATION!
              
              Reset the transaction DDL status on commit. Fix some existing bugs in online
              index creation code that relied on the the dict status being set across commit
              on the same transaction instance.
              
              rb://1094 Approved by Jimmy Yang.
            ------------------------------------------------------------
            revno: 3690.35.18
            committer: Mattias Jonsson <mattias.jonsson@oracle.com>
            branch nick: wl4305-reverted
            timestamp: Thu 2012-05-24 07:46:03 +0200
            message:
              bug#13838761
              Reverting InnoDB part of WL#4305, which caused the regression.
              
              rb 1089 approved by Jimmy
              
              No easy/small test case have yet been found,
              but I have verified that it does not crash after 30 min of sysqa
              test as it does without this patch.
            ------------------------------------------------------------
            revno: 3690.35.17
            committer: Mayank Prasad <mayank.prasad@oracle.com>
            branch nick: trunk
            timestamp: Fri 2012-05-25 19:17:42 +0530
            message:
              Bug #14117145     SPURIOUS TEST FAILURES, TEST PERFORMANCE_SCHEMA.CONNECTION
              
              Details:
               - There were continuous disconnect statements one after another,
                 without synchronization. That was causing race conditions.
              
              Fix:
               - Wait for each disconnect to finish explicitly and then do
                 further disconnect.
            ------------------------------------------------------------
            revno: 3690.35.16
            committer: Alfranio Correia <alfranio.correia@oracle.com>
            branch nick: mysql-trunk
            timestamp: Fri 2012-05-25 14:41:59 +0100
            message:
              The variable g_stage_name is defined and used in debugging builds
              but is not protected by any specific macro generating failures in
              regular builds where warning messages are transformed in errors.
              
              To fix the problem we protected the variable with DBUG_OFF.
            ------------------------------------------------------------
            revno: 3690.35.15
            committer: Jorgen Loland <jorgen.loland@oracle.com>
            branch nick: mysql-trunk-11752201
            timestamp: Fri 2012-05-25 15:00:50 +0200
            message:
              Bug#11752201: TABLE/INDEX SCAN WHEN QUOTING LARGE
                            NUMBERS IN AN 'IN' OF A SELECT (...)
              
              When the range optimizer constructs the SEL_ARG graph from the
              predicates, get_mm_leaf() will convert constant values to the 
              appropriate type so a field vs constant comparison can be done.
              This is done by calling Item::save_in_field_no_warning().
              
              If this conversion is not OK for some reason, get_mm_leaf() will
              conclude that the predicate is either always false or always
              true. Consider
              
              Q1: EXPLAIN SELECT * FROM t1 WHERE a > value;
               and
              Q2: EXPLAIN SELECT * FROM t1 WHERE a > 'value';
              
              where value is a number higher than the maximum value for int
              column a. In Q1, get_mm_leaf() finds that the predicate is always
              false. In Q2 on the other hand, get_mm_leaf() intreprets the
              conversion error from string to int incorrectly and assumes that
              the condition is always true to be on the safe side. Due to this,
              the range access method is not used for this query.
              
              Before this fix, get_mm_leaf() would only come to the 
              conclusion that the range was impossible if both the constant
              and the field had an INT type. With this bugfix, quoted numbers
              will be treated the same way.
            ------------------------------------------------------------
            revno: 3690.35.14
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk
            timestamp: Fri 2012-05-25 14:23:56 +0300
            message:
              In dict_stats_analyze_index_for_n_prefix() we could try to dive below
              the supremum in an edge case where the tree has changed in such a way
              that dive_below_idx is the index of the supremum record.
              
              Treat this as if the tree has shrunk a bit more - just quite the scan.
            ------------------------------------------------------------
            revno: 3690.35.13
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk
            timestamp: Fri 2012-05-25 11:27:16 +0300
            message:
              Use a dedicated trx in dict_stats_drop_index() instead of prebuilt->trx
              because prebuilt->trx is not committed and the following scenario causes
              a lock wait timeout:
              
              SET GLOBAL innodb_stats_persistent=1;
              
              CREATE TABLE t1 (i INT PRIMARY KEY) ENGINE=InnoDB;
              CREATE TABLE t2 (i INT, FOREIGN KEY (i) REFERENCES t1 (i)) ENGINE=InnoDB;
              CREATE INDEX ind2 ON t2(i);
              
              The CREATE INDEX command drops the implicitly added index "i" on t2 and
              tries to add a new index before committing the trx. So we end up with
              DELETE FROM mysql.innodb_index_stats dangling uncommitted and later
              INSERT/UPDATE in another trx by dict_stats_save() which causes lock wait
              timeout.
              
              With this change all code that deals with mysql.innodb_table_stats or
              mysql.innodb_index_stats creates a dedicated trx locally and commits it.
            ------------------------------------------------------------
            revno: 3690.35.12 [merge]
            committer: Mayank Prasad <mayank.prasad@oracle.com>
            branch nick: mysql-trunk
            timestamp: Fri 2012-05-25 16:44:08 +0530
            message:
              NUll merge: 5.5->trunk
                ------------------------------------------------------------
                revno: 2875.386.5
                committer: Mayank Prasad <mayank.prasad@oracle.com>
                branch nick: 5.5
                timestamp: Fri 2012-05-25 15:44:27 +0530
                message:
                  PB2 Failure Fix : Disabled the test case in correct manner.
                ------------------------------------------------------------
                revno: 2875.386.4
                committer: Mayank Prasad <mayank.prasad@oracle.com>
                branch nick: 5.5
                timestamp: Fri 2012-05-25 13:19:44 +0530
                message:
                  PB2 fix : Modified result file
                ------------------------------------------------------------
                revno: 2875.386.3
                committer: Mayank Prasad <mayank.prasad@oracle.com>
                branch nick: 5.5
                timestamp: Thu 2012-05-24 23:00:32 +0530
                message:
                  Bug#13417440 : 63340: ARCHIVE FILE IO NOT INSTRUMENTED
                        
                  Details:
                   - Archive storage engine file access were not instrumented and thus
                     were not shown in PS tables.
                        
                  Fix:
                   - Added instrumentation code by using PS Apis for I/O.
            ------------------------------------------------------------
            revno: 3690.35.11 [merge]
            committer: Inaam Rana <inaam.rana@oracle.com>
            branch nick: mysql-trunk
            timestamp: Fri 2012-05-25 07:03:03 -0400
            message:
              merge from 5.5
                ------------------------------------------------------------
                revno: 2875.386.2 [merge]
                committer: Inaam Rana <inaam.rana@oracle.com>
                branch nick: mysql-5.5
                timestamp: Thu 2012-05-24 12:44:27 -0400
                message:
                  merge from 5.1
                    ------------------------------------------------------------
                    revno: 2661.840.21
                    committer: Inaam Rana <inaam.rana@oracle.com>
                    branch nick: mysql-5.1
                    timestamp: Thu 2012-05-24 12:37:03 -0400
                    message:
                      Bug #14100254 65389: MVCC IS BROKEN WITH IMPLICIT LOCK
                      
                      rb://1088
                      approved by: Marko Makela
                      
                      This bug was introduced in early stages of plugin. We were not
                      checking for an implicit lock on sec index rec for trx_id that is
                      stamped on current version of the clust_index in case where the
                      clust_index has a previous delete marked version.
            ------------------------------------------------------------
            revno: 3690.35.10 [merge]
            committer: Alfranio Correia <alfranio.correia@oracle.com>
            branch nick: mysql-trunk
            timestamp: Fri 2012-05-25 11:51:43 +0100
            message:
              merge mysql-trunk-wl5223 --> mysql-trunk
                ------------------------------------------------------------
                revno: 3690.37.32
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Thu 2012-05-24 14:00:39 +0100
                message:
                  WL#5223 Fixed failures in platforms that provided no information on
                          LEVEL1_DCACHE_LINESIZE.
                  
                  Patch provided by Mats.
                ------------------------------------------------------------
                revno: 3690.37.31 [merge]
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Wed 2012-05-23 17:16:31 +0100
                message:
                  merge mysql-trunk --> mysql-trunk-wl5223
                ------------------------------------------------------------
                revno: 3690.37.30 [merge]
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Wed 2012-05-23 00:21:24 +0100
                message:
                  merge mysql-trunk --> mysql-trunk-wl5223
                ------------------------------------------------------------
                revno: 3690.37.29 [merge]
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-22 20:54:36 +0100
                message:
                  merge mysql-trunk --> mysql-trunk-wl5223
                ------------------------------------------------------------
                revno: 3690.37.28
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-22 20:51:27 +0100
                message:
                  Removed trace information from rpl_semi_sync.test
                ------------------------------------------------------------
                revno: 3690.37.27 [merge]
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-22 16:40:57 +0100
                message:
                  merge mysql-trunk --> mysql-trunk-wl5223
                ------------------------------------------------------------
                revno: 3690.37.26
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-22 16:35:38 +0100
                message:
                  Set trace in rpl_semi_sync.test
                ------------------------------------------------------------
                revno: 3690.37.25
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-22 15:03:56 +0100
                message:
                  Introduced some synchronization points that were missing in
                  the rpl_semi_sync.test.
                ------------------------------------------------------------
                revno: 3690.37.24
                committer: Serge Kozlov <serge.kozlov@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-22 13:37:37 +0200
                message:
                  WL#5223. Test case for BGC options
                ------------------------------------------------------------
                revno: 3690.37.23
                committer: Serge Kozlov <serge.kozlov@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-22 13:35:49 +0200
                message:
                  WL#5223. Test case for BGC options
                ------------------------------------------------------------
                revno: 3690.37.22
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Mon 2012-05-21 10:19:31 +0100
                message:
                  BUG#14094591 - SERVER CRASHED WITH --BINLOG-MAX-FLUSH-QUEUE-TIME=1
                  
                  If a timeout was set, wait_queue might never be updated thus
                  leading to an assertion failure, i.e. BUG_ASSERT(queue).
                  
                  To fix the problem, we make sure that wait_queue is never
                  null.
                ------------------------------------------------------------
                revno: 3690.37.21 [merge]
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Sun 2012-05-20 09:35:35 +0100
                message:
                  merge mysql-trunk --> mysql-trunk-wl5223
                ------------------------------------------------------------
                revno: 3690.37.20
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Fri 2012-05-18 16:11:30 +0100
                message:
                  WL#5223: Used std::pair as return type in function sync_binlog_file
                  as requested in the review process.
                ------------------------------------------------------------
                revno: 3690.37.19
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Thu 2012-05-17 23:48:04 +0100
                message:
                  Increased timeout in rpl_semi_sync.
                ------------------------------------------------------------
                revno: 3690.37.18
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Thu 2012-05-17 23:26:22 +0100
                message:
                  WL#5223:
                  
                  . Merged sync_binlog_file() and flush_and_sync() to avoid duplicated code.
                  
                  . Removed unused functions after the prepare_commit_mutex:
                    mysql_bin_log_file_name() and mysql_bin_log_file_pos().
                  
                  . Removed unused function remove_pending_rows_event().
                ------------------------------------------------------------
                revno: 3690.37.17 [merge]
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Thu 2012-05-17 13:51:37 +0100
                message:
                  merge mysql-trunk --> mysql-trunk-wl5223
                ------------------------------------------------------------
                revno: 3690.37.16
                committer: Alfranio Correia <alfranio.correia@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Thu 2012-05-17 12:07:55 +0100
                message:
                  WL#5223: Fixed result files.
                ------------------------------------------------------------
                revno: 3690.37.15 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Sat 2012-05-12 10:13:02 +0200
                message:
                  Merging with mysql-trunk-wl5223.
                    ------------------------------------------------------------
                    revno: 3690.40.9
                    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Thu 2012-05-10 11:47:31 +0100
                    message:
                      WL#5223: Binary Log Group Commit
                          
                      Added missing sys_vars.binlog_order_commits_basic and
                      sys_vars.innodb_flush_log_at_timeout_basic tests.
                    ------------------------------------------------------------
                    revno: 3690.40.8
                    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Wed 2012-05-09 20:40:23 +0100
                    message:
                      WL#5223: Binary Log Group Commit
                        
                      Added missing m_key_LOCK_sync_queue initialization on 
                      MYSQL_BIN_LOG:set_psi_keys().
                    ------------------------------------------------------------
                    revno: 3690.40.7
                    committer: Alfranio Correia <alfranio.correia@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Wed 2012-05-09 17:31:44 +0100
                    message:
                      The patch was developed in the context of the WL#5223 and aims at
                      postponing the write and flush while committing a transaction when
                      the binary log is enabled.
                    ------------------------------------------------------------
                    revno: 3690.40.6
                    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Wed 2012-05-09 16:23:08 +0100
                    message:
                      WL#5223: Binary Log Group Commit
                       
                      Refactored rpl_rewrt_db test file to wait until each session disconnect
                      ends and also for logged DROP event on master binlog.
                    ------------------------------------------------------------
                    revno: 3690.40.5
                    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Wed 2012-05-09 14:30:44 +0100
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      dml_setup_instruments result file only list 10 lines per query, I'm 
                      removing the 11th line.
                    ------------------------------------------------------------
                    revno: 3690.40.4
                    committer: Alfranio Correia <alfranio.correia@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Wed 2012-05-09 06:59:03 +0100
                    message:
                      Fixed result file for mysqld--help-win.test and configured
                      rpl_stm_mts_crash_safe as a big test.
                    ------------------------------------------------------------
                    revno: 3690.40.3 [merge]
                    committer: Alfranio Correia <alfranio.correia@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Tue 2012-05-08 22:29:29 +0100
                    message:
                      merge mysql-trunk --> mysql-trunk-wl5223
                      
                      conflicts:
                        Text conflict in sql/field.cc
                        Text conflict in sql/handler.cc
                        Text conflict in sql/mysqld.cc
                        Text conflict in sql/mysqld.h
                    ------------------------------------------------------------
                    revno: 3690.40.2
                    committer: Alfranio Correia <alfranio.correia@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Tue 2012-05-08 21:03:33 +0100
                    message:
                      Increased timeout for big tests.
                    ------------------------------------------------------------
                    revno: 3690.40.1
                    committer: Alfranio Correia <alfranio.correia@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Tue 2012-05-08 20:34:42 +0100
                    message:
                      Post-push fix for build on windows.
                ------------------------------------------------------------
                revno: 3690.37.14
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Sat 2012-05-12 10:11:10 +0200
                message:
                  WL#5223: Binary Log Group Commit
                  
                  Setting default of binlog-order-commits to TRUE, so handler commit calls are by
                  default issued in the same order as the transactions are written to the binary
                  log.
                ------------------------------------------------------------
                revno: 3690.37.13 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-08 20:18:29 +0200
                message:
                  Merging in mysql-trunk-wl5223
                    ------------------------------------------------------------
                    revno: 3690.39.1
                    committer: Alfranio Correia <alfranio.correia@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Tue 2012-05-08 11:57:04 +0100
                    message:
                      Fixed build on windows.
                      
                      The my_atomic_rwlock is ignored in some platforms but not in windows
                      where the build fails becuase the "LOCK_opt_binlog_max_flush_queue_time"
                      variable does not exist. "opt_binlog_max_flush_queue_time_lock" is the
                      correct name.
                ------------------------------------------------------------
                revno: 3690.37.12 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-08 20:16:27 +0200
                message:
                  Merging into mysql-trunk-wl5223.
                    ------------------------------------------------------------
                    revno: 3690.36.11
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Tue 2012-05-08 20:01:19 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      Fixes to code according to review comments.
                ------------------------------------------------------------
                revno: 3690.37.11
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-08 09:09:01 +0200
                message:
                  Re-enabling tests disabled by patches in mysql-trunk-wl5223.
                ------------------------------------------------------------
                revno: 3690.37.10 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Mon 2012-05-07 19:57:48 +0200
                message:
                  Merging with mysql-trunk-wl5223
                    ------------------------------------------------------------
                    revno: 3690.36.10
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Mon 2012-05-07 19:33:18 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      This patch add a variable where the user can choose
                      between running commits either in parallel or ordered
                      in sequence.
                            
                      When ordered, the transactions are committed in the same
                      order as the transactions are written to the binary log.
                      When committed in paralle, each thread execute an engine
                      commit independent of the other sessions.
                ------------------------------------------------------------
                revno: 3690.37.9 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Wed 2012-05-02 10:14:10 +0200
                message:
                  Merging with mysql-trunk-wl5223
                    ------------------------------------------------------------
                    revno: 3690.36.9
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Wed 2012-05-02 10:05:26 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      It is possible that a leader overtakes another leader
                      between stages since the stage lock is released before
                      the leader has registered for the next stage.
                      
                      This patch solves the problem by enrolling the session
                      for the next stage before releasing the stage lock. This
                      will allow new leader to enter completed stages, but not
                      allow leaders to overtake each others and instead merge
                      their queues.
                      
                      It also does some refactoring and change name of some
                      classes to fit what they actually do now.
                ------------------------------------------------------------
                revno: 3690.37.8 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-05-01 10:54:15 +0200
                message:
                  Merging into mysql-trunk-wl5223.
                    ------------------------------------------------------------
                    revno: 3690.36.8
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Tue 2012-05-01 10:51:40 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      Patch so that server builds without performance schema
                      storage engine.
                    ------------------------------------------------------------
                    revno: 3690.36.7
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Tue 2012-05-01 10:44:03 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      Patch to improve the number of transactions being written
                      at each sync by reading repeatedly from the queue for the
                      flush stage until it is empty or a timeout is reached.
                      
                      The patch adds the variable binlog-max-flush-queue-time
                      to configure the timeout.
                ------------------------------------------------------------
                revno: 3690.37.7 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Wed 2012-04-25 13:56:11 +0200
                message:
                  Merging into mysql-trunk-wl5223.
                    ------------------------------------------------------------
                    revno: 3690.36.6
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Wed 2012-04-25 13:53:57 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      - Adding missing file for extracting CPU information.
                      - Adding missing key name for COND_done.
                ------------------------------------------------------------
                revno: 3690.37.6 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Mon 2012-04-23 09:17:43 +0200
                message:
                  Merging in patches into mysql-trunk-wl5223
                    ------------------------------------------------------------
                    revno: 3690.36.5
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Mon 2012-04-23 09:09:59 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      This patch split the commit into several phases
                      to allow several threads to work in parallel on
                      committing transactions. Each phase is run by a
                      leader, which will execute a commit on behalf of
                      zero or more followers. If a leader catches up on
                      the preceeding phase, it will merge with that set
                      and allow the leader for that phase to run the
                      commits for itself and all its followers. The
                      intention is to allow the commit procedure to be
                      self-adapting, so that slow phases will accumulate
                      larger batches of commits to execute.
                      
                      The patch also extends the build files to gather
                      information about the CPU (specifically, the cache
                      line size).
                ------------------------------------------------------------
                revno: 3690.37.5 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Fri 2012-04-20 12:34:08 +0200
                message:
                  Merging into mysql-trunk-wl5223
                    ------------------------------------------------------------
                    revno: 3690.36.4
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Fri 2012-04-20 12:21:28 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      Patch to remove the last traces of the prepare_commit_mutex
                      from InnoDB code.
                      
                      This patch adds a function thd_binlog_pos that gives the file
                      and position for the transaction last written to the binary
                      log and uses that in innobase_commit.
                      
                      The old functions that were declared in InnoDB-specific files
                      are removed.
                ------------------------------------------------------------
                revno: 3690.37.4 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Fri 2012-04-13 10:10:42 +0200
                message:
                  Merging into mysql-trunk-wl5223.
                    ------------------------------------------------------------
                    revno: 3690.36.3
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Fri 2012-04-13 10:09:15 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      Split the group flush+commit into two phases, protecting each with a
                      separate mutex. This improve performance by allowing waiting threads to start
                      flushing the next batch of transactions while the previous thread handles the
                      commits.
                      
                      Change the threads excursion class by removing the use of
                      setup_connection_thread_globals introducing it's own "thread globals setup"
                      function. The old function is mainly intended to be used when setting up threads
                      and does a little more things than necessary.
                      
                      Avoid locking LOCK_log when checking if it is necessary to rotate
                      by fetching the information after the caches have been flushed but before releasing
                      LOCK_log. After the commit phase, a rotate will be executed if this check indicates
                      that a flush is necessary.
                      
                      Fix the performance schema keys by removing some old keys that are not used any more
                      and creating separate keys for the binary log, the relay log, and the other logs.
                      
                      Eliminate extreneous arguments to do_write_cache() and optimize lock use by avoiding
                      calls to ordered_commit() when there is nothing to log to the binary log.
                ------------------------------------------------------------
                revno: 3690.37.3 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-04-10 11:49:59 +0200
                message:
                  Merging with mysql-trunk-wl5223.
                    ------------------------------------------------------------
                    revno: 3690.38.2
                    committer: Alfranio Correia <alfranio.correia@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Tue 2012-04-10 10:38:07 +0100
                    message:
                      Removed -skip-test-list=collections/disabled-per-push.list from mysql-trunk-wl5223.push.
                    ------------------------------------------------------------
                    revno: 3690.38.1
                    committer: Alfranio Correia <alfranio.correia@oracle.com>
                    branch nick: mysql-trunk-wl5223
                    timestamp: Wed 2012-04-04 09:36:51 +0100
                    message:
                      Enabled big tests and tests that require row and statement format in
                      the WL5223's tree.
                ------------------------------------------------------------
                revno: 3690.37.2 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-04-10 11:48:23 +0200
                message:
                  Merging in WL#5223 patch.
                    ------------------------------------------------------------
                    revno: 3690.36.2
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Sat 2012-04-07 21:22:42 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      This is the main patch for implementing binary log group commit.
                      
                      It performs a group flush to the binary log by maintaining a queue
                      of pending (session) threads that want to write to the binary log
                      and flush and commit them in batches.
                      
                      This patch:
                      
                      Introduces a simple lock-based thread queue with two functions:
                      - Enqueue a thread
                      - Fetch and empty the complete queue.
                      
                      Introduces a class Thread_excursion to handle (session) thread excursions,
                      that is, attaching a POSIX thread temporarily to a session thread and
                      execute as if it was that session.
                      
                      Extends the binary log caches with a "finalize" function that is
                      used to finalize the cache by writing the final COMMIT or ROLLBACK. After
                      a cache is finalized, no new events can be written to it. To reset the flag,
                      it is necessary to either flush or truncate the cache.
                      
                      Introduce MYSQL_BIN_LOG::ordered_commit which is called from the function
                      MYSQL_BIN_LOG::commit and MYSQL_BIN_LOG::rollback to execute a ordered group
                      flush and commit.
                ------------------------------------------------------------
                revno: 3690.37.1 [merge]
                committer: Mats Kindahl <mats.kindahl@oracle.com>
                branch nick: mysql-trunk-wl5223
                timestamp: Tue 2012-04-03 19:37:54 +0200
                message:
                  Merging with mysql-trunk-wl5223.
                    ------------------------------------------------------------
                    revno: 3690.36.1
                    committer: Mats Kindahl <mats.kindahl@oracle.com>
                    branch nick: w5223-trunk
                    timestamp: Tue 2012-04-03 19:34:58 +0200
                    message:
                      WL#5223: Binary Log Group Commit
                      
                      This patch does some refactoring of the way transaction coordinators
                      and moves towards having the binary being a transaction coordinator
                      proper rather than a mix between a handlerton and a transaction
                      coordinator. This is done in preparation for the binary log group
                      commit.
                      
                      This is done by extending the TC_LOG class with two new methods, 
                      commit and rollback, and extending the handler functions with three
                      new functions, ha_commit_low, ha_rollback_low, and ha_prepare_low.
                      
                      The ha_*_low functions does the actual commit job towards the
                      handlertons and are used when the transaction should be prepared,
                      committed, or rolled back in the engines.
                      
                      When a transaction is committed (or rolled back), the transaction
                      coordinator is called and is expected to ensure that the
                      transaction is committed and then return. The basic transaction
                      coordinators just calls the ha_*_low function, but for more
                      advanced transaction coordinators a more complex job is done before
                      (and after) the ha_*_low.
                      
                      This patch:
                      
                      Removes the log_xid and unlog functions from the TC_LOG class
                      and add pure virtual functions TC_LOG::commit and TC_LOG::rollback.
                      
                      Change TC_LOG_DUMMY and TC_LOG_MMAP to implement the new interface.
                      
                      Moves the code in the binlog_commit into MYSQL_BIN_LOG::commit.
                      
                      Moves the code in binlog_rollback into MYSQL_BIN_LOG::rollback.
                      
                      Adds a class binlog_stmt_cache_data to represent the statement
                      cache.
                      
                      Moves several free functions related to the binary log caches
                      into the corresponding classes.
                      
                      Updates the trans_* function to use the new TC_LOG logic.
                      
                      Fixes some tests so that it can enable error triggers without
                      disabling trace output.
            ------------------------------------------------------------
            revno: 3690.35.9
            committer: Praveenkumar Hulakund <praveenkumar.hulakund@oracle.com>
            branch nick: trunk
            timestamp: Fri 2012-05-25 16:11:08 +0530
            message:
              BUG#13575199 - MySQL IS TRYING TO PERFORM A CONSISTENT READ
                             BUT THE READ VIEW IS NOT ASSIGNED
              
              Analysis:
              ---------------
              Thread 1 is calling function "my_tz_find" to get the time
              zone. And this function in turn calls function 
              "open_system_tables_for_read". At the same time, Thread 2
              kills the query getting executed in Thread 1. Open tables
              function, checks flag "thd->killed" and transaction is
              rolled back if "thd->killed" is set. But in function
              "evaluate_join_record" (caller of "my_tz_find"), the
              "thd->killed" state was not checked and OK was returned to caller.
              Execution of query continued without transaction and assert 
              is seen.
              
              Fix:
              ---------------
              Added a check in function "evaluate_join_record" to check the
              "thd->killed" flag status.
            ------------------------------------------------------------
            revno: 3690.35.8
            committer: Martin Hansson <martin.hansson@oracle.com>
            branch nick: mysql-trunk
            timestamp: Fri 2012-05-25 09:57:33 +0200
            message:
              Bug#14031825: SQL_ALLOC DOES NOT BELONG IN SQL_LIST.H
                    
              Moving Sql_alloc to its own header file: sql_alloc.h.
            ------------------------------------------------------------
            revno: 3690.35.7
            committer: Mayank Prasad <mayank.prasad@oracle.com>
            branch nick: trunk
            timestamp: Fri 2012-05-25 13:22:28 +0530
            message:
              PB2 fix : Modified result file.
            ------------------------------------------------------------
            revno: 3690.35.6 [merge]
            committer: Sujatha Sivakumar <sujatha.sivakumar@oracle.com>
            branch nick: Bug13833962_trunk
            timestamp: Fri 2012-05-25 11:05:54 +0530
            message:
              Null merge from 5.5 to 5.6
                ------------------------------------------------------------
                revno: 2875.386.1
                committer: Sujatha Sivakumar <sujatha.sivakumar@oracle.com>
                branch nick: Bug13833962_5.5
                timestamp: Thu 2012-05-24 16:25:07 +0530
                message:
                  Bug#13833962:DISABLE [NOTE] START BINLOG_DUMP TO SLAVE_SERVER(0) MESSAGES
                  IN THE ERROR LOG
                        
                  Problem:
                  Using mysqlbinlog with the --read-from-remote-server option as shown below
                  prints a message in error log for each call. This happens for 5.5 and above
                  versions
                        
                  mysqlbinlog -uroot -p --read-from-remote-server --host=localhost test
                        
                  Message in error log file is given below:
                  120312 10:27:57 [Note] Start binlog_dump to slave_server(0), pos(test, 4)
                        
                  The problem is that it can fill up the error log if the command is called
                  very often.
                        
                  Analysis:
                  The below mentioned print function is called from "mysql_binlog_send" function
                  which causes the "Start binlog_dump..." string to be printed in error log file.
                  
                  sql_print_information("Start binlog_dump to master_thread_id(%lu) 
                  slave_server(%d)..."
                        
                  Fix:
                  A condition has been added in such a way that the 'sql_print_information' 
                  will be invoked only when the "log_warnings" variable is set to >1 
                  otherwise don't call the 'sql_print_information' function.
            ------------------------------------------------------------
            revno: 3690.35.5
            committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
            branch nick: mysql-trunk
            timestamp: Fri 2012-05-25 10:56:41 +0530
            message:
              Little modification in syntax
            ------------------------------------------------------------
            revno: 3690.35.4 [merge]
            committer: Gleb Shchepa <gleb.shchepa@oracle.com>
            branch nick: trunk-wl6219
            timestamp: Fri 2012-05-25 08:50:38 +0400
            message:
              auto merge trunk --> local tree (WL6219)
                ------------------------------------------------------------
                revno: 3768.1.19
                committer: Sunny Bains <Sunny.Bains@Oracle.Com>
                branch nick: trunk
                timestamp: Fri 2012-05-25 11:02:00 +1000
                message:
                  Bug# 14112789 INNODB.INNODB-WL5522-ZIP,INNODB.INNODB-WL5522 FAILS ON PB2 SPORADICALLY.
                  
                  Change the tests to copy the files to a temporary directory instead of the
                  working directory. Otherwise during crash recovery testing, InnoDB attempts
                  to load the backed up file. That causes an "already exists" warning message
                  to be printed to the error log.
            ------------------------------------------------------------
            revno: 3690.35.3 [merge]
            committer: Gleb Shchepa <gleb.shchepa@oracle.com>
            branch nick: trunk-wl6219
            timestamp: Fri 2012-05-25 02:49:31 +0400
            message:
              manual merge trunk --> local tree (WL6219)
                ------------------------------------------------------------
                revno: 3768.1.18
                committer: Mayank Prasad <mayank.prasad@oracle.com>
                branch nick: jlt
                timestamp: Thu 2012-05-24 23:04:12 +0530
                message:
                  Bug#13417440 : 63340: ARCHIVE FILE IO NOT INSTRUMENTED
                  
                  Details:
                   - Archive storage engine file access were not instrumented and thus
                    were not shown in PS tables.
                              
                  Fix:
                   - Added instrumentation code by using PS Apis for I/O.
            ------------------------------------------------------------
            revno: 3690.35.2 [merge]
            committer: Gleb Shchepa <gleb.shchepa@oracle.com>
            branch nick: trunk-wl6219
            timestamp: Fri 2012-05-25 02:21:16 +0400
            message:
              manual merge trunk --> local tree (WL6219)
            ------------------------------------------------------------
            revno: 3690.35.1
            committer: Gleb Shchepa <gleb.shchepa@oracle.com>
            branch nick: trunk-wl6219
            timestamp: Thu 2012-04-26 11:14:36 +0400
            message:
              WL#6219: Deprecate and remove YEAR(2) type
              
              YEAR(2) is a subject to deprecation since it has ill design.
              The replacement is YEAR(4) or just "YEAR" type.
              
              * This patch forbids new YEAR(2) column creation:
                CREATE TABLE and ALTER TABLE create YEAR(4) instead.
              
              * For tables with YEAR(2) columns the CHECK TABLE ...
                FOR UPGRADE command returns:
              
                  "Table upgrade required.
                   Please do "REPAIR TABLE `...`" or dump/reload to fix it!"
              
                or
              
                  "Table rebuild required.
                   Please do "ALTER TABLE `...` FORCE" or dump/reload to fix it!"
              
              * For tables with YEAR(2) columns the "REPAIR TABLE" command
                calls "ALTER TABLE ... FORCE" where applicable.
              
              * From now any effective ALTER TABLE command application
                converts YEAR(2) columns to YEAR(4) columns.
        ------------------------------------------------------------
        revno: 3873.3.6 [merge]
        committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
        branch nick: mysql-trunk-wl5772-2
        timestamp: Fri 2012-05-25 00:02:43 +0400
        message:
          Merged recent changes from mysql-trunk into mysql-trunk-wl5772
          tree.
            ------------------------------------------------------------
            revno: 3768.1.17
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk
            timestamp: Thu 2012-05-24 20:13:07 +0300
            message:
              Followup to vasil.dimov@oracle.com-20120524151644-cjue8kej8g57izzq
              
              Remove variable which is only set and not used, causes a compilation
              warning in gcc 4.6 and newer.
            ------------------------------------------------------------
            revno: 3768.1.16
            committer: Vasil Dimov <vasil.dimov@oracle.com>
            branch nick: mysql-trunk
            timestamp: Thu 2012-05-24 18:16:44 +0300
            message:
              Extend the fix for Bug#13838962 STATISTICS CALCULATION SKIPS DELETE-MARKED
              RECORDS AND CAUSES ASSERTION FAILURE
              
              Counting all delete marked records brings too much nondeterminism because
              purge may or may not have wiped them away when table and index statistics
              are being gathered.
              
              Instead skip delete marked records only on the leaf pages - that is, behave
              as if they do not exist. Delete marks on records on non-leaf pages are
              nonsensical and should not be looked up at all - that is, behave as if
              the non-leaf records do not _contain_ a delete-marked bit.
            ------------------------------------------------------------
            revno: 3768.1.15
            committer: Nuno Carvalho <nuno.carvalho@oracle.com>
            branch nick: mysql-trunk
            timestamp: Thu 2012-05-24 14:33:48 +0100
            message:
              BUG#14021292 - 65152: MYSQL CAN'T START IF RELAY LOGS ARE REMOVED AND SKIP_SLAVE_START = 0
              
              Updated rpl.rpl_binlog_index to new slave start behaviour, when relay 
              log file name is changed directly on mysql.slave_relay_log_info table
              after a missing relay log file error a server restart is required.
            ------------------------------------------------------------
            revno: 3768.1.14
            committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
            branch nick: mysql-trunk
            timestamp: Thu 2012-05-24 13:53:05 +0100
            message:
              disabling variables-notembedded until Bug#13431369 is fixed on Windows
            ------------------------------------------------------------
            revno: 3768.1.13 [merge]
            committer: Sujatha Sivakumar <sujatha.sivakumar@oracle.com>
            branch nick: Bug13833962_trunk
            timestamp: Thu 2012-05-24 16:34:09 +0530
            message:
              Bug#13833962:DISABLE [NOTE] START BINLOG_DUMP TO SLAVE_SERVER(0) MESSAGES
              IN THE ERROR LOG
                          
              Problem:
              Using mysqlbinlog with the --read-from-remote-server option as shown below
              prints a message in error log for each call. This happens for 5.5 and above
              versions
                          
              mysqlbinlog -uroot -p --read-from-remote-server --host=localhost test
                          
              Message in error log file is given below:
              120312 10:27:57 [Note] Start binlog_dump to slave_server(0), pos(test, 4)
                          
              The problem is that it can fill up the error log if the command is called
              very often.
                          
              Analysis:
              The below mentioned print function is called from "mysql_binlog_send" function
              which causes the "Start binlog_dump..." string to be printed in error log file.
                    
              sql_print_information("Start binlog_dump to master_thread_id(%lu) 
              slave_server(%d)..."
                          
              Fix:
              A condition has been added in such a way that the 'sql_print_information' 
              will be invoked only when the "log_warnings" variable is set to >1 
              otherwise don't call the 'sql_print_information' function.
                ------------------------------------------------------------
                revno: 2875.376.59
                committer: Sujatha Sivakumar <sujatha.sivakumar@oracle.com>
                branch nick: Bug13833962_5.5
                timestamp: Thu 2012-05-24 15:14:43 +0530
                message:
                  Bug#13833962:DISABLE [NOTE] START BINLOG_DUMP TO SLAVE_SERVER(0) MESSAGES
                  IN THE ERROR LOG
                        
                  Problem:
                  Using mysqlbinlog with the --read-from-remote-server option as shown below
                  prints a message in error log for each call. This happens for 5.5 and above
                  versions
                        
                  mysqlbinlog -uroot -p --read-from-remote-server --host=localhost test
                        
                  Message in error log file is given below:
                  120312 10:27:57 [Note] Start binlog_dump to slave_server(0), pos(test, 4)
                        
                  The problem is that it can fill up the error log if the command is called
                  very often.
                        
                  Analysis:
                  The below mentioned print function is called from "mysql_binlog_send" function
                  which causes the "Start binlog_dump..." string to be printed in error log file.
                  
                  sql_print_information("Start binlog_dump to master_thread_id(%lu) 
                  slave_server(%d)..."
                        
                  Fix:
                  A condition has been added in such a way that the 'sql_print_information' 
                  will be invoked only when the "log_warnings" variable is set to >1 
                  otherwise don't call the 'sql_print_information' function.
            ------------------------------------------------------------
            revno: 3768.1.12
            committer: Sunny Bains <Sunny.Bains@Oracle.Com>
            branch nick: trunk
            timestamp: Thu 2012-05-24 20:45:40 +1000
            message:
              Bug#13641926 - INNODB ASSERTS: ERROR: A RECORD LOCK WAIT HAPPENS IN A DICTIONARY OPERATION!
                    
              Temporary revert of fix, it exposes a bug in onine index creation.
            ------------------------------------------------------------
            revno: 3768.1.11
            committer: Martin Hansson <martin.hansson@oracle.com>
            branch nick: mysql-trunk
            timestamp: Thu 2012-05-24 10:30:38 +0200
            message:
              Bug#13985071: DEPRECATE INSERT DELAYED
              
              Follow-up patch. The test script in create_recursive_construct.inc needed to be aware that deprecation messages don't show up when running with --ps-protocol. This is because deprecation warnings are suppressed in prepared statements.
            ------------------------------------------------------------
            revno: 3768.1.10
            committer: Sunny Bains <Sunny.Bains@Oracle.Com>
            branch nick: trunk
            timestamp: Thu 2012-05-24 18:23:23 +1000
            message:
              Bug#13641926 - INNODB ASSERTS: ERROR: A RECORD LOCK WAIT HAPPENS IN A DICTIONARY OPERATION!
              
              Reset the transaction's dict operation flag at transaction commit. Truncate
              and drop table use foreground transactions for DDL operations and therefore
              they can be reused. If we don't reset the flag then the next transaction that
              reused the trx_t instance will have the dict operation flag set.
              
              Approved by Jimmy Yang over IM.
            ------------------------------------------------------------
            revno: 3768.1.9
            committer: Sunny Bains <Sunny.Bains@Oracle.Com>
            branch nick: trunk
            timestamp: Thu 2012-05-24 15:57:32 +1000
            message:
              Fix warning introduced in the WL#5522 patch.
            ------------------------------------------------------------
            revno: 3768.1.8 [merge]
            committer: Christopher Powers <chris.powers@oracle.com>
            branch nick: mysql-trunk-bootstrap
            timestamp: Wed 2012-05-23 23:58:54 -0500
            message:
              local merge with mysql-trunk
                ------------------------------------------------------------
                revno: 3768.2.2
                committer: Sunny Bains <Sunny.Bains@Oracle.Com>
                branch nick: trunk
                timestamp: Thu 2012-05-24 14:48:16 +1000
                message:
                  Rename tests.
                ------------------------------------------------------------
                revno: 3768.2.1
                committer: Sunny Bains <Sunny.Bains@Oracle.Com>
                branch nick: trunk
                timestamp: Thu 2012-05-24 14:29:43 +1000
                message:
                  Bug#14108709 - WITH READ ONLY TRANSACTION AND XA ROLLBACK: FAILING ASSERTION: !(TRX)->READ_ONLY
                  
                  XA transactions can be read only, they can't be auto-commit.
                  
                  rb://1090 Approved by Jimmy Yang.
            ------------------------------------------------------------
            revno: 3768.1.7
            committer: Christopher Powers <chris.powers@oracle.com>
            branch nick: mysql-trunk-bootstrap
            timestamp: Wed 2012-05-23 23:38:03 -0500
            message:
              Bug#11766342 INITIAL DB CREATION FAILS ON WINDOWS WITH AN ASSERT IN SQL_ERROR.CC
                
              Fixed build break due to compiler warning
            ------------------------------------------------------------
            revno: 3768.1.6 [merge]
            committer: Christopher Powers <chris.powers@oracle.com>
            branch nick: mysql-trunk-bootstrap
            timestamp: Wed 2012-05-23 20:37:13 -0500
            message:
              local merge from mysql-trunk
                ------------------------------------------------------------
                revno: 3876.1.11
                committer: Sunny Bains <Sunny.Bains@Oracle.Com>
                branch nick: trunk
                timestamp: Thu 2012-05-24 09:01:45 +1000
                message:
                  Fix comment. Non-functional change.
            ------------------------------------------------------------
            revno: 3768.1.5 [merge]
            committer: Christopher Powers <chris.powers@oracle.com>
            branch nick: mysql-trunk-bootstrap
            timestamp: Wed 2012-05-23 15:18:54 -0500
            message:
              local merge from mysql-trunk
                ------------------------------------------------------------
                revno: 3876.1.10
                committer: Mayank Prasad <mayank.prasad@oracle.com>
                branch nick: trunk
                timestamp: Thu 2012-05-24 21:31:28 +0530
                message:
                  Bug#14069132 : STATEMENT DIGESTS DUPLICATE CALL STATEMENTS OF THE SAME NORMALIZED FORM
                        
                  Issue:
                    During parsing of a call statement, tokens from sub statements were 
                    getting considered as well because of which tokens collection of 
                    'call statement' was getting affected. So, due to these extra unwanted 
                    tokens, digest generated for call statement, was different from the 
                    further calls of same call statement where sub statements were not 
                    parsed again.
                        
                  Resolution:
                    Restrict collection of token for only top-level statement. i.e. no 
                    instrumentation for sub-statements.
                ------------------------------------------------------------
                revno: 3876.1.9
                committer: Guilhem Bichot <guilhem.bichot@oracle.com>
                branch nick: nested_loop_no_more_rows2
                timestamp: Wed 2012-05-23 17:13:27 +0200
                message:
                  Rename trigcond_if() to <if>(), it should be clearer
                  for users who read EXPLAIN EXTENDED: triggered conditions
                  work like the familiar IF() SQL function.
                  <if>() is surrounded with <> to distinguish from
                  the if() SQL function, to emphasize that this is optimizer-
                  generated. Like Item_func_not_all is '<not>' and
                  the SQL NOT in 'not'.
                ------------------------------------------------------------
                revno: 3876.1.8
                committer: Olav Sandstaa <olav.sandstaa@oracle.com>
                branch nick: range-revert
                timestamp: Wed 2012-05-23 15:28:41 +0200
                message:
                  Fix for Bug#13810048 INCORRECT JOIN ORDER USED DUE TO INCORRECT 
                                       COST CALCULATIONS
                  
                  The problem is that we fail to select the best join order for a two
                  table join. The cause for the wrong join order is that
                  best_access_path() selects the wrong index to use for the join. The
                  selected index has much higher record and cost estimate than the best
                  index. Because of the high index cost, the estimated cost of the optimal
                  join order became very high, and another, less optimal, join order was
                  selected.
                  
                  Assume best_access_path() can select among the following indexes:
                  
                    (a, d)
                    (b)
                    (b, c)
                  
                  and that the select condition is:
                  
                    a=1 AND b = 1 AND c <> 3
                  
                  The current code in best_access_path() will compute record and cost
                  estimates for each of these. What causes the bug to happen is an
                  heuristic introduced as a fix for Bug#26106. This heuristic was
                  introduced to ensure that when considering the index (b, c) this
                  should be selected based on that this index has a quick select object
                  and this quick select object is able to use more parts of the index
                  than the other alternative indexes. The code that does this is:
                  
                    /* 
                      Fix for the case where the index statistics is too
                      optimistic: If 
                      (1) We're considering ref(const) and there is quick select
                          on the same index, 
                      (2) and that quick select uses more keyparts (i.e. it will
                          scan equal/smaller interval then this ref(const))
                      (3) and E(#rows) for quick select is higher then our
                          estimate,
                          Then 
                            We'll use E(#rows) from quick select.
                  
                      Q: Why do we choose to use 'ref'? Won't quick select be
                      cheaper in some cases ?
                      TODO: figure this out and adjust the plan choice if needed.
                    */
                    if (!found_ref && table->quick_keys.is_set(key) &&    // (1)
                        table->quick_key_parts[key] > max_key_part &&     // (2)
                        records < (double)table->quick_rows[key])         // (3)
                    {
                      records= quick_records= (double)table->quick_rows[key];
                      quick_matches_more_parts= true;                  
                    }
                  
                  Setting quick_matches_more_parts to true will ensure that this index is
                  select even if it has a much higher cost than the currently best
                  index. The (a, d) and (b) index can only use the first part of the index
                  while (b, c) can use two parts of the index. So the code will select
                  to use (b, c) without considering the cost of using (a, d) or
                  (b). This is wrong, since the (a, d) index might select a lot fewer
                  records even using only the first part of the index.
                  
                  The goal of the fix for Bug#26106 was to solve the cases where we
                  "wrongly" selected to use (b) instead of (b, c). Using (b, c) should
                  always be equal or less costly than using (b) since it will produce
                  fewer (or the same) number of records (if we ignore that it is more
                  costly to use an index with more columns.).
                  
                  The fix for this problem is to revert the patch for Bug#26106. This
                  will re-introduce the "bug" that we can select to use an index with
                  with few fields (e.g. (b)) when there is another index, (e.g. (b, c))
                  that can use more parts of the index and thus will produce the same or
                  fewer records. The argument for allowing this is that this situation
                  should only occur when the record and cost estimates for these two
                  indexes are very close and thus the cost of using either of these are
                  almost similar. Basically, by reverting the patch we return to let the
                  choice of using (b) or (b, c) be cost based instead of based on an
                  extra heuristic.
                  
                  The assumption is that this can now only happen when the real cost of using
                  (b) or (b, c) is similar. If this assumption is wrong then we need to
                  first understand why we choose the wrong index or why the cost numbers
                  are wrong before making an alternative fix. This might either be to
                  fix the cost numbers or implement a better version of the heuristic to
                  always select the index that can use most parts of the index when
                  another index with a common prefix is the best index based on cost
                  estimates.
                ------------------------------------------------------------
                revno: 3876.1.7 [merge]
                committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
                branch nick: mysql-trunk-wl6311
                timestamp: Wed 2012-05-23 13:20:06 +0200
                message:
                  WL#6311 Remove --safe-mode
                  
                  Null merge 5.5->trunk
                    ------------------------------------------------------------
                    revno: 2875.376.58
                    committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
                    branch nick: mysql-5.5-wl6311
                    timestamp: Wed 2012-05-23 12:27:32 +0200
                    message:
                      WL#6311 Remove --safe-mode
                      
                      Print deprecation warning if the --safe-mode command line option is
                      used.
                ------------------------------------------------------------
                revno: 3876.1.6
                committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
                branch nick: mysql-trunk-wl6311
                timestamp: Wed 2012-05-23 12:37:22 +0200
                message:
                  WL#6311 Remove --safe-mode
                  
                  Remove the --safe-mode command line option. An error message about an
                  invalid command line option will be printed if mysqld is started with
                  this option.
                  
                  Also removes the SPECIAL_SAFE_MODE flag and all tests for it.
                ------------------------------------------------------------
                revno: 3876.1.5
                committer: Marko M?kel? <marko.makela@oracle.com>
                branch nick: mysql-trunk
                timestamp: Wed 2012-05-23 13:06:12 +0300
                message:
                  Fix errors after WL#5522 merge.
                ------------------------------------------------------------
                revno: 3876.1.4
                committer: Guilhem Bichot <guilhem.bichot@oracle.com>
                branch nick: nested_loop_no_more_rows2
                timestamp: Wed 2012-05-23 11:12:49 +0200
                message:
                  A small refactoring:
                  eliminate NESTED_LOOP_NO_MORE_ROWS; this enum value was unneeded
                  in most cases, and having too many enum values poses the problem
                  of handling them properly in all tests. Lots of if()s get simpler.
                ------------------------------------------------------------
                revno: 3876.1.3
                committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                branch nick: mysql-trunk
                timestamp: Wed 2012-05-23 10:45:42 +0100
                message:
                  Force server restart before run perfschema.relaylog test, it depends on
                  the number of binary and relay logs.
                ------------------------------------------------------------
                revno: 3876.1.2 [merge]
                committer: Marc Alff <marc.alff@oracle.com>
                branch nick: mysql-trunk
                timestamp: Wed 2012-05-23 11:25:42 +0200
                message:
                  Merge mysql-5.5 --> mysql-trunk
                    ------------------------------------------------------------
                    revno: 2875.376.57
                    committer: Marc Alff <marc.alff@oracle.com>
                    branch nick: mysql-5.5
                    timestamp: Wed 2012-05-23 10:21:35 +0200
                    message:
                      Improved the test performance_schema.func_file_io,
                      so that investigating test failures is easier.
                      
                      Detect cases when @before_count / @after_count is NULL.
                ------------------------------------------------------------
                revno: 3876.1.1
                committer: Sunny Bains <Sunny.Bains@Oracle.Com>
                branch nick: trunk
                timestamp: Wed 2012-05-23 17:14:09 +1000
                message:
                  Revert default.conf that was mistakenly updated during the merge of WL5522.
            ------------------------------------------------------------
            revno: 3768.1.4 [merge]
            committer: Christopher Powers <chris.powers@oracle.com>
            branch nick: mysql-trunk-bootstrap
            timestamp: Tue 2012-05-22 13:05:25 -0500
            message:
              local merge from mysql-trunk
            ------------------------------------------------------------
            revno: 3768.1.3 [merge]
            committer: Christopher Powers <chris.powers@oracle.com>
            branch nick: mysql-trunk-bootstrap
            timestamp: Tue 2012-05-22 12:10:05 -0500
            message:
              local merge from mysql-trunk
            ------------------------------------------------------------
            revno: 3768.1.2 [merge]
            committer: Christopher Powers <chris.powers@oracle.com>
            branch nick: mysql-trunk-bootstrap
            timestamp: Tue 2012-05-22 12:08:45 -0500
            message:
              local merge
            ------------------------------------------------------------
            revno: 3768.1.1
            committer: Christopher Powers <chris.powers@oracle.com>
            branch nick: mysql-trunk
            timestamp: Wed 2012-05-02 22:16:40 -0500
            message:
              Bug#11766342 INITIAL DB CREATION FAILS ON WINDOWS WITH AN ASSERT IN SQL_ERROR.CC
              
              Improved bootstrap error handling:
              - Detect and report file i/o errors
              - Report query size errors with nearest query text
        ------------------------------------------------------------
        revno: 3873.3.5
        committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
        branch nick: mysql-trunk-wl5772-2
        timestamp: Thu 2012-05-24 22:58:39 +0400
        message:
          WL#5772 "Add partitioned Table Definition Cache to avoid using
          LOCK_open and its derivatives in DML queries".
          
          Follow-up patch that fixes failures of table_cache unit test
          in non-debug builds:
           - Ensured that EXPECT_DEATH checks which rely on SAFE_MUTEX
             asserts are done only when SAFE_MUTEX is defined.
           - Ensured that EXPECT_DEATH checks which rely on debug asserts
             are carried out only in debug builds.
           - Added DeathTest suffix to tests expecting death, as per
             GoogleTest documentation.
        ------------------------------------------------------------
        revno: 3873.3.4
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: trunk-wl5772
        timestamp: Thu 2012-05-24 14:46:29 +0200
        message:
          WL#5772 Add partitioned Table Definition Cache
          
          Cleanup unit test linking.
          Some portability fixes for solaris and windows.
        ------------------------------------------------------------
        revno: 3873.3.3
        committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
        branch nick: mysql-trunk-wl5772-2
        timestamp: Wed 2012-05-23 23:23:08 +0400
        message:
          WL#5772 "Add partitioned Table Definition Cache to avoid using
          LOCK_open and its derivatives in DML queries".
          
          Follow-up patch #2: Added unit tests for Table_cache,
          Table_cache_manager and Table_cache_iterator classes.
        ------------------------------------------------------------
        revno: 3873.3.2
        committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
        branch nick: mysql-trunk-wl5772-1
        timestamp: Tue 2012-05-22 14:41:38 +0400
        message:
          WL#5772 "Add partitioned Table Definition Cache to avoid using
          LOCK_open and its derivatives in DML queries".
          
          Follow-up patch #1:
          - Move definition of Table_cache, Table_cache_manager and
            Table_cache_iterator classes and their methods to a separate
            files - table_cache.h and table_cache.cc.
          - Made methods of Table_cache_iterator inline.
        ------------------------------------------------------------
        revno: 3873.3.1
        committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
        branch nick: mysql-trunk-wl5772
        timestamp: Mon 2012-05-21 21:56:02 +0400
        message:
          WL#5772 "Add partitioned Table Definition Cache to avoid using
          LOCK_open and its derivatives in DML queries".
          
          Re-introduced table cache - a separate cache holding TABLE objects
          ready for use by statements protected by its own mutex. In the most
          common case a connection opening/closing a table only needs to go
          to this cache for getting/releasing TABLE object and do not need
          to go to the table definition cache. By having several instances of
          such cache (each protected by its own lock) and partitioning
          user connections between these instances (based on connection id)
          we can greatly improve scalability in some scenarios.
          
          Added new start-up parameter --table_open_cache_instances for
          setting number of table cache instances in the system.
          
          Existing --table_open_cache parameter now limits total number of
          TABLE object in all table cache instances combined.
          
          Added Table_open_cache_hits, Table_open_cache_misses,
          Table_open_cache_overflows - per-connection and global status
          variables for tracking and tuning performance of new cache.
          (The latter allows to track how often we have to expel tables
          from the cache since the table cache instance contains more
          than table_open_cache/table_open_cache_instances objects.)
    ------------------------------------------------------------
    revno: 3690.34.3
    committer: Sergey Glukhov <sergey.glukhov@oracle.com>
    branch nick: mysql-trunk-wl6098
    timestamp: Tue 2012-05-22 11:20:04 +0400
    message:
      merge fix
    ------------------------------------------------------------
    revno: 3690.34.2 [merge]
    committer: Sergey Glukhov <sergey.glukhov@oracle.com>
    branch nick: mysql-trunk-wl6098
    timestamp: Tue 2012-05-22 11:02:35 +0400
    message:
      automerge
    ------------------------------------------------------------
    revno: 3690.34.1
    committer: Sergey Glukhov <sergey.glukhov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-04-18 14:58:30 +0400
    message:
      WL#6098 Eliminate GROUP_CONCAT intermediate result limitation.
------------------------------------------------------------
revno: 3884
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Thu 2012-06-07 11:16:17 +0400
message:
  WL#6216 - Changes to Server defaults in 5.6
  
  Adjusted test cases according to reviews.
  Applied a patch provided by InnoDB to fix DROP TEMPORARY TABLE
  timeouts on Windows.
------------------------------------------------------------
revno: 3883
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Fri 2012-06-01 22:42:39 +0400
message:
  WL#6216 - Changes to Server defaults in 5.6
  
  Fixed failures detected by PB2.
------------------------------------------------------------
revno: 3882
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Fri 2012-06-01 11:34:26 +0400
message:
  WL#6216 - Changes to Server defaults in 5.6
  
  General changes: back_log, flush_time, join_buffer_size,
  max_allowed_packet, max_connect_errors, sql_mode.
------------------------------------------------------------
revno: 3881
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Wed 2012-05-30 15:37:38 +0400
message:
  WL#6216 - Changes to Server defaults in 5.6
  
  Adjusted suppression in innodb_bug-13628249.
  Fixed uninitialized variable warning in binlog.
------------------------------------------------------------
revno: 3880
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Wed 2012-05-30 11:25:30 +0400
message:
  WL#6216 - Changes to Server defaults in 5.6
  
  Fixed parts.partition_alter3_innodb, parts.partition_basic_innodb.
------------------------------------------------------------
revno: 3879
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Tue 2012-05-29 10:44:58 +0400
message:
  WL#6216 - Changes to Server defaults in 5.6
  
  InnoDB changes.
------------------------------------------------------------
revno: 3878
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Mon 2012-05-28 10:33:52 +0400
message:
  WL#6216 - Changes to Server defaults in 5.6
  
  Fix for mysqlbinlog_row tests failures.
------------------------------------------------------------
revno: 3877
committer: Sergey Vojtovich <sergey.vojtovich@oracle.com>
branch nick: mysql-trunk-wl6216
timestamp: Wed 2012-05-23 17:19:33 +0400
message:
  WL#6216 - Changes to Server defaults in 5.6
  
  Replication and binlog changes.
------------------------------------------------------------
revno: 3876 [merge]
committer: Gleb Shchepa <gleb.shchepa@oracle.com>
branch nick: trunk-wl6242
timestamp: Wed 2012-05-23 09:02:04 +0400
message:
  manual merge from trunk to local tree (for WL6242)
    ------------------------------------------------------------
    revno: 3873.1.31 [merge]
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-23 10:14:54 +0530
    message:
      Merge from mysql-5.5 to mysql-trunk. 
        ------------------------------------------------------------
        revno: 2875.376.56
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-5.5
        timestamp: Wed 2012-05-23 10:12:52 +0530
        message:
          After the fix for Bug #12752572, there is a pb2 failure.  Fixing it by
          updating the result file.  Because a multi-row insert now reserves the
          auto increment values before hand, if any explicitly specified auto
          increment values are there, then some of the reserved values are lost.
    ------------------------------------------------------------
    revno: 3873.1.30 [merge]
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Wed 2012-05-23 11:09:47 +1000
    message:
      WL#5522 - InnoDB: transportable tablespaces
      
      Allow users to 'cold' export a table from a running MySQL server instance to
      another running instance. It can also be used to do a full table restore on the
      same instance.
      
      No rb entry, See WL for approvals.
        ------------------------------------------------------------
        revno: 3402.86.517
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-05-23 11:02:07 +1000
        message:
          WL#5522 - Fix comments, add a debug assertion.
        ------------------------------------------------------------
        revno: 3402.86.516 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-05-23 10:31:12 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
          
          Fixed sql/handler.h conflicts
        ------------------------------------------------------------
        revno: 3402.86.515
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-22 19:37:17 +1000
        message:
          WL#5522 - Update MTR suppression text.
        ------------------------------------------------------------
        revno: 3402.86.514 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-22 17:52:51 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.513 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-22 07:27:12 +1000
        message:
          WL#5522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.512 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-05-21 13:33:57 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.511 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-05-19 08:13:05 +1000
        message:
          WL#5522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.510
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-18 21:21:55 +1000
        message:
          WL#5522 - Force a delete of .ibd and generated files if the tablespace is
          missing or discarded. The .ibd file can be lying around if a .ibd to .ibt
          rename failed.
        ------------------------------------------------------------
        revno: 3402.86.509 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-18 16:53:09 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.508
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-18 07:23:26 +1000
        message:
          WL#5522 - Update test result file.
        ------------------------------------------------------------
        revno: 3402.86.507 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-18 06:46:57 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.506
        committer: Vinay Fisrekar <vinay.fisrekar@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Thu 2012-05-17 19:58:43 +0530
        message:
          Adding new test for wl5522 - tests created bu converting JET cases
        ------------------------------------------------------------
        revno: 3402.86.505
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-05-17 19:56:06 +1000
        message:
          WL#5522 - BUG#14084530 - WL5522 - ASSERT FAILURE IN BTR0CUR.CC:916 DURING IMPORT TABLESPACE
          
          Stamp the index id on the index pages even if they are empty.
        ------------------------------------------------------------
        revno: 3402.86.504
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-05-17 09:08:16 +1000
        message:
          WL#5522 - Fix code after merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.503 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-05-17 08:55:20 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.502
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-05-16 16:10:55 +1000
        message:
          WL#5522 - Fix formatting.
        ------------------------------------------------------------
        revno: 3402.86.501
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-05-16 16:10:06 +1000
        message:
          WL#5522 Update comment about free page handling in the tablespace.
        ------------------------------------------------------------
        revno: 3402.86.500
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-05-16 11:43:42 +1000
        message:
          WL#5522 - Add debug instrumentation to track where the transaction was
          started from. 
        ------------------------------------------------------------
        revno: 3402.86.499
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-05-16 11:22:20 +1000
        message:
          WL#5522 - Fix format of error messages.
        ------------------------------------------------------------
        revno: 3402.86.498
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-05-16 11:09:52 +1000
        message:
          WL#5522 - Remove redundant variable, we can get the number of transactions
          created for MySQL by looking at the trx_sys_t::mysql_trx_list length.
        ------------------------------------------------------------
        revno: 3402.86.497 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-05-16 08:18:32 +1000
        message:
          WL#5522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.496
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-15 13:57:14 +1000
        message:
          WL#5522 - Get rid STL map. Problems on SunStudio and its STLport.
        ------------------------------------------------------------
        revno: 3402.86.495
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-15 13:49:03 +1000
        message:
          WL#5522 - Update test result due to error number reordering.
        ------------------------------------------------------------
        revno: 3402.86.494
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-15 10:26:19 +1000
        message:
          WL#5522 - Fix assertion, sum_sizes will always be greater than 0 if the function
          ibuf_get_merge_pages() was called.
        ------------------------------------------------------------
        revno: 3402.86.493
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-15 10:24:47 +1000
        message:
          WL#5522 - Include <map> after univ.i but before sync0sync.h. SunStudio has an
          STLPort version that uses the same function names as InnoDB's mutexes.
        ------------------------------------------------------------
        revno: 3402.86.492
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-15 10:23:06 +1000
        message:
          WL#5522 - Fix test results after the error (re)numbering change.
        ------------------------------------------------------------
        revno: 3402.86.491
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-15 09:10:53 +1000
        message:
          WL#5522 - Include the C++ STL std::map file before the InnoDB files.
        ------------------------------------------------------------
        revno: 3402.86.490
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-15 09:07:02 +1000
        message:
          WL#5522 - Reorder the error messages so tht WL#5522 messages are last.
        ------------------------------------------------------------
        revno: 3402.86.489 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-15 07:43:25 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.488
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-05-14 20:57:09 +1000
        message:
          WL#5522 - If an index id can't be mapped to any known index then we assume that
          the page belongs to an index that has been freed.
        ------------------------------------------------------------
        revno: 3402.86.487
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-05-14 20:55:43 +1000
        message:
          WL#5522 - Ignore empty index pages. They could be free and if they are empty
          then there is nothing to do.
        ------------------------------------------------------------
        revno: 3402.86.486
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-05-14 15:47:17 +1000
        message:
          WL#5522 - Ensure that a page doesn't become empty during the IMPORT phase
          purge. Force a second phase purge.
        ------------------------------------------------------------
        revno: 3402.86.485 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-05-14 10:53:44 +1000
        message:
          WL#522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.484
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-05-14 10:24:46 +1000
        message:
          WL#5522 - Factor out buf_flush_update_zip_checksum() from
          buf_flush_init_for_writing() so that we can calculate and update the
          checksum (and LSN) on non-index compressed pages without copying to
          and from the raw data. Call the function explicitly after making the
          changes necessary for IMPORT. Without this change we end up copying data
          first to the block->frame, doing the updates and then copying back to
          the buffer that will be written to disk, very inefficient way of doing
          things. We only do this double copy for compressed index pages now,
          because we cannot work on them without decompressing them and we can't
          avoid that.
        ------------------------------------------------------------
        revno: 3402.86.483
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-05-14 07:37:11 +1000
        message:
          WL#5522 - Return DB_CORRUPTION if page type is unknown.
        ------------------------------------------------------------
        revno: 3402.86.482
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-05-13 20:18:01 +1000
        message:
          WL#5522 - Fix the IMPORT tablespace performance.
          
          1. Get rid of the old code that tired to reuse the CHECK TABLE code.
          
          2. Do the space id, max trx id, LSN, light weight purge and BLOB ref
             space id update in the first pass.
          
          3. If some records couldn't be purged because purge requires tree modifications
             then we do another pass over all the indexes.
        ------------------------------------------------------------
        revno: 3402.86.481
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-11 08:45:15 +1000
        message:
          WL#5522 - Make the code const correct. Main change is to make the dict_index_t*
          parameter const where it is used as a const. Make the mini-transaction pointer
          optional for  mtr_log_write_ulint() and mtr_log_write_ull().
          
          These changes are required for the single pass IMPORT to work.
        ------------------------------------------------------------
        revno: 3402.86.480 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-11 07:05:11 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.479
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-05-10 10:48:12 +1000
        message:
          WL#5522 - Flush the pages to disk before updating the DISCARDED flag and making
          any data dictionary changes. This is because we don't generate REDO, thefore
          changes cannot be recovered after a crash.
        ------------------------------------------------------------
        revno: 3402.86.478
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-05-10 10:11:17 +1000
        message:
          WL#5522 - Set the error before discarding the changes.
        ------------------------------------------------------------
        revno: 3402.86.477 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-05-10 05:32:57 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.476
        committer: Vinay Fisrekar <vinay.fisrekar@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-05-09 18:41:11 +0530
        message:
          Adding schema mismatch (differ in KEY_BLOCK_SIZE) between import and export table definition.
        ------------------------------------------------------------
        revno: 3402.86.475
        committer: Vinay Fisrekar <vinay.fisrekar@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-05-09 18:16:57 +0530
        message:
          Adding compressed table tests for transportable tablespace
          Created from existing tests innodb-wl5522 , innodb-wl5522-debug. 
          (Changed create table definition to have compressed tables)
        ------------------------------------------------------------
        revno: 3402.86.474
        committer: Vinay Fisrekar <vinay.fisrekar@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-05-09 10:33:28 +0530
        message:
          Changing test to Use "FLUSH TABLE .. FOR EXPORT" instead of "FLUSH TABLE ..WITH READ LOCK".
          Added some cleaup statement to able to run test with chtest.
        ------------------------------------------------------------
        revno: 3402.86.473
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-05-09 12:55:19 +1000
        message:
          WL#5522 - Add the exporting instance index id to the .cfg file. It will be
          required when we do an IMPORT in a single pass over the tablespace file.
        ------------------------------------------------------------
        revno: 3402.86.472 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-05-09 06:54:34 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.471
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-08 21:03:21 +1000
        message:
          WL#5522 - Fix formatting.
        ------------------------------------------------------------
        revno: 3402.86.470
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-08 20:52:57 +1000
        message:
          WL#5522 - Reset the state of all tables in the FLUSH TABLES list not just
          the first one. Change the boolean flag to a counter. Increment it each time
          we add a table to the flush queue and decrement it each time we complete
          or abort the flush (on F_UNLCK).
        ------------------------------------------------------------
        revno: 3402.86.469
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-08 18:52:52 +1000
        message:
          WL#5522 - Make the check for end of flush generic. Add a flag to trx_t that
          is set when the FLUSH TABLES ... is started. We check this flag and unset it
          when a FLUSH TABLES completes or aborts. It can be aborted by starting
          a new transaction in the middle. The trx_t instance is like an InnoDB
          session variable in this context.
          
            FLUSH TABLES t ...;
            START TRANSACTION; <- This will implicitly abort the FLUSH TABLES;
        ------------------------------------------------------------
        revno: 3402.86.468 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-08 18:26:59 +1000
        message:
          WL#5522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.467
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-08 18:25:16 +1000
        message:
          WL#5522 - Remove useless code.
        ------------------------------------------------------------
        revno: 3402.86.466 [merge]
        committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Tue 2012-05-08 10:03:18 +0200
        message:
          Merge of WL#6168 and WL#6169 from 
          mysql-trunk-wl6168 to mysql-trunk-wl5522.
          No conflicts.
            ------------------------------------------------------------
            revno: 3690.33.5
            committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
            branch nick: mysql-trunk-wl6168
            timestamp: Tue 2012-05-08 08:26:36 +0200
            message:
              WL#6169 FLUSH TABLES ... FOR EXPORT -- runtime
              
              This worklog adds the runtime side for the new FOR EXPORT
              option for FLUSH TABLES <table_list>.
              
              The FLUSH TABLES <table_list> FOR EXPORT statement:
              - Acquires MDL_SHARED_NO_WRITE metadata lock on the tables
                listed in <table_list>. The effect is that FLUSH TABLES
                <table_list> FOR EXPORT will block until all active
                transactions that have updated any table in <table_list>
                have completed. While FLUSH TABLES <table_list> FOR EXPORT
                is in effect, no new updating transactions and no DDL
                statements are allowed. Read-only transactions will not be
                affected.
              - Enters LOCK TABLES mode so that locks are held until
                the UNLOCK TABLES statement is executed.
              - Notifies the storage engine by calling handler::extra()
                using the new flag HA_EXTRA_EXPORT. This allows the storage
                engine to perform any steps needed to make the table ready
                for export (e.g. quiesce the table and write metadata file).
              
              The worklog also adds a new ha_table_flags() flag:
              HA_CAN_EXPORT_TABLESPACE. This flags indicates that a given
              storage engine support FLUSH TABLES <table_list> FOR EXPORT.
              If such a statement includes tables for which the storage
              engine does not have this flag, an error will be returned.
            ------------------------------------------------------------
            revno: 3690.33.4 [merge]
            committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
            branch nick: mysql-trunk-wl6168-merge
            timestamp: Wed 2012-05-02 14:48:08 +0200
            message:
              Merge from mysql-trunk to mysql-trunk-wl6168
              No conflicts
            ------------------------------------------------------------
            revno: 3690.33.3 [merge]
            committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
            branch nick: mysql-trunk-wl6168
            timestamp: Wed 2012-04-25 11:45:58 +0200
            message:
              Merge from mysql-trunk to mysql-trunk-wl6168
              Text conflict in mysql-test/suite/perfschema/r/digest_table_full.result
              Text conflict in mysql-test/suite/perfschema/r/statement_digest.result
              Text conflict in mysql-test/suite/perfschema/r/statement_digest_consumers.result
              Text conflict in mysql-test/suite/perfschema/r/statement_digest_long_query.result
            ------------------------------------------------------------
            revno: 3690.33.2
            committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
            branch nick: mysql-trunk-wl6168
            timestamp: Wed 2012-04-25 11:15:45 +0200
            message:
              Change tree name
            ------------------------------------------------------------
            revno: 3690.33.1
            committer: Gleb Shchepa <gleb.shchepa@oracle.com>
            branch nick: trunk-wl6168
            timestamp: Thu 2012-04-12 10:38:47 +0400
            message:
              WL#6168: FLUSH TABLES ... FOR EXPORT -- parser
              
              This WL introduces the new "FLUSH TABLES ... FOR EXPORT" syntax for the
              larger WL5522.
              
              The "FOR EXPORT" option is mutually exclusive with the old
              "WITH READ LOCK" lock.
              
              A temporary implementation for the "FLUSH TABLES .... FOR EXPORT" command
              just copies the behaviour of "FLUSH TABLES ... WITH READ LOCK".
              
              Further logic of the "FOR EXPORT" lock will be implemented by the WL6169.
        ------------------------------------------------------------
        revno: 3402.86.465
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-05-07 17:18:33 +1000
        message:
          WL#5522 - Change regexp to normalise output of error messages.
        ------------------------------------------------------------
        revno: 3402.86.464
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-05-07 13:16:47 +1000
        message:
          WL#5522 - Add a regex that replaces '\' with '/' so that we don't get string
          mismatches on path names on Windows.
        ------------------------------------------------------------
        revno: 3402.86.463
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-05-07 08:02:27 +1000
        message:
          WL#5522 - When simulating fil_reset_space_and_lsn_failure close the file
          before returing. Otherwise we get a sharing violation on Windows.
        ------------------------------------------------------------
        revno: 3402.86.462
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-05-06 21:24:28 +1000
        message:
          WL#5522 - Reduce the size of the VARCHAR from 7192 to 1024. Otherwise it makes
          the test non-deterministic for smaller page sizes.
        ------------------------------------------------------------
        revno: 3402.86.461
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-05-06 15:35:29 +1000
        message:
          WL#5522 - Update test result.
        ------------------------------------------------------------
        revno: 3402.86.460 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-05-06 07:59:32 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.459
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-04 22:41:39 +1000
        message:
          WL#5522 - Move the restart tests to the top, to workaround the gcov bug.
        ------------------------------------------------------------
        revno: 3402.86.458
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-04 21:11:49 +1000
        message:
          WL#5522 - Fix result file.
        ------------------------------------------------------------
        revno: 3402.86.457
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-04 13:10:48 +1000
        message:
          WL#5522 - Use the random number generator from ut0ut.cc.
        ------------------------------------------------------------
        revno: 3402.86.456
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-04 13:05:22 +1000
        message:
          WL#5522 - Fix error log suppression after changed error log output.
        ------------------------------------------------------------
        revno: 3402.86.455
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-04 12:55:59 +1000
        message:
          WL#5522 - Add missing definition of srv_ibuf_disable_background_merge
        ------------------------------------------------------------
        revno: 3402.86.454 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-04 10:34:22 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.453
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-04 10:22:19 +1000
        message:
          WL#5522 - Fix error code in result file.
        ------------------------------------------------------------
        revno: 3402.86.452 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-05-04 10:18:45 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
          Fix result files because of error code changes due to the merge.
        ------------------------------------------------------------
        revno: 3402.86.451 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-05-03 18:40:15 +1000
        message:
          WL#5522 - Merge from mysql-trunk. Get rid of the workaround that was used
          because of the get error message bugs.
        ------------------------------------------------------------
        revno: 3402.86.450
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-05-03 17:57:31 +1000
        message:
          WL#5522 - Add tests for gcov.
        ------------------------------------------------------------
        revno: 3402.86.449
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-01 10:27:44 +1000
        message:
          WL#5522 - Add tests to check for all fread()/fwrite() failures. Add tests to
          check for OOM during import.
        ------------------------------------------------------------
        revno: 3402.86.448 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-05-01 08:59:49 +1000
        message:
          WL#5522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.447 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-04-30 16:48:32 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.446
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-27 23:08:00 +1000
        message:
          WL#5522 - Solaris uses 'Bad file number' as the error string. Normalise the
          message using regex.
        ------------------------------------------------------------
        revno: 3402.86.445
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-27 17:14:58 +1000
        message:
          WL#5522 - Add missing error code to ha_innodb.cc. Simulate error during write
          by closing the underlying file descriptor.
        ------------------------------------------------------------
        revno: 3402.86.444
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-27 14:06:52 +1000
        message:
          WL#5522 - Fix error messages in the result file.
        ------------------------------------------------------------
        revno: 3402.86.443
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-27 14:04:22 +1000
        message:
          WL#5522 - Fix result file due error number change.
        ------------------------------------------------------------
        revno: 3402.86.442
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-27 13:52:55 +1000
        message:
          WL#5522 - There can be multiple records for the same page. Only collect the
          page numbers once in each pass.
        ------------------------------------------------------------
        revno: 3402.86.441
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-27 13:44:45 +1000
        message:
          WL#5522 - Rename ibuf_get_merge_page_nos_func() to ibuf_get_merge_pages().
        ------------------------------------------------------------
        revno: 3402.86.440
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-27 13:41:54 +1000
        message:
          WL#5522 - Improve the regexp for normalising the .ibd file name.
        ------------------------------------------------------------
        revno: 3402.86.439
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-27 13:34:06 +1000
        message:
          WL#5522 - For the IO read error injection test, simulate EOF instead of
          fclose(). fclose() causes problems on some platforms.
        ------------------------------------------------------------
        revno: 3402.86.438 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-27 13:21:05 +1000
        message:
          WL#5522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.437
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Thu 2012-04-26 12:05:59 +0300
        message:
          Correct a function comment.
        ------------------------------------------------------------
        revno: 3402.86.436
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Thu 2012-04-26 12:01:40 +0300
        message:
          Correct a function comment.
        ------------------------------------------------------------
        revno: 3402.86.435
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-04-26 12:37:20 +1000
        message:
          WL#5522 - Send commit emails to mysql_commits_ww_grp@oracle.com
        ------------------------------------------------------------
        revno: 3402.86.434
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-04-26 12:34:48 +1000
        message:
          WL#5522 - Remove dependency on my_get_err_msg() and work around bugs:
          Bug#13979228 - MEMORY CORRUPTION IN READ_TEXTS() (SQL/DERROR.CC) 
          Bug#13983918 - FACTOR OUT MY_GET_ERR_MSG() FROM MY_ERROR() FOR GENERAL USE
        ------------------------------------------------------------
        revno: 3402.86.433 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-04-26 10:15:26 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.432
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-20 18:53:32 +1000
        message:
          WL#5522 - Cleanup. No functional change as such.
        ------------------------------------------------------------
        revno: 3402.86.431
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-20 16:47:54 +1000
        message:
          WL#5522 - Add ER_INNODB_INDEX_CORRUPT. Add ib_verrf(), function uses the
          sql/share/errmsg-utf8.txt format string for its varargs. Use the new function
          where appropriate. Some other minor changes.
        ------------------------------------------------------------
        revno: 3402.86.430 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-20 13:16:38 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.429
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-04-19 16:04:14 +1000
        message:
          WL#5522 - replace return(NULL) with DBUG_RETURN(NULL);
        ------------------------------------------------------------
        revno: 3402.86.428
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-04-19 14:55:45 +1000
        message:
          WL#5522 - Add temporary hack to workaround a MySQL bug.
        ------------------------------------------------------------
        revno: 3402.86.427 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-04-18 16:32:37 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl5522.
        ------------------------------------------------------------
        revno: 3402.86.426
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-04-18 16:19:16 +0300
        message:
          WL#5522: Simplify row_discard_tablespace_for_mysql().
        ------------------------------------------------------------
        revno: 3402.86.425
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-04-18 16:14:09 +0300
        message:
          Remove an unused #define.
        ------------------------------------------------------------
        revno: 3402.86.424
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-04-18 13:49:12 +0300
        message:
          Use table_id_t instead of ib_id_t for table_id.
        ------------------------------------------------------------
        revno: 3402.86.423
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-04-18 13:48:10 +0300
        message:
          Remove an unnecesary type cast.
        ------------------------------------------------------------
        revno: 3402.86.422
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-04-18 12:48:50 +0300
        message:
          White space cleanup.
        ------------------------------------------------------------
        revno: 3402.86.421
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-04-18 12:48:00 +0300
        message:
          Revert a non-functional change in WL#5522.
        ------------------------------------------------------------
        revno: 3402.86.420
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-04-18 11:12:23 +0300
        message:
          WL#5522: Remove trailing space from code and tests.
        ------------------------------------------------------------
        revno: 3402.86.419 [merge]
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-04-18 10:46:53 +0300
        message:
          Merge mysql-trunk to mysql-trunk-wl5522.
          
          Several tests crash before and after this merge. To mention some:
          --suite innodb: innodb-wl5522-debug (glibc detected double free)
          --suite main: date_formats ctype_errors ctype_ucs ctype_utf8mb4_heap
          ctype_utf8mb4_myisam variables mysql ctype_utf8mb4 create-big
        ------------------------------------------------------------
        revno: 3402.86.418
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk-wl5522
        timestamp: Wed 2012-04-18 09:43:39 +0300
        message:
          WL#5522: Adjust mysql-test suppressions for changed InnoDB message.
        ------------------------------------------------------------
        revno: 3402.86.417 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-04-18 09:22:32 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.416
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-04-18 09:19:05 +1000
        message:
          WL#5522 - Add ib_errf() to push mesages to the client. This function is used
          when the format string is from errmsg-utf8.txt.
        ------------------------------------------------------------
        revno: 3402.86.415
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-17 23:42:59 +1000
        message:
          WL#5522 - Add test for ER_INTERNAL_ERROR handling.
        ------------------------------------------------------------
        revno: 3402.86.414
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-17 22:26:01 +1000
        message:
          WL#5522 - Factor out my_get_err_msg() out of my_error() so that the error
          message format strings can be used by any function.
        ------------------------------------------------------------
        revno: 3402.86.413
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-17 22:17:24 +1000
        message:
          WL#5522 - Add test for ER_IO_READ_ERROR ad ER_IO_WRITE_ERROR.
        ------------------------------------------------------------
        revno: 3402.86.412
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-17 19:41:46 +1000
        message:
          WL#5522 - Fix a bug introduced in the new .cfg filename create.
        ------------------------------------------------------------
        revno: 3402.86.411
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-17 19:31:32 +1000
        message:
          WL#5522 - Reverse the assertion check.
        ------------------------------------------------------------
        revno: 3402.86.410
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-17 18:32:13 +1000
        message:
          WL#5522 - Get rid of srv_path_copy(), use the same path as ".ibd" file to
          construct the path to the ".cfg" file.
        ------------------------------------------------------------
        revno: 3402.86.409
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-17 18:31:11 +1000
        message:
          WL#5522 - Change error code to ER_IO_READ_ERROR.
        ------------------------------------------------------------
        revno: 3402.86.408
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-17 14:49:13 +1000
        message:
          WL#5522 - Add test for ER_TABLESPACE_EXISTS.
        ------------------------------------------------------------
        revno: 3402.86.407
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-17 14:35:43 +1000
        message:
          WL#5522 - Use my_error() for ER_TABLESPACE_MISSING and ER_TABLESPACE_DISCARDED.
        ------------------------------------------------------------
        revno: 3402.86.406
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-17 12:18:24 +1000
        message:
          WL#5522 - Fix unused variable warning. Make the assertion that checks for
          non-null return from fseg_inode_get() a runtime assertion.
        ------------------------------------------------------------
        revno: 3402.86.405
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-04-16 17:54:51 +1000
        message:
          WL#5522 - Fix bug introduced when adding code to allow DDL changes on a
          table with a DISCARDed tablespace.
        ------------------------------------------------------------
        revno: 3402.86.404 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-04-16 16:14:23 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.403
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-04-14 08:34:55 +1000
        message:
          WL#5522 - The space id can 0 for temp tables if innodb_file_per_table=0. Remove
          bogus assertion and comment.
        ------------------------------------------------------------
        revno: 3402.86.402 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-04-14 08:25:48 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.401
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-13 07:50:30 +1000
        message:
          WL#5522 - Fix results after merge from mysql-trunk. Error codes changed.
        ------------------------------------------------------------
        revno: 3402.86.400
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-13 07:43:03 +1000
        message:
          WL#5522 - Disable an assertion, seems to be an issue inherited from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.399 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-13 07:41:14 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.398 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-04-12 22:34:18 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.397
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-04-11 10:33:25 +1000
        message:
          WL#5522 - Fix declaration of buf_pool_get_dirty_pages_count().
        ------------------------------------------------------------
        revno: 3402.86.396
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-04-11 10:25:31 +1000
        message:
          WL#5522 - Fine tune the assertion. Only valid if trx and id != 0.
        ------------------------------------------------------------
        revno: 3402.86.395
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-04-11 08:18:31 +1000
        message:
          WL#5522 - Fix assertion. Check only the buffer pool that has been flushed,
          not all the buffer pool flush lits.
        ------------------------------------------------------------
        revno: 3402.86.394 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-04-11 07:55:16 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.393
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-10 22:34:38 +1000
        message:
          WL#5522 - Fix memory leak.
        ------------------------------------------------------------
        revno: 3402.86.392 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-10 19:11:06 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.391
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-04-09 22:29:05 +1000
        message:
          WL#5522 - Allow ADD/DROP INDEX for discarded tablespaces. Update the test to
          check for this usage. Skip the build index phase, where we read the records.
        ------------------------------------------------------------
        revno: 3402.86.390
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-06 08:23:42 +1000
        message:
          WL#5522 - Rename dict_tf_valid() to dict_tf_is_valid().
        ------------------------------------------------------------
        revno: 3402.86.389
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-04-06 08:13:50 +1000
        message:
          WL#5522 - Remove fsp_flags_valid().
        ------------------------------------------------------------
        revno: 3402.86.388
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-04-05 10:38:54 +1000
        message:
          WL#5522 - fopen() should use the 'b' binary mode during export and import.
        ------------------------------------------------------------
        revno: 3402.86.387 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-04-05 07:53:54 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.386
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-04-04 17:13:34 +1000
        message:
          WL#5522 - fflush() the meta-data file name during export.
        ------------------------------------------------------------
        revno: 3402.86.385 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-04-04 16:53:03 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.384
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-04-04 16:43:23 +1000
        message:
          WL#5522 - Log the OS error during IMPORT meta data read.
        ------------------------------------------------------------
        revno: 3402.86.383 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-04-04 07:43:38 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.382 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-03 20:38:12 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.381
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-03 10:53:01 +1000
        message:
          WL#5522 - Fix error codes in result due to merge.
        ------------------------------------------------------------
        revno: 3402.86.380
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-03 08:25:31 +1000
        message:
          WL#5522 - Remove experimental fix. We already set the dict op flag in TRUNCATE.
        ------------------------------------------------------------
        revno: 3402.86.379 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-04-03 08:10:58 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.378
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-04-02 18:25:53 +1000
        message:
          WL#5522 - Remove fix for bug# 13913670, use DICT_OP_INDEX for the IMPORT
          transaction so that it won't be dropped and also rolled back properly.
        ------------------------------------------------------------
        revno: 3402.86.377
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-04-02 17:39:20 +1000
        message:
          WL#5522 - Fix error codes that were changed after last merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.376 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-04-02 12:24:32 +1000
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.375
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-03-31 10:17:44 +1100
        message:
          WL#5522 - Make the test deterministic, don't check for existince of files when
          attempting to unlink them.
        ------------------------------------------------------------
        revno: 3402.86.374
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 22:48:44 +1100
        message:
          WL#5522 - Fix the test case and get rid of the non-determinism.
        ------------------------------------------------------------
        revno: 3402.86.373
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 22:47:56 +1100
        message:
          WL#5522 - Commit the mini-tranasction only after it has processed the page.
        ------------------------------------------------------------
        revno: 3402.86.372
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 22:16:19 +1100
        message:
          WL#5522 - Flush the dirty pages to disk during IMPORT. Otherwise they will
          flood the buffer pool. For this we commit the mini-transaction more frequently
          in order to unfix the pages.
        ------------------------------------------------------------
        revno: 3402.86.371
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 17:51:45 +1100
        message:
          WL#5522 - Fix warnings.
        ------------------------------------------------------------
        revno: 3402.86.370
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 17:08:34 +1100
        message:
          WL#5522 - Remove debug build option in CMakeLists.txt.
        ------------------------------------------------------------
        revno: 3402.86.369 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 17:04:07 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.368
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 17:00:07 +1100
        message:
          WL#5522 - Rename innodb_disable_background_merge.test  to
          innodb_disable_background_merge_basic.test and its result file.
        ------------------------------------------------------------
        revno: 3402.86.367
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 16:45:34 +1100
        message:
          WL#5522 - Introduce MTR_LOG_NO_REDO. Avoid acquiring table and record locks
          if a transaction is tagged as a DDL recovery transaction. Use MTR_LOG_NO_REDO
          during the IMPORT phase for updating the tablespace fields. Otherwise we end
          up generating REDO that is of no use during crash recovery. The locking changes
          are due to a serious bug in the DD recovery code where we attempt to drop
          the temp tables and indexes before doing UNDO.
        ------------------------------------------------------------
        revno: 3402.86.366
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 11:37:31 +1100
        message:
          WL#5522 - Update result file.
        ------------------------------------------------------------
        revno: 3402.86.365 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 06:51:39 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.364 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-30 06:37:12 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.363
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-29 20:29:02 +1100
        message:
          WL#5522 - Update test results after removing ibuf_page_merges variable.
        ------------------------------------------------------------
        revno: 3402.86.362
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-29 19:31:09 +1100
        message:
          WL#5522 - Fix result file - all_vars.result.
        ------------------------------------------------------------
        revno: 3402.86.361
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-29 18:49:57 +1100
        message:
          WL#5522 - Add a check for ibuf inserts in the test case.
        ------------------------------------------------------------
        revno: 3402.86.360
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-29 18:37:45 +1100
        message:
          WL#5522 - Remove the added monitor variable and reuse existing ibuf_merges.
        ------------------------------------------------------------
        revno: 3402.86.359
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-29 16:13:40 +1100
        message:
          WL#5522 - Add test for innodb_disable_background_merge. Merge change buffer
          entries during quiesce in a loop, so that all entries are merged.
        ------------------------------------------------------------
        revno: 3402.86.358
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-29 13:56:34 +1100
        message:
          WL#5522 - Get rid of the DBUG_EXECUTE_IF() replace with debug global variable
          that can be set via MySQL. The DBUG_EXECUTE_IF() was unreliable (unknown reason)
          during Windows debug testing. Add CHECK TABLE after successful IMPORT.
        ------------------------------------------------------------
        revno: 3402.86.357
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-29 12:15:30 +1100
        message:
          WL#522 - Remove redundant sync point.
        ------------------------------------------------------------
        revno: 3402.86.356
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-29 12:02:33 +1100
        message:
          WL#5522 - Update error code in result file.
        ------------------------------------------------------------
        revno: 3402.86.355
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-29 11:59:14 +1100
        message:
          WL#5522 - When ib_ibuf_disable_background_merge is set, force aggressive
          flushing so that more changes are buffered in the change buffer.
        ------------------------------------------------------------
        revno: 3402.86.354 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-29 10:01:04 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.353 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-28 18:47:28 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.352
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-28 18:42:19 +1100
        message:
          WL#5522 - Save the AUTOINC value to the .cfg file and restore during import.
        ------------------------------------------------------------
        revno: 3402.86.351
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 21:40:48 +1100
        message:
          WL#5522 - CHeck for ibuf_page_merges before and after quiesce. Before the
          flush tables it should be 0 and > 0 after flush tables.
        ------------------------------------------------------------
        revno: 3402.86.350
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 21:23:01 +1100
        message:
          WL#5522 - Return the number of bytes actually read in the error message that is
          pushed to the client.
        ------------------------------------------------------------
        revno: 3402.86.349
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 20:57:05 +1100
        message:
          WL#5522 - Disable test in an embedded build, because the test has to restart.
        ------------------------------------------------------------
        revno: 3402.86.348
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 17:36:52 +1100
        message:
          WL#5522 - Fix typo in sync point name:  ib_ibuf_disable_background_merge.
        ------------------------------------------------------------
        revno: 3402.86.347
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 17:20:35 +1100
        message:
          WL#5522 - List the files in the test.
        ------------------------------------------------------------
        revno: 3402.86.346
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 16:57:11 +1100
        message:
          WL#5522 - Make ibuf_contract() static.
        ------------------------------------------------------------
        revno: 3402.86.345
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 16:51:03 +1100
        message:
          WL#5522 - Add strerror() to the file open error message.
        ------------------------------------------------------------
        revno: 3402.86.344 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 16:46:08 +1100
        message:
          WL#5522 - Merge from mysql-trunk. The flushing changes were originally written
          for this branch. When the changes were back ported to trunk some of the
          functionality required in this branch was removed. Reinstate those changes.
        ------------------------------------------------------------
        revno: 3402.86.343
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 14:18:27 +1100
        message:
          WL#5522 - Remove debug statements from test.
        ------------------------------------------------------------
        revno: 3402.86.342
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 09:22:01 +1100
        message:
          WL#5522 - Update error codes in result file.
        ------------------------------------------------------------
        revno: 3402.86.341
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-27 09:16:16 +1100
        message:
          WL#5522 - Fix memory leak.
        ------------------------------------------------------------
        revno: 3402.86.340
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-26 19:07:19 +1100
        message:
          WL#5522 - Fix result file because the error code changed after the merge.
        ------------------------------------------------------------
        revno: 3402.86.339 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-26 17:58:39 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.338
        committer: Sunny Bains <sunny.bains@oracle.com>
        branch nick: wl5522
        timestamp: Tue 2012-03-20 18:34:07 +0100
        message:
          WL#5522 - Use the sizeof of the struct not pointer in memset.
        ------------------------------------------------------------
        revno: 3402.86.337
        committer: Sunny Bains <sunny.bains@oracle.com>
        branch nick: wl5522
        timestamp: Tue 2012-03-20 14:11:25 +0100
        message:
          WL#5522 - Do a mtr commit more frequently.
        ------------------------------------------------------------
        revno: 3402.86.336 [merge]
        committer: Sunny Bains <sunny.bains@oracle.com>
        branch nick: wl5522
        timestamp: Tue 2012-03-20 10:59:52 +0100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.335
        committer: Sunny Bains <sunny.bains@oracle.com>
        branch nick: wl5522
        timestamp: Tue 2012-03-20 07:52:53 +0100
        message:
          WL#5522 - Fix compilation error.
        ------------------------------------------------------------
        revno: 3402.86.334
        committer: Sunny Bains <sunny.bains@oracle.com>
        branch nick: wl5522
        timestamp: Mon 2012-03-19 23:32:20 +0100
        message:
          WL#5522 - Commit the mtr every N pages, so that the pages can be evicted
          by the background flush thread during an IMPORT.
        ------------------------------------------------------------
        revno: 3402.86.333 [merge]
        committer: Sunny Bains <sunny.bains@oracle.com>
        branch nick: wl5522
        timestamp: Mon 2012-03-19 11:05:53 +0100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.332
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-16 12:09:08 +1100
        message:
          WL#5522 - Update test result.
        ------------------------------------------------------------
        revno: 3402.86.331
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-16 12:00:12 +1100
        message:
          WL#5522 - Add a test from bug# 13850196
        ------------------------------------------------------------
        revno: 3402.86.330
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-16 09:24:20 +1100
        message:
          WL#5522 - Change from absolute count to > 0 when checking ibuf pages merged.
        ------------------------------------------------------------
        revno: 3402.86.329 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-16 09:17:35 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.328
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 20:16:42 +1100
        message:
          WL#5522 - Adjust test results after adding ibuf_page_merges.
        ------------------------------------------------------------
        revno: 3402.86.327
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 20:14:18 +1100
        message:
          WL#5522 - Adjust results after adding ibuf_page_merges addition.
        ------------------------------------------------------------
        revno: 3402.86.326
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 18:52:43 +1100
        message:
          WL#5522 - Add test to check if the change buffer does a quiesce. Add two
          new sync points:
          
           1. ib_buf_force_flush
              Does the same thing as ibuf_debug. 
           2. ib_ibuf_disable_background_merge
              Disable the ibuf merge from the master thread.
          
          Add a new MONITOR counter ibuf_merged_pages, we use this to check whether
          the ibuf did a merge or not.
        ------------------------------------------------------------
        revno: 3402.86.325
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 16:23:43 +1100
        message:
          WL#5522 - Update test results due to error code changes.
        ------------------------------------------------------------
        revno: 3402.86.324 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 16:18:28 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.323
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 14:19:32 +1100
        message:
          WL#5522 - Move the new error codes to the end.
        ------------------------------------------------------------
        revno: 3402.86.322
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 12:12:01 +1100
        message:
          WL#5522 - Handle the case when purge is disabled, avoid start/stop.
        ------------------------------------------------------------
        revno: 3402.86.321
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 11:41:07 +1100
        message:
          WL#5522 - Undo the following change (the disabling part).
          
          "Add TRX_PURGE_DISABLED for disabling InnoDB purge at compilation time.
          This is for narrowing down Bug#13807811 and similar bugs, which are
          somehow triggered by purge."
        ------------------------------------------------------------
        revno: 3402.86.320
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 11:32:11 +1100
        message:
          WL#5522 - Add MTR tests for innodb_purge_stop_now and innodb_purge_start_now
        ------------------------------------------------------------
        revno: 3402.86.319
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 10:15:39 +1100
        message:
          WL#5522 - Get rid of the OpenSolaris version of vasprintf(), use my_vnsprintf()
          instead on platforms that don't have vasprintf().
        ------------------------------------------------------------
        revno: 3402.86.318 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-15 10:08:58 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.317
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-14 21:30:43 +1100
        message:
          WL#5522 - Move purge start/stop to debug build. Move purge test from non-debug
          to debug test file. Remove UT_MEM_ASSERT_W(), it is undefined. Return
          immediately if the table exists during an IMPORT. No need to do any error
          conversion.
        ------------------------------------------------------------
        revno: 3402.86.316 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-14 19:59:50 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.315
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-14 19:53:51 +1100
        message:
          WL#5522 - Fix whitespace. Fix cursor positioning in IndexImporter(). Add new
          GLOBAL variables:
          
            SET GLOBAL INNODB_PURGE_RUN_NOW=ON;
            SET GLOBAL INNODB_PURGE_STOP_NOW=ON;
          
          There is no equivalent OFF setting, it is a no-op.
          
          Add a test that uses the above variables so that we can test the purge of
          delete mark records during IMPROT.
        ------------------------------------------------------------
        revno: 3402.86.314
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-14 16:06:41 +1100
        message:
          WL#5522 - Normalize the file name in the result output. Replace \ with /.
        ------------------------------------------------------------
        revno: 3402.86.313
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-14 12:14:30 +1100
        message:
          WL#5522 - Fix error message in the test. Use the new functions for
          fil_delete_tablespace().
        ------------------------------------------------------------
        revno: 3402.86.312
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-14 11:18:44 +1100
        message:
          WL#5522 - Fix comment.
        ------------------------------------------------------------
        revno: 3402.86.311
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-14 11:07:22 +1100
        message:
          WL#5522 - Fix typo.
        ------------------------------------------------------------
        revno: 3402.86.310
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-14 10:23:10 +1100
        message:
          WL#5522 - Add a NUL byte to the output string on Windows.
        ------------------------------------------------------------
        revno: 3402.86.309
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-14 10:16:07 +1100
        message:
          WL#5522 - Close the tablesapce file on error during IMPORT.
        ------------------------------------------------------------
        revno: 3402.86.308 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-14 09:01:50 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.307
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-13 23:41:04 +1100
        message:
          WL#5522 - Use File::Spec to create portable file paths.
        ------------------------------------------------------------
        revno: 3402.86.306
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-13 22:44:34 +1100
        message:
          WL#5522 - Remove Q&D hack and replace with TODO.
        ------------------------------------------------------------
        revno: 3402.86.305
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-13 18:18:04 +1100
        message:
          WL#5522 - Zero out the destination string on Windows. Otherwise the old contents
          show up in the message.
        ------------------------------------------------------------
        revno: 3402.86.304
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-13 17:56:21 +1100
        message:
          WL#5522 - Print errno string.
        ------------------------------------------------------------
        revno: 3402.86.303
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-13 17:52:35 +1100
        message:
          WL#5522 - Fix error message.
        ------------------------------------------------------------
        revno: 3402.86.302
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-13 17:43:58 +1100
        message:
          WL#5522 - Update the test results due to changes in error messages.
        ------------------------------------------------------------
        revno: 3402.86.301
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-13 12:42:23 +1100
        message:
          WL#5522 - Fix table and tablespace check.
        ------------------------------------------------------------
        revno: 3402.86.300
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-13 12:41:37 +1100
        message:
          WL#5522 - Enclose strings in '%s'.
        ------------------------------------------------------------
        revno: 3402.86.299 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-13 10:00:40 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.298 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-03-10 11:27:40 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.297
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-03-10 00:57:00 +1100
        message:
          WL#5522 - Update test, add a suppression for a new warning.
        ------------------------------------------------------------
        revno: 3402.86.296
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-03-10 00:43:37 +1100
        message:
          WL#5522 - Update tests.
        ------------------------------------------------------------
        revno: 3402.86.295
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-03-10 00:41:38 +1100
        message:
          WL#5522 - Check if the table flags and the flags in the meta data file match.
          There is no need discard change buffer pages for a space during IMPORT because
          the table can't have a tablespace. Discard the change buffer pages for a
          tablespace when it is being discarded.
        ------------------------------------------------------------
        revno: 3402.86.294
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-03-10 00:24:00 +1100
        message:
          WL#5522 - Add the 0x prefix to hex output.
        ------------------------------------------------------------
        revno: 3402.86.293
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:59:28 +1100
        message:
          WL#5522 - Update test to handle InnoDB flushing.
        ------------------------------------------------------------
        revno: 3402.86.292 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:53:32 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.291
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:44:17 +1100
        message:
          WL#5522 - Update the test.
        ------------------------------------------------------------
        revno: 3402.86.290
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:38:21 +1100
        message:
          WL#5522 - There is no need to tag the IMPORT transaction with TRX_DICT_OP_TABLE.
          We don't want to drop the table on recovery if the server crashes halfway. There
          is no need to do another table id reassign because for IMPORT to work we have
          to DISCARD the tablespace first and we assign the table a new id during DISCARD
          which will make it invisible to purge anyway.
          
          Do the checkpoint after committing the transaction.
        ------------------------------------------------------------
        revno: 3402.86.289
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:37:57 +1100
        message:
          WL#5522 - Remove debug fprintf().
        ------------------------------------------------------------
        revno: 3402.86.288
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:37:16 +1100
        message:
          WL#5522 - Fix log messages.
        ------------------------------------------------------------
        revno: 3402.86.287
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:36:36 +1100
        message:
          WL#5522 - Add a newline, fix log messages.
        ------------------------------------------------------------
        revno: 3402.86.286
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:36:00 +1100
        message:
          WL#5522 - Fix log message.
        ------------------------------------------------------------
        revno: 3402.86.285
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:34:44 +1100
        message:
          WL#5522 - Don't drop the table if the table is marked as discarded during
          recovery od uncommitted transactions. Fix the error logging.
        ------------------------------------------------------------
        revno: 3402.86.284
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:34:00 +1100
        message:
          WL#5522 - Check for DB_SUCCESS and not a boolean return value.
        ------------------------------------------------------------
        revno: 3402.86.283
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 23:33:00 +1100
        message:
          WL#5522 - Clean up the code and fix the error messages.
        ------------------------------------------------------------
        revno: 3402.86.282 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 07:50:40 +1100
        message:
          WL#5522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.281
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-09 00:05:21 +1100
        message:
          WL#5522 - We assume that _vscprintf() and vsnprintf() are present in Win builds.
        ------------------------------------------------------------
        revno: 3402.86.280
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 23:15:23 +1100
        message:
          WL#5522 - Update test results.
        ------------------------------------------------------------
        revno: 3402.86.279
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 23:08:11 +1100
        message:
          WL#5522 - Fix check for function.
        ------------------------------------------------------------
        revno: 3402.86.278
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 22:04:26 +1100
        message:
          WL#5522 - Fix the check for Windows (HAVE_VSCPRINTF && HAVE_VSNPRINTF)
        ------------------------------------------------------------
        revno: 3402.86.277
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 21:58:03 +1100
        message:
          WL#5522 - Add checks for Windows vsnprintf() and _vscprintf() functions.
        ------------------------------------------------------------
        revno: 3402.86.276
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 21:06:45 +1100
        message:
          WL#5522 - Check for vasprintf() and asprintf() unconditional.
        ------------------------------------------------------------
        revno: 3402.86.275
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 21:02:53 +1100
        message:
          WL#5522 - Remove unnecessary local variable.
        ------------------------------------------------------------
        revno: 3402.86.274
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 20:58:39 +1100
        message:
          WL#5522 - Fix warnings in vasprintf() because it is being compiled as C++ code.
        ------------------------------------------------------------
        revno: 3402.86.273
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 19:05:53 +1100
        message:
          WL#5522 - Add asprintf() and vasprintf() source from OpenSolaris.
        ------------------------------------------------------------
        revno: 3402.86.272
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 18:22:30 +1100
        message:
          WL#5522 - Save the ibd_file_missing flag before freeing the table.
        ------------------------------------------------------------
        revno: 3402.86.271
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 16:50:57 +1100
        message:
          WL#5522 - Fix error message strings enclose %s in '%s'. Make the function
          fil_make_ibd_name() public. Add attributes to ib_pushf() and ib_logf() so that
          the arguments are checked by the compiler. Add missing arguments to several
          ib_pushf() functions. Change some messages that are pushed to the user.
        ------------------------------------------------------------
        revno: 3402.86.270 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-08 08:58:24 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.269 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-07 19:19:10 +1100
        message:
          WL#5522 - Merge from myqsql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.268
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-07 19:17:49 +1100
        message:
          WL#5522 - Fix comment.
        ------------------------------------------------------------
        revno: 3402.86.267
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-07 18:30:53 +1100
        message:
          WL#5522 - Add new MySQL error codes, use where appropriate in InnoDB code.
          
          ER_TABLE_SCHEMA_MISMATCH
          ER_TABLE_IN_SYSTEM_TABLESPACE
          ER_IO_READ_ERROR
          ER_IO_WRITE_ERROR
          ER_TABLESPACE_MISSING
          ER_TABLESPACE_DISCARDED
          ER_INTERNAL_ERROR
          
          Fix innodb-wl5522.test to check for the  new codes.
        ------------------------------------------------------------
        revno: 3402.86.266
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-07 16:46:33 +1100
        message:
          WL#5522 - Add a debug function to check if a tablespace has any dirty pages.
        ------------------------------------------------------------
        revno: 3402.86.265
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-07 16:26:59 +1100
        message:
          WL#5522 - Allow DISCARD of a table whose .ibd file is missing. Use ib_pushf()
          for pushing messages to the client.
        ------------------------------------------------------------
        revno: 3402.86.264 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-07 16:11:25 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.263 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-03-07 08:45:42 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.262
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 17:22:53 +1100
        message:
          WL#5522 - Do a select to check that the server doesn't crash after a DISCARD.
          Suppress log messages that are part of the testing. Add more row format tests.
        ------------------------------------------------------------
        revno: 3402.86.261
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 16:26:41 +1100
        message:
          WL#5522 - Add tests that use different row formats.
        ------------------------------------------------------------
        revno: 3402.86.260
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 13:39:44 +1100
        message:
          WL#5522 - Fix error mesages.
        ------------------------------------------------------------
        revno: 3402.86.259
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 13:39:19 +1100
        message:
          WL#5522 - Remove newline.
        ------------------------------------------------------------
        revno: 3402.86.258
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 13:38:12 +1100
        message:
          WL#5522 - If renaming a discarded table then it is not an error.
        ------------------------------------------------------------
        revno: 3402.86.257
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 13:37:28 +1100
        message:
          WL#5522 - Don't rename the .ibd file if the tablespace is discarded.
        ------------------------------------------------------------
        revno: 3402.86.256
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 13:36:45 +1100
        message:
          WL#5522 - Add schema check tests.
        ------------------------------------------------------------
        revno: 3402.86.255
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 12:33:06 +1100
        message:
          WL#5522 - Reduce the verbosity of the log messages.
        ------------------------------------------------------------
        revno: 3402.86.254
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 11:56:06 +1100
        message:
          WL#5522 - Rename the id in the table id cache after IMPORT is complete.
        ------------------------------------------------------------
        revno: 3402.86.253
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 11:55:15 +1100
        message:
          WL#5522 - Allow open of tables where the tablespace has been discarded.
        ------------------------------------------------------------
        revno: 3402.86.252 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-03-06 10:20:03 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.251
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-05 22:53:48 +1100
        message:
          WL#5522 - Fix log messages when the .ibd file has been discarded or is missing.
        ------------------------------------------------------------
        revno: 3402.86.250
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-05 22:48:28 +1100
        message:
          WL#5522 - When resetting the root page number use storage byte order. Add
          assertions to check if the discarded flag was actually set.
        ------------------------------------------------------------
        revno: 3402.86.249
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-05 22:47:17 +1100
        message:
          WL#5522 - Fix error log messages when the ibd file is missing or discarded.
          Update the discarded flag and index root page numbers before doing the
          table id reassign.
        ------------------------------------------------------------
        revno: 3402.86.248
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-05 22:45:54 +1100
        message:
          WL#5522 - Remove superfluous wrapper function pars_info_get_user_func().
        ------------------------------------------------------------
        revno: 3402.86.247
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-05 18:45:46 +1100
        message:
          WL#5522 - Remove diagnostic printf.
        ------------------------------------------------------------
        revno: 3402.86.246
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-05 18:45:10 +1100
        message:
          WL#5522 - Don't build the index if the tablespace is missing.
        ------------------------------------------------------------
        revno: 3402.86.245
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-05 18:42:56 +1100
        message:
          WL#5522 - It is a pre-condition of row_search_for_mysql() that the transaction
          must not be holding the btr search latch. Remove the unnecessary checks on
          each error return during entry. Simplify the error message for the missing
          .ibd file case.
        ------------------------------------------------------------
        revno: 3402.86.244
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-05 18:41:47 +1100
        message:
          WL#5522 - Allow addition of an index to the data dictionary if the tablespace
          has been DISCARDed or if the .ibd file is missing.
        ------------------------------------------------------------
        revno: 3402.86.243
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-05 14:02:03 +1100
        message:
          WL#5522 - Add schema checks during IMPORT. If the check fails then abort the
          IMPORT and push the error message(s) to the client. Existing test updated with
          new error message. Make the schema checking more strict. The number of indexes,
          column names, type info and the index definitions must match exactly.
        ------------------------------------------------------------
        revno: 3402.86.242
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-03-05 11:59:36 +1100
        message:
          WL#5522 - Write the index definitions to the .cfg file and add code to read
          the definitions.
        ------------------------------------------------------------
        revno: 3402.86.241 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-03-04 17:31:17 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.240
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-03-04 17:26:33 +1100
        message:
          WL#5522 - Change the .cfg file format to:
          
          ib_uint32_t	version;
          string_t	hostname;
          string_t	table_name;
          ib_uint32	Number of columns
          dict_col_t	For each column + string_t (column name)
          ib_uint32_t	Number of indexes
          row_import_t	For each index
          
          Where string_t is { ib_uint32_t, byte array[] };
        ------------------------------------------------------------
        revno: 3402.86.239 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-02 08:32:24 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.238 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-03-02 08:29:02 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.237 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-03-01 06:43:25 +1100
        message:
          WL#5522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.236
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-29 19:16:00 +1100
        message:
          WL#5522 - Make fsp_flags_validate() return bool instead of asserting.
        ------------------------------------------------------------
        revno: 3402.86.235
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-29 19:00:57 +1100
        message:
          WL#5522 - Remove the bogus assertion.
        ------------------------------------------------------------
        revno: 3402.86.234 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-29 09:24:20 +1100
        message:
          WL#5522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.233 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-29 07:03:15 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.232 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-28 18:08:27 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.231
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-28 17:55:30 +1100
        message:
          WL#5522 - Clean up the code.
        ------------------------------------------------------------
        revno: 3402.86.230
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-28 14:44:42 +1100
        message:
          WL#5522 - Code clean up.
        ------------------------------------------------------------
        revno: 3402.86.229
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-28 12:22:35 +1100
        message:
          WL5522 - Remove #ifdef UNIV_DEBUG from around DBUG_EXECUTE_IF().
        ------------------------------------------------------------
        revno: 3402.86.228 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-27 18:34:02 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.227
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-27 18:25:35 +1100
        message:
          WL#5522 - Fix the test results. Check the page status after acquiring the
          block mutex to avoid a race condition.
        ------------------------------------------------------------
        revno: 3402.86.226
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-27 16:05:44 +1100
        message:
          WL#5522 - Acquire the block mutex before releasing the flush list mutex when
          flushing a single page during quiesce.
        ------------------------------------------------------------
        revno: 3402.86.225 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-25 20:51:18 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.224
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-23 20:58:02 +1100
        message:
          WL#5522 - Add more error injection tests. Note: this is work in progress. The
          recovery tests print warnigns that need to be tamed.
        ------------------------------------------------------------
        revno: 3402.86.223
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-23 20:56:48 +1100
        message:
          WL#5522 - No need to check table->ibd_file_missing flag if tablespace can't
          be found because it will _always_ be set. Return DB_CORRUPTION if the first
          index in a table is not a cluster index. Move a comment to where it is more
          relevant.
        ------------------------------------------------------------
        revno: 3402.86.222
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-23 20:55:51 +1100
        message:
          WL#5522 - Add new mapping from DB_TABLE_NOT_FOUND to ER_FILE_NOT_FOUND.
        ------------------------------------------------------------
        revno: 3402.86.221 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-23 17:25:02 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.220
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-23 09:19:43 +1100
        message:
          WL#5522 - Reduce scope of new_id in row_import_for_mysql(). Add a new debug
          test file and results. Add an injection failure test.
        ------------------------------------------------------------
        revno: 3402.86.219
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-22 22:44:17 +1100
        message:
          WL#5522 - Change assertion during DROP DATABASE where it is OK if for DROP
          TABLE we can't find a file whose .ibd file is missing. Remove the rename of
          the to be imported .ibd file to .ibt and back. It is an unnecessary complication
          with dubious benefit.
        ------------------------------------------------------------
        revno: 3402.86.218
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-22 06:40:13 +1100
        message:
          WL#5522 - Use rebind version instead of add because we are iterating.
        ------------------------------------------------------------
        revno: 3402.86.217
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-22 06:39:31 +1100
        message:
          WL#5522 - Use a portable version of copy.
        ------------------------------------------------------------
        revno: 3402.86.216
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-22 06:37:48 +1100
        message:
          WL#5522 - Add pars_info_bind_ull_literal() function.
        ------------------------------------------------------------
        revno: 3402.86.215 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-22 06:13:03 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.214
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-22 06:09:51 +1100
        message:
          WL#5522 - UNDO changes to row_truncate_table_for_mysql.
        ------------------------------------------------------------
        revno: 3402.86.213
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-22 06:05:31 +1100
        message:
          WL#5522 - Remove unused callback.
        ------------------------------------------------------------
        revno: 3402.86.212
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-22 06:04:57 +1100
        message:
          WL#5522 - Set file missing to true.
        ------------------------------------------------------------
        revno: 3402.86.211
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-22 06:02:25 +1100
        message:
          WL#5522 - Add const char* format param to vsnprintf().
        ------------------------------------------------------------
        revno: 3402.86.210 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-21 01:20:36 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.209
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-21 01:18:28 +1100
        message:
          WL#5522 - Check the DISCARDED flag during table load and set the ibd file
          missing field in dict_table_t.
        ------------------------------------------------------------
        revno: 3402.86.208
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-21 01:15:32 +1100
        message:
          WL#5522 - Use builtin SQL parser to update the SYS_INDEXES and SYS_TABLES
          system tables. We need to rollback the changes and this is the easiest way
          to do it currently.
        ------------------------------------------------------------
        revno: 3402.86.207
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-21 00:50:47 +1100
        message:
          WL#5522 - Reserve the dict mutex if the UNDO is on the SYS_INDEXES table. Remove
          bogus assertion because we are not modifying anything in the dict cache.
        ------------------------------------------------------------
        revno: 3402.86.206
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-21 00:42:34 +1100
        message:
          WL#5522 - Check for discarded flag before printing message.
        ------------------------------------------------------------
        revno: 3402.86.205
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-21 00:41:57 +1100
        message:
          WL#5522 - Fix log message.
        ------------------------------------------------------------
        revno: 3402.86.204
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-21 00:41:16 +1100
        message:
          WL#5522 - Fix error message.
        ------------------------------------------------------------
        revno: 3402.86.203
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-21 00:13:19 +1100
        message:
          WL#5522 - Fix the check for generated index. Ensure that the system max row
          id is > importing tables max row id if it has a generated cluster index.
        ------------------------------------------------------------
        revno: 3402.86.202
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-18 18:07:13 +1100
        message:
          WL#5522 - The check for the BLOB ref len should be < BTR_EXTERN_FIELD_REF_SIZE.
        ------------------------------------------------------------
        revno: 3402.86.201
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-18 17:31:25 +1100
        message:
          WL#5522 - Fix fsp_flags_valid(), the check was wrong. It was flagging a post
          Antelope file format with atomic BLOBS as invalid.
        ------------------------------------------------------------
        revno: 3402.86.200
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-18 16:56:33 +1100
        message:
          WL#5522 - Fix uninitialised vaiable compiler warnings. The warnings are bogus.
        ------------------------------------------------------------
        revno: 3402.86.199 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-18 16:08:56 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.198
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-18 07:19:33 +1100
        message:
          WL#5522 - Print the error string instead of the error code.
        ------------------------------------------------------------
        revno: 3402.86.197
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 20:06:08 +1100
        message:
          WL#5522 - Add tests.
        ------------------------------------------------------------
        revno: 3402.86.196
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 20:05:14 +1100
        message:
          WL#5522 - Don't spam the log if the tablespace is discarded during a DROP
          TABLE. Honour the print to the log flag in fil0fil.cc.
        ------------------------------------------------------------
        revno: 3402.86.195
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 19:13:36 +1100
        message:
          WL#5522 - Collect the dict stats and other meta info only on a successful import
        ------------------------------------------------------------
        revno: 3402.86.194
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 19:10:50 +1100
        message:
          WL#5522 - Ensure that all asynchronouse IO is completed for the tablespace.
        ------------------------------------------------------------
        revno: 3402.86.193
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 18:23:18 +1100
        message:
          WL#5522 - The check for validate was inverted, fixed.
        ------------------------------------------------------------
        revno: 3402.86.192
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 18:16:55 +1100
        message:
          WL#5522 - The index root page has to be adjusted before validation. The function
          btr_validate_index() is misnamed, it updates the trx and idex id too.
        ------------------------------------------------------------
        revno: 3402.86.191
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 18:02:48 +1100
        message:
          WL#5522 - Make parameters const where required.
        ------------------------------------------------------------
        revno: 3402.86.190
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 16:23:20 +1100
        message:
          WL#5522 - Add another test, this one advances the LSN before restore.
        ------------------------------------------------------------
        revno: 3402.86.189
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 13:49:04 +1100
        message:
          WL#5522 - Add an mtr include file for simplifying testing. Update test and
          result.
        ------------------------------------------------------------
        revno: 3402.86.188
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 11:43:29 +1100
        message:
          WL#5522 - No need to drop AHI entries when doing BUF_REOVE_FLUSH_NO_WRITE. No
          need to wait for pending writes to complete. Remove duplicate assertions.
        ------------------------------------------------------------
        revno: 3402.86.187 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 10:23:40 +1100
        message:
          WL#5522 - Merge from mysql-trunk. Resolve conflicts.
        ------------------------------------------------------------
        revno: 3402.86.186
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 10:06:51 +1100
        message:
          WL#5522 - Fix whitespace, add assertions, wakeup IO threads after posting a
          write to disk, fix comments. Essentially make the code behave the samas as in
          mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.185
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 02:36:02 +1100
        message:
          WL#5522 - Add first basic test.
        ------------------------------------------------------------
        revno: 3402.86.184
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 02:16:20 +1100
        message:
          WL#5522 - We can't use push_warning_printf() to push errors to the client. Fix
          a bug where we were setting the error on success.
        ------------------------------------------------------------
        revno: 3402.86.183 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 00:58:36 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.182
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 00:55:50 +1100
        message:
          WL#5522 - Rename error injection probe.
        ------------------------------------------------------------
        revno: 3402.86.181
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 00:44:56 +1100
        message:
          WL#5522 - Fix spellings of the error injection probe names. Anything with a
          _crash suffix will crash the server and anything with _failure will set the
          error code to something appropriate for the context.
        ------------------------------------------------------------
        revno: 3402.86.180
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-17 00:19:55 +1100
        message:
          WL#5522 - Remove the meta-data file when the user UNLOCKs the tables after
          a FLUSH TABLES. Remove the .ibt and .cfg file when we remove the .ibd
          file during drop tablespace.
        ------------------------------------------------------------
        revno: 3402.86.179
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 22:38:42 +1100
        message:
          WL#5522 - Acquire the dict mutex and lock before locking a tables indexes.
        ------------------------------------------------------------
        revno: 3402.86.178
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 22:28:50 +1100
        message:
          WL#5522 - Add DBUG_EXECUTE_IF() error injection points. Change function in
          fil0fil.cc, fil_reset_space_and_lsn() to return db_err so that we can handle
          the error at a higher level. Push errors and warnings from ibuf0ibuf.cc to
          the client. Use exiting functions, dict_table_x_lock_indexes() and its unlock
          counterpart.
        ------------------------------------------------------------
        revno: 3402.86.177 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 20:17:25 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.176
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 19:42:14 +1100
        message:
          WL#5522 - Make fil_open_single_table_tablespace() return db_err. So that we
          can handle and report the error properly at a higher layer.
        ------------------------------------------------------------
        revno: 3402.86.175
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 19:31:29 +1100
        message:
          WL#5522 - Remove some more unrelated changes.
        ------------------------------------------------------------
        revno: 3402.86.174
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 18:10:14 +1100
        message:
          WL#5522 - Call the function and then check the return value in the assertion.
        ------------------------------------------------------------
        revno: 3402.86.173
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 18:09:22 +1100
        message:
          WL#5522 - Fix assertion.
        ------------------------------------------------------------
        revno: 3402.86.172
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 18:07:31 +1100
        message:
          WL#5522 - Fix patch.
        ------------------------------------------------------------
        revno: 3402.86.171
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 17:53:20 +1100
        message:
          WL#5522 - Remove unrelated changes.
        ------------------------------------------------------------
        revno: 3402.86.170
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 17:17:25 +1100
        message:
          WL#5522 - Undo the changes to buf0flu.cc and include/buf0flu.h. The flushing
          for quiesce now happens via buf_LRU_flush_or_remove().
        ------------------------------------------------------------
        revno: 3402.86.169
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 17:02:38 +1100
        message:
          WL#5522 - Use the LRU flush mechanism for quiesce because the original scheme
          doesn't move the checkpoint LSN and causes the other threads to wait for the
          flush list batch to end. Modify the LRU flush mechanism that is used for
          invalidating tablespace to handle all cases including flush a tablespace's
          pages from the flush list but without removing them from the buffer pool.
        ------------------------------------------------------------
        revno: 3402.86.168
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 11:58:19 +1100
        message:
          WL#5522 - Change some assertions to return DB_CORRUPTION. We don't want to crash
          the system if the tablespace that is being IMPORTed is corrupt. Fix formatting.
          Rename ibuf_contract_ext() functions so that they are not overloaded. Remove
          ib_logf(const char*, ...) function.
        ------------------------------------------------------------
        revno: 3402.86.167 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-16 09:32:04 +1100
        message:
          WL#5522 - Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.166
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-15 20:59:31 +1100
        message:
          WL#5522 - Fix a memory leak.
        ------------------------------------------------------------
        revno: 3402.86.165 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-15 19:50:11 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.164
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-15 19:25:00 +1100
        message:
          WL#5522 - Store the table->flags in the .cfg file too. Read the flags from the
          .cfg file when importing. Simplify the btr_root_adjust_on_import() get rid of
          the gotos. Use the new TF macros for space and table flags.
        ------------------------------------------------------------
        revno: 3402.86.163 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-15 16:21:09 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.162 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-15 16:13:12 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.161 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-14 18:49:34 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.160 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-14 18:37:10 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.159 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-14 17:41:15 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.158 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-14 17:29:25 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.157 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-14 17:26:21 +1100
        message:
          WL#5522 - Merge from mysql-trunk. Since this code was originally written for
          this branch, this resulted in conflicts that had to be resolved manually.
        ------------------------------------------------------------
        revno: 3402.86.156
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-14 13:48:38 +1100
        message:
          WL#5522: Pass an instance of trx_t down the buf_flush_list() call graph so
          that we can abort any long running flushes via quiesce. In buf_flush_list_batch
          fix a bug where on iteration we need to check whether the current page has been
          flushed since we released the flush mutex.
          
          Handle the case where the session that initiated the FLUSH TABLES was killed.
        ------------------------------------------------------------
        revno: 3402.86.155 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-14 09:27:02 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.154
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-13 10:31:13 +1100
        message:
          WL#5522: Move srv_path_copy() to include/srv0start.h from include/srv0srv.h
        ------------------------------------------------------------
        revno: 3402.86.153
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-02-12 10:21:12 +1100
        message:
          WL#5522: Update comments in ha_innodb.cc. Push a warning to the client
          if the flush table requirements are not satisfied. Remove a debug fprintf
          from fsp0fsp.cc
        ------------------------------------------------------------
        revno: 3402.86.152 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-11 10:24:59 +1100
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.151 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-09 22:58:11 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.150
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-09 15:01:07 +1100
        message:
          WL#5522 - Fix comment and whitespace. Non-functional change.
        ------------------------------------------------------------
        revno: 3402.86.149
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-09 14:58:20 +1100
        message:
          WL#5522 - Signal flush batch end for a buffer pool after successfully flushing
          that buffer pool.
        ------------------------------------------------------------
        revno: 3402.86.148
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-09 14:02:38 +1100
        message:
          WL#5522 - Ensure that all buffer pools are flushed during queies. The changes
          avoid flushing buffer pools multiple times. The problem with the previous scheme
          was that we could end up iterating over the flush list of buffer pools multiple
          times during a quiesce. For large buffer pools this is undesirable.
        ------------------------------------------------------------
        revno: 3402.86.147
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-09 11:22:46 +1100
        message:
          WL#5522 - Add an invariant. If the space id is specified during flush then
          the min_n and flush up to LSN must be set to MAX. Retry the flushing if some
          buffer pool was skipped during the dirty page flush.
        ------------------------------------------------------------
        revno: 3402.86.146 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-09 10:01:18 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.145 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-08 21:15:54 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.144 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-08 17:37:55 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.143
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-08 17:01:35 +1100
        message:
          WL#5522: Push corruption messages to the client. Add comments.
        ------------------------------------------------------------
        revno: 3402.86.142
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-08 16:25:19 +1100
        message:
          WL#5522: Discard the tablespace and reset the index root page numbers in the
          dictionary cache if the import fails for any reason.
        ------------------------------------------------------------
        revno: 3402.86.141
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-08 16:10:22 +1100
        message:
          WL#5522: Remove FIXME comment.
        ------------------------------------------------------------
        revno: 3402.86.140
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-08 16:01:56 +1100
        message:
          WL#5522: ib_pushf() will only push to clients and ib_logf() functions will only
          write the MySQL logger. Add a ib_logf() variant that allows selecting the log
          level.
        ------------------------------------------------------------
        revno: 3402.86.139
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-08 15:04:28 +1100
        message:
          WL#5522: Use the MySQL logger for logging messages.
        ------------------------------------------------------------
        revno: 3402.86.138
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-08 13:14:15 +1100
        message:
          WL#5522: Rename row_import_tablespace functions to row_import. Push error
          message to the client connection instead of stderr.
        ------------------------------------------------------------
        revno: 3402.86.137
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-08 12:52:13 +1100
        message:
          WL#5522: Factor out the quiesce and import code from row0mysql.cc to their
          own respective files. Revert assertion that was changed to a conditional.
          Add ib_sendf() function to send InnoDB messages to the client
          Add ib_logf() function to send InnoDB log messages to the MySQL logger.
        ------------------------------------------------------------
        revno: 3402.86.136 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-08 08:25:14 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.135
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-07 09:50:52 +1100
        message:
          WL#5522: Address review comments.
        ------------------------------------------------------------
        revno: 3402.86.134
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-07 08:28:26 +1100
        message:
          WL#5522: Add an assertion to check that the same slot is not allocated to two
          different threads.
        ------------------------------------------------------------
        revno: 3402.86.133
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-07 08:26:00 +1100
        message:
          WL#5522: Start the search for worker thread slots from index 2. The first two
          slots are reserved for the MASTER and PURGE thread.
        ------------------------------------------------------------
        revno: 3402.86.132 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-02-07 08:11:43 +1100
        message:
          WL#5522 - Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.131
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 21:31:26 +1100
        message:
          WL#5522: Revert debug change. Restore original assertion.
        ------------------------------------------------------------
        revno: 3402.86.130
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 21:21:40 +1100
        message:
          WL#5522 - Remove unrelated code.
        ------------------------------------------------------------
        revno: 3402.86.129
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 21:15:01 +1100
        message:
          WL#5522 - Remove unnecessary header include.
        ------------------------------------------------------------
        revno: 3402.86.128
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 21:13:51 +1100
        message:
          WL#5522: Remove unrelated code.
        ------------------------------------------------------------
        revno: 3402.86.127
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 21:10:27 +1100
        message:
          WL#5522 - Fix white space.
        ------------------------------------------------------------
        revno: 3402.86.126
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 20:50:17 +1100
        message:
          WL#5522: Simplify the meta-data reads and writes.
        ------------------------------------------------------------
        revno: 3402.86.125
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 19:41:22 +1100
        message:
          WL#5522: Remove the optimisation option, that was used for debugging.
        ------------------------------------------------------------
        revno: 3402.86.124 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 18:03:34 +1100
        message:
          WL#5522: Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.123
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 17:27:35 +1100
        message:
          WL#5522: Convert DB_END_OF_INDEX to DB_SUCCESS after importing an index. End of
          index is a success error code.
        ------------------------------------------------------------
        revno: 3402.86.122
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 15:31:54 +1100
        message:
          WL#5522: Refactor row_import_tablespace_scan_index.
        ------------------------------------------------------------
        revno: 3402.86.121
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 09:51:15 +1100
        message:
          WL#5522: Keep one sentinel slot in srv_sys_t::sys_threads. Fix comment.
        ------------------------------------------------------------
        revno: 3402.86.120
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 08:36:21 +1100
        message:
          WL#5522: Remove unnecessary indirection.
        ------------------------------------------------------------
        revno: 3402.86.119
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-02-06 08:24:37 +1100
        message:
          WL#5522: Calculate the background system threads at startup and add the
          size parameter to the srv_sys_t structure.
        ------------------------------------------------------------
        revno: 3402.86.118
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-02-05 15:52:42 +1100
        message:
          WL#5522: Quiesce the table only if it is in a separate tablespace.
        ------------------------------------------------------------
        revno: 3402.86.117
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-02-05 15:44:02 +1100
        message:
          WL#5522: Remove debug fprintf.
        ------------------------------------------------------------
        revno: 3402.86.116
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-02-05 15:29:39 +1100
        message:
          WL#5522: Add comments. For the worker threads it should be sufficient to check
          the purge coordinater state. We do the check without holding the latch.
        ------------------------------------------------------------
        revno: 3402.86.115
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-02-05 15:10:19 +1100
        message:
          WL#5522: Add assertions that check the state of the purge coordinator thread
          when a worker exits. A worker thread can only exit after the coordinator thread
          changes the state to PURGE_STATE_EXIT and has itself exited.
        ------------------------------------------------------------
        revno: 3402.86.114
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-02-05 14:36:22 +1100
        message:
          WL#5522: Add some more assertions to catch thread active increment code.
        ------------------------------------------------------------
        revno: 3402.86.113
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-02-05 14:25:42 +1100
        message:
          WL#5522: Remove unused functions. Set the maximum number of system background
          threads to 34. Magic number explained in the code. Add assertions to tighten
          up the code further.
        ------------------------------------------------------------
        revno: 3402.86.112
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-04 19:19:00 +1100
        message:
          WL#5522: Cleanup the code.
        ------------------------------------------------------------
        revno: 3402.86.111
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-04 11:23:19 +1100
        message:
          WL#5522: Make an assertion non-debug, it negligible overhead.
        ------------------------------------------------------------
        revno: 3402.86.110
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-04 11:18:09 +1100
        message:
          WL#5522: Rename function in row0mysql.cc.
        ------------------------------------------------------------
        revno: 3402.86.109
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-04 10:32:58 +1100
        message:
          WL#5522: When freeing the slot and if it is already suspended then don't attempt
          to suspend it again. We need to keep purging while the history list is "large".
        ------------------------------------------------------------
        revno: 3402.86.108
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-04 10:08:55 +1100
        message:
          WL#5522: Remove the additional quiesce states. Change state by acquiring the
          index->lock in X mode for all state changes. Makes it uniform.
        ------------------------------------------------------------
        revno: 3402.86.107 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-02-04 09:21:06 +1100
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.106
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-03 11:27:23 +1100
        message:
          WL#5522: Remove unrelated code that was part of the initial work done by
          Marko on the import.
        ------------------------------------------------------------
        revno: 3402.86.105
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-03 10:59:36 +1100
        message:
          WL#5522: Free the thread slot and decrement the active count at the same time.
          This fixes a race condition where a thread release call could increment the
          active count after the suspend but before the thread slot was released.
        ------------------------------------------------------------
        revno: 3402.86.104
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-03 10:09:55 +1100
        message:
          WL#5522: Remove enum qualifier. Remove unnecessary cast. Fix comments.
        ------------------------------------------------------------
        revno: 3402.86.103
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-03 08:49:55 +1100
        message:
          WL#5522: Remove unused function and field from srv_sys_t. Fix whitespace.
        ------------------------------------------------------------
        revno: 3402.86.102 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-03 08:32:14 +1100
        message:
          WL#5522: Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.101
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-02-03 08:25:59 +1100
        message:
          WL#5522: We only support "export" if purge is done using dedicated thread(s).
        ------------------------------------------------------------
        revno: 3402.86.100
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 22:01:18 +1100
        message:
          WL#5522: Add a virtual destructor to the virtual class.
        ------------------------------------------------------------
        revno: 3402.86.99
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 20:08:08 +1100
        message:
          WL#5522: Add assertions in trx_purge_start() and trx_purge_stop().
        ------------------------------------------------------------
        revno: 3402.86.98
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 19:30:56 +1100
        message:
          WL#5522: Remove comment about the dirty read. It should now be protected by
          the index->lock.
        ------------------------------------------------------------
        revno: 3402.86.97
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 19:28:20 +1100
        message:
          WL#5522: Move check for table state to ibuf_should_try(). Lock all indexes of
          a table when changing the state of the table from QUIESCE_NONE to QUIESCE_INIT.
          The check in ibuf_should_try() will then be protected by the relevant index.
        ------------------------------------------------------------
        revno: 3402.86.96
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 14:44:52 +1100
        message:
          WL#5522: Fix log messages so that user is notified about the flush status
          of the table files.
        ------------------------------------------------------------
        revno: 3402.86.95
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 14:39:19 +1100
        message:
          WL#5522: Signal the purge thread before changing the purge state to stop and
          use the sig_count to avoid missing notification signals from purge stop.
        ------------------------------------------------------------
        revno: 3402.86.94
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 14:32:20 +1100
        message:
          WL#5522: Wakeup the purge thread before waiting for state change ACK.
        ------------------------------------------------------------
        revno: 3402.86.93
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 14:18:08 +1100
        message:
          WL#5522: Fix log messages.
        ------------------------------------------------------------
        revno: 3402.86.92
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 13:26:32 +1100
        message:
          WL#5522: Reduce number of purge threads in adaptive purge only if there is
          user activity.
        ------------------------------------------------------------
        revno: 3402.86.91
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 13:04:59 +1100
        message:
          WL#5522: If no change in history list length since last purge attempt then
          wait for new events that will be generated when new UNDO logs are added
          instead of doing timed waits.
        ------------------------------------------------------------
        revno: 3402.86.90
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 11:07:35 +1100
        message:
          WL#5522:  Use the purge states to check whether purge is running.
        ------------------------------------------------------------
        revno: 3402.86.89
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 10:54:13 +1100
        message:
          Remove srv_thread_has_reserved_slot() use purge states to check for startup
          and shutdown of purge threads.
        ------------------------------------------------------------
        revno: 3402.86.88
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 10:47:54 +1100
        message:
          WL#5522: Undo changes that were not used to fix the purge shutdown issue.
        ------------------------------------------------------------
        revno: 3402.86.87
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 10:22:05 +1100
        message:
          Increment the count when we wakeup a suspended thread.
        ------------------------------------------------------------
        revno: 3402.86.86
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 10:07:31 +1100
        message:
          srv_release_threads() - return ULINT_UNDEFINED if there are no threads active.
        ------------------------------------------------------------
        revno: 3402.86.85
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 10:03:48 +1100
        message:
          Ensure that the purge worker threads exit after the coordinator. This will
          ensure that the purge task queue is cleared before the worker threads exit.
        ------------------------------------------------------------
        revno: 3402.86.84 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-02-02 08:17:52 +1100
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.83
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-01 12:43:44 +1100
        message:
          1. Add an import flag to buf_page_is_corrupted() so that it doesn't spam the
          log with LSN in the future warnings.
          
          2. Add check for file offset == 0 when reading in a page during reset LSN.
          
          3. Fix some whitespace.
        ------------------------------------------------------------
        revno: 3402.86.82
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-01 12:22:20 +1100
        message:
          Fix assertion and check for end of string.
        ------------------------------------------------------------
        revno: 3402.86.81
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-01 12:21:50 +1100
        message:
          Cleanup and simplify the code.
        ------------------------------------------------------------
        revno: 3402.86.80
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-01 11:42:24 +1100
        message:
          Exit trx_purge() loop if the last attempt did not purge any records.
        ------------------------------------------------------------
        revno: 3402.86.79
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-01 08:28:03 +1100
        message:
          Set the purge state changes in the master thread only if the purge will happen
          via the master thread.
        ------------------------------------------------------------
        revno: 3402.86.78
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-01 08:13:21 +1100
        message:
          Set the purge state changes in the master thread too.
        ------------------------------------------------------------
        revno: 3402.86.77
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-01 08:05:26 +1100
        message:
          Handle the case for innodb-purge-threads=0.
        ------------------------------------------------------------
        revno: 3402.86.76 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-02-01 07:33:48 +1100
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.75
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-31 20:58:40 +1100
        message:
          Remove debug fprintf from row0purge.cc.
        ------------------------------------------------------------
        revno: 3402.86.74
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-31 20:56:36 +1100
        message:
          Check for purge states on startup and shutdown.
        ------------------------------------------------------------
        revno: 3402.86.73
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-31 12:03:23 +1100
        message:
          Handle the server state changes explicitly in the purge thread.
        ------------------------------------------------------------
        revno: 3402.86.72
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-31 11:15:59 +1100
        message:
          The slot->suspend flag can be cleared after the event times out but before the
          assertion is checked.
        ------------------------------------------------------------
        revno: 3402.86.71 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-31 09:05:41 +1100
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.70
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-01-30 14:54:00 +1100
        message:
          Revert printf back to an assertion in btr0cur.cc
          Do an explicit malloc/free in row0mysql.cc and srv0start.cc.
        ------------------------------------------------------------
        revno: 3402.86.69 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-01-30 13:16:55 +1100
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.68 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-25 10:23:42 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.67 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-24 08:37:48 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.66 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-01-22 09:02:19 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.65
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-01-20 18:34:06 +0530
        message:
          Remove debug code that was added to investigate a bug during development.
        ------------------------------------------------------------
        revno: 3402.86.64
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-01-20 16:49:14 +0530
        message:
          Use a ref count to manage purge stop calls from multiple threads/sessions.
        ------------------------------------------------------------
        revno: 3402.86.63
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-01-20 16:11:31 +0530
        message:
          Undo unrelated changes that were part of the original patch from Marko.
        ------------------------------------------------------------
        revno: 3402.86.62 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-01-20 09:59:48 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.61
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-01-20 09:51:20 +0530
        message:
          Remove dict_table_t::tablespace_discarded. The ibd_file_missing field in the
          same structure has subsumed its role.
          Fix error messages and handling of missing ibd file during table open.
          Load index definitions even if the .ibd file is missing.
          Add page_size to the .cfg file.
          Add DICT_TF2_DISCARDED flag, currently unused.
          Factor out a function for iterating over the SYS_INDEXES records for a
          matching table id from truncate table code.
        ------------------------------------------------------------
        revno: 3402.86.60
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-01-19 10:06:49 +0530
        message:
          Fix formatting.
        ------------------------------------------------------------
        revno: 3402.86.59
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-01-19 09:49:02 +0530
        message:
          Refactor the meta data read code.
          Add page size to the meta data file.
          Check the meta data info before we start the import.
        ------------------------------------------------------------
        revno: 3402.86.58 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-01-19 09:10:55 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.57 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-18 23:22:58 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.56
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-18 23:15:32 +0530
        message:
          Refactor the code.
          Add number of indexes to the meta-data file.
        ------------------------------------------------------------
        revno: 3402.86.55
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-18 17:46:29 +0530
        message:
          Change the meta-data file format from text to binary.
          struct meta_data {
          	ib_uint32_t	version;
          	list of {
          		ib_uint32_t	root_page_no;
          		ib_uint32_t	name_len;
          		char		name[name_len];
          	};
          };
          
          name_len includes the NUL byte.
          
          Remove the index parameter from the error reporting function.
        ------------------------------------------------------------
        revno: 3402.86.54
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-18 12:58:07 +0530
        message:
          Fix purge start/stop code:
            1. Partitions sync will call trx purge start for each partition
            2. Purge can be asleep when we attempt to stop it.
        ------------------------------------------------------------
        revno: 3402.86.53
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-18 09:40:54 +0530
        message:
          Fix warning log messages formatting.
        ------------------------------------------------------------
        revno: 3402.86.52 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-18 09:33:11 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.51
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-17 20:34:34 +0530
        message:
          Remove printfs.
          Add some debug code.
          Add a simple parser to read the .cfg file that contains the root pages.
          DB_ROW_ID is only present in non-unique indexes. Don't attempt to read and
          set the max row id for unique indexes.
        ------------------------------------------------------------
        revno: 3402.86.50
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-17 18:59:33 +0530
        message:
          Set err to DB_SUCCESS by default.
        ------------------------------------------------------------
        revno: 3402.86.49
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-17 14:00:59 +0530
        message:
          Change return value from ibool to db_err for some functions in fil0fil.cc.
          Handle the error codes in callers.
          Reset the index root page and space to 0 on discard.
        ------------------------------------------------------------
        revno: 3402.86.48 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-17 09:49:49 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.47
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-01-16 19:26:34 +0530
        message:
          Write out the table meta data (index root page numbers) to a text file.
        ------------------------------------------------------------
        revno: 3402.86.46
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-01-16 10:36:18 +0530
        message:
          Fix function names.
        ------------------------------------------------------------
        revno: 3402.86.45
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-01-16 10:32:07 +0530
        message:
          Clean up the re-factored code.
        ------------------------------------------------------------
        revno: 3402.86.44
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2012-01-16 10:28:31 +0530
        message:
          When we discard a tablespace we need to get rid of all the pages that were
          in use by the tablespace. Othwerwise when we import the tablespace we end
          up reading the old pages from the buffer pool cache.
        ------------------------------------------------------------
        revno: 3402.86.43
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-01-14 10:09:03 +0530
        message:
          Use the import tablespace specific transaction.
        ------------------------------------------------------------
        revno: 3402.86.42 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2012-01-14 10:08:26 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.41
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-01-13 19:46:46 +0530
        message:
          Refactor row_import_tablespace_for_mysql().
          Fix const parameters of affected functions.
          Move quiesce code to row0mysql.cc from ha_innodb.cc.
        ------------------------------------------------------------
        revno: 3402.86.40 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2012-01-13 10:24:52 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.39
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-01-12 14:23:26 +0530
        message:
          Add code to disable puge when we quiesce a tablespace.
        ------------------------------------------------------------
        revno: 3402.86.38
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-01-12 11:24:56 +0530
        message:
          Disable purge by acquiring the purge_sys->latch in S mode.
        ------------------------------------------------------------
        revno: 3402.86.37
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-01-12 10:39:55 +0530
        message:
          Fix the order of the parameters.
        ------------------------------------------------------------
        revno: 3402.86.36
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2012-01-12 10:21:55 +0530
        message:
          Remove ibuf_create_search_tuple that was added earlier, use existing function.
          Add new parameter FALSE to fil_delete_tablespace(), required after merge
          from upstream.
        ------------------------------------------------------------
        revno: 3402.86.35 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-11 22:36:14 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.34
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-11 10:14:45 +0530
        message:
          Remove redundant code.
          Add first part of quiesce state change serialization.
        ------------------------------------------------------------
        revno: 3402.86.33
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-11 10:13:58 +0530
        message:
          Fix the case where the page is flushed and we need to restart the flush.
        ------------------------------------------------------------
        revno: 3402.86.32
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2012-01-11 10:13:28 +0530
        message:
          Change search mode to GE from LE.
        ------------------------------------------------------------
        revno: 3402.86.31
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-10 10:31:31 +0530
        message:
          Disable change buffering if quiesce in progress.
        ------------------------------------------------------------
        revno: 3402.86.30
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-10 10:25:19 +0530
        message:
          Remove bogus micro-optimisation hints.
        ------------------------------------------------------------
        revno: 3402.86.29 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2012-01-10 08:04:02 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.28 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sun 2012-01-08 11:09:45 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.27 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2011-12-29 18:32:26 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.26 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2011-12-21 22:34:00 +0530
        message:
          Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.25 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2011-12-20 11:08:52 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.24 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2011-12-19 12:14:13 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.23 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Mon 2011-12-19 08:28:16 +0530
        message:
          Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.22
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2011-12-17 08:28:07 +0530
        message:
          Undo changes that disabled ibuf merge in the master thread.
        ------------------------------------------------------------
        revno: 3402.86.21 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2011-12-16 23:17:56 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.20 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2011-12-16 18:34:33 +0530
        message:
          Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.19 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2011-12-16 09:09:40 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.18
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2011-12-15 23:26:50 +0530
        message:
          Q&D hack to test code.
        ------------------------------------------------------------
        revno: 3402.86.17
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2011-12-15 20:25:28 +0530
        message:
          Add ibuf merge per tablespace functionality.
          Add flush of specific tablespace functionality.
          Not tested.
        ------------------------------------------------------------
        revno: 3402.86.16 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2011-12-15 00:36:33 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.15 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2011-12-14 09:10:28 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.14 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2011-12-14 03:47:05 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.13 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2011-12-07 06:00:23 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.12
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2011-12-06 08:44:41 +0530
        message:
          Fix format specifier.
        ------------------------------------------------------------
        revno: 3402.86.11 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2011-12-06 08:27:30 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.10 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Sat 2011-12-03 10:55:28 +0530
        message:
          Merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3402.86.9 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2011-12-02 06:50:24 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.8 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2011-11-29 22:20:37 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.7 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Tue 2011-11-29 22:18:14 +0530
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.6
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2011-11-25 18:23:09 +1100
        message:
          Add quiesce states.
          Add checks to determine that user has issued a:
          
            FLUSH TABLE t1,...,tn WITH READ LOCK;
        ------------------------------------------------------------
        revno: 3402.86.5
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2011-11-25 10:40:34 +1100
        message:
          Some bug fixes + remove UNIV_*LIKELY branch prediction hints and formatting.
        ------------------------------------------------------------
        revno: 3402.86.4 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Fri 2011-11-25 10:35:33 +1100
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.3 [merge]
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Thu 2011-11-24 07:16:49 +1100
        message:
          Merge from mysql-trunk.
        ------------------------------------------------------------
        revno: 3402.86.2
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2011-11-23 16:50:27 +1100
        message:
          Don't free the table locks vector on lock release at transaction commit.
        ------------------------------------------------------------
        revno: 3402.86.1
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: wl5522
        timestamp: Wed 2011-11-23 16:03:59 +1100
        message:
          Initial version.
    ------------------------------------------------------------
    revno: 3873.1.29
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-trunk
    timestamp: Tue 2012-05-22 23:13:57 +0100
    message:
      BUG#14021292 - 65152: MYSQL CAN'T START IF RELAY LOGS ARE REMOVED AND SKIP_SLAVE_START = 0 
      
      Disabled "Warning  1612  Being purged log ./slave-relay-bin.0* was not 
      found" because it is different on Unix and Windows systems.
    ------------------------------------------------------------
    revno: 3873.1.28 [merge]
    committer: Christopher Powers <chris.powers@oracle.com>
    branch nick: base_mysql-trunk
    timestamp: Tue 2012-05-22 12:51:27 -0500
    message:
      local merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3873.2.5
        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-05-22 18:03:04 +0100
        message:
          BUG#14021292 - 65152: MYSQL CAN'T START IF RELAY LOGS ARE REMOVED AND SKIP_SLAVE_START = 0
          
          If relay logs are removed after server stop without stopping 
          replication before, server is not able to start correctly.
          
          Current behaviour allows a correct server start, so server downtime is
          avoided.
          Replication threads are marked as failed, only after a RESET SLAVE and
          manual intervention they can be restarted. Manual intervention consists
          on restore relay logs, if available, and point slave to master binary
          file and position until which slave had applied updates.
    ------------------------------------------------------------
    revno: 3873.1.27
    committer: Christopher Powers <chris.powers@oracle.com>
    branch nick: mysql-trunk-thread_pool
    timestamp: Tue 2012-05-22 12:44:21 -0500
    message:
      Bug#13915235 - THREAD_POOL.THREAD_POOL_KILL_INNODB.TEST FAILS - ASSERT IN PFS.CC ON TRUNK
      
      The thread pool processes KILL commands by circumventing the typical thread_attach/detach
      sequence, causing a discrepancy in the thread contexts that the Performance Schema uses to
      track table locking.
      
      The more robust solution is to remove the assertion in the Performance Schema rather than
      modify the thread pool code,
    ------------------------------------------------------------
    revno: 3873.1.26 [merge]
    committer: Christopher Powers <chris.powers@oracle.com>
    branch nick: mysql-trunk-thread_pool
    timestamp: Tue 2012-05-22 12:36:49 -0500
    message:
      local merge from mysql-trunk
        ------------------------------------------------------------
        revno: 3873.2.4
        committer: Ole John Aske <ole.john.aske@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-05-22 11:24:50 +0200
        message:
          WL#5940: Forgot to 'bzr add' the abstract_query_plan files in the previous WL#5940 commit :-(
        ------------------------------------------------------------
        revno: 3873.2.3
        committer: Ole John Aske <ole.john.aske@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-05-22 11:03:56 +0200
        message:
          WL#5940: Handler extension and optimizer addaption required for pushed joins.
          
           
        ------------------------------------------------------------
        revno: 3873.2.2
        committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
        branch nick: mysql-trunk
        timestamp: Tue 2012-05-22 10:46:02 +0530
        message:
          Several tests are failing on mysql/daily trunk with "Thread stack overrun" on Solaris.Making these tests experimental since Alik is trying to setup a workaround.
        ------------------------------------------------------------
        revno: 3873.2.1
        committer: Sunny Bains <Sunny.Bains@Oracle.Com>
        branch nick: trunk
        timestamp: Tue 2012-05-22 07:28:07 +1000
        message:
          Remove dead code.
------------------------------------------------------------
revno: 3875 [merge]
committer: Gleb Shchepa <gleb.shchepa@oracle.com>
branch nick: trunk-wl6242
timestamp: Tue 2012-05-22 01:05:28 +0400
message:
  auto-merge from trunk to local tree
    ------------------------------------------------------------
    revno: 3873.1.25
    committer: Mayank Prasad <mayank.prasad@oracle.com>
    branch nick: md5
    timestamp: Mon 2012-05-21 18:08:40 +0530
    message:
      BUG#13784804 : REMOVE THE LEGACY SHA1 AND MD5 CODE FROM THE SERVER
      
      Details:
       - Removing MySQL implementation of MD5 and SHA1.
       - Removed -DWITH_SSL=no compile option for SSL. 
      
      NOTE:
        As per include/my_global.h, HAVE_OPENSSL is undefined in embedded library:
       
         #ifdef EMBEDDED_LIBRARY
       
         /* Things we don't need in the embedded version of MySQL */
         /* TODO HF add #undef HAVE_VIO if we don't want client in embedded library
         */
       
         #undef HAVE_OPENSSL
         #undef HAVE_SMEM                /* No shared memory */
       
         #endif /* EMBEDDED_LIBRARY */
       
        If embedded library is built with -DWITH_SSL=system option, earlier (before
        this bug) it was suppose to go into MySQL implementation of SSL but now this
        has been removed, so it wouldn't have SSL support.
    ------------------------------------------------------------
    revno: 3873.1.24 [merge]
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-trunk
    timestamp: Mon 2012-05-21 17:38:05 +0530
    message:
      Merge from mysql-5.5 to mysql-trunk. 
        ------------------------------------------------------------
        revno: 2875.376.55 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-5.5
        timestamp: Mon 2012-05-21 17:27:21 +0530
        message:
          Merge from mysql-5.1 to mysql-5.5
            ------------------------------------------------------------
            revno: 2661.840.20
            committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
            branch nick: mysql-5.1
            timestamp: Mon 2012-05-21 17:25:40 +0530
            message:
              Bug #12752572 61579: REPLICATION FAILURE WHILE
              INNODB_AUTOINC_LOCK_MODE=1 AND USING TRIGGER
              
              When an insert stmt like "insert into t values (1),(2),(3)" is
              executed, the autoincrement values assigned to these three rows are
              expected to be contiguous.  In the given lock mode
              (innodb_autoinc_lock_mode=1), the auto inc lock will be released
              before the end of the statement.  So to make the autoincrement
              contiguous for a given statement, we need to reserve the auto inc
              values at the beginning of the statement.  
              
              Modified the fix based on review comment by Svoj.  
    ------------------------------------------------------------
    revno: 3873.1.23
    committer: Jorgen Loland <jorgen.loland@oracle.com>
    branch nick: mysql-trunk-review
    timestamp: Mon 2012-05-21 13:48:38 +0200
    message:
      WL#6158 followup
      
      Move counting of partial plans to best_access_path().
    ------------------------------------------------------------
    revno: 3873.1.22
    committer: brajmohan saxena <brajmohan.saxena@oracle.com>
    branch nick: mysql-trunk
    timestamp: Mon 2012-05-21 17:14:04 +0530
    message:
                  BUG#13869401   :  MYSQL CLIENT EXITING IMMEDIATELY UPON LOGIN IN WINDOWS
            
                       Problem   : MySQL client exits immediately upon login in Windows XP and Windows2003
                                   due to failure of ReadConsoleW  API with Error code 8: not enough storage
                                   space to execute this command.this failure in Windows API is due to the size of
                                   number of characters to be read from console input buffer is more than 24530.
            
                      Solution  :  Reduced the size of number of characters to be read from console input buffer
                                   to 24530 in ReadConsoleW API.
    ------------------------------------------------------------
    revno: 3873.1.21 [merge]
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-merge
    timestamp: Mon 2012-05-21 11:27:56 +0200
    message:
      merge 5.5 => trunk
        ------------------------------------------------------------
        revno: 2875.376.54
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: 5.5
        timestamp: Mon 2012-05-21 10:47:12 +0200
        message:
          Bug#13986705 CRASH IN GET_INTERVAL_VALUE() WITH DATE CALCULATION WITH UTF32 INTERVALS
          
          This is a followup to the fix for Bug#12340997
          get_interval_value() was trying to parse the input string,
          looking for leading '-' while skipping whitespace.
          The macro my_isspace() does not work for utf32 character set,
          since my_charset_utf32_general_ci.ctype == NULL.
          
          Solution: convert input to ASCII before parsing,
          and use the character set of the returned ASCII string.
    ------------------------------------------------------------
    revno: 3873.1.20
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Sun 2012-05-20 09:44:07 +0300
    message:
      Synchronize access to mysql.innodb_(table|index)_stats with
      dict_sys->mutex to avoid deadlocks between operations that access
      both tables and lock wait timeouts (since trx->mysql_thd is NULL
      the trx cannot wait and the timeout happens instantly if some other
      thread is doing DML on mysql.innodb_(table|index)_stats).
    ------------------------------------------------------------
    revno: 3873.1.19
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Sun 2012-05-20 09:43:11 +0300
    message:
      Add the possibility to take a snapshot of the stats tables (under
      dict_sys->mutex) and later use that snapshot in dict_stats_save().
    ------------------------------------------------------------
    revno: 3873.1.18
    committer: Jorgen Loland <jorgen.loland@oracle.com>
    branch nick: mysql-trunk
    timestamp: Mon 2012-05-21 11:17:07 +0200
    message:
      BUG#13423851: CRASH IN ITEM_FIELD::ITEM_FIELD, WITH QUERY
                    USING A VIEW
      
      Original committer forgot to record ps-protocol
      optimizer trace result files.
    ------------------------------------------------------------
    revno: 3873.1.17
    committer: Jorgen Loland <jorgen.loland@oracle.com>
    branch nick: mysql-trunk
    timestamp: Mon 2012-05-21 10:06:45 +0200
    message:
      Bug#11754168 - PARTS OF INDEX_MERGE_INNODB.TEST ARE DISABLED 
                     DUE TO EXPLAIN DIFFS
      
      Trying to stabilize index_merge_innodb test
    ------------------------------------------------------------
    revno: 3873.1.16
    committer: Yasufumi Kinoshita <yasufumi.kinoshita@oracle.com>
    branch nick: mysql-trunk
    timestamp: Sat 2012-05-19 19:43:56 +0900
    message:
      Fix for Bug#13798956 : fix for flush_neighbors behavior to flush only contiguous pages
      innodb_flush_neighbors option is extended for supporting also the previous method
    ------------------------------------------------------------
    revno: 3873.1.15 [merge]
    committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
    branch nick: merge-13733221
    timestamp: Fri 2012-05-18 23:41:42 +0100
    message:
      auto-merge
        ------------------------------------------------------------
        revno: 3690.32.1
        committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
        branch nick: 56-13733221
        timestamp: Fri 2012-04-27 15:15:25 +0100
        message:
          BUG#13733221 - 64345: MYSQLD CRASHES ON SHUTDOWN WHEN SLOW LOG IS A PIPE
          
          We could not properly log to a named pipe as logging did not handle failing
          ftell() well. We now just ignore it if log-file is a pipe.
          
          A related error during shutdown tried to print a per-thread message without
          having a thd; we now use the default messages as we should.
    ------------------------------------------------------------
    revno: 3873.1.14 [merge]
    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
    branch nick: b13949735-t
    timestamp: Fri 2012-05-18 20:13:50 +0200
    message:
      merge
        ------------------------------------------------------------
        revno: 2875.376.53
        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
        branch nick: b13949735-55
        timestamp: Tue 2012-05-15 12:45:52 +0200
        message:
          bug#13949735: crash regression from bug#13694811.
          
          There can be cases when the optimizer calls ha_partition::records_in_range
          when there are no matching partitions. So the DBUG_ASSERT of
          !tot_used_partitions does assert.
          
          Fixed by returning 0 instead when no matching partitions are found.
          
          This will avoid the crash. records_in_range will then try to find the
          biggest used partition, which will not find any partition and
          records_in_range will then return 0, meaning non rows can be found.
          
          Patch contributed by Davi Arnaut at twitter.
    ------------------------------------------------------------
    revno: 3873.1.13
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-05-18 16:35:20 +0300
    message:
      Split an error message in two separate error messages so it is clear
      which of the two conditions failed - table not found or missing tablespace.
    ------------------------------------------------------------
    revno: 3873.1.12
    committer: Vasil Dimov <vasil.dimov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-05-18 12:32:41 +0300
    message:
      Make rename table and index stats to retry in case of a deadlock too.
    ------------------------------------------------------------
    revno: 3873.1.11
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-05-18 16:21:06 +0100
    message:
      BUG#13992602: BINLOGGING STATEMENTS WITH GTID CRASHES IN BOOTSTRAP MODE
      
      Bootstrap mode should only be used to initialize a new datadir with
      mysql_install_db, this initialization steps should not generate GTIDs
      because this steps are only meant for this server.
      
      When server is started on bootstrap mode, GTIDs and replication
      are automatically disabled.
    ------------------------------------------------------------
    revno: 3873.1.10
    committer: Martin Hansson <martin.hansson@oracle.com>
    branch nick: mysql-trunk-first-beautiful
    timestamp: Fri 2012-05-18 16:39:25 +0200
    message:
      Follow-up patch to WL#5874, moving the COPY_INFO class to sql_data_change.h and sql_data_change.cc.
    ------------------------------------------------------------
    revno: 3873.1.9
    committer: Martin Hansson <martin.hansson@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-05-18 16:08:49 +0200
    message:
      Bug#13423851: CRASH IN ITEM_FIELD::ITEM_FIELD, WITH QUERY
      USING A VIEW
      
      Queries with an ORDER BY clause are frequently executed
      using a temporary table, where some of the expressions from
      the select list are stored. The function create_tmp_table()
      chooses all select list expressions that are not constant
      during evaluation of the query (and some additional ones.)
      For column references that are resolved to a view which will
      be "merged", the Item_direct_view_ref object is asked, which
      checks that the expression does not reference any
      tables. The bug made it fail to include RAND_TABLE_BIT into
      the set of tables if the expression is a non-deterministic
      function.
      
      When execution begins, the data in the temporary table are
      needed. We now try to yet again infer the column's
      const-ness. But this time round the reference has been
      flattened (since the view was merged) and we are talking to
      the Item_func directly. And it knows that it's always
      non-constant, so obviously it thinks that create_tmp_table()
      must have set something up. But since it didn't, all we find
      is a NULL pointer.
      
      This fix implements a means to make sure RAND_TABLE_BIT is
      always set in used_tables() by creating a new interface
      get_initial_pseudo_tables(), the result of which must always
      be picked up whenever we cache the set of used tables. Hence
      all assignments of Item_func::used_tables_cache= 0 have been
      replaced by Item_func::used_tables_cache=
      get_initial_pseudo_tables(). This enables us to remove some
      other, more error-prone ways of setting RAND_TABLE_BIT.
      
      We make some changes to an optimizer_trace test:
      
      A non-deterministic stored procedure is used in a WHERE
      equality condition inside a subquery. The subquery is
      rewritten into a semijoin. Because the optimizer now
      correctly recognizes the stored procedure as
      non-deterministic, it does not consider using an index
      access on the outer table. This causes DuplicateWeedout to
      be used rather than the previously used FirstMatch. Because
      the strategy involves access to a temporary table, we need
      to make more room in the optimizer trace depth.
    ------------------------------------------------------------
    revno: 3873.1.8
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-05-18 18:11:17 +0530
    message:
      followup patch for BUG#14005409  fixing failure in i_rpl.rpl_query_cache_stmt. 
    ------------------------------------------------------------
    revno: 3873.1.7 [merge]
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-bug14039955rpad
    timestamp: Fri 2012-05-18 14:07:06 +0200
    message:
      merge 5.5 => trunk
        ------------------------------------------------------------
        revno: 2875.376.52
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: 5.5
        timestamp: Fri 2012-05-18 12:57:38 +0200
        message:
          Bug#14039955 RPAD FUNCTION LEADS TO UNINITIALIZED VALUES WARNING IN MY_STRTOD
          
          Rewrite the "parser" in my_strtod_int() to avoid
          reading past the end of the input string.
    ------------------------------------------------------------
    revno: 3873.1.6
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-05-18 17:27:06 +0530
    message:
      Moving "Additional run to test rpl HASH_SCAN & INDEX_SCAN" tests from default.daily to default.weekly since one of the mtr command is using "--big-test" option.
    ------------------------------------------------------------
    revno: 3873.1.5
    committer: Martin Hansson <martin.hansson@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-05-18 13:06:00 +0200
    message:
      Bug#13985071: DEPRECATE INSERT DELAYED
      
      Shows a deprecation message when parsing the DELAYED keyword. Two parser rules are affected, and a very convoluted replication test in create_recursive_construct.inc needed to be augmented. The rest is re-recorded MTR tests.
    ------------------------------------------------------------
    revno: 3873.1.4 [merge]
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-05-18 14:57:25 +0530
    message:
      upmerge from mysql-5.5 --> mysql-trunk
        ------------------------------------------------------------
        revno: 2875.376.51 [merge]
        committer: Rohit Kalhans <rohit.kalhans@oracle.com>
        branch nick: mysql-5.5
        timestamp: Fri 2012-05-18 14:53:23 +0530
        message:
          upmerge from mysql-5.1 -> mysql-5.5.
            ------------------------------------------------------------
            revno: 2661.840.19
            committer: Rohit Kalhans <rohit.kalhans@oracle.com>
            branch nick: mysql-5.1
            timestamp: Fri 2012-05-18 14:44:40 +0530
            message:
              BUG#14005409 - 64624
                    
              Problem: After the fix for Bug#12589870, a new field that
              stores the length of db name was added in the buffer that
              stores the query to be executed. Unlike for the plain user
              session, the replication execution did not allocate the
              necessary chunk in Query-event constructor. This caused an
              invalid read while accessing this field.
                    
              Solution: We fix this problem by allocating a necessary chunk
              in the buffer created in the Query_log_event::Query_log_event()
              and store the length of database name.
    ------------------------------------------------------------
    revno: 3873.1.3
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-05-18 13:02:45 +0530
    message:
      To skip certain tests from daily valgrind run.
    ------------------------------------------------------------
    revno: 3873.1.2
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: trunk
    timestamp: Fri 2012-05-18 10:55:20 +0400
    message:
      Follow-up for WL#4179 (Stored programs: validation of stored program statements).
      
      Use bigger stack-size constant for Solaris SPARC 64 only.
    ------------------------------------------------------------
    revno: 3873.1.1
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Fri 2012-05-18 16:49:30 +1000
    message:
      Add basic read view tests for InnoDB.
------------------------------------------------------------
revno: 3874
committer: Gleb Shchepa <gleb.shchepa@oracle.com>
branch nick: trunk-wl6242
timestamp: Fri 2012-05-18 00:54:59 +0400
message:
  WL#6242: Move "PROCEDURE ANALYSE" implementation
           to select_send-like class
  
  The outdated and undocumented "proceudre" API makes Optimizer
  refactoring tasks problematic.
  As far the API supports the only "ANALYSE" procedure, it was
  decided to remove it and relocate the "ANALYSE" procedure
  implementation to a simpler, select_send-like interceptor class.
------------------------------------------------------------
revno: 3873
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-17 21:38:50 +0300
message:
  Followup to vasil.dimov@oracle.com-20120517145619-2psjzr1lku2l8som
  
  The error message is present in to mtr files that need to be adjusted.
------------------------------------------------------------
revno: 3872 [merge]
committer: Mayank Prasad <mayank.prasad@oracle.com>
branch nick: trunk
timestamp: Thu 2012-05-17 22:38:46 +0530
message:
  merge from 5.5->trunk for Bug#11766101
    ------------------------------------------------------------
    revno: 2875.376.50
    committer: Mayank Prasad <mayank.prasad@oracle.com>
    branch nick: 5.5
    timestamp: Thu 2012-05-17 22:24:23 +0530
    message:
      Bug#11766101 : 59140: LIKE CONCAT('%',@A,'%') DOESN'T MATCH WHEN @A CONTAINS LATIN1 STRING
      
      Issue/Cause:
      Issue is of memory corruption.During optimization phase, pattern to be matched in where 
      clause, is prepared. This is done in Item_func_concat::val_str() function which forms the
      resultant string (tmp_value) and return its pointer. In caller, Item_func_like::fix_fields, 
      pattern is made to point to this string (tmp_value). In further processing, tmp_value is 
      getting modified which causes pattern to have changed/wrong values.
      
      Fix:
      Allocate its own memroy location in caller, copy value of resultant string (tmp_value) 
      into that and make pattern to point to that. This makes sure no further changes to 
      tmp_value will affect pattern.
------------------------------------------------------------
revno: 3871
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk
timestamp: Thu 2012-05-17 20:15:44 +0400
message:
  Follow-up for WL#4179: increase check-stack-size for sp_head::execute().
------------------------------------------------------------
revno: 3870
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-17 17:56:19 +0300
message:
  Reword the error message if innodb stats tables are not present.
------------------------------------------------------------
revno: 3869
committer: Praveenkumar Hulakund <praveenkumar.hulakund@oracle.com>
branch nick: trunk-new
timestamp: Thu 2012-05-17 19:08:46 +0530
message:
  BUG#13812961 - ASSERT: 'REMOVE_TYPE == TDC_RT_REMOVE_UNUSED..' 
                 TDC_REMOVE_TABLE / LOCK_IO_CACHE 
  
  Analysis:
  -------------
  When creating a view, exclusive metadata lock should be taken on the view
  name. If CREATE VIEW has SELECT with "LOCK IN SHARE MODE" set then
  shared lock should be taken on all the table names used in SELECT.
  
  The TABLE_LIST object of view is part of the LEX->current_select while 
  creating the view. So while requesting the shared lock for all tables
  of "LEX->current_select", shared lock MDL request is made on view also.
  Lock type of the VIEW was therefore by mistake reset for EXCLUSIVE to 
  SHARED.  
  
  Since, the lock on view should be exclusive lock, in "tdc_remove_table"
  function, assert to check lock type fails.
  
  Even create view with "SELECT...... FOR UPDATE" also cause this issue.
  
  Users should not be allowed to create view when database is in 
  "read_only" mode. But because of this bug, users are allowed to
  CREATE VIEW. 
  
  Fix:
  -------------
  While creating the table as below,
        CREATE TABLE t1 AS SELECT * FROM t1 LOCK IN SHARED MODE
            OR
        CREATE TABLE t1 AS SELECT * FROM t1 FOR UPDATE
  
  After parsing table "t1", exclusive lock is taken on t1. Then while
  parsing SELECT query, if "LOCK IN SHARED MODE" or "FOR UPDATE" is found
  then all the non-select tables are removed from the 
  "LEX->current_select->table_list". Lock Type "Shared Lock" in case
  "LOCK IN SHARED MODE" and "WRITE LOCK" is set in case "FOR UPDATE" on 
  only tables of SELECT query. After completion of SELECT query parsing, 
  all non-select tables are pushed to the front of 
  "LEX->current_select->table_list".
  
  Similarly to fix this issue, parsing code is changed to remove non-select 
  view tables from the "LEX->current_select->table_list". Required MDL Lock
  type is set on the select tables only. Once select query parsing is over 
  then view table is pushed to the front of 
  "LEX->current_select->table_list".
  
  Setting proper lock type for CREATE VIEW table(/view) names also fixes the
  issue of, creating a view while database is in "read_only" mode.
------------------------------------------------------------
revno: 3868 [merge]
committer: Gopal Shankar <gopal.shankar@oracle.com>
branch nick: thdctxdeadlock-trunk
timestamp: Thu 2012-05-17 18:25:26 +0530
message:
  null merge for Bug#12636001
    ------------------------------------------------------------
    revno: 2875.376.49 [merge]
    committer: Gopal Shankar <gopal.shankar@oracle.com>
    branch nick: thdctxdeadlock-55
    timestamp: Thu 2012-05-17 18:21:45 +0530
    message:
       null merge for Bug#12636001
        ------------------------------------------------------------
        revno: 2661.840.18
        committer: Gopal Shankar <gopal.shankar@oracle.com>
        branch nick: thdctxdeadlock-51
        timestamp: Thu 2012-05-17 18:07:59 +0530
        message:
          Bug#12636001 : deadlock from thd_security_context
          
          PROBLEM:
          Threads end-up in deadlock due to locks acquired as described
          below,
          
          con1: Run Query on a table. 
            It is important that this SELECT must back-off while
            trying to open the t1 and enter into wait_for_condition().
            The SELECT then is blocked trying to lock mysys_var->mutex
            which is held by con3. The very significant fact here is
            that mysys_var->current_mutex will still point to LOCK_open,
            even if LOCK_open is no longer held by con1 at this point.
          
          con2: Try dropping table used in con1 or query some table.
            It will hold LOCK_open and be blocked trying to lock
            kernel_mutex held by con4.
          
          con3: Try killing the query run by con1.
            It will hold THD::LOCK_thd_data belonging to con1 while
            trying to lock mysys_var->current_mutex belonging to con1.
            But current_mutex will point to LOCK_open which is held
            by con2.
          
          con4: Get innodb engine status
            It will hold kernel_mutex, trying to lock THD::LOCK_thd_data
            belonging to con1 which is held by con3.
          
          So while technically only con2, con3 and con4 participate in the
          deadlock, con1's mysys_var->current_mutex pointing to LOCK_open
          is a vital component of the deadlock.
          
          CYCLE = (THD::LOCK_thd_data -> LOCK_open ->
                   kernel_mutex -> THD::LOCK_thd_data)
          
          FIX:
          LOCK_thd_data has responsibility of protecting,
          1) thd->query, thd->query_length
          2) VIO
          3) thd->mysys_var (used by KILL statement and shutdown)
          4) THD during thread delete.
          
          Among above responsibilities, 1), 2)and (3,4) seems to be three
          independent group of responsibility. If there is different LOCK
          owning responsibility of (3,4), the above mentioned deadlock cycle
          can be avoid. This fix introduces LOCK_thd_kill to handle
          responsibility (3,4), which eliminates the deadlock issue.
          
          Note: The problem is not found in 5.5. Introduction MDL subsystem 
          caused metadata locking responsibility to be moved from TDC/TC to
          MDL subsystem. Due to this, responsibility of LOCK_open is reduced. 
          As the use of LOCK_open is removed in open_table() and 
          mysql_rm_table() the above mentioned CYCLE does not form.
          Revision ID for changes,
          open_table() = dlenev@mysql.com-20100727133458-m3ua9oslnx8fbbvz
          mysql_rm_table() = jon.hauglid@oracle.com-20101116100012-kxep9txz2fxy3nmw
------------------------------------------------------------
revno: 3867
committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
branch nick: bug13713205-trunk
timestamp: Thu 2012-05-17 15:10:48 +0300
message:
  Bug #13713205: upgrade yassl from 1.7.2 to 2.1.4 for mysql-trunk 
     
  Upgraded the baseline yassl library to 2.1.4. 
  Done by taking the diff against the previous baseline (1.7.2) and 
  applying it to the new baseline (2.1.4).
------------------------------------------------------------
revno: 3866
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk-bug14057174
timestamp: Thu 2012-05-17 15:11:26 +0400
message:
  Bug#14057174: VALGRIND FAILURE OBSERVED IN MAIN.SP-BUGS ON MYSQL-TRUNK.
  
  The cause of this bug was wrong merge.
------------------------------------------------------------
revno: 3865 [merge]
committer: Nuno Carvalho <nuno.carvalho@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-17 11:49:32 +0100
message:
  Merge from mysql-5.5 into mysql-trunk.
    ------------------------------------------------------------
    revno: 2875.376.48 [merge]
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-5.5
    timestamp: Thu 2012-05-17 11:46:11 +0100
    message:
      Merge from mysql-5.1 into mysql-5.5.
        ------------------------------------------------------------
        revno: 2661.840.17
        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
        branch nick: mysql-5.1
        timestamp: Thu 2012-05-17 11:41:46 +0100
        message:
          Added combinations file to i_rpl suite.
------------------------------------------------------------
revno: 3864 [merge]
committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-17 10:21:55 +0530
message:
  Null merge from mysql-5.5 to mysql-trunk. 
    ------------------------------------------------------------
    revno: 2875.376.47 [merge]
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-5.5
    timestamp: Thu 2012-05-17 10:19:53 +0530
    message:
      Merging from mysql-5.1 to mysql-5.5 
        ------------------------------------------------------------
        revno: 2661.840.16
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-5.1
        timestamp: Thu 2012-05-17 10:15:54 +0530
        message:
          Fixing a pb2 test case.  All debug_sync test cases
          must include have_debug_sync.inc.  
------------------------------------------------------------
revno: 3863
committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-17 10:05:04 +0530
message:
  Fix for a failing pb2 test.  All debug sync test
  case must include have_debug_sync.inc. 
------------------------------------------------------------
revno: 3862
committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-17 09:44:02 +0530
message:
  Fixing a failing test case in pb2.  While merging I 
  forgot to correct the result file.  
------------------------------------------------------------
revno: 3861
committer: Jimmy Yang <jimmy.yang@oracle.com>
branch nick: trunk4
timestamp: Thu 2012-05-17 09:21:00 +0800
message:
  Fix Bug #14067205 - SEGV FTS_FREE() FTS_OPTIMIZE_THREAD(), IN NORMAL SHUTDOWN
  
  rb://1076 approved by Sunny Bains
------------------------------------------------------------
revno: 3860
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk-stage.2
timestamp: Wed 2012-05-16 17:58:54 +0400
message:
  Follow-up patch for WL#4179 (Stored programs: validation of
  stored program statements).
  
  Refactoring: moving SP-instructions from sp_head.h/.cc to new
  sp_instr.h/.cc.
------------------------------------------------------------
revno: 3859 [merge]
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk-stage.2
timestamp: Wed 2012-05-16 17:33:37 +0400
message:
  Auto-merge from trunk.
    ------------------------------------------------------------
    revno: 3855.1.4
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-16 16:48:56 +0530
    message:
      Fixing the failing test in pb2.  
    ------------------------------------------------------------
    revno: 3855.1.3 [merge]
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-16 16:38:59 +0530
    message:
      merge from mysql-5.5 to mysql-trunk. 
        ------------------------------------------------------------
        revno: 2875.376.46 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-5.5
        timestamp: Wed 2012-05-16 16:38:02 +0530
        message:
          null merge from mysql-5.1 to mysql-5.5
            ------------------------------------------------------------
            revno: 2661.840.15
            committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
            branch nick: mysql-5.1
            timestamp: Wed 2012-05-16 16:36:49 +0530
            message:
              Bug #13943231: ALTER TABLE AFTER DISCARD MAY CRASH THE SERVER
              
              The following scenario crashes our mysql server:
              
              1.  set global innodb_file_per_table=1;
              2.  create table t1(c1 int) engine=innodb;
              3.  alter table t1 discard tablespace;
              4.  alter table t1 add unique index(c1);
              
              Step 4 crashes the server.  This patch introduces a check on discarded
              tablespace to avoid the crash.
              
              rb://1041 approved by Marko Makela
    ------------------------------------------------------------
    revno: 3855.1.2 [merge]
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-16 16:35:14 +0530
    message:
      null merge from mysql-5.5 to mysql-trunk. 
        ------------------------------------------------------------
        revno: 2875.376.45 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-5.5
        timestamp: Wed 2012-05-16 16:33:22 +0530
        message:
          Merge from mysql-5.1 to mysql-5.5. 
    ------------------------------------------------------------
    revno: 3855.1.1 [merge]
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-16 16:31:58 +0530
    message:
      Null merge from mysql-5.5 to mysql-trunk. 
        ------------------------------------------------------------
        revno: 2875.385.1 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-5.5
        timestamp: Wed 2012-05-16 16:29:52 +0530
        message:
          Merge from mysql-5.1 to mysql-5.5. 
------------------------------------------------------------
revno: 3858
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk-stage.2
timestamp: Wed 2012-05-16 16:38:01 +0400
message:
  WL#6230: Remove 'SET = DEFAULT'.
  
  This patch forbids assigning the DEFAULT keyword
  to stored program local variables or stored procedure
  parameters.
------------------------------------------------------------
revno: 3857
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk-stage.2
timestamp: Wed 2012-05-16 16:36:41 +0400
message:
  WL#4179: Stored programs: validation of stored program statements.
  
  Briefly, that's the implementation of WL#4179. The idea is to remember
  the original query for SQL-statement within a Stored Programs and re-parse
  it when meta-data has changed.
------------------------------------------------------------
revno: 3856
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk-stage.2
timestamp: Wed 2012-05-16 15:03:43 +0400
message:
  Prerequisite patch for WL#4179: Stored programs: validation of stored
  program statements.
  
  This patch contains the following refactorings:
  
    - Introduce enum_sp_type enum with type-code constants for stored
      procedures, functions and triggers (SP_TYPE_FUNCTION,
      SP_TYPE_PROCEDURE, SP_TYPE_TRIGGER). Those constants should be used
      instead of TYPE_ENUM_ macros.
  
    - Introduce sp_start_parsing() and sp_finish_parsing() functions to be
      used in the parser instead of the typical sequence of operations
      (including reset_thd_mem_root() and restore_thd_mem_root()).
  
    - Introduce sp_parser_data class -- the class that contains attributes
      used at the SP-parsing time only. sp_parser_data has been extracted
      from sp_head.
  
    - Get rid of sp_head::m_tmp_query -- a pointer, which pointed to
      different things. Introduced various push_xxx_ptr() / pop_xxx_ptr()
      instead.
  
    - Move LEX::trg_table_fields to sp_head::m_trg_table_fields.
  
    - Move LEX::trg_chistics to sp_head::m_trg_chistics.
  
    - Use Table_triggers_list::trigger_table in a member function
      (Table_triggers_list::prepare_record1_accessors) instead of passing
      the table object by argument.
  
    - Change ambiguous names
      - THD::spcont -> THD::sp_runtime_ctx
      - LEX::spcont -> LEX::sp_current_parsing_ctx
      - sp_head::m_pcont -> sp_head::m_parsing_ctx
      - sp_head::get_parse_ctx() -> sp_head::get_parsing_ctx()
      - sp_head::m_parsing_ctx -> sp_head::m_root_parsing_ctx
      - sp_head::push_backpatch() -> sp_parser_data::add_backpatch_entry()
      - sp_head::push_cont_backpatch() -> sp_parser_data::add_cont_backpatch_entry()
      - sp_head::backpatch() -> sp_parser_data::do_backpatch()
      - bp_t -> Backpatch_info
      - bp_t::lab -> Backpatch_info::label
      - sp_instr::is_marked() -> sp_instr::opt_is_marked()
  
    - Make LEX::sp_current_parsing_ctx private and provide get/set accessors
      for it.
  
    - Remove sp_runtime_ctx_saved from sp_head::execute() as it is not used.
  
    - Combine sp_pcontext::register_case_expr() and
      sp_pcontext::push_case_expr_id().
  
    - Add two new methods in the Dynamic_array template:
      - elements(uint) to directly assign the number of elements;
      - set(index, element) to directly assign item at the given index.
  
    - Change sp_head::m_instr to be of Dynamic_array instead of
      DYNAMIC_ARRAY.
  
    - Make operations return bool instead of int, use boolean values instead
      of numbers.
  
    - Avoid SP-variable substitution for SET-statements. It did not work
      properly anyway -- the positions of Item_splocal were not properly
      calculated.  In any case, it does not make sense to do the substitution
      for SET-statememnts, because they are not bin-logged.
  
    - Use placement new explicitly for SP-instruction instantiations.
  
    - Use accessors (sp_head::get_ip()) instead of attibutes (sp_head::m_ip).
  
    - Move global functions out of sp_head.h/.cc to sp.h/.cc
  
    - Introduce sp_printable interface to be used in the Optimizer Traces
      (to avoid using sp_instr there).
  
    - Introduce sp_branch_instr class -- an interface for all SP-instructions
      with destinations that need to be updated by the SP-optimizer.
  
    - Introduce sp_lex_instr class -- base class for SP-instructions, whose
      execution is based on expression evaluation.
------------------------------------------------------------
revno: 3855 [merge]
committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-05-16 16:27:57 +0530
message:
  Merging changes from mysql-5.5 to mysql-trunk.  
  The fix is diff in mysql-trunk.
  rb://1041 approved by Marko Makela
  rb://1044 approved by Marko Makela
    ------------------------------------------------------------
    revno: 2875.384.1 [merge]
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-5.5
    timestamp: Wed 2012-05-16 15:44:25 +0530
    message:
      Merge from mysql-5.1 to mysql-5.5. 
        ------------------------------------------------------------
        revno: 2661.846.1
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-5.1
        timestamp: Wed 2012-05-16 15:23:56 +0530
        message:
          Bug #13943231: ALTER TABLE AFTER DISCARD MAY CRASH THE SERVER
          
          The following scenario crashes our mysql server:
          
          1.  set global innodb_file_per_table=1;
          2.  create table t1(c1 int) engine=innodb;
          3.  alter table t1 discard tablespace;
          4.  alter table t1 add unique index(c1);
          
          Step 4 crashes the server.  This patch introduces a check on discarded
          tablespace to avoid the crash.
          
          rb://1041 approved by Marko Makela
------------------------------------------------------------
revno: 3854 [merge]
committer: Venkata Sidagam <venkata.sidagam@oracle.com>
branch nick: mysql-5.6-13955256
timestamp: Wed 2012-05-16 16:21:54 +0530
message:
  merge from 5.5 to trunk
    ------------------------------------------------------------
    revno: 2875.376.44 [merge]
    committer: Venkata Sidagam <venkata.sidagam@oracle.com>
    branch nick: mysql-5.5-13955256
    timestamp: Wed 2012-05-16 16:19:20 +0530
    message:
      Null merge from 5.1 to 5.5
        ------------------------------------------------------------
        revno: 2661.840.14
        committer: Venkata Sidagam <venkata.sidagam@oracle.com>
        branch nick: mysql-5.1-13955256
        timestamp: Wed 2012-05-16 16:14:27 +0530
        message:
          Bug #13955256: KEYCACHE CRASHES, CORRUPTIONS/HANGS WITH, 
                         FULLTEXT INDEX AND CONCURRENT DML.
          
          Problem Statement:
          ------------------
          1) Create a table with FT index.
          2) Enable concurrent inserts.
          3) In multiple threads do below operations repeatedly
             a) truncate table
             b) insert into table ....
             c) select ... match .. against .. non-boolean/boolean mode
          
          After some time we could observe two different assert core dumps
          
          Analysis:
          --------
          1)assert core dump at key_read_cache():
          Two select threads operating in-parallel on same key 
          root block.
          1st select thread block->status is set to BLOCK_ERROR 
          because the my_pread() in read_block() is returning '0'. 
          Truncate table made the index file size as 1024 and pread 
          was asked to get the block of count bytes(1024 bytes) 
          from offset of 1024 which it cannot read since its 
          "end of file" and retuning '0' setting 
          "my_errno= HA_ERR_FILE_TOO_SHORT" and the key_file_length, 
          key_root[0] is same i.e. 1024. Since block status has BLOCK_ERROR 
          the 1st select thread enter into the free_block() and will 
          be under wait on conditional mutex by making status as 
          BLOCK_REASSIGNED and goes for wait_on_readers(). Other select 
          thread will also work on the same block and sees the status as 
          BLOCK_ERROR and enters into free_block(), checks for BLOCK_REASSIGNED 
          and asserting the server.
          
          2)assert core dump at key_write_cache():
          One select thread and One insert thread.
          Select thread gets the unlocks the 'keycache->cache_lock', 
          which allows other threads to continue and gets the pread() 
          return value as'0'(please see the explanation above) and 
          tries to get the lock on 'keycache->cache_lock' and waits 
          there for the lock.
          Insert thread requests for the block, block will be assigned 
          from the hash list and makes the page_status as 
          'PAGE_WAIT_TO_BE_READ' and goes for the read_block(), waits 
          in the queue since there are some other threads performing 
          reads on the same block.
          Select thread which was waiting for the 'keycache->cache_lock' 
          mutex in the read_block() will continue after getting the my_pread() 
          value as '0' and sets the block status as BLOCK_ERROR and goes to 
          the free_block() and go to the wait_for_readers().
          Now the insert thread will awake and continues. and checks 
          block->status as not BLOCK_READ and it asserts.  
          
          Fix:
          ---
          In the full text code, multiple readers of index file is not guarded. 
          Hence added below below code in _ft2_search() and walk_and_match().
          
          to lock the key_root I have used below code in _ft2_search()
           if (info->s->concurrent_insert)
              mysql_rwlock_rdlock(&share->key_root_lock[0]);
          
          and to unlock 
           if (info->s->concurrent_insert)
             mysql_rwlock_unlock(&share->key_root_lock[0]);
------------------------------------------------------------
revno: 3853 [merge]
committer: Venkata Sidagam <venkata.sidagam@oracle.com>
branch nick: mysql-5.6-13955256
timestamp: Wed 2012-05-16 16:08:52 +0530
message:
  Null merge
    ------------------------------------------------------------
    revno: 2875.376.43 [merge]
    committer: Venkata Sidagam <venkata.sidagam@oracle.com>
    branch nick: mysql-5.5-13955256
    timestamp: Wed 2012-05-16 16:06:07 +0530
    message:
      Merging the fix from mysql-5.1 to mysql-5.5
------------------------------------------------------------
revno: 3852 [merge]
committer: Venkata Sidagam <venkata.sidagam@oracle.com>
branch nick: mysql-5.6-13955256
timestamp: Wed 2012-05-16 15:58:00 +0530
message:
  Merging the fix from mysql-5.5 to mysql-trunk
    ------------------------------------------------------------
    revno: 2875.383.1 [merge]
    committer: Venkata Sidagam <venkata.sidagam@oracle.com>
    branch nick: mysql-5.5-13955256
    timestamp: Wed 2012-05-16 15:30:45 +0530
    message:
      Merging the fix from mysql-5.1 to mysql-5.5
        ------------------------------------------------------------
        revno: 2661.845.1
        committer: Venkata Sidagam <venkata.sidagam@oracle.com>
        branch nick: mysql-5.1-13955256
        timestamp: Wed 2012-05-16 13:55:22 +0530
        message:
          Bug #13955256: KEYCACHE CRASHES, CORRUPTIONS/HANGS WITH, 
                         FULLTEXT INDEX AND CONCURRENT DML.
          
          Problem Statement:
          ------------------
          1) Create a table with FT index.
          2) Enable concurrent inserts.
          3) In multiple threads do below operations repeatedly
             a) truncate table
             b) insert into table ....
             c) select ... match .. against .. non-boolean/boolean mode
          
          After some time we could observe two different assert core dumps
          
          Analysis:
          --------
          1)assert core dump at key_read_cache():
          Two select threads operating in-parallel on same key 
          root block.
          1st select thread block->status is set to BLOCK_ERROR 
          because the my_pread() in read_block() is returning '0'. 
          Truncate table made the index file size as 1024 and pread 
          was asked to get the block of count bytes(1024 bytes) 
          from offset of 1024 which it cannot read since its 
          "end of file" and retuning '0' setting 
          "my_errno= HA_ERR_FILE_TOO_SHORT" and the key_file_length, 
          key_root[0] is same i.e. 1024. Since block status has BLOCK_ERROR 
          the 1st select thread enter into the free_block() and will 
          be under wait on conditional mutex by making status as 
          BLOCK_REASSIGNED and goes for wait_on_readers(). Other select 
          thread will also work on the same block and sees the status as 
          BLOCK_ERROR and enters into free_block(), checks for BLOCK_REASSIGNED 
          and asserting the server.
          
          2)assert core dump at key_write_cache():
          One select thread and One insert thread.
          Select thread gets the unlocks the 'keycache->cache_lock', 
          which allows other threads to continue and gets the pread() 
          return value as'0'(please see the explanation above) and 
          tries to get the lock on 'keycache->cache_lock' and waits 
          there for the lock.
          Insert thread requests for the block, block will be assigned 
          from the hash list and makes the page_status as 
          'PAGE_WAIT_TO_BE_READ' and goes for the read_block(), waits 
          in the queue since there are some other threads performing 
          reads on the same block.
          Select thread which was waiting for the 'keycache->cache_lock' 
          mutex in the read_block() will continue after getting the my_pread() 
          value as '0' and sets the block status as BLOCK_ERROR and goes to 
          the free_block() and go to the wait_for_readers().
          Now the insert thread will awake and continues. and checks 
          block->status as not BLOCK_READ and it asserts.  
          
          Fix:
          ---
          In the full text code, multiple readers of index file is not guarded. 
          Hence added below below code in _ft2_search() and walk_and_match().
          
          to lock the key_root I have used below code in _ft2_search()
           if (info->s->concurrent_insert)
              mysql_rwlock_rdlock(&share->key_root_lock[0]);
          
          and to unlock 
           if (info->s->concurrent_insert)
             mysql_rwlock_unlock(&share->key_root_lock[0]);
------------------------------------------------------------
revno: 3851 [merge]
committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-05-16 14:13:38 +0530
message:
  Null merge from mysql-5.5 to mysql-trunk. 
    ------------------------------------------------------------
    revno: 2875.376.42 [merge]
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-5.5
    timestamp: Wed 2012-05-16 14:10:18 +0530
    message:
      Merge from mysql-5.1 to mysql-5.5. 
------------------------------------------------------------
revno: 3850 [merge]
committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-05-16 14:07:43 +0530
message:
  Merge from mysql-5.5 to mysql-trunk. 
    ------------------------------------------------------------
    revno: 2875.382.1 [merge]
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-5.5
    timestamp: Wed 2012-05-16 12:16:36 +0530
    message:
      Merge from mysql-5.1 to mysql-5.5. 
        ------------------------------------------------------------
        revno: 2661.840.13
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-5.1
        timestamp: Wed 2012-05-16 11:17:48 +0530
        message:
          Bug #12752572 61579: REPLICATION FAILURE WHILE
          INNODB_AUTOINC_LOCK_MODE=1 AND USING TRIGGER
          
          When an insert stmt like "insert into t values (1),(2),(3)" is
          executed, the autoincrement values assigned to these three rows are
          expected to be contiguous.  In the given lock mode
          (innodb_autoinc_lock_mode=1), the auto inc lock will be released
          before the end of the statement.  So to make the autoincrement
          contiguous for a given statement, we need to reserve the auto inc
          values at the beginning of the statement.  
          
          rb://1074 approved by Alexander Nozdrin
------------------------------------------------------------
revno: 3849
committer: Alexander Barkov <alexander.barkov@oracle.com>
branch nick: mysql-trunk.item_name4
timestamp: Wed 2012-05-16 12:24:00 +0400
message:
  Removing Item_return_date_time and using Item_temporal instead,
  as it has all the functionality needed for SHOW purposes.
------------------------------------------------------------
revno: 3848 [merge]
committer: Olav Sandstaa <olav.sandstaa@oracle.com>
branch nick: icp-range-fix
timestamp: Wed 2012-05-16 10:13:19 +0200
message:
  Merging fix for Bug#12667154 from mysql-5.5 to mysql-trunk.
    ------------------------------------------------------------
    revno: 2875.376.41
    committer: Olav Sandstaa <olav.sandstaa@oracle.com>
    branch nick: icp-range-fix-5.5
    timestamp: Wed 2012-05-16 09:49:23 +0200
    message:
      Fix for Bug#12667154 SAME QUERY EXEC AS WHERE SUBQ GIVES DIFFERENT
                           RESULTS ON IN() & NOT IN() COMP #3
      
      This bug causes a wrong result in mysql-trunk when ICP is used
      and bad performance in mysql-5.5 and mysql-trunk.
      
      Using the query from bug report to explain what happens and causes
      the wrong result from the query when ICP is enabled:
      
      1. The t3 table contains four records. The outer query will read
         these and for each of these it will execute the subquery.
      
      2. Before the first execution of the subquery it will be optimized. In
         this case the important is what happens to the first table t1:
         -make_join_select() will call the range optimizer which decides
          that t1 should be accessed using a range scan on the k1 index
          It creates a QUICK_RANGE_SELECT object for this.
         -As the last part of optimization the ICP code pushes the
          condition down to the storage engine for table t1 on the k1 index.
      
         This produces the following information in the explain for this table:
      
           2 DEPENDENT SUBQUERY t1 range k1 k1 5 NULL 3 Using index condition; Using filesort
      
         Note the use of filesort.
      
      3. The first execution of the subquery does (among other things) due
         to the need for sorting:
         a. Call create_sort_index() which again will call find_all_keys():
         b. find_all_keys() will read the required keys for all qualifying
            rows from the storage engine. To do this it checks if it has a
            quick-select for the table. It will use the quick-select for
            reading records. In this case it will read four records from the
            storage engine (based on the range criteria). The storage engine
            will evaluate the pushed index condition for each record.
         c. At the end of create_sort_index() there is code that cleans up a
            lot of stuff on the join tab. One of the things that is cleaned
            is the select object. The result of this is that the
            quick-select object created in make_join_select is deleted.
      
      4. The second execution of the subquery does the same as the first but
         the result is different:
         a. Call create_sort_index() which again will call find_all_keys()
            (same as for the first execution)
         b. find_all_keys() will read the keys from the storage engine. To
            do this it checks if it has a quick-select for the table. Now
            there is NO quick-select object(!) (since it was deleted in
            step 3c). So find_all_keys defaults to read the table using a
            table scan instead. So instead of reading the four relevant records
            in the range it reads the entire table (6 records). It then
            evaluates the table's condition (and here it goes wrong). Since
            the entire condition has been pushed down to the storage engine
            using ICP all 6 records qualify. (Note that the storage engine
            will not evaluate the pushed index condition in this case since
            it was pushed for the k1 index and now we do a table scan
            without any index being used).
            The result is that here we return six qualifying key values
            instead of four due to not evaluating the table's condition.
         c. As above.
      
      5. The two last execution of the subquery will also produce wrong results
         for the same reason.
      
      Summary: The problem occurs due to all but the first executions of the
      subquery is done as a table scan without evaluating the table's
      condition (which is pushed to the storage engine on a different
      index). This is caused by the create_sort_index() function deleting
      the quick-select object that should have been used for executing the
      subquery as a range scan.
      
      Note that this bug in addition to causing wrong results also can
      result in bad performance due to executing the subquery using a table
      scan instead of a range scan. This is an issue in MySQL 5.5.
      
      The fix for this problem is to avoid that the Quick-select-object that
      the optimizer created is deleted when create_sort_index() is doing
      clean-up of the join-tab. This will ensure that the quick-select
      object and the corresponding pushed index condition will be available
      and used by all following executions of the subquery.
------------------------------------------------------------
revno: 3847 [merge]
committer: Olav Sandstaa <olav.sandstaa@oracle.com>
branch nick: trunk-tmp
timestamp: Wed 2012-05-16 09:22:13 +0200
message:
  Merging backporting of subquery test.
    ------------------------------------------------------------
    revno: 2875.376.40
    committer: Olav Sandstaa <olav.sandstaa@oracle.com>
    branch nick: 5.5-tmp
    timestamp: Wed 2012-05-16 09:18:57 +0200
    message:
      Backporting the subquery test file from mysql-trunk to mysql-5.5.
      Note that it is intentionally empty in mysql-5.5.
------------------------------------------------------------
revno: 3846
committer: Alexander Barkov <alexander.barkov@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-05-16 10:42:17 +0400
message:
  Fixing naming convension:
  SimpleCString  -> Simple_cstring
  NameString     -> Name_string
  ItemNameString -> Item_name_string
------------------------------------------------------------
revno: 3845 [merge]
committer: Nuno Carvalho <nuno.carvalho@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-05-15 22:24:58 +0100
message:
  BUG#11754117 - 45670: INTVAR_EVENTS FOR FILTERED-OUT QUERY_LOG_EVENTS ARE EXECUTED
  
  Automerge from mysql-5.5 into mysql-trunk.
    ------------------------------------------------------------
    revno: 2875.376.39 [merge]
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-5.5
    timestamp: Tue 2012-05-15 22:18:59 +0100
    message:
      BUG#11754117 - 45670: INTVAR_EVENTS FOR FILTERED-OUT QUERY_LOG_EVENTS ARE EXECUTED
      
      Automerge from mysql-5.1 into mysql-5.5.
        ------------------------------------------------------------
        revno: 2661.840.12
        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
        branch nick: mysql-5.1
        timestamp: Tue 2012-05-15 22:06:48 +0100
        message:
          BUG#11754117 - 45670: INTVAR_EVENTS FOR FILTERED-OUT QUERY_LOG_EVENTS ARE EXECUTED
          
          Improved random number filtering verification on
          rpl_filter_tables_not_exist test.
------------------------------------------------------------
revno: 3844
committer: Marc Alff <marc.alff@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-05-15 21:14:49 +0200
message:
  Fixed the order of parameters when calling _aligned_malloc (Windows specific)
------------------------------------------------------------
revno: 3843 [merge]
committer: Marc Alff <marc.alff@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-05-15 19:08:30 +0200
message:
  local merge
    ------------------------------------------------------------
    revno: 3841.1.1
    committer: kevin.lewis@oracle.com
    branch nick: mysql-trunk
    timestamp: Tue 2012-05-15 11:32:40 -0500
    message:
      Fix recent compiler warnings on windows platform.
      reviewed, modified, and approved by Vasil
------------------------------------------------------------
revno: 3842
committer: Marc Alff <marc.alff@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-05-15 19:07:19 +0200
message:
  Post push cleanup: adjusted event_name_index in unit test pfs-t.cc, to align on code changes.
------------------------------------------------------------
revno: 3841
committer: Marc Alff <marc.alff@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-05-15 18:18:30 +0200
message:
  Fixed build breaks (MacOSX, Windows)
------------------------------------------------------------
revno: 3840
committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
branch nick: mysql-trunk-13966809
timestamp: Tue 2012-05-15 16:37:48 +0200
message:
  Bug#13966809 CRASH IN COPY_FUNCS WHEN GROUPING BY OUTER QUERY BLOB
  FIELD IN SUBQUERY
  
  Problem: Grouping by an outer BLOB field in a subquery causes the
  server to crash.
  
  The outer field is referenced through an Item_outer_ref that points to
  an Item_ref that points to an Item_copy_string. In create_tmp_table(),
  an array is created to store pointers to function items that are
  replaced with fields. The size of this array is determined by a count
  of functions, passed as parameter to create_tmp_table(). When
  create_tmp_field() is called for the outer field, it calls
  create_tmp_field_from_item(), where the field is mistaken for a
  function, and a pointer to the Item_outer_ref is stored in the array
  of function items. This results in overflowing the allocated storage
  space since one more item than intended is added.
  
  The mistake is made because create_tmp_field_from_item() checks
  item->is_result_field() to determine if the item is a function. Since
  the Item_outer_ref, like functions, returns true for this test, it is
  assumed to be a function, regardless of what item type it is a
  reference to. This bug is triggered only when the item referred to by
  the Item_ref is neither a field and nor a function.
  
  In copy_funcs(), a terminating null pointer is expected to end the
  array of function items. Because of the extra entry in the array, this
  null pointer is outside the allocated storage space for the array and
  the memory location may be overwritten with other information, causing
  copy_funcs() to dereference a wild pointer.
  
  Fix: Check item->real_item()->is_result_field() to determine if the
  item should be added to the array of function items.
------------------------------------------------------------
revno: 3839 [merge]
committer: Marko M?kel? <marko.makela@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-05-15 15:17:11 +0300
message:
  Merge mysql-5.5 to mysql-trunk.
    ------------------------------------------------------------
    revno: 2875.376.38 [merge]
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-5.5
    timestamp: Tue 2012-05-15 15:11:34 +0300
    message:
      Merge mysql-5.1 to mysql-5.5.
        ------------------------------------------------------------
        revno: 2661.840.11
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-5.1
        timestamp: Tue 2012-05-15 15:04:39 +0300
        message:
          Bug#14025221 FOREIGN KEY REFERENCES FREED MEMORY AFTER DROP INDEX
          
          dict_table_replace_index_in_foreign_list(): Replace the dropped index
          also in the foreign key constraints of child tables that are
          referencing this table.
          
          row_ins_check_foreign_constraint(): If the underlying index is
          missing, refuse the operation.
          
          rb:1051 approved by Jimmy Yang
------------------------------------------------------------
revno: 3838
committer: Marko M?kel? <marko.makela@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-05-15 14:30:19 +0300
message:
  Bug#13875241 Nondeterminism in innodb-index-online.test
  
  Adjust the replace_regexp for the record counts.
  This was forgotten last time when the test output was modified.
------------------------------------------------------------
revno: 3837 [merge]
committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
branch nick: B11761822-trunk
timestamp: Tue 2012-05-15 13:38:17 +0300
message:
  merge
    ------------------------------------------------------------
    revno: 3835.1.1
    committer: Marc Alff <marc.alff@oracle.com>
    branch nick: mysql-trunk-bug12346211-tuning
    timestamp: Tue 2012-05-15 11:39:47 +0200
    message:
      Bug#12346211 - PERF IMPACT OF PERFORMANCE-SCHEMA WITH DISABLED INSTRUMENTS/CONSUMERS
      
      This changeset implement various performance improvements implemented to
      date.
      
      Major change:
      
      The instrumentation of table io and table lock has been re factored,
      to avoid performing excessive CPU computation when a table is reused in the
      table open cache.
      The statistics (1) by calling thread and (2) by object are collected in a
      more disjoint way, avoiding the need to aggregate stats per table share in
      (2) every time the thread using the table changes in (1).
      See the updated doxygen documentation for table_locker.
      
      Minor changes:
      
      Performance schema memory structures and critical global variables are not
      aligned on 128 bytes boundaries, to avoid false sharing between CPU cache
      lines, and to avoid using more cache lines than necessary.
      
      Every LF_HASH table is sized to the maximum when the hash is created,
      to avoid having to resize dynamically the LF_HASH when new elements are
      inserted.
      
      The size and load count of every LF_HASH table is now displayed in the
      output of SHOW ENGINE PERFORMANCE_SCHEMA STATUS, to help diagnostics.
      
      The macro PSI_CALL has been replaced by PSI_XXX_CALL for each type of
      instrumentation. This change is a preliminary cleanup, to make implementing
      further optimizations possible.
      
      Event name indexes for hard coded events (table io, table lock, idle) are
      now compile time constants, instead of being dynamically allocated.
      Using constants makes the code simpler and helps the compiler to perform
      better optimizations.
------------------------------------------------------------
revno: 3836 [merge]
committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
branch nick: B11761822-trunk
timestamp: Tue 2012-05-15 13:33:25 +0300
message:
  merge 5.5->trunk
    ------------------------------------------------------------
    revno: 2875.376.37 [merge]
    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
    branch nick: B11761822-5.5
    timestamp: Tue 2012-05-15 13:18:42 +0300
    message:
      merge 5.1->5.5
        ------------------------------------------------------------
        revno: 2661.840.10
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: B11761822-5.1
        timestamp: Tue 2012-05-15 13:12:22 +0300
        message:
          Bug #11761822: yassl rejects valid certificate which openssl accepts
              
          Applied the fix that updates yaSSL to 2.2.1 and fixes parsing this 
          particular certificate.
          Added a test case with the certificate itself.
------------------------------------------------------------
revno: 3835
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-05-15 09:52:53 +0200
message:
  BUG#11754168 followup: trying to stabilize index_merge_innodb.test
------------------------------------------------------------
revno: 3834 [merge]
committer: Bjorn Munch <bjorn.munch@oracle.com>
branch nick: int-tr
timestamp: Tue 2012-05-15 09:23:37 +0200
message:
  Upmerge optional testsuite path
    ------------------------------------------------------------
    revno: 2875.376.36 [merge]
    committer: Bjorn Munch <bjorn.munch@oracle.com>
    branch nick: int-55
    timestamp: Tue 2012-05-15 09:19:58 +0200
    message:
      Upmerge optional testsuite path
        ------------------------------------------------------------
        revno: 2661.840.9
        committer: Bjorn Munch <bjorn.munch@oracle.com>
        branch nick: int-51
        timestamp: Tue 2012-05-15 09:14:44 +0200
        message:
          Added some extra optional path to test suites
------------------------------------------------------------
revno: 3833 [merge]
committer: Joerg Bruehe <joerg.bruehe@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-05-14 15:21:25 +0200
message:
  Null-upmerge a 5.5 version number change
    ------------------------------------------------------------
    revno: 2875.376.35
    committer: Joerg Bruehe <joerg.bruehe@oracle.com>
    branch nick: mysql-5.5
    timestamp: Mon 2012-05-14 15:15:13 +0200
    message:
      Raise version after cloning 5.5.25
------------------------------------------------------------
revno: 3832
committer: Tor Didriksen <tor.didriksen@oracle.com>
branch nick: trunk-bug14042545useconds
timestamp: Mon 2012-05-14 14:42:43 +0200
message:
  Bug#14042545 ASSERTION FAILED: DEC <= 6 IN MY_USECONDS_TO_STR()
  
  Item_func_ifnull::fix_length_and_dec() failed to calculate number of decimals
  for time arguments.
------------------------------------------------------------
revno: 3831
committer: Raghav Kapoor <raghav.kapoor@oracle.com>
branch nick: mysql-trunk-bug13463397
timestamp: Mon 2012-05-14 16:03:46 +0530
message:
  BUG#13463397 - 63562: UNKNOWN DATABASE INFORMATION_SCHEMA 
  
  Regression Test added to demonstrate that main complaint 
  mentioned in the bug report CREATE PROCEDURE information_schema.is() 
  giving "Unknown database 'information_schema' is not reproducible 
  in 5.6. It currently gives ER_DBACCESS_DENIED_ERROR.
  
  Closing this bug as it is not reproducible in 5.6 and attaching 
  a small note to address the other complaints mentioned in 
  the bug report. 
  
  NOTE:
  This is a small testcase written to demonstrate the inconsistencies 
  of error messages for I_S and P_S databases. This is the current 
  behaviour of I_S and P_S in 5.6.
  
  --error ER_DBACCESS_DENIED_ERROR
  CREATE PROCEDURE information_schema.is() BEGIN END;
  --error ER_DBACCESS_DENIED_ERROR
  CREATE PROCEDURE performance_schema.ps() BEGIN END;
  
  --error ER_DBACCESS_DENIED_ERROR
  CREATE TABLE information_schema.is(a INT);
  --error ER_TABLEACCESS_DENIED_ERROR
  CREATE TABLE performance_schema.ps(a INT);
  
  --error ER_DBACCESS_DENIED_ERROR
  ALTER TABLE information_schema.collations ADD COLUMN c INT;
  --error ER_DBACCESS_DENIED_ERROR
  ALTER TABLE performance_schema.setup_consumers ADD COLUMN c INT; 
  
  Ideally Both of I_S and P_S databases should give same errors 
  for the same operation but this is currently NOT the case.
  
  These inconsistencies will be handled later when the runtime 
  team starts working on New Data Dictionary Project as it is 
  pretty hard to fix these inconsistencies at this point of time 
  in the code.
------------------------------------------------------------
revno: 3830
committer: Marko M?kel? <marko.makela@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-05-14 13:04:59 +0300
message:
  Bug#14058373 ADD DEBUG ASSERTIONS FOR PAGE_INDEX_ID MISMATCH
  
  btr_cur_search_to_nth_level(), btr_cur_open_at_index_side_func(),
  btr_cur_open_at_rnd_pos_func(): Assert that the page type is FIL_PAGE_INDEX,
  a B-tree page.
  
  btr_cur_update_in_place(), btr_cur_optimistic_update(),
  page_cur_insert_rec_low(), page_cur_insert_rec_zip(),
  page_cur_delete_rec(), row_search_for_mysql(): Assert that the page
  type is FIL_PAGE_INDEX (a B-tree page) and that the PAGE_INDEX_ID
  matches the index->id.
  
  rb:1071 approved by Jimmy Yang
------------------------------------------------------------
revno: 3829
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-05-14 11:30:58 +0200
message:
  Bug#11754168 list bug-id from new bug system instead of old bug
  system in default.experimental
------------------------------------------------------------
revno: 3828
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-05-14 08:41:47 +0200
message:
  BUG#45727 followup: trying to stabilize index_merge_innodb.test
------------------------------------------------------------
revno: 3827
committer: Mattias Jonsson <mattias.jonsson@oracle.com>
branch nick: b13717277-t
timestamp: Sun 2012-05-13 23:45:16 +0200
message:
  Bug#13717277: MAIN.PARTITION_BINLOG IS FAILING ON WEEKLY TRUNK.
  
  Fixed by adding RESET MASTER, to truncate the binlog and reset the
  number to 1.
------------------------------------------------------------
revno: 3826
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 21:24:56 +0300
message:
  During stats rename try to delete the existent rows if UPDATE
  returns a duplicate key error and retry the operation a few
  times because transactions with trx->mysql_thd == NULL are not
  allowed to wait and could easily get lock wait timeout.
  
  Overwriting existent rows in the stats tables during rename is important
  because ALTER table that recreates the table will fail to rename the stats
  properly. Internally InnoDB sees a new (temp) table being created and later
  renamed to the real table, while the real table's stats are still in the
  stats tables.
------------------------------------------------------------
revno: 3825
committer: Sergey Glukhov <sergey.glukhov@oracle.com>
branch nick: mysql-trunk
timestamp: Sat 2012-05-12 12:31:02 +0400
message:
  Bug#13948247 DIVISION BY 0 IN GET_BEST_DISJUNCT_QUICK WITH FORCE INDEX GROUP BY
  An attempt to create QUICK_SELECT object for empty table
  (BLACKHOLE is always empty) leads to 'DIVISION BY 0' crash.
  The fix is to skip QUICK_SELECT creation for empty table as
  it's meaningless.
------------------------------------------------------------
revno: 3824
committer: Gleb Shchepa <gleb.shchepa@oracle.com>
branch nick: trunk-bug13906945
timestamp: Fri 2012-05-11 23:37:22 +0400
message:
  Bug #13906945: EXPLAIN JSON DISPLAYS ATTACHED CONDITION WRONGLY                                      
                 IF INDEX_SUBQUERY                                                                     
                                                                                                       
  The value of the "attached_condition" string in JSON EXPLAIN                                         
  may display an outdated (unoptimized) expression text.                                               
                                                                                                       
                                                                                                       
  For top query, shallow_explain() writes attached_condition,                                          
  then explain_subqueries() runs JOIN::optimize() on subquery                                          
  which *transforms* subquery, so the subquery text printed                                            
  in top query's attached_condition becomes out-of-date.                                               
                                                                                                       
  The abstract "Lazy" class has been introduced to emulate                                             
  a lazy computation to evaluate expressions on demand.                                                 
                                                                                                       
  The Lazy_condition successor for this class has been                                                 
  introduced to defer Item tree pretty-printer call.     
------------------------------------------------------------
revno: 3823
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 20:45:45 +0300
message:
  Non-functional change, rename:
  
  dict_stats_delete_index_stats() -> dict_stats_drop_index()
  dict_stats_delete_table_stats() -> dict_stats_drop_table()
------------------------------------------------------------
revno: 3822
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 20:45:02 +0300
message:
  Add debug assertions that dict_sys->mutex is not held in
  dict_stats_delete_index_stats() and dict_stats_delete_table_stats().
  
  This makes the code easier to read.
------------------------------------------------------------
revno: 3821
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 20:44:42 +0300
message:
  Non-functional change - extend comments
------------------------------------------------------------
revno: 3820
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 20:44:20 +0300
message:
  Whitespace fixup
------------------------------------------------------------
revno: 3819
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 20:43:45 +0300
message:
  Non-functional change - print the error message from
  ha_innobase::delete_table() instead of from dict_stats_delete_table_stats().
------------------------------------------------------------
revno: 3818
committer: Nuno Carvalho <nuno.carvalho@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 15:07:38 +0100
message:
  BUG#13680651: RPL_CORRUPTION TEST FAILS WITH SLAVE STOPPED WITH WRONG ERROR CODE ON VALGRIND
  
  Errors numbers shifted and include/wait_for_slave_io_error.inc does not
  supports error names, so changed 1742 to new
  ER_NETWORK_READ_EVENT_CHECKSUM_FAILURE number (1743).
------------------------------------------------------------
revno: 3817
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 16:03:36 +0200
message:
  BUG#45727 followup - trying to stabilize index_merge_innodb
------------------------------------------------------------
revno: 3816 [merge]
committer: magnus.blaudd@oracle.com
branch nick: trunk
timestamp: Fri 2012-05-11 14:05:39 +0200
message:
  Merge trunk-wl5906 -> trunk
    ------------------------------------------------------------
    revno: 3734.1.4
    committer: magnus.blaudd@oracle.com
    branch nick: trunk-wl5906
    timestamp: Fri 2012-05-11 14:00:09 +0200
    message:
      WL#5906
       - Improve comments by describing the HA_READ_BEFORE_WRITE_REMOVAL flag
          and adding references to it in the other three places affected
    ------------------------------------------------------------
    revno: 3734.1.3
    committer: magnus.blaudd@oracle.com
    branch nick: trunk-wl5906
    timestamp: Thu 2012-04-26 09:44:58 +0200
    message:
      WL#5906
       - fix typo in comment and doxygen syntax
    ------------------------------------------------------------
    revno: 3734.1.2
    committer: magnus.blaudd@oracle.com
    branch nick: trunk-wl5906
    timestamp: Wed 2012-04-25 14:30:33 +0200
    message:
      WL#5906 read before write removal (RBWR)
       - Adapt patch to latest trunk.
       - Since both update and delete now does all the checks in one
         place, the common code has been factored out into TABLE::check_read_removal() which is then
        called both from mysql_update() and mysql_delete() 
       - Remove handler::read_before_write_removal_supported() in favor of using
        the HA_READ_BEFORE_WRITE_REMOVAL table flag.
       - Rename handler::read_before_write_removal_rows_written() to handler::end_read_removal()
       - Rename handler::read_before_write_removal_possible() to handler::start_read_removal()
       - Remove unnecessary DBUG printouts
    ------------------------------------------------------------
    revno: 3734.1.1 [merge]
    committer: magnus.blaudd@oracle.com
    branch nick: merge_trunk-wl5906_2_trunk
    timestamp: Wed 2012-04-25 09:05:16 +0200
    message:
      Merge trunk-wl5906 with trunk
        ------------------------------------------------------------
        revno: 3186.1.1
        committer: magnus.blaudd@oracle.com
        branch nick: trunk-wl5906-rbwr
        timestamp: Thu 2011-10-13 09:16:28 +0200
        message:
          WL#5906 read before write removal (RBWR)
           - Make it possible for storage engines to optimize away
             read of row before UPDATE/DELETE in order to save
             roundtrips and allow for batching.
------------------------------------------------------------
revno: 3815
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-trunk-11765737
timestamp: Fri 2012-05-11 12:51:38 +0200
message:
  Reenable index_merge_innodb tests disabled by BUG#45727. 
  
  The test is marked as experimental since it is expected that 
  it will fail due to varying row estimates in EXPLAIN. It will
  be removed from the experimental list once it has stabilized
  in PB
------------------------------------------------------------
revno: 3814 [merge]
committer: magnus.blaudd@oracle.com
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 12:41:19 +0200
message:
  Merge
    ------------------------------------------------------------
    revno: 3812.1.1 [merge]
    committer: magnus.blaudd@oracle.com
    branch nick: mysql-trunk
    timestamp: Fri 2012-05-11 12:29:03 +0200
    message:
      Merge
        ------------------------------------------------------------
        revno: 3811.1.1 [merge]
        committer: magnus.blaudd@oracle.com
        branch nick: trunk
        timestamp: Fri 2012-05-11 12:15:28 +0200
        message:
          Merge trunk-wl6003 -> trunk
            ------------------------------------------------------------
            revno: 3767.1.2
            committer: Frazer Clement <frazer.clement@oracle.com>
            branch nick: mysql-trunk-wl6003
            timestamp: Wed 2012-05-09 11:46:03 +0100
            message:
              WL#6003 Support silent slave transaction retries
              
              Support handler returning error resulting in silent slave 
              transaction retry.
              
              This feature allows handlers to use automatic, quick transaction 
              retries for purposes such as conflict detection, error handling etc.
            ------------------------------------------------------------
            revno: 3767.1.1
            committer: Frazer Clement <frazer.clement@oracle.com>
            branch nick: mysql-trunk-wl6003
            timestamp: Wed 2012-05-09 11:44:25 +0100
            message:
              Empty commit
------------------------------------------------------------
revno: 3813
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 13:34:28 +0300
message:
  Change RENAME TABLE where it renames the table stats to use UPDATE
  insead of delete and save because at the time dict_stats_save() is
  called the table be closed and in-memory stats cleared.
  
  UPDATE was not used before because of the foreign key which existed
  between the stats tables. The foreign key is now removed.
  
  As a side effect, the result in the exceptional case where rows exist
  for the new table name is changed. Instead of overwriting existing rows
  (which was the case with delete and save()) now the existing rows are
  left and RENAME TABLE emits a warning that it failed to rename the table
  stats.
------------------------------------------------------------
revno: 3812
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-11 13:27:51 +0300
message:
  restoring rpl_stm_mts_crash_safe back to be big_test.
------------------------------------------------------------
revno: 3811 [merge]
committer: magnus.blaudd@oracle.com
branch nick: trunk
timestamp: Fri 2012-05-11 10:59:53 +0200
message:
  Merge trunk-bug13979471 -> trunk
    ------------------------------------------------------------
    revno: 3765.1.1
    committer: magnus.blaudd@oracle.com
    branch nick: trunk-bug13979471
    timestamp: Fri 2012-05-11 10:04:48 +0200
    message:
      Bug#13979471 INPLACE ALTER CALLS HANDLER::GET_NO_PARTS() CALLED BEFORE TABLE IS CREATED IN SE
       - Set "is_create_table" to TRUE when calling open_table_from_share()
       if the table does not exists in engine yet
       - Improve function comments for open_table_from_share() and
       handler::get_no_parts()
------------------------------------------------------------
revno: 3810
committer: Sunny Bains <Sunny.Bains@Oracle.Com>
branch nick: trunk
timestamp: Fri 2012-05-11 14:34:58 +1000
message:
  Bug#14057307 - CRASH DUE TO FIX FOR BUG#14034087
  
  The event that coordinates between the lock wait monitor thread and other 
  threads needs to be anchored in lock_sys_t. The current problem is that at 
  startup, the monitor thread may not have started up. To ensure that the event 
  always exists we create it at the same time as the lock data structures are 
  created at startup.
  
  rb://1066 Approved by Jimmy Yang.
------------------------------------------------------------
revno: 3809
committer: kevin.lewis@oracle.com
branch nick: mysql-trunk
timestamp: Thu 2012-05-10 20:23:39 -0500
message:
  Whitespace changes and a compiler warning on windows.
------------------------------------------------------------
revno: 3808
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-10 22:08:12 +0300
message:
  Non-functional change - remove unnecessary parameter from
  dict_stats_init(), it is always being passed as FALSE.
------------------------------------------------------------
revno: 3807 [merge]
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-10 15:46:11 +0300
message:
  Merge mysql-trunk from myrepo into my local copy of the branch
    ------------------------------------------------------------
    revno: 3803.1.12
    committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-05-10 18:09:22 +0530
    message:
      Putting this test in experimental list considering the recent failures.
    ------------------------------------------------------------
    revno: 3803.1.11
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-bug14040277ipv6
    timestamp: Thu 2012-05-10 11:34:16 +0200
    message:
      Bug#14040277 UNINITIALIZED VALUE REFERENCED IN STR_TO_IPV6
      
      Problem : valgrind warnings due to some wrong checking of character
                values before checking charcter string boundaries.
      Solution: checking string length before evaluating character
                string values.
      
      The patch for Bug#12635232 fixed it for str_to_ipv4()
      This patch fixes it for str_to_ipv6()
    ------------------------------------------------------------
    revno: 3803.1.10
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-05-10 12:16:15 +0300
    message:
      Bug#14006907 FOREIGN KEY problems after DROP INDEX
      
      dict_index_t: Add the to_be_dropped flag to incidate when an index
      is about to be dropped.
      
      dict_foreign_find_index(): Assert that the caller is holding the
      dict_sys->mutex. Skip indexes that are flagged as to-be-dropped.
      
      dict_foreign_replace_index(): Assert that the index is to-be-dropped.
      
      ha_innobase::prepare_inplace_alter_table(): Lock the data dictionary
      while checking if any foreign key constraints depend on the indexes
      that are to be dropped. Flag them as such in the data dictionary cache.
      
      ha_innobase::inplace_alter_table(): Add a debug sync point for the
      DEBUG_SYNC test.
      
      rollback_inplace_alter_table(): Clear the index->to_be_dropped flag in
      the data dictionary cache.
      
      rb:1049 approved by Jimmy Yang
    ------------------------------------------------------------
    revno: 3803.1.9
    committer: Nisha Gopalakrishnan <nisha.gopalakrishnan@oracle.com>
    branch nick: mysql-trunk-11757486
    timestamp: Thu 2012-05-10 14:19:23 +0530
    message:
      Bug#11757486:49539: NON-DESCRIPTIVE ERR (ERROR 0 FROM STORAGE ENGINE) WITH
                          MULTI-TABLE UPDATE
            
      Analysis:
      ---------
      Multiple-table UPDATE statement with IGNORE keyword in strict mode 
      having invalid or missing values could trigger an assertion in debug
      mode. However on a release build, the query execution fails reporting 
      inappropriate errors.
      
      The multiple-table UPDATE does not test for IGNORE to decide
      whether the query should be aborted in case of any warning.This causes
      the warning to be converted to error(STRICT MODE behavior). However
      since the errors are to be suppressed due to the IGNORE keyword, the
      diagnostic area is not set to DA_ERROR.
      
      Since the diagnostic area remains DA_EMPTY, an ASSERT is triggered
      which causes the mysqld to crash on a debug build. On a release build
      the query execution fails with incorrect errors being reported. 
      
      Fix:
      ---
      To test for IGNORE during the execution of the multiple-table UPDATE 
      statement. This causes the successful execution of the query with
      appropriate warnings being reported.
    ------------------------------------------------------------
    revno: 3803.1.8
    committer: Nisha Gopalakrishnan <nisha.gopalakrishnan@oracle.com>
    branch nick: mysql-trunk-13726075
    timestamp: Thu 2012-05-10 13:42:13 +0530
    message:
      Bug#13726075:64310: CZECH ERROR MESSAGES CONTAIN GARBAGE
      
      Fix:
      ---
      Removed the garbage characters in the CZECH error messages listed in
      the file sql/share/errmsg-utf8.txt.
    ------------------------------------------------------------
    revno: 3803.1.7 [merge]
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-05-10 11:38:23 +0530
    message:
      Merge from mysql-5.5 to mysql-trunk. 
        ------------------------------------------------------------
        revno: 2875.376.34 [merge]
        tags: clone-5.5.25-build, mysql-5.5.25
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-5.5
        timestamp: Thu 2012-05-10 10:33:16 +0530
        message:
          Merging from mysql-5.1 to mysql-5.5. 
            ------------------------------------------------------------
            revno: 2661.840.8
            committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
            branch nick: mysql-5.1
            timestamp: Thu 2012-05-10 10:18:31 +0530
            message:
              Bug #14007649 65111: INNODB SOMETIMES FAILS TO UPDATE ROWS INSERTED 
              BY A CONCURRENT TRANSACTIO
              
              The member function QUICK_RANGE_SELECT::init_ror_merged_scan() performs
              a table handler clone. Innodb does not provide a clone operation.  
              The ha_innobase::clone() is not there. The handler::clone() does not 
              take care of the ha_innobase->prebuilt->select_lock_type.  Because of 
              this what happens is that for one index we do a locking read, and 
              for the other index we were doing a non-locking (consistent) read. 
              The patch introduces ha_innobase::clone() member function.  
              It is implemented similar to ha_myisam::clone().  It calls the 
              base class handler::clone() and then does any additional operation 
              required.  I am setting the ha_innobase->prebuilt->select_lock_type 
              correctly. 
              
              rb://1060 approved by Marko
    ------------------------------------------------------------
    revno: 3803.1.6 [merge]
    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-09 19:57:46 +0300
    message:
      merge
        ------------------------------------------------------------
        revno: 3803.2.1
        committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
        branch nick: mysql-trunk
        timestamp: Wed 2012-05-09 20:55:50 +0530
        message:
          As per discussion with Olav, skipping this test from valgrind runs.
    ------------------------------------------------------------
    revno: 3803.1.5 [merge]
    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-09 19:53:03 +0300
    message:
      merge mysql-5.5->mysql-trunk
        ------------------------------------------------------------
        revno: 2875.376.33 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-5.5
        timestamp: Wed 2012-05-09 17:08:44 +0300
        message:
          merge
            ------------------------------------------------------------
            revno: 2661.840.7 [merge]
            committer: Sunanda Menon <sunanda.menon@oracle.com>
            branch nick: mysql-5.1
            timestamp: Tue 2012-05-08 07:19:14 +0200
            message:
              Merge from mysql-5.1.63-release
            ------------------------------------------------------------
            revno: 2661.840.6
            committer: Venkata Sidagam <venkata.sidagam@oracle.com>
            branch nick: mysql-5.1-bug-45740
            timestamp: Mon 2012-05-07 16:46:44 +0530
            message:
              Bug #11754178 45740: MYSQLDUMP DOESN'T DUMP GENERAL_LOG AND SLOW_QUERY 
                                   CAUSES RESTORE PROBLEM
              Problem Statement:
              ------------------
              mysqldump is not having the dump stmts for general_log and slow_log
              tables. That is because of the fix for Bug#26121. Hence, after 
              dropping the mysql database, and applying the dump by enabling the 
              logging, "'general_log' table not found" errors are logged into the 
              server log file.
              
              Analysis:
              ---------
              As part of the fix for Bug#26121, we skipped the dumping of tables 
              for general_log and slow_log, because the data dump of those tables 
              are taking LOCKS, which is not allowed for log tables.
              
              Fix:
              ----
              We came up with an approach that instead of taking both meta data 
              and data dump information for those tables, take only the meta data 
              dump which doesn't need LOCKS.
              As part of fixing the issue we came up with below algorithm.
              Design before fix:
              1) mysql database is having tables like db, event,... general_log,
                 ... slow_log...
              2) Skip general_log and slow_log while preparing the tables list
              3) Take the TL_READ lock on tables which are present in the table 
                 list and do 'show create table'.
              4) Release the lock.
              
              Design with the fix:
              1) mysql database is having tables like db, event,... general_log,
                 ... slow_log...
              2) Skip general_log and slow_log while preparing the tables list
              3) Explicitly call the 'show create table' for general_log and 
                 slow_log
              3) Take the TL_READ lock on tables which are present in the table 
                 list and do 'show create table'.
              4) Release the lock.
              
              While taking the meta data dump for general_log and slow_log the 
              "CREATE TABLE" is replaced with "CREATE TABLE IF NOT EXISTS". 
              This is because we skipped "DROP TABLE" for those tables, 
              "DROP TABLE" fails for these tables if logging is enabled. 
              Customer is applying the dump by enabling logging so, if the dump 
              has "DROP TABLE" it will fail. Hence, removed the "DROP TABLE" 
              stmts for those tables.
                
              After the fix we could observe "Table 'mysql.general_log' 
              doesn't exist" errors initially that is because in the customer 
              scenario they are dropping the mysql database by enabling the 
              logging, Hence, those errors are expected. Once we apply the 
              dump which is taken before the "drop database mysql", the errors 
              will not be there.
        ------------------------------------------------------------
        revno: 2875.376.32 [merge]
        committer: Joerg Bruehe <joerg.bruehe@oracle.com>
        branch nick: mysql-5.5
        timestamp: Mon 2012-05-07 22:20:42 +0200
        message:
          Merge 5.5.24 back into main 5.5.
          This is a weave merge, but without any conflicts.
          In 14 source files, the copyright year needed to be updated to 2012.
    ------------------------------------------------------------
    revno: 3803.1.4 [merge]
    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-09 19:47:39 +0300
    message:
      merge mysql-trunk-security-fixed->mysql-trunk
        ------------------------------------------------------------
        revno: 2876.471.126 [merge]
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: trunk-security
        timestamp: Thu 2012-04-12 15:07:13 +0200
        message:
          NULL merge 5.5-security => trunk-security
            ------------------------------------------------------------
            revno: 2875.379.30
            tags: mysql-5.5.24, clone-5.5.24-build
            committer: Tor Didriksen <tor.didriksen@oracle.com>
            branch nick: 5.5-security
            timestamp: Thu 2012-04-12 15:04:22 +0200
            message:
              Bug#13871079 RQG_MYISAM_DML_ALTER_VALGRIND FAILS ON VALGRIND PN PB2
              
              The class Copy_field contains a String tmp, 
              which may allocate memory on the heap.
              That means that all instances of Copy_field
              must be properly destroyed. Alas they are not.
              
              Solution: don't use Copy_field::tmp for copying
              from_field => tmp => to_field
              in do_field_string()
        ------------------------------------------------------------
        revno: 2876.471.125
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Thu 2012-04-12 15:44:00 +0300
        message:
          fixed test suite results post mysql-trunk->mysql-trunk-security merge 
          to match the error codes.
        ------------------------------------------------------------
        revno: 2876.471.124 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Thu 2012-04-12 14:20:53 +0300
        message:
          empty weave merge mysql-5.5-security->mysql-trunk-security
            ------------------------------------------------------------
            revno: 2875.379.29 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: merge-5.5-security
            timestamp: Thu 2012-04-12 14:04:12 +0300
            message:
              merge mysql-5.5->mysql-5.5-security
        ------------------------------------------------------------
        revno: 2876.471.123 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Thu 2012-04-12 14:13:43 +0300
        message:
          merged mysql-trunk->mysql-trunk-security
        ------------------------------------------------------------
        revno: 2876.471.122
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Tue 2012-04-10 17:28:49 +0300
        message:
          post mysql-trunk->mysql-trunk-security merge problems fix.
          1. Set the right numeric error codes for some tests that need them
          2. Removed a merge of a flag set that's obsolete by a better architecture
        ------------------------------------------------------------
        revno: 2876.471.121 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Tue 2012-04-10 15:20:51 +0300
        message:
          empty weave merge mysql-5.5-security->mysql-trunk-security
            ------------------------------------------------------------
            revno: 2875.379.28 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: merge-5.5-security
            timestamp: Tue 2012-04-10 14:46:21 +0300
            message:
              empty weave merge mysql-5.1-security->mysql-5.5-security
                ------------------------------------------------------------
                revno: 2661.842.18 [merge]
                tags: mysql-5.1.63, clone-5.1.63-build
                committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
                branch nick: merge-5.1-security
                timestamp: Tue 2012-04-10 14:21:57 +0300
                message:
                  merge mysql-5.1->mysql-5.1-security
            ------------------------------------------------------------
            revno: 2875.379.27 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: merge-5.5-security
            timestamp: Tue 2012-04-10 14:23:17 +0300
            message:
              merge mysql-5.5->mysql-5.5-security
        ------------------------------------------------------------
        revno: 2876.471.120 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Tue 2012-04-10 14:47:39 +0300
        message:
          merged mysql-trunk->mysql-trunk-security
        ------------------------------------------------------------
        revno: 2876.471.119 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: B13934049-trunk-security
        timestamp: Fri 2012-04-06 13:37:56 +0300
        message:
          auto-merge mysql-5.5-security->mysql-trunk-security
            ------------------------------------------------------------
            revno: 2875.379.26 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: B13934049-5.5-security
            timestamp: Fri 2012-04-06 13:20:33 +0300
            message:
              auto mere mysql-5.1-security->mysql-5.5-security
                ------------------------------------------------------------
                revno: 2661.842.17
                committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
                branch nick: B13934049-5.1-security
                timestamp: Fri 2012-04-06 12:04:07 +0300
                message:
                  Bug #13934049: 64884: LOGINS WITH INCORRECT PASSWORD ARE ALLOWED
                  
                  Fixed an improper type conversion on return that can make the server accept
                  logins with a wrong password.
        ------------------------------------------------------------
        revno: 2876.471.118 [merge]
        committer: Sergey Glukhov <sergey.glukhov@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Wed 2012-04-04 15:06:05 +0400
        message:
          Bug#11766300 59387: FAILING ASSERTION: CURSOR->POS_STATE == 1997660512 (BTR_PCUR_IS_POSITIONE
          Bug#13639204 64111: CRASH ON SELECT SUBQUERY WITH NON UNIQUE INDEX
          The crash happened due to wrong calculation
          of key length during creation of reference for
          sort order index. The problem is that
          keyuse->used_tables can have OUTER_REF_TABLE_BIT enabled
          but used_tables parameter(create_ref_for_key() func) does
          not have it. So key parts which have OUTER_REF_TABLE_BIT
          are ommited and it could lead to incorrect key length
          calculation(zero key length).
            ------------------------------------------------------------
            revno: 2875.379.25 [merge]
            committer: Sergey Glukhov <sergey.glukhov@oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Wed 2012-04-04 14:19:00 +0400
            message:
              5.1-security -> 5.5-security merge
                ------------------------------------------------------------
                revno: 2661.842.16
                committer: Sergey Glukhov <sergey.glukhov@oracle.com>
                branch nick: mysql-5.1-security
                timestamp: Wed 2012-04-04 13:29:45 +0400
                message:
                  Bug#11766300 59387: FAILING ASSERTION: CURSOR->POS_STATE == 1997660512 (BTR_PCUR_IS_POSITIONE
                  Bug#13639204 64111: CRASH ON SELECT SUBQUERY WITH NON UNIQUE INDEX
                  The crash happened due to wrong calculation
                  of key length during creation of reference for
                  sort order index. The problem is that
                  keyuse->used_tables can have OUTER_REF_TABLE_BIT enabled
                  but used_tables parameter(create_ref_for_key() func) does
                  not have it. So key parts which have OUTER_REF_TABLE_BIT
                  are ommited and it could lead to incorrect key length
                  calculation(zero key length).
        ------------------------------------------------------------
        revno: 2876.471.117
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: trunk-security
        timestamp: Thu 2012-03-29 17:30:32 +0200
        message:
          Cherrypick merge from trunk:
          Fix broken build on Mac (with MYSQL_MAINTAINER_MODE)
        ------------------------------------------------------------
        revno: 2876.471.116 [merge]
        committer: Gleb Shchepa <gleb.shchepa@oracle.com>
        branch nick: trunk-security
        timestamp: Wed 2012-03-28 12:35:25 +0400
        message:
          auto-upmerge
            ------------------------------------------------------------
            revno: 2875.379.24
            committer: Gleb Shchepa <gleb.shchepa@oracle.com>
            branch nick: 5.5-security
            timestamp: Wed 2012-03-28 12:22:31 +0400
            message:
              Bug #11880012: INDEX_SUBQUERY, BLACKHOLE,
                             HANG IN PREPARING WITH 100% CPU USAGE
              
              Infinite loop in the subselect_indexsubquery_engine::exec()
              function caused Server hang with 100% CPU usage.
              
              The BLACKHOLE storage engine didn't update handler's
              table->status variable after index operations, that
              caused an infinite "while(!table->status)" execution.
              
              Index access methods of the BLACKHOLE engine handler
              have been updated to set table->status variable to
              STATUS_NOT_FOUND or 0 when such a method returns a
              HA_ERR_END_OF_FILE error or 0 respectively.
        ------------------------------------------------------------
        revno: 2876.471.115
        committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Thu 2012-03-22 17:35:39 +0530
        message:
          Fix failing rpl.rpl_alter_repository.test after last merge
          due to error message file reshuffle.
        ------------------------------------------------------------
        revno: 2876.471.114 [merge]
        committer: Jimmy Yang <jimmy.yang@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Thu 2012-03-22 11:56:34 +0800
        message:
          Merge from mysql-5.5-security to mysql-trunk-security
            ------------------------------------------------------------
            revno: 2875.379.23
            committer: Jimmy Yang <jimmy.yang@oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Thu 2012-03-22 11:22:54 +0800
            message:
              Fix Bug #13849910 - INNODB ASSERTS ON TOO LONG TABLENAME WHEN USING PARTITIONS
              
              rb://981 approved by Sunny Bains
        ------------------------------------------------------------
        revno: 2876.471.113 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Wed 2012-03-21 18:02:19 +0200
        message:
          empty weave merge mysql-5.5-security->mysql-trunk-security
            ------------------------------------------------------------
            revno: 2875.379.22 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: merge-5.5-security
            timestamp: Wed 2012-03-21 15:06:25 +0200
            message:
              empty weave merge mysql-5.1-security->mysql-5.5-security
                ------------------------------------------------------------
                revno: 2661.842.15 [merge]
                committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
                branch nick: merge-5.1-security
                timestamp: Wed 2012-03-21 14:58:27 +0200
                message:
                  empty weave merge mysql-5.0-security->mysql-5.1-security
                    ------------------------------------------------------------
                    revno: 1810.4008.3 [merge]
                    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
                    branch nick: merge-5.0-security
                    timestamp: Wed 2012-03-21 14:35:25 +0200
                    message:
                      weave merge mysql-5.0->mysql-5.0-security
                ------------------------------------------------------------
                revno: 2661.842.14 [merge]
                committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
                branch nick: merge-5.1-security
                timestamp: Wed 2012-03-21 14:53:09 +0200
                message:
                  merge mysql-5.1->mysql-5.1-security
            ------------------------------------------------------------
            revno: 2875.379.21 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: merge-5.5-security
            timestamp: Wed 2012-03-21 14:56:29 +0200
            message:
              merge mysql-5.5->mysql-5.5-security
        ------------------------------------------------------------
        revno: 2876.471.112 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Wed 2012-03-21 17:59:46 +0200
        message:
          merged mysql-trunk->mysql-trunk-security
        ------------------------------------------------------------
        revno: 2876.471.111 [merge]
        committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Thu 2012-03-15 12:32:28 +0100
        message:
          Null-merge from mysql-5.5-security to mysql-trunk-security
            ------------------------------------------------------------
            revno: 2875.379.20 [merge]
            committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Thu 2012-03-15 12:29:01 +0100
            message:
              Merge from mysql-5.5 to mysql-5.5-security
              Text conflict in sql/share/errmsg-utf8.txt
            ------------------------------------------------------------
            revno: 2875.379.19 [merge]
            committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Thu 2012-03-15 11:28:29 +0100
            message:
              Merge from mysql-5.5 to mysql-5.5-security
              Text conflict in sql/filesort.cc
            ------------------------------------------------------------
            revno: 2875.379.18 [merge]
            committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Thu 2012-03-15 11:25:53 +0100
            message:
              Merge from mysql-5.5 to mysql-5.5-security
              No conflicts
        ------------------------------------------------------------
        revno: 2876.471.110 [merge]
        committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Thu 2012-03-15 12:27:52 +0100
        message:
          Merge from mysql-trunk to mysql-trunk-security
          Text conflict in sql/share/errmsg-utf8.txt
        ------------------------------------------------------------
        revno: 2876.471.109 [merge]
        committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Thu 2012-03-15 11:43:17 +0100
        message:
          Merge from mysql-trunk to mysql-trunk-security
          Text conflict in sql/sql_class.cc
        ------------------------------------------------------------
        revno: 2876.471.108 [merge]
        committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Thu 2012-03-15 11:41:14 +0100
        message:
          Merge from mysql-trunk to mysql-trunk-security
          No conflicts
        ------------------------------------------------------------
        revno: 2876.471.107 [merge]
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: trunk-security
        timestamp: Wed 2012-03-14 14:30:18 +0100
        message:
          Null merge 5.5-security => trunk-security.
          (except for the test case)
            ------------------------------------------------------------
            revno: 2875.379.17
            committer: Tor Didriksen <tor.didriksen@oracle.com>
            branch nick: 5.5-security
            timestamp: Wed 2012-03-14 13:25:14 +0100
            message:
              Bug#13721076 CRASH WITH TIME TYPE/TIMESTAMP() AND WARNINGS IN SUBQUERY
              
              The table contains one time value: '00:00:32'
              This value is converted to timestamp by a subquery.
              
              In convert_constant_item we call (*item)->is_null()
              which triggers execution of the Item_singlerow_subselect subquery,
              and the string "0000-00-00 00:00:32" is cached
              by Item_cache_datetime.
              We continue execution and call update_null_value, which calls val_int()
              on the cached item, which converts the time value to ((longlong) 32)
              Then we continue to do (*item)->save_in_field()
              which ends up in Item_cache_datetime::val_str() which fails,
              since (32 < 101) in number_to_datetime, and val_str() returns NULL.
              
              Item_singlerow_subselect::val_str isnt prepared for this:
              if exec() succeeds, and return !null_value, then val_str()
              *must* succeed.
              
              Solution: refuse to cache strings like "0000-00-00 00:00:32"
              in Item_cache_datetime::cache_value, and return NULL instead.
              
              This is similar to the solution for 
              Bug#11766860 - 60085: CRASH IN ITEM::SAVE_IN_FIELD() WITH TIME DATA TYPE
              
              This patch is for 5.5 only.
              The issue is not present after WL#946, since a time value
              will be converted to a proper timestamp, with the current date
              rather than "0000-00-00"
        ------------------------------------------------------------
        revno: 2876.471.106 [merge]
        committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
        branch nick: mysql-trunk-security-13031606
        timestamp: Mon 2012-03-12 09:49:05 +0100
        message:
          Merge 5.5 => trunk.
            ------------------------------------------------------------
            revno: 2875.379.16 [merge]
            committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
            branch nick: mysql-5.5-security-13031606
            timestamp: Mon 2012-03-12 09:24:59 +0100
            message:
              Merge 5.1 => 5.5.
                ------------------------------------------------------------
                revno: 2661.842.13
                committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
                branch nick: mysql-5.1-security-13031606
                timestamp: Mon 2012-03-12 08:56:56 +0100
                message:
                  Bug#13031606 VALUES() IN A SELECT STATEMENT CRASHES SERVER
                  
                  Problem: Grouping results by VALUES(alias for string literal) causes
                  the server to crash.
                  
                  Item_insert_values is not constructed to handle other types of
                  arguments than field and reference to field. In this case, the
                  argument is an Item_string, and this causes
                  Item_insert_values::fix_fields() to crash.
                  
                  Fix: Issue an error message when the argument to Item_insert_values is
                  not a field or a reference to a field.
                  
                  This is slightly in breach with documentation, which states that
                  VALUES should return NULL, but the error message is only issued in
                  cases where the server otherwise would crash, so there is no change in
                  behavior for queries that already work. Future versions will restrict
                  syntax so that using VALUES in this way is illegal.
        ------------------------------------------------------------
        revno: 2876.471.105 [merge]
        committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Sun 2012-03-11 16:19:36 +0400
        message:
          Merged fix for a test case into trunk tree.
            ------------------------------------------------------------
            revno: 2875.379.15 [merge]
            committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Sun 2012-03-11 16:11:08 +0400
            message:
              Merged fix for a test case into 5.5 tree.
                ------------------------------------------------------------
                revno: 2661.842.12
                committer: Dmitry Lenev <Dmitry.Lenev@oracle.com>
                branch nick: mysql-5.1-security
                timestamp: Sun 2012-03-11 16:05:42 +0400
                message:
                  Fixed test case for bug #13105873 "valgrind warning:possible
                  crash in foreign key handling on subsequent create table if
                  not exists".
                  
                  Do not leave current database unassigned after the end of
                  the test case.
        ------------------------------------------------------------
        revno: 2876.471.104
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: B12408412-trunk-security
        timestamp: Fri 2012-03-09 17:06:36 +0200
        message:
          Fixed the result of the test to reflect the fact that this option
          does nothing and is just ignored.
        ------------------------------------------------------------
        revno: 2876.471.103 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: B12408412-trunk-security
        timestamp: Fri 2012-03-09 16:40:39 +0200
        message:
          merge mysql-5.5-security->mysql-trunk-security
            ------------------------------------------------------------
            revno: 2875.379.14
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: B12408412-5.5-security
            timestamp: Fri 2012-03-09 15:04:49 +0200
            message:
              Bug #12408412: GROUP_CONCAT + ORDER BY + INPUT/OUTPUT SAME 
              USER VARIABLE = CRASH
              
              Moved the preparation of the variables that receive the output from 
              SELECT INTO from execution time (JOIN:execute) to compile time 
              (JOIN::prepare). This ensures that if the same variable is used in the
              SELECT part of SELECT INTO it will be properly marked as non-const
              for this query.
              Test case added.
              Used proper fast iterator.
        ------------------------------------------------------------
        revno: 2876.471.102 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Fri 2012-03-09 15:54:12 +0200
        message:
          merge mysql-trunk->mysql-trunk-security
        ------------------------------------------------------------
        revno: 2876.471.101
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Fri 2012-03-09 15:40:32 +0200
        message:
          manually reverted 
          revid:annamalai.gurusami@oracle.com-20120229145745-1nx9nxb7ibde2rmd from 29 Feb 2012
        ------------------------------------------------------------
        revno: 2876.471.100 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Thu 2012-03-08 17:43:37 +0200
        message:
          empty weave merge mysql-5.5-security->trunk-security
            ------------------------------------------------------------
            revno: 2875.379.13 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: merge-5.5-security
            timestamp: Thu 2012-03-08 17:24:29 +0200
            message:
              empty weave merge mysql-5.1-security->mysql-5.5-security
                ------------------------------------------------------------
                revno: 2661.842.11 [merge]
                committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
                branch nick: merge-5.1-security
                timestamp: Thu 2012-03-08 17:20:03 +0200
                message:
                  empty weave merge mysql-5.0-security->mysql-5.1-security
                    ------------------------------------------------------------
                    revno: 1810.4008.2 [merge]
                    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
                    branch nick: merge-5.0-security
                    timestamp: Thu 2012-03-08 17:15:43 +0200
                    message:
                      empty auto merge of mysql-5.0->mysql-5.0-security
                ------------------------------------------------------------
                revno: 2661.842.10 [merge]
                committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
                branch nick: merge-5.1-security
                timestamp: Thu 2012-03-08 17:16:53 +0200
                message:
                  merge mysql-5.1->mysql-5.1-security
            ------------------------------------------------------------
            revno: 2875.379.12 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: merge-5.5-security
            timestamp: Thu 2012-03-08 17:19:54 +0200
            message:
              merge mysql-5.5->mysql-5.5-security
        ------------------------------------------------------------
        revno: 2876.471.99 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: merge-trunk-security
        timestamp: Thu 2012-03-08 17:34:34 +0200
        message:
          merge mysql-trunk->mysql-trunk-security
        ------------------------------------------------------------
        revno: 2876.471.98 [merge]
        committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Tue 2012-03-06 15:22:08 +0400
        message:
          Auto-merge from mysql-5.5-security.
            ------------------------------------------------------------
            revno: 2875.379.11 [merge]
            committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Tue 2012-03-06 15:17:06 +0400
            message:
              Auto-merge from mysql-5.1-security.
                ------------------------------------------------------------
                revno: 2661.842.9
                committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
                branch nick: mysql-5.1-security
                timestamp: Tue 2012-03-06 15:13:56 +0400
                message:
                  BUG#12537203 - CRASH WHEN SUBSELECTING GLOBAL VARIABLES IN 
                  GEOMETRY FUNCTION ARGUMENTS
                  
                  Fixed --ps-protocol gis test failure.
        ------------------------------------------------------------
        revno: 2876.471.97 [merge]
        committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Mon 2012-03-05 22:48:59 +0400
        message:
          Manual merge from mysql-5.5-security.
            ------------------------------------------------------------
            revno: 2875.379.10 [merge]
            committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Mon 2012-03-05 22:36:56 +0400
            message:
              Auto-merge from mysql-5.1-security.
                ------------------------------------------------------------
                revno: 2661.842.8
                committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
                branch nick: b12537203-5.1-security
                timestamp: Mon 2012-03-05 22:15:23 +0400
                message:
                  BUG#12537203 - CRASH WHEN SUBSELECTING GLOBAL VARIABLES IN GEOMETRY FUNCTION ARGUMENTS
                  
                  A defect in the subquery substitution code may lead to a server crash:
                  setting substitution's name should be followed by setting its length
                  (to keep them in sync).
                ------------------------------------------------------------
                revno: 2661.842.7
                committer: Ramil Kalimullin <ramil.kalimullin@oracle.com>
                branch nick: b12414917-5.1-security
                timestamp: Mon 2012-03-05 21:58:07 +0400
                message:
                  Fix for BUG#12414917 - ISCLOSED() CRASHES ON 64-BIT BUILDS 
                  
                  Problem:      
                  lack of incoming geometry data validation may 
                  lead to a server crash when ISCLOSED() function called.
                  
                  Solution:
                  necessary incoming data check added.
        ------------------------------------------------------------
        revno: 2876.471.96 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-trunk-security-bug13635833
        timestamp: Thu 2012-03-01 15:50:45 +0530
        message:
          null merge from mysql-5.5 to mysql-trunk. 
            ------------------------------------------------------------
            revno: 2875.379.9 [merge]
            committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
            branch nick: mysql-5.5-security-bug13635833
            timestamp: Thu 2012-03-01 15:49:15 +0530
            message:
              Null merge from mysql-5.1 to mysql-5.5. 
                ------------------------------------------------------------
                revno: 2661.842.6
                committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
                branch nick: mysql-5.1-security-bug13635833
                timestamp: Thu 2012-03-01 15:44:23 +0530
                message:
                  The innodb plugin module cannot use DEBUG_SYNC_C facility on Windows. 
                  Taking care of it.  
        ------------------------------------------------------------
        revno: 2876.471.95 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-trunk-security-bug13635833
        timestamp: Thu 2012-03-01 13:59:56 +0530
        message:
          Null merge from mysql-5.5 to mysql-trunk. 
            ------------------------------------------------------------
            revno: 2875.379.8 [merge]
            committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
            branch nick: mysql-5.5-security-bug13635833
            timestamp: Thu 2012-03-01 13:57:43 +0530
            message:
              Null merge from mysql-5.1 to mysql-5.5
                ------------------------------------------------------------
                revno: 2661.842.5
                committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
                branch nick: mysql-5.1-security-bug13635833
                timestamp: Thu 2012-03-01 11:05:51 +0530
                message:
                  Bug#13635833: MULTIPLE CRASHES IN FOREIGN KEY CODE WITH CONCURRENT DDL/DML
                        
                  There are two threads.  In one thread, dml operation is going on 
                  involving cascaded update operation.  In another thread, alter 
                  table add foreign key constraint is happening.  Under these 
                  circumstances, it is possible for the dml thread to access a 
                  dict_foreign_t object that has been freed by the ddl thread.  
                  The debug sync test case provides the sequence of operations.  
                  Without fix, the test case will crash the server (because of 
                  newly added assert).  With fix, the alter table stmt will return 
                  an error message.  
                        
                  Backporting the fix from MySQL 5.5 to 5.1
                  
                  rb:961
                  rb:947
        ------------------------------------------------------------
        revno: 2876.471.94
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-trunk-security-bug13635833
        timestamp: Wed 2012-02-29 20:27:45 +0530
        message:
          All the ER_ and HA_ERR_ error codes must match b/w mysql-5.1 and mysql-5.5 and mysql-trunk.
          I have made the changes in mysql-trunk so that it matches with mysql-5.5.
          I also updated corresponding test cases.  
        ------------------------------------------------------------
        revno: 2876.471.93 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-trunk-security-bug13635833
        timestamp: Mon 2012-02-27 17:40:04 +0530
        message:
          Merge from mysql-5.5-security to mysql-trunk-security. 
            ------------------------------------------------------------
            revno: 2875.379.7
            committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
            branch nick: mysql-5.5-security-bug13635833
            timestamp: Mon 2012-02-27 17:23:56 +0530
            message:
              Bug#13635833: MULTIPLE CRASHES IN FOREIGN KEY CODE WITH CONCURRENT DDL/DML
                    
              There are two threads.  In one thread, dml operation is going on 
              involving cascaded update operation.  In another thread, alter 
              table add foreign key constraint is happening.  Under these 
              circumstances, it is possible for the dml thread to access a 
              dict_foreign_t object that has been freed by the ddl thread.  
              The debug sync test case provides the sequence of operations.  
              Without fix, the test case will crash the server (because of 
              newly added assert).  With fix, the alter table stmt will return 
              an error message.  
                    
              rb:947
              approved by Jimmy Yang
        ------------------------------------------------------------
        revno: 2876.471.92
        committer: Luis Soares <luis.soares@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Fri 2012-02-24 17:27:10 +0000
        message:
          BUG#13693012
          
          Adding warnings to the result file of the newly introduced
          test case.
        ------------------------------------------------------------
        revno: 2876.471.91 [merge]
        committer: Luis Soares <luis.soares@oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Fri 2012-02-24 16:58:13 +0000
        message:
          BUG#13693012
          
          Manual merge mysql-5.5-security --> mysql-trunk-security.
            ------------------------------------------------------------
            revno: 2875.379.6 [merge]
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Fri 2012-02-24 16:32:46 +0000
            message:
              BUG#13693012
              
              Automerged approved cset.
                ------------------------------------------------------------
                revno: 2875.381.1
                committer: Luis Soares <luis.soares@oracle.com>
                branch nick: mysql-5.5-security
                timestamp: Fri 2012-02-24 16:07:43 +0000
                message:
                  Bug#13693012: SLAVE CRASHING ON INSERT STATEMENT WITH MERGE TABLE 
                  
                  PROBLEM: After WL 4144, when using MyISAM Merge tables, the routine
                  open_and_lock_tables will append to the list of tables to lock, the
                  base tables that make up the MERGE table. This has two side-effects in
                  replication: 
                  
                    1. On the master side, we log additional table maps for the base
                       tables, since they appear in the list of locked tables, even
                       though we don't really use them at the slave.
                  
                    2. On the slave side, when opening a MERGE table while applying a
                       ROW event, additional tables are appended to the list of tables
                       to lock.
                  
                  Side-effect #1 is not harmful. It's just that when using MyISAM Merge
                  tables a few table maps more may be logged.
                  
                  Side-effect #2, is harmful, because the list rli->tables_to_lock is an
                  extended structure from TABLE_LIST in which the extra fields are
                  filled from the table maps that are processed. Since
                  open_and_lock_tables appends tables to the list after all table map
                  events have been processed we end up with entries without
                  replication/table map data on them. Thus when trying to access that
                  info for these extra tables, the server will crash.
                  
                  SOLUTION: We fix side-effect #2 by making sure that we access the
                  replication part of the structure for those in the list that were
                  accounted for when processing the correspondent table map events. All
                  in all, we never go beyond rli->tables_to_lock_count.
                  
                  We also deploy an assertion when clearing rli->tables_to_lock, making
                  sure that the base tables are not in the list anymore (were closed in
                  close_thread_tables).
        ------------------------------------------------------------
        revno: 2876.471.90 [merge]
        committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
        branch nick: 56-13431369pb
        timestamp: Wed 2012-02-22 16:40:17 +0100
        message:
          auto-merge
            ------------------------------------------------------------
            revno: 2875.379.5 [merge]
            committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
            branch nick: 55-13431369pb
            timestamp: Wed 2012-02-22 16:33:07 +0100
            message:
              auto-merge
                ------------------------------------------------------------
                revno: 2661.842.4 [merge]
                committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
                branch nick: 51-13431369pb
                timestamp: Wed 2012-02-22 16:18:12 +0100
                message:
                  auto-merge
            ------------------------------------------------------------
            revno: 2875.379.4 [merge]
            committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
            branch nick: 55-13431369pb
            timestamp: Wed 2012-02-22 16:30:24 +0100
            message:
              auto-merge
        ------------------------------------------------------------
        revno: 2876.471.89 [merge]
        committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
        branch nick: 56-13431369pb
        timestamp: Wed 2012-02-22 16:37:21 +0100
        message:
          auto-merge
            ------------------------------------------------------------
            revno: 2876.485.3 [merge]
            committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
            branch nick: 56-13431369
            timestamp: Sun 2012-02-19 09:12:15 +0000
            message:
              auto merge
                ------------------------------------------------------------
                revno: 2875.380.2 [merge]
                committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
                branch nick: 55-13431369
                timestamp: Sun 2012-02-19 09:09:44 +0000
                message:
                  auto merge
            ------------------------------------------------------------
            revno: 2876.485.2 [merge]
            committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
            branch nick: 56-13431369
            timestamp: Sun 2012-02-19 09:10:43 +0000
            message:
              auto merge
            ------------------------------------------------------------
            revno: 2876.485.1 [merge]
            committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
            branch nick: 56-13431369
            timestamp: Sun 2012-02-19 09:05:44 +0000
            message:
              Bug#13431369 - MAIN.VARIABLES-NOTEMBEDDED CRASHES THE SERVER SPORADICALLY ON WINDOWS
              
              On shutdown(), Windows can drop traffic still queued for sending even if that
              wasn't specifically requested. As a result, fatal errors (those after
              signaling which the server will drop the connection) were sometimes only
              seen as "connection lost" on the client side, because the server-side
              shutdown() erraneously discarded the correct error message before sending
              it.
              
              If on Windows, we now use the Windows API to access the (non-broken) equivalent
              of shutdown().
                ------------------------------------------------------------
                revno: 2875.380.1 [merge]
                committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
                branch nick: 55-13431369
                timestamp: Sun 2012-02-19 09:00:52 +0000
                message:
                  BUG#13431369 - MAIN.VARIABLES-NOTEMBEDDED CRASHES THE SERVER SPORADICALLY ON WINDOWS
                  
                  On shutdown(), Windows can drop traffic still queued for sending even if that
                  wasn't specifically requested. As a result, fatal errors (those after
                  signaling which the server will drop the connection) were sometimes only
                  seen as "connection lost" on the client side, because the server-side
                  shutdown() erraneously discarded the correct error message before sending
                  it.
                  
                  If on Windows, we now use the Windows API to access the (non-broken) equivalent
                  of shutdown().
                  
                  Backport from trunk
                    ------------------------------------------------------------
                    revno: 2661.844.1 [merge]
                    committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
                    branch nick: 51-13431369
                    timestamp: Sun 2012-02-19 08:57:11 +0000
                    message:
                      BUG#13431369 - MAIN.VARIABLES-NOTEMBEDDED CRASHES THE SERVER SPORADICALLY ON WINDOWS
                      
                      On shutdown(), Windows can drop traffic still queued for sending even if that
                      wasn't specifically requested. As a result, fatal errors (those after
                      signaling which the server will drop the connection) were sometimes only
                      seen as "connection lost" on the client side, because the server-side
                      shutdown() erraneously discarded the correct error message before sending
                      it.
                      
                      If on Windows, we now use the Windows API to access the (non-broken) equivalent
                      of shutdown().
                      
                      Backport from trunk
                        ------------------------------------------------------------
                        revno: 2661.843.1
                        committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
                        branch nick: mysql-5.1-security
                        timestamp: Fri 2012-02-17 19:02:17 +0000
                        message:
                          BUG#13431369 - MAIN.VARIABLES-NOTEMBEDDED CRASHES THE SERVER SPORADICALLY ON WINDOWS
                          
                          On shutdown(), Windows can drop traffic still queued for sending even if that
                          wasn't specifically requested. As a result, fatal errors (those after
                          signaling which the server will drop the connection) were sometimes only
                          seen as "connection lost" on the client side, because the server-side
                          shutdown() erraneously discarded the correct error message before sending
                          it.
                          
                          If on Windows, we now use the Windows API to access the (non-broken) equivalent
                          of shutdown().
                          
                          Backport from trunk
        ------------------------------------------------------------
        revno: 2876.471.88 [merge]
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: trunk-security
        timestamp: Wed 2012-02-22 11:26:35 +0100
        message:
          merge 5.5-security => trunk-security
            ------------------------------------------------------------
            revno: 2875.379.3 [merge]
            committer: Tor Didriksen <tor.didriksen@oracle.com>
            branch nick: 5.5-security
            timestamp: Wed 2012-02-22 11:20:52 +0100
            message:
              Merge 5.1-security => 5.5-security
                ------------------------------------------------------------
                revno: 2661.842.3
                committer: Tor Didriksen <tor.didriksen@oracle.com>
                branch nick: 5.1-security
                timestamp: Wed 2012-02-22 11:17:50 +0100
                message:
                  Bug#13519724 63793: CRASH IN DTCOLLATION::SET(DTCOLLATION &SET)
                  
                  Backport of fix for:
                  Bug#53236 Segfault in DTCollation::set(DTCollation&)
        ------------------------------------------------------------
        revno: 2876.471.87 [merge]
        committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
        branch nick: mysql-trunk-security
        timestamp: Tue 2012-02-21 11:11:12 +0200
        message:
          merge mysql-5.5-security->mysql-trunk-security
            ------------------------------------------------------------
            revno: 2875.379.2 [merge]
            committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Tue 2012-02-21 11:09:12 +0200
            message:
              merge mysql-5.1-security->mysql-5.5-security
                ------------------------------------------------------------
                revno: 2661.842.2 [merge]
                committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
                branch nick: mysql-5.1-security
                timestamp: Tue 2012-02-21 11:06:08 +0200
                message:
                  merge 5.0-security->5.1-security
                    ------------------------------------------------------------
                    revno: 1810.4008.1
                    committer: Sunanda Menon <sunanda.menon@oracle.com>
                    branch nick: mysql-5.0-security
                    timestamp: Mon 2012-02-20 06:19:12 +0100
                    message:
                      Raise version number after cloning 5.0.96
                ------------------------------------------------------------
                revno: 2661.842.1
                committer: Karen Langford <karen.langford@oracle.com>
                branch nick: mysql-5.1-security
                timestamp: Mon 2012-02-20 17:03:24 +0100
                message:
                  Raise version number after cloning 5.1.62
            ------------------------------------------------------------
            revno: 2875.379.1
            committer: Hery Ramilison <hery.ramilison@oracle.com>
            branch nick: mysql-5.5-security
            timestamp: Mon 2012-02-20 16:54:54 +0100
            message:
              cloning 5.5.22
    ------------------------------------------------------------
    revno: 3803.1.3
    committer: Manish Kumar<manish.4.kumar@oracle.com>
    branch nick: mysql_13812374
    timestamp: Wed 2012-05-09 17:23:48 +0530
    message:
      BUG#13812374 : RPL.RPL_REPORT_PORT FAILS OCCASIONALLY ON PB2 
      
      Removing the test from the experimental list.
    ------------------------------------------------------------
    revno: 3803.1.2
    committer: Jimmy Yang <jimmy.yang@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-05-09 15:53:14 +0800
    message:
      Add sleep to innodb.innodb_bug13867871.test, to eliminate possible
      indeterministic from a cascade delete with DBUG_SYNC and a select
      from two different sessions.
    ------------------------------------------------------------
    revno: 3803.1.1
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-gcov
    timestamp: Wed 2012-05-09 09:13:25 +0200
    message:
      Bug#14028421 DBUG_SUICIDE() DOES NOT FLUSH GCOV DATA
------------------------------------------------------------
revno: 3806
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-10 15:44:46 +0300
message:
  Implement renaming/updating of rows in InnoDB stats tables during
  RENAME TABLE.
  
  This fixes
  Bug#13920437 RENAMING A TABLE WILL NOT RENAME THE PERSISTENT INDEX
  CARDINALITY STATISTICS
------------------------------------------------------------
revno: 3805
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-10 15:43:57 +0300
message:
  Refactor the code that saves, updates and deletes rows from
  mysql.innodb_table_stats and mysql.innodb_index_stats to prepare it
  for being able to rename a table (update the corresponding rows).
  
  * Remove the foreign key from innodb_index_stats because it is a source
    of various deadlocks. Also the absence of FK would allow users to
    temporarily store some rows in innodb_index_stats that do not have
    corresponding rows in innodb_table_stats.
  
  * When saving table and its indexes stats - save the table stats and each
    index stat in a separate transaction to avoid deadlocks.
  
    The previous mode of operation for saving was:
  
    BEGIN;
    SELECT FOR UPDATE;
    if not found
      INSERT;
    else
      UPDATE;
    COMMIT;
  
    Which had the flaw that if there was no entry and two concurrent save
    functions were called, then one of them could get a deadlock, like this:
  
    t1: SELECT FOR UPDATE; (returns not found)
    t2: SELECT FOR UPDATE; (returns not found)
    t1: INSERT; (hangs, waiting on t2)
    t2: INSERT; (fails because of a deadlock)
  
    Another way of operation would be:
  
    BEGIN;
    INSERT;
    if duplicate
      UPDATE;
    COMMIT;
  
    but that could deadlock with a single DELETE of the corresponding entry in
    the table, like this:
  
    t1: INSERT; (returns duplicate)
    t2: DELETE; (hangs, waiting on t1)
    t1: UPDATE; (fails because of a deadlock)
  
    Another solution would have been to synchronize dict_stats_save() and
    dict_stats_delete_table_stats() with a simple mutex, but que_eval_sql()
    does not allow any latches to be held during its execution except
    dict_sys->mutex.
  
    So we change the save of table stats to:
  
    BEGIN;
    INSERT;
    COMMIT;
    if duplicate
      BEGIN;
      UPDATE;
      COMMIT;
  
    At worse, a row could get deleted after INSERT has returned a duplicate error
    and before UPDATE executes, but then the UPDATE will be noop because the
    WHERE clause will match nothing. The effect will be as if the delete executed
    after the end of the save operation.
  
  * When deleting stats, delete the table and the index stats in separate
    transactions.
------------------------------------------------------------
revno: 3804
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-05-09 10:05:06 +0300
message:
  When saving table statistics, copy database and table name under
  dict_sys->mutex because RENAME TABLE does memcpy() over table->name
  under dict_sys->mutex. If we do not synchronize, then the read code may
  read garbage.
------------------------------------------------------------
revno: 3803
committer: Sunny Bains <Sunny.Bains@Oracle.Com>
branch nick: trunk
timestamp: Wed 2012-05-09 07:47:01 +1000
message:
  include string.h, to avoid compiler warnings when using clang.
------------------------------------------------------------
revno: 3802
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-05-08 22:53:29 +0300
message:
  rpl_stm_mts_crash_safe.test is done runnable with mixed format as well.
  The previous change to the test got ineffective on PB2 because it does 
  not run per push as it was supposed to.
------------------------------------------------------------
revno: 3801
committer: Nuno Carvalho <nuno.carvalho@oracle.com>
branch nick: mysql-trunk-followup
timestamp: Tue 2012-05-08 18:11:38 +0100
message:
  BUG#13810456: GTID: UNTIL_SQL_BEFORE_GTID DOES NOT WORK
  
  Fixed parser verification on START SLAVE UNTIL SQL_*_GTID and position
  conditions.
  Added reset method to struct_slave_connection to allways clean previous
  values before parsing a new START SLAVE statement.
------------------------------------------------------------
revno: 3800 [merge]
committer: Venkata Sidagam <venkata.sidagam@oracle.com>
branch nick: mysql-trunk-bug-45740
timestamp: Tue 2012-05-08 15:29:59 +0530
message:
  Null merge from mysql-5.5 to mysql-trunk
    ------------------------------------------------------------
    revno: 2875.376.31 [merge]
    committer: Venkata Sidagam <venkata.sidagam@oracle.com>
    branch nick: mysql-5.5-bug-45740
    timestamp: Mon 2012-05-07 16:51:26 +0530
    message:
      Bug #11754178 45740: MYSQLDUMP DOESN'T DUMP GENERAL_LOG AND SLOW_QUERY
                           CAUSES RESTORE PROBLEM
      
      Merging the fix from mysql-5.1 to mysql-5.5
------------------------------------------------------------
revno: 3799
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-trunk-13970015
timestamp: Tue 2012-05-08 08:07:50 +0200
message:
  Bug#13970015: ASSERT `MIN_ENDP || MAX_ENDP' FAILED IN 
                HANDLER::MULTI_RANGE_READ_INFO_CONST
  
  When key_or() finds that two SEL_ARG trees form a full range
  (no upper or lower bound in the range; is always true), NULL 
  is returned. In most cases the range optimizer then forgets 
  about these trees, but when the trees belong to two different
  SEL_TREEs used in an index merge the always true range is only
  removed from one of the SEL_TREEs. 
  
  Index merge is a disjunct operation, meaning that the rows
  read from the different indexes shall be ORed. If the
  predicate for one of the indexes is always true then index 
  merge range access will effectively fetch all rows from the
  table. Range access in this case is not a good idea.
------------------------------------------------------------
revno: 3798 [merge]
committer: Jorgen Loland <jorgen.loland@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-05-08 07:18:11 +0200
message:
  Merge from feature tree to trunk:
   * refactoring of Field::store() return type
   * cleanup of server setup/teardown for large server unit tests
    ------------------------------------------------------------
    revno: 3788.1.2
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-jorgen
    timestamp: Mon 2012-05-07 14:05:48 +0200
    message:
      Refactoring: cleanup server setup/teardown for large/server tests.
      Merge all field tests into one executable (to save some time/space when linking)
    ------------------------------------------------------------
    revno: 3788.1.1
    committer: Jorgen Loland <jorgen.loland@oracle.com>
    branch nick: mysql-trunk-11752201-2
    timestamp: Mon 2012-05-07 10:29:18 +0200
    message:
      Refactoring: change return type of Field::store(), 
      Item::save_in_field and friends from poorly defined int values
      to enum.
------------------------------------------------------------
revno: 3797
committer: Bjorn Munch <bjorn.munch@oracle.com>
branch nick: main-tr
timestamp: Mon 2012-05-07 23:01:12 +0200
message:
  unitest/unit.pl failed to fail if a test failed, using TAP
------------------------------------------------------------
revno: 3796
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-05-07 22:15:48 +0300
message:
  rpl_stm_mts_crash_safe fails on PB2.
  
  Experimenting with the test to reveal more info.
------------------------------------------------------------
revno: 3795
committer: horst.hunger@oracle.com
branch nick: mysql-trunk
timestamp: Mon 2012-05-07 18:11:47 +0200
message:
  bug#14041565: Fixed for embedded.
------------------------------------------------------------
revno: 3794 [merge]
committer: Venkata Sidagam <venkata.sidagam@oracle.com>
branch nick: mysql-trunk-bug-45740
timestamp: Mon 2012-05-07 16:57:29 +0530
message:
  Bug #11754178 45740: MYSQLDUMP DOESN'T DUMP GENERAL_LOG AND SLOW_QUERY
                       CAUSES RESTORE PROBLEM
        
  Merging the fix from mysql-5.5 to mysql-trunk
    ------------------------------------------------------------
    revno: 2875.378.1 [merge]
    committer: Venkata Sidagam <venkata.sidagam@oracle.com>
    branch nick: mysql-5.5-bug-45740
    timestamp: Mon 2012-05-07 16:02:32 +0530
    message:
      Bug #11754178 45740: MYSQLDUMP DOESN'T DUMP GENERAL_LOG AND SLOW_QUERY
                           CAUSES RESTORE PROBLEM
      
      Merging the fix from mysql-5.1 to mysql-5.5
        ------------------------------------------------------------
        revno: 2661.841.1
        committer: Venkata Sidagam <venkata.sidagam@oracle.com>
        branch nick: mysql-5.1-bug-45740
        timestamp: Fri 2012-05-04 18:33:34 +0530
        message:
          Bug #11754178 45740: MYSQLDUMP DOESN'T DUMP GENERAL_LOG AND SLOW_QUERY 
                               CAUSES RESTORE PROBLEM
          Problem Statement:
          ------------------
          mysqldump is not having the dump stmts for general_log and slow_log
          tables. That is because of the fix for Bug#26121. Hence, after 
          dropping the mysql database, and applying the dump by enabling the 
          logging, "'general_log' table not found" errors are logged into the 
          server log file.
          
          Analysis:
          ---------
          As part of the fix for Bug#26121, we skipped the dumping of tables 
          for general_log and slow_log, because the data dump of those tables 
          are taking LOCKS, which is not allowed for log tables.
          
          Fix:
          ----
          We came up with an approach that instead of taking both meta data 
          and data dump information for those tables, take only the meta data 
          dump which doesn't need LOCKS.
          As part of fixing the issue we came up with below algorithm.
          Design before fix:
          1) mysql database is having tables like db, event,... general_log,
             ... slow_log...
          2) Skip general_log and slow_log while preparing the tables list
          3) Take the TL_READ lock on tables which are present in the table 
             list and do 'show create table'.
          4) Release the lock.
          
          Design with the fix:
          1) mysql database is having tables like db, event,... general_log,
             ... slow_log...
          2) Skip general_log and slow_log while preparing the tables list
          3) Explicitly call the 'show create table' for general_log and 
             slow_log
          3) Take the TL_READ lock on tables which are present in the table 
             list and do 'show create table'.
          4) Release the lock.
          
          While taking the meta data dump for general_log and slow_log the 
          "CREATE TABLE" is replaced with "CREATE TABLE IF NOT EXISTS". 
          This is because we skipped "DROP TABLE" for those tables, 
          "DROP TABLE" fails for these tables if logging is enabled. 
          Customer is applying the dump by enabling logging so, if the dump 
          has "DROP TABLE" it will fail. Hence, removed the "DROP TABLE" 
          stmts for those tables.
            
          After the fix we could observe "Table 'mysql.general_log' 
          doesn't exist" errors initially that is because in the customer 
          scenario they are dropping the mysql database by enabling the 
          logging, Hence, those errors are expected. Once we apply the 
          dump which is taken before the "drop database mysql", the errors 
          will not be there.
------------------------------------------------------------
revno: 3793
committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-05-07 15:37:20 +0530
message:
  Event scheduler is not available at all when the embedded server is used. Including "--source include/not_embedded.inc" to this test.
------------------------------------------------------------
revno: 3792
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-04 19:41:23 +0300
message:
  Prevent deadlock between dict_stats_delete_table_stats() and
  dict_stats_save() (which, if occurs, is discovered and one of the two
  would fail).
  
  If ANALYZE TABLE t; (which would cause INSERT/UPDATE) is called at the
  same time with DROP TABLE t; then one of the two may fail.
  
  Because there is a foreign key between the innodb_table_stats and
  innodb_index_stats we must first INSERT/UPDATE into innodb_table_stats
  (parent) and after that into innodb_index_stats (child). But during DELETE
  we must follow the reverse order - first delete from innodb_index_stats
  and later from innodb_table_stats.
  
  To avoid this, we first lock innodb_table_stats during DELETE with
  SELECT ... FOR UPDATE;
------------------------------------------------------------
revno: 3791
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-04 16:27:05 +0300
message:
  Adjust innodb_stats_drop_locked.result after
  vasil.dimov@oracle.com-20120504115859-htde8io4g1yeufu2
------------------------------------------------------------
revno: 3790
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-04 14:58:59 +0300
message:
  Print the error code/text in all places where que_eval_sql() fails.
------------------------------------------------------------
revno: 3789
committer: Marc Alff <marc.alff@oracle.com>
branch nick: mysql-trunk-cleanup
timestamp: Fri 2012-05-04 12:00:43 +0200
message:
  Bug 12951609 - 62282: LOCK_THREAD_COUNT IS USED FOR RANDOM FUNCTIONS
  
  Post merge fix:
  - use the same coding pattern as for other server mutexes
  - which fixes a build break, when compiling without the performance schema.
------------------------------------------------------------
revno: 3788
committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-04 13:36:56 +0530
message:
  Skiping certain tests only from daily Valgrind execution.
------------------------------------------------------------
revno: 3787
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-04 09:46:01 +0300
message:
  Fix Bug#14007109 RECURSIVE ACQ OF BLOCK LOCK IN S MODE, STATS UPDATE
  ASRT !RW_LOCK_OWN(LOCK, 352)
  
  Manually release the latch on the last page before calling btr_pcur_close().
  If that latch is not released we will stumble on the latched page upon our
  next iteration on the same level which causes an assertion failure because
  recursive S-latches are not allowed.
  
  The code, roughly does this:
  dict_stats_analyze_index()
    start mtr
    dict_stats_analyze_index_level(mtr)
      traverse the level (leaves the last page in the middle level S-latched)
    dict_stats_analyze_index_for_n_prefix(mtr)
      traverse the level (would try to S-latch the last page)
    commit mtr
  Notice that if the level has just one page, then this bug does not resurface
  because the pcur code always latches the first page (where opened) in X-mode
  and a page left latched in X-mode is not a problem because X-mode latches are
  allowed to be recursive.
  
  Another way to fix this would be to commit the mtr in order to release the
  page latch, but that will also release the tree-level S-lock and the tree may
  change in between and we must take care to recognize such change.
  
  Given that those page-level latches are acquired internally by the pcur code
  and that they are released internally by the pcur code when jumping to the
  next page, it makes most sense to release the latch on the current page when
  closing the cursor in btr_pcur_close(). But that would require passing the
  mtr to btr_pcur_close() and this function is used in lots of places. Another
  consideration (raised by Marko) is that the page may contain changes in which
  case the mtr should be committed instead of releasing the page latch. On the
  other hand, the pcur code already releases the latches on pages it leaves.
------------------------------------------------------------
revno: 3786 [merge]
committer: Alfranio Correia <alfranio.correia@oracle.com>
branch nick: mysql-trunk-merge
timestamp: Fri 2012-05-04 08:51:46 +0100
message:
  merge mysql-trunk (local) --> mysql-trunk
    ------------------------------------------------------------
    revno: 3690.31.1
    committer: Alfranio Correia <alfranio.correia@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-04-19 16:22:04 +0100
    message:
      BUG#13971348 - FAILURE WHILE CONFIGURING REPLICATION CAUSES THE SERVER TO SHUTDOWN
      
      If something went wrong while setting up replication's objects (i.e. slave 
      objects), the server was brought off-line. For some specific errors, one
      could provide --skip-slave-start to try to avoid shutting down the server.
      
      This was a drastic measure as the replication is just one of the services 
      provided by the server.
      
      With this patch, we just print out some error messages on the problem and
      let the server continue its execution.
------------------------------------------------------------
revno: 3785 [merge]
committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-05-04 12:32:33 +0530
message:
  Null merge from mysql-5.5 to mysql-trunk. 
    ------------------------------------------------------------
    revno: 2875.376.30
    committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
    branch nick: mysql-5.5
    timestamp: Fri 2012-05-04 12:29:49 +0530
    message:
      In perl, to break out of a foreach loop we need to use 
      the keyword "last" and not "break".  Fixing the failing
      test case. 
------------------------------------------------------------
revno: 3784
committer: Sunny Bains <Sunny.Bains@Oracle.Com>
branch nick: trunk
timestamp: Fri 2012-05-04 10:07:22 +1000
message:
  Bug#14034087 - FIX FALSE CACHELINE SHARING IN 5.6
  
  1. Reduce false sharing
  
  2. Reduce the overhead of cache coherency
  
  3. Remove redundant code
  
  4. Remove bogus stats printfs that were only enabled when UNIV_DEBUG was set
  
  Add a class ib_counter_t that splits the counter into N slots. Currently
  hard coded to 64 slots. It pads the slots on 64 bytes, again currently hard
  coded. We may in the future make these configurable once there is a platform
  independent and reliable way to get the necessary information.
  
  There is an implementation that uses the Linux function cpu_getsched() instead
  of the OS thread id. It is currently not used.
  
  Group all the stats variables in srv_stats_t.
  
  rb://1028 Approved by Inaam Rana.
------------------------------------------------------------
revno: 3783
committer: Nuno Carvalho <nuno.carvalho@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-03 18:03:03 +0100
message:
  BUG#11933491: RPL_CHANGE_MASTER_DBUG FAILS ON X86_64 GCOV, TRUNK AFTER FIX FOR BUG 11766112
  
  This test uses 'dummy' as master hostname to mimic a connection failure,
  assuming that 'dummy' is a undefined hostname, although 'dummy' is 
  defined in some *.oracle.com domains what will cause a timeout and not 
  connection retry, the expect error.
  
  Replaced 'dummy' by '300.1.1.1'.
------------------------------------------------------------
revno: 3782
committer: Gleb Shchepa <gleb.shchepa@oracle.com>
branch nick: trunk
timestamp: Thu 2012-05-03 15:07:39 +0400
message:
  WL#5855: Print EXPLAIN in JSON format
  
  Minor update to make old Sun C++ compiler happy.
------------------------------------------------------------
revno: 3781
committer: Tor Didriksen <tor.didriksen@oracle.com>
branch nick: trunk
timestamp: Thu 2012-05-03 12:59:36 +0200
message:
  BUG#13983918 - FACTOR OUT MY_GET_ERR_MSG() FROM MY_ERROR() FOR GENERAL USE
  
  Post-push fix for unit test, 
  adjust to different perror() messages on different platforms.
------------------------------------------------------------
revno: 3780
committer: Frazer Clement <frazer.clement@oracle.com>
branch nick: mysql-trunk-wl5917
timestamp: Thu 2012-05-03 11:33:07 +0100
message:
  Second part of not removing MySQL Cluster binary man pages
------------------------------------------------------------
revno: 3779
committer: Alexander Barkov <alexander.barkov@oracle.com>
branch nick: mysql-trunk.11765016
timestamp: Thu 2012-05-03 14:22:59 +0400
message:
  Bug#11765016 / 57926: ILLEGAL MIX OF COLLATIONS FOR OPERATION 'UNION' .. USING CONCAT/FUNCTION/
  Not a bug. Adding coverage tests.
------------------------------------------------------------
revno: 3778
committer: Frazer Clement <frazer.clement@oracle.com>
branch nick: mysql-trunk-wl5917
timestamp: Thu 2012-05-03 11:26:04 +0100
message:
  Don't remove man pages for ndb* binaries in MySQL Cluster
------------------------------------------------------------
revno: 3777
committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-03 15:46:48 +0530
message:
  Added "--big-test" option corresponding to "embedded" run in default.weekly.
------------------------------------------------------------
revno: 3776
committer: Frazer Clement <frazer.clement@oracle.com>
branch nick: mysql-trunk-wl5917
timestamp: Thu 2012-05-03 10:41:32 +0100
message:
  WL#5917 Appending data to Rows_log_event
  
  Overview
  --------
  This feature implements new 'version 2' Binlog row events for the existing
  WRITE_ROW, UPDATE_ROW, DELETE_ROW events.  Version 2 Binlog row events
  become the default.
  
  These new 'version 2' Binlog row events can transport extra information
  *with* each row event.
  
  A Master can optionally generate 'version 1' Binlog row events by setting the
  --log-bin-use-v1-row-events=1 MySQLD option/variable.  This is necessary
  during an upgrade where the Master is upgraded before the Slave.
  
  Motivation
  ----------
  This feature is primarily motivated by WL5353 Reflecting GCI, which uses
  the extra row event data to transport per-row event transaction identities.
  
  
  Details
  -------
  - 3 new event types added
  - Existing row events renamed with _v1 suffix
  - log-bin-use-v1-row-events option added
  - Existing row event classes reused
  - Extra row info is one use case of new 'v2' extensible row 
    event format.  Should be no need for 'v3'.
  - Binlog injector Api enhanced to allow info to be passed in
  - THD Api enhanced to expose info to storage engine running as 
    Slave SQL thread
  - mysqlbinlog tool enhanced to show extra info in --verbose mode.
  - New testcases : rpl_extra_row_data, log_bin_use_v1_row_events_basic
  - Enhanced testcase : binlog_old_versions
  - Various corrected / adjusted testcases
------------------------------------------------------------
revno: 3775
committer: Thayumanavar <thayumanavar.x.sachithanantha@oracle.com>
branch nick: mysql_check
timestamp: Thu 2012-05-03 14:09:42 +0530
message:
  Bug#12951609: 62282: LOCK_THREAD_COUNT IS USED FOR RANDOM FUNCTIONS
  PROBLEM: LOCK_thread_count was used to protect sql_rand.LOCK_thread_count
  is used for a different purpose and is held across at various  places 
  which causes hot contention during connect times.LOCK_thread_count is not
  meant to protect sql_rand.
  FIX: Added a new global LOCK_sql_rand rather than use LOCK_THREAD_COUNT.
------------------------------------------------------------
revno: 3774
committer: Frazer Clement <frazer.clement@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-03 09:11:43 +0100
message:
  Revert accidental push of WL6003 patch (revision 3768)
------------------------------------------------------------
revno: 3773
committer: Mattias Jonsson <mattias.jonsson@oracle.com>
branch nick: test-trunk
timestamp: Thu 2012-05-03 10:05:16 +0200
message:
  bug#14026815: mysql_client_test_embedded takes too long time
  
  require big-test to run, to avoid sporadic timeouts.
------------------------------------------------------------
revno: 3772
committer: Jimmy Yang <jimmy.yang@oracle.com>
branch nick: trunk4
timestamp: Thu 2012-05-03 15:30:45 +0800
message:
  Fix Bug #13966091 - ASSERTION FAILED: LENGTH || !SCALE,
  FILE .\\\\SQL\\\\MY_DECIMAL.H, LINE 244
  
  rb://1052 approved by Sunny Bains
------------------------------------------------------------
revno: 3771
committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
branch nick: mysql-trunk-13330886
timestamp: Thu 2012-05-03 09:03:59 +0200
message:
  Bug#13330886 TOO MANY ROWS WITH ALL|ANY
  
  Post push fix. Corrected test result for test engines/funcs.sq_all.
------------------------------------------------------------
revno: 3770
committer: brajmohan saxena <brajmohan.saxena@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-03 12:19:33 +0530
message:
                    BUG#12402882  :  MYSQL.EXE CRASHES UNDER XP SP2 WHEN CALLED WITH ITS FULL PATH
        
                    Problem  :  MySQL client is getting crash while running with full path from
                                windows command line.
                                
                    Solution :  Changes in for loop condition for number of arguments in one of
                                the client side unicode function.
------------------------------------------------------------
revno: 3769
committer: Jimmy Yang <jimmy.yang@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-05-03 10:51:59 +0800
message:
  FIx Bug #14008582 - SHUTDOWN HANG, LATCH DEADLOCK BETWEEN FTS OPTIMIZING
  THREAD AND DICTIONARY CACHE
  
  rb://1050 approved by Sunny Bains
------------------------------------------------------------
revno: 3768
committer: Frazer Clement <frazer.clement@oracle.com>
branch nick: mysql-trunk-wl6003
timestamp: Thu 2012-05-03 00:45:28 +0100
message:
  WL#6003 Support silent slave transaction retries
  
  Support handler returning error resulting in silent slave 
  transaction retry.
  
  This feature allows handlers to use automatic, quick transaction 
  retries for purposes such as conflict detection, error handling etc.
------------------------------------------------------------
revno: 3767
committer: Alexander Barkov <alexander.barkov@oracle.com>
branch nick: mysql-trunk.boolfunc4
timestamp: Wed 2012-05-02 23:59:24 +0400
message:
  After-fix for WL#946
  check_simple_equality() didn't work well with
  temporal arguments in some cases, which made
  redundant warnings get produced.
  Fixing agg_arg_charsets_for_comparison() to store its
  result into cmp.cmp_collation instead of a temporary
  variable, so Item_bool_func2::compare_collation()
  returns a correct result.
------------------------------------------------------------
revno: 3766
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-05-02 20:30:42 +0300
message:
  Remove duplicate definition of OS_SYNC_TIME_EXCEEDED and fix
  typo in the macro os_event_wait_time().
------------------------------------------------------------
revno: 3765 [merge]
committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
branch nick: 56
timestamp: Wed 2012-05-02 14:28:50 +0100
message:
  auto-merge
    ------------------------------------------------------------
    revno: 3743.2.1
    committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
    branch nick: 56-13983918
    timestamp: Wed 2012-05-02 05:50:53 +0100
    message:
      BUG#13983918 - FACTOR OUT MY_GET_ERR_MSG() FROM MY_ERROR() FOR GENERAL USE
      
      In order to use the format strings in sql/share/errmsg-utf8.txt we should
      factor out the format string lookup code into a separate function. That way
      we can use the function to write to the error log and also to push
      info/warning message to the client using the format string from
      sql/share/errmsg-utf8.txt. This is required for WL#5522 to work.
------------------------------------------------------------
revno: 3764
committer: Marko M?kel? <marko.makela@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-05-02 16:09:58 +0300
message:
  Non-functional changes.
  
  dict_mem_table_create(): Remove bogus comment about clustered tables,
  which were never implemented in InnoDB.
  
  create_table_def(): Remove unnecessary type casts.
------------------------------------------------------------
revno: 3763 [merge]
committer: Rohit Kalhans <rohit.kalhans@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-05-02 17:34:42 +0530
message:
  WL#5597: Using batch operations when there is no index in RBR
  
  CONTEXT
  -------
  
  With RBR, if a table has no indexes, the slave does a full table scan for each
  row changed (i.e. updated or deleted). This can be extremely time consuming
  when there is a high number of rows to be updated.
  
  SOLUTION
  ---------
  
  When there is a table without a PK or an INDEX, create a temporary in-memory
  index (e.g. in-memory hash table) and store the rows to be update in it. Then for
  each row in the table, check if the row exists in the hash table. If there is a
  match, do the operation, i.e. update or delete.
    ------------------------------------------------------------
    revno: 3402.84.36
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Wed 2012-04-25 16:48:57 +0530
    message:
      WL#5597: fixing warnings in rpl.rpl_row_hash_scan when run with MTS.
    ------------------------------------------------------------
    revno: 3402.84.35
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Wed 2012-04-25 13:23:10 +0530
    message:
      WL#5597: Adding new run for testing feature with MTS 
    ------------------------------------------------------------
    revno: 3402.84.34 [merge]
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Tue 2012-04-24 19:09:42 +0530
    message:
      merge mysql-trunk->mysql-trunk-wl5597
    ------------------------------------------------------------
    revno: 3402.84.33
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Thu 2012-04-19 22:16:25 +0530
    message:
      WL#5597: fixing RPL_ROW_IDEMPOTENCY failure. 
    ------------------------------------------------------------
    revno: 3402.84.32
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Thu 2012-04-19 17:43:09 +0530
    message:
      Adding assertion for !m_table->file->inited
      in Rows_log_event::row_operations_scan_and_key_teardown()
    ------------------------------------------------------------
    revno: 3402.84.31
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Thu 2012-04-19 17:30:53 +0530
    message:
      WL#5597:
      
      Changes handling review comments from Luis.
      -Renaming finish_row_update_or_delete() -> row_operations_scan_and_key_teardown()
      -Renaming init_row_update_or_delete() -> row_operations_scan_and_key_setup()
    ------------------------------------------------------------
    revno: 3402.84.30
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Thu 2012-04-19 15:32:15 +0530
    message:
      WL#5597:
      
      Changes handling review comments from Luis and Nuno.
    ------------------------------------------------------------
    revno: 3402.84.29
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Tue 2012-04-17 16:07:22 +0530
    message:
      WL#5597:
      Code cleanup (removed trailing spaces)
      Removed DBUG_ASSERT(crc > 0) from make_hash_key() as 0
      has become a valid value of hash_key.
    ------------------------------------------------------------
    revno: 3402.84.28
    committer: Luis Soares <luis.soares@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Mon 2012-04-16 19:12:19 +0100
    message:
      WL#5597
      
      Fix for the case when row image is minimal and hashing is done on
      an image that contains NULL fields that were not signaled in the
      read_set. This means that the unpack_row function would not have 
      set the null bit (it not meaningful). Ultimately, this means that
      when hashing the record got from the SE, one would get different 
      hash value, because the SE would have the null_bytes fully set,
      whereas the BI would not.
      
      We fix this by only checksumming the null_bytes if the read_set is
      entirely set. This is the M.O. already followed by the record
      comparison and the rest of the hashing calculation.
    ------------------------------------------------------------
    revno: 3402.84.27
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Mon 2012-04-16 22:27:42 +0530
    message:
      WL#5597
      fixing the test failures(result content mismatch) on the wL branch. 
    ------------------------------------------------------------
    revno: 3402.84.26
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Mon 2012-04-16 21:01:21 +0530
    message:
      1- Addressing Svoj's comments regarding exposing a flag for 
         Search engines that donot synchronize result set. e.g. BLACKHOLE.
        -Modified sql/log_event.cc accordingly
      
      2- Made next_record_scan() readable by adding comment and slight refactoring. 
    ------------------------------------------------------------
    revno: 3402.84.25 [merge]
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Tue 2012-04-10 14:22:15 +0530
    message:
      fixing build failure on the  feature tree
    ------------------------------------------------------------
    revno: 3402.84.24 [merge]
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk_WL5597
    timestamp: Mon 2012-04-09 19:13:35 +0530
    message:
      WL#5597: merging mysql-trunk---->feature tree mysql-trunk-WL5597
    ------------------------------------------------------------
    revno: 3402.84.23
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk_WL5597
    timestamp: Fri 2012-04-06 15:47:21 +0530
    message:
      WL#5597:
      -Added handler flag to distinguish engines that do not store actual rows.
      -Added the flag in the list of flgs returned by ha_blackhole::table_flags().
    ------------------------------------------------------------
    revno: 3402.84.22
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk_WL5597
    timestamp: Wed 2012-04-04 22:45:40 +0530
    message:
      WL#5597: Fix  content mismatch  for sys_vars.slave_rows_search_algorithms_basic filure.
    ------------------------------------------------------------
    revno: 3402.84.21
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk_WL5597
    timestamp: Wed 2012-04-04 19:34:11 +0530
    message:
      Fixing tieout failures on PB2 when Index scan is done on non-unique keys.
    ------------------------------------------------------------
    revno: 3402.84.20
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk_WL5597
    timestamp: Wed 2012-04-04 16:12:59 +0530
    message:
      WL#5597: 
      
      This patch includes 
      1. code cleanup, Remeved trailing spaces
      2. Fix for build failure on some platform.
    ------------------------------------------------------------
    revno: 3402.84.19
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk_WL5597
    timestamp: Tue 2012-04-03 18:31:53 +0530
    message:
      WL#5597: Using batch operations when there is no index in RBR
      Patch addressing Nuno's review comments
    ------------------------------------------------------------
    revno: 3402.84.18
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk_WL5597
    timestamp: Tue 2012-04-03 15:24:52 +0530
    message:
      WL#5597:
      Patch to fix the failures on the WL branch.
      We store the list of all distinct keys  and iteratre over them while fetching the
      next record if HASH_SCAN over an index is to be done.
    ------------------------------------------------------------
    revno: 3402.84.17 [merge]
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Fri 2012-03-16 11:35:15 +0530
    message:
      merging luis' patch to use hash even when Index/Key is present. 
        ------------------------------------------------------------
        revno: 3402.85.1
        committer: Luis Soares <luis.soares@oracle.com>
        branch nick: mysql-trunk-wl5597
        timestamp: Mon 2012-03-12 10:29:49 +0000
        message:
          WL#5597
          
          Testing making hash scan work for regular indexes as well:
          
            - made decide_row_lookup_algorithm to decide on both:
              1. lookup method
              2. key to be used during searches (Index or Hash)
          
            - made decide_row_lookup_algorithm member function of 
              Rows_log_event
          
            - wrapped the opening and closing of index / table on 
              do_hash_scan member function so that it is transparent
              whether an index or table is opened.
          
            - changed do_before_row_operations because the choosing
              of the index to use is done inside decide_row_lookup_algorithm.
    ------------------------------------------------------------
    revno: 3402.84.16
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Tue 2012-02-28 17:12:53 +0530
    message:
      WL#5597: Fixed test failure in rpl.rpl_row_hash_scan which 
      was caused due to change in binlog position caused due to 
      use of GTIDs.
    ------------------------------------------------------------
    revno: 3402.84.15 [merge]
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Tue 2012-02-28 11:46:05 +0530
    message:
      WL#5597: merging WL branch with the current trunk.
    ------------------------------------------------------------
    revno: 3402.84.14
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Wed 2012-02-22 12:08:16 +0530
    message:
      WL#5597:Using batch operations when there is no index in RBR
      
      Fixed the valgrind failures by skipping use of bit type field in the 
      the hash key generation.
    ------------------------------------------------------------
    revno: 3402.84.13
    committer: Luis Soares <luis.soares@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Sat 2012-02-18 02:00:23 +0000
    message:
      WL#5597
      
      Reverting changes to the result file of rpl_row_binlog_max_cache_size
      introduced in rohit.kalhans@oracle.com-20111215091140-69hnhau1ppbns365,
      ie, removing the incident entry from the show binlog events output.
      
      The result file in mysql-trunk also does not show the incident event,
      which makes sense, since only a transactional table is involved in the
      equation here, therefore the rollback is safe (no need to write an 
      incident event).
    ------------------------------------------------------------
    revno: 3402.84.12
    committer: Luis Soares <luis.soares@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Fri 2012-02-17 18:24:06 +0000
    message:
      WL#5597 
      
      There were a missing braces in an 'if' inside 
      Rows_log_event::do_post_row_operations .
      
      Also refactored rpl_bug26395 a bit.
    ------------------------------------------------------------
    revno: 3402.84.11
    committer: Luis Soares <luis.soares@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Fri 2012-02-17 14:06:05 +0000
    message:
      WL#5597
      
      Updating the collection name and var dir when running with HASH_SCAN on.
    ------------------------------------------------------------
    revno: 3402.84.10 [merge]
    committer: Luis Soares <luis.soares@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Fri 2012-02-17 12:46:44 +0000
    message:
      WL#5597
      
      Auto merge from mysql-trunk --> mysql-trunk-wl5597.
    ------------------------------------------------------------
    revno: 3402.84.9
    committer: Luis Soares <luis.soares@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Fri 2012-02-17 12:38:19 +0000
    message:
      WL#5597
      
      Added a couple of extra runs on the collection that the feature tree picks.
      
      The extra do:
      
        - run the binlog and rpl suite in row mode only
        - run binlog and rpl suite with HASH_SCAN active
    ------------------------------------------------------------
    revno: 3402.84.8
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Tue 2012-02-14 14:14:53 +0530
    message:
      Fix for failure of main.type_date.
    ------------------------------------------------------------
    revno: 3402.84.7 [merge]
    committer: Rohit Kalhans <rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-wl5597
    timestamp: Tue 2012-02-14 00:35:40 +0530
    message:
      Merge with the latest trunk.
      -Test fixes:
             rpl.rpl_relayrotate.test has been fixed.
    ------------------------------------------------------------
    revno: 3402.84.6 [merge]
    committer: Rohit Kalhans<rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-merged
    timestamp: Fri 2011-12-30 13:02:00 +0530
    message:
      merge with the latest trunk 
    ------------------------------------------------------------
    revno: 3402.84.5
    committer: Rohit Kalhans<rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-merged
    timestamp: Thu 2011-12-22 18:16:37 +0530
    message:
      WL#5597: fixed test failures
      The following tests have been fixed 
       1. main.mysqld-help-win
       2. rpl.rpl_parallel_start_stop
       3. rpl.rpl_relayrotate
    ------------------------------------------------------------
    revno: 3402.84.4
    committer: Rohit Kalhans<rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-merged
    timestamp: Thu 2011-12-15 17:08:28 +0530
    message:
      WL#5597: Removed test rpl_row_find_row_debug as this test is now obsolete.
    ------------------------------------------------------------
    revno: 3402.84.3 [merge]
    committer: Rohit Kalhans<rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-merged
    timestamp: Thu 2011-12-15 14:47:25 +0530
    message:
      Merging WL tree with MySQL trunk.
    ------------------------------------------------------------
    revno: 3402.84.2
    committer: Rohit Kalhans<rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-merged
    timestamp: Thu 2011-12-15 14:41:40 +0530
    message:
      Fixed the test cases that failed after the merge.
      
      The Following tests have been fixed.
      1. rpl.rpl_row_hash_scan_sanity.test
      2. rpl.rpl_row_idempotency.test
      3. rpl.rpl_row_hash_scan.test
      4. rpl.rpl_row_rec_comp_innodb.test
      
      The tree name has also been changed to mysql-tunk-wl5597
    ------------------------------------------------------------
    revno: 3402.84.1 [merge]
    committer: Rohit Kalhans<rohit.kalhans@oracle.com>
    branch nick: mysql-trunk-merged
    timestamp: Mon 2011-12-12 16:26:21 +0530
    message:
      WL#5597 Merging the WL5597 tree with the trunk.
        ------------------------------------------------------------
        revno: 2876.482.6 [merge]
        committer: Rohit Kalhans<rohit.kalhans@oracle.com>
        branch nick: mysql-trunk-wl5597
        timestamp: Thu 2011-12-08 12:22:10 +0530
        message:
          Applying patch addressing alfranios comments 
            ------------------------------------------------------------
            revno: 2876.484.1
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-trunk-wl5597
            timestamp: Wed 2011-01-26 16:00:19 +0000
            message:
              WL#5597
              
              Addressing Alfranio's review comments.
        ------------------------------------------------------------
        revno: 2876.482.5
        committer: Luis Soares <luis.soares@oracle.com>
        branch nick: mysql-trunk-wl5597
        timestamp: Tue 2011-01-11 01:03:43 +0000
        message:
          WL#5597
          
          Fixing broken tests cases:
          
            - sys_vars.all_vars
            - sys_vars.slave_rows_search_algorithms_basic
            - main.mysqld--help-win
        ------------------------------------------------------------
        revno: 2876.482.4
        committer: Luis Soares <luis.soares@oracle.com>
        branch nick: mysql-trunk-wl5597
        timestamp: Tue 2011-01-11 01:01:56 +0000
        message:
          Fixed tree name.
        ------------------------------------------------------------
        revno: 2876.482.3
        committer: Luis Soares <luis.soares@oracle.com>
        branch nick: mysql-trunk-wl5597
        timestamp: Tue 2011-01-11 00:59:45 +0000
        message:
          WL#5597
          
          Addressing Zhenxing's review comments.
          
          Other changes (not requested by reviewer)
          -----------------------------------------
          
          - log_event
            - fix typo in search_key_in_table
            - fix missing (get_type_code() == UPDATE_ROWS_EVENT) when
              setting the table readset
            - identation
            - added debug
          
          - log_event.h (none)
            
          - rpl_utility.cc
            - added more comments
            - improvement on next() implementation
        ------------------------------------------------------------
        revno: 2876.482.2 [merge]
        committer: Luis Soares <luis.soares@oracle.com>
        branch nick: mysql-next-mr-wl5597-push
        timestamp: Mon 2011-01-10 19:11:35 +0000
        message:
          WL#5597: Using batch operations when there is no index in RBR
          
          NOTE: WORK-IN-PROGRESS
            
          When applying large delete_rows or update_rows log events and the
          destination table does not have any index, the operation can take
          a very long time. This is due to the fact that several table
          scans are actually performed instead of just one.
            
          We fix this by adding a new search and update procedure to the
          slave. Consequently, when a delete_rows or update_rows event is
          about to be processed and there is no PK or INDEX on the
          associated table, the slave is able to create a temporary
          in-memory hash table and store the rows to be updated in
          it. Then, for each row in the storage engine table, it checks if
          the row exists in the hash table. If there is a match, it does
          the operation. This is done in a one time table scan instead of
          several.
            ------------------------------------------------------------
            revno: 2876.483.13
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Tue 2010-11-23 00:53:54 +0000
            message:
              WL#5597
              
              Tests part II.
              
              Improvements on this cset:
              - Added sanity tests for checking whether slave selects the correct
                search algorithm or not.
            ------------------------------------------------------------
            revno: 2876.483.12
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Tue 2010-11-23 00:51:55 +0000
            message:
              WL#5597
              
              Work-in-progress.
              
              Improvements on this cset:
              - Disallow INDEX_SCAN to be set as the only search algorithm.
            ------------------------------------------------------------
            revno: 2876.483.11
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Tue 2010-11-23 00:08:01 +0000
            message:
              WL#5597
              
              Work-in-progress.
              
              Tests part I.
              
              Improvements on this cset:
              - moved rpl_row_idempotency contents to a file in extra/rpl_tests
              - made rpl_row_idempotency run twice: one time with TABLE_SCAN
                and another with HASH_SCAN by including 
                extra/rpl_tests/rpl_row_idempotency.test
              - added rpl_row_hash_scan.test with several assertions on
                HASH_SCAN algorithm (also provides coverage the new 
                code introduced).
              - fixed slave_rows_search_algorithm_basic.test that was broken
                from previous commit.
              - instrumented log_event.cc, mysqld.cc and mysqld.h with a new
                status var: slave_rows_last_search_algorithm_used so that 
                some sanity tests are written.
            ------------------------------------------------------------
            revno: 2876.483.10
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Mon 2010-11-22 21:36:08 +0000
            message:
              WL#5597
              
              Work-in-progress.
              
              Improvements on this cset:
              - made row_lookup_method a member variable of Rows_log_event.
                This way, we just need to call decide_row_lookup_algorithm
                once while applying one each Rows_log_event;
              - deployed assertion when there is no match for 
                m_rows_lookup_algorithm.
            ------------------------------------------------------------
            revno: 2876.483.9
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Mon 2010-11-22 21:18:52 +0000
            message:
              WL#5597
              
              Work-in-progress
              
              Improvement on this cset:
              - moved write_rows from Rows_log_event to Write_rows_log_event.
            ------------------------------------------------------------
            revno: 2876.483.8
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Mon 2010-11-22 21:10:41 +0000
            message:
              WL#5597
              
              Work-in-progress.
              
              Improvements on this cset:
              - implemented the system variable: slave_rows_search_algorithm;
              - fixed a few issues introduced in latest cset;
              - fixed rpl_blackhole to not use hash_scan (still hackish);
              - added test case for system variable;
              - documentation effort.
            ------------------------------------------------------------
            revno: 2876.483.7
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Mon 2010-11-22 14:55:17 +0000
            message:
              WL#5597
              
              Work-in-progress.
              
              Improvements on this cset:
              - bugfixing for do_table_scan_and_update
              - hack fixing rpl_blackhole (always use table scan)
              - few refactorings
            ------------------------------------------------------------
            revno: 2876.483.6
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Mon 2010-11-22 02:11:25 +0000
            message:
              WL#5597
              
              Work-in-progress.
              
              Improvements in this cset:
              - fixing a couple of test cases that failed.
              - improved and documented (doxygen) hash interface.
              - better handling for hashing collisions.
            ------------------------------------------------------------
            revno: 2876.483.5
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Fri 2010-11-19 23:00:43 +0000
            message:
              WL#5597
              
              Work-in-progress.
              
              This cset fixes client tools build problem introduced in earlier
              patch.
            ------------------------------------------------------------
            revno: 2876.483.4
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Fri 2010-11-19 22:44:52 +0000
            message:
              WL#5597
              
              Work-in-progress.
              
              Improvements:
              
              - Placed code for handling row hashing into its own class
                aggregating an HASH instance. 
              - Moved hash handling to rpl_utility.cc
              - Fixed a few implementation bugs that were making some tests 
                failing.
              - slave idempotency and slave-skip-errors seems to be working 
                properly. Needs more testing.
            ------------------------------------------------------------
            revno: 2876.483.3
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Fri 2010-11-19 11:33:10 +0000
            message:
              WL#5597
              
              Work-in-progress!
              
              Improvements on this cset:
              - fixes to idempotency handling.
              - fixes to m_curr_row pointer in exec row main loop.
              - refactory on main loop: we check what apply method to use only 
                once keep the pointer and use it inside the exec row main loop
              - added some DBUG macros
              - fixes to bugs inside do_index_scan_and_update
            ------------------------------------------------------------
            revno: 2876.483.2
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Fri 2010-11-12 13:59:15 +0000
            message:
              WL#5597: Using batch operations when there is no index in RBR
              
              Work-in-progress.
              
              Improvements on this cset:
              - key to hash table contains hashed value, not the row (smaller 
                memory footprint)
              - blobs are removed from the hashing
            ------------------------------------------------------------
            revno: 2876.483.1
            committer: Luis Soares <luis.soares@oracle.com>
            branch nick: mysql-next-mr
            timestamp: Fri 2010-11-05 00:31:22 +0000
            message:
              WL 5597: Work in progress.
        ------------------------------------------------------------
        revno: 2876.482.1
        committer: Luis Soares <luis.soares@oracle.com>
        branch nick: mysql-next-mr-wl5597-push
        timestamp: Mon 2011-01-10 19:09:45 +0000
        message:
          Fixing tree name.
------------------------------------------------------------
revno: 3762
committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
branch nick: mysql-trunk-13330886
timestamp: Wed 2012-05-02 12:40:45 +0200
message:
  Bug#13330886 TOO MANY ROWS WITH ALL|ANY
  
  Post push fix. Changed test result for test explain_json_validate.
------------------------------------------------------------
revno: 3761
committer: Tor Didriksen <tor.didriksen@oracle.com>
branch nick: trunk
timestamp: Wed 2012-05-02 10:30:33 +0200
message:
  Followup patch for Bug#13945257 NEW COMPILATION ERRORS/WARNINGS WITH XCODE 4.3.2
  
  Do not allocate anything on the heap in Fake_TABLE,
  since TABLE::~TABLE() is not virtual.
------------------------------------------------------------
revno: 3760
committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
branch nick: mysql-trunk-13330886
timestamp: Wed 2012-05-02 09:44:09 +0200
message:
  Bug#13330886 TOO MANY ROWS WITH ALL|ANY
  
  Queries with subquery predicates containing ALL may return incorrect
  results due to a faulty query transformation. E.g.:
  
  SELECT * FROM t1 WHERE b > ALL (SELECT a FROM t2);
  
  is rewritten
  
  SELECT * FROM t1 WHERE b > (SELECT MAX(a) FROM t2);
  
  This transformation in Item_in_subselect::single_value_transformer()
  is correct only when t2.a doesn't contain NULL values. If the subquery
  result contains at least one non-NULL value, MAX(a) returns the
  largest non-NULL value, and this value is compared with b. However,
  (b > ALL(result that contains at least one NULL)) should return UNKNOWN
  unless there is a value in the subquery result that is greater than b,
  in which case the condition should return FALSE.
  
  Fix: Disable this transformation for ALL subquery predicates that may
  return NULL.
  
  This patch also enables the transformation for queries that are not
  top-level if both the left-hand and right-hand expressions are
  non-nullable.
------------------------------------------------------------
revno: 3759
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-30 19:14:26 +0300
message:
  Bug#14018843 - FAULTY LOGICS IN MTS_DEBUG_CONCURRENT_ACCESS HANDLING
  
  Introduced to verify MTS concurrent behavior `mts_debug_concurrent_access'
  debug flag was unnecessaliry checked by IO thread which leads to a hang like. 
  
     http://pb2.no.oracle.com/web.py?template=mysql_show_test_failure&search=yes&push_id=3396783&test_id=3400389&test_run=rpl_binlog-debug-big&test_suite=rpl&test_case=rpl_mts_debug
  
  Fixed with excluding other than MTS worker threads 
  from checking the debug flag.
  
  One-liner fixes suppressing a warning in rpl_filter_tables_not_exist is piggybacked.
------------------------------------------------------------
revno: 3758
committer: Marko M?kel? <marko.makela@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-30 16:39:52 +0300
message:
  Non-functional changes (formatting and data type cleanup)
------------------------------------------------------------
revno: 3757
committer: Marko M?kel? <marko.makela@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-30 16:13:04 +0300
message:
  Bug#14017795 DROP, ADD INDEX ON VARCHAR FAILS
  
  innobase_find_equiv_index(): Subtract the length_bytes
  from the pack_length() of MYSQL_TYPE_VARCHAR.
------------------------------------------------------------
revno: 3756
committer: Tor Didriksen <tor.didriksen@oracle.com>
branch nick: trunk-bug13988413useconds
timestamp: Mon 2012-04-30 14:42:56 +0200
message:
  Bug#13988413 CRASH/ASSERTION AFTER INVALID MEMORY READ IN MY_USECONDS_TO_STR
  
  Item_func_if::fix_length_and_dec() failed to calculate number of decimals
  for time arguments.
------------------------------------------------------------
revno: 3755
committer: Guilhem Bichot <guilhem.bichot@oracle.com>
branch nick: bug13432631
timestamp: Mon 2012-04-30 12:06:23 +0200
message:
  Bug #13949068 ASSERT TAB->REF.KEY == REF_KEY IN PLAN_CHANGE_WATCHDOG::~PLAN_CHANGE_WATCHDOG
  another bug in test_if_skip_sort_order()
------------------------------------------------------------
revno: 3754
committer: Guilhem Bichot <guilhem.bichot@oracle.com>
branch nick: bug13432631
timestamp: Mon 2012-04-30 11:22:08 +0200
message:
  No testcase needed, as it's only a Valgrind error in an existing test.
------------------------------------------------------------
revno: 3753
committer: Guilhem Bichot <guilhem.bichot@oracle.com>
branch nick: bug13432631
timestamp: Mon 2012-04-30 11:05:12 +0200
message:
  Bug #13432631 ASSERTION `NEXT_INSERT_ID == 0' FAILED | ASSERT IN HANDLER::HA_EXTERNAL_LOCK
  When testing INSERT DELAYED with RQG this assertion happens.
  Investigation spotted at least one suspicious place where
  members of Delayed_insert are updated without holding the
  Delayed_insert::mutex.
  This fix makes the crash far less frequent according to QA,
  so they suggested pushing it.
------------------------------------------------------------
revno: 3752
committer: sayantan.dutta@oracle.com
branch nick: mysql-trunk
timestamp: Mon 2012-04-30 12:47:11 +0530
message:
  # Turn off check testcases in Valgrind
------------------------------------------------------------
revno: 3751
committer: Raghav Kapoor <raghav.kapoor@oracle.com>
branch nick: mysql-trunk-bug-11746295v4
timestamp: Mon 2012-04-30 12:43:31 +0530
message:
  BUG#11746295 - 25168: "INCORRECT TABLE NAME" INSTEAD OF 
  		      "IDENTIFIER TOO LONG" IF TABLE NAME > 64 
  
  BACKGROUND:
  When table/database name is more then 64 character, 
  "Incorrect table name" error is thrown. But expected error 
  is "Identifier too long".
  
  FIX:
  This bug has been fixed by reporting ER_TOO_LONG_IDENT error 
  when table/database/function/procedure name etc is greater 
  than 64 characters. 
  Also please note the behaviour changes in check_table_name() 
  and check_and_convert_db_name() functions in table.cc file. 
  Their return type has been changed accordingly to report 
  the appropriate error and now they return enum instead of 
  bool. Other files have also been appropriately modified at 
  relevant places to report the appropriate error in each 
  case.
  Also a testcase has been written in create.test and 
  corresponding result files have been updated.
------------------------------------------------------------
revno: 3750
committer: gopal.shankar@oracle.com
branch nick: corr_read_tests
timestamp: Mon 2012-04-30 10:55:05 +0530
message:
  Bug#13979228 - MEMORY CORRUPTION IN READ_TEXTS() (SQL/DERROR.CC)
  
  PROBLEM:
  --------
  The following command could cause mysqld to crash.
  mysql> set LC_TIME_NAMES='ru_RU';
  
  The problem is seen only when there are more new error messages
  are added to sql/share/errmsg-utf8.txt, before compilation.
  
  ANALYSIS:-
  ----------
  errmsg-utf8.txt contains all the error messages. For faster access
  errmsg.sys files are created for each language. The errmsg.sys file
  has following file format.
  
  --------------------------------------------------------------
  Current errmsg.sys File Format:
  --------------------------------------------------------------
  SECTION1:
  Header=32 bytes,
     length = (uint16) of byte 6 & 7
     count  = (uint16) of byte 8 & 9
  
  SECTION2:
  Array of offset pointer to messages= count*2 bytes
     Every 2 bytes [after header, until header_size+count*2]
     contains offset of error message in the errmsg.sys file.
     These offsets point to section3.
  
  SECTION3:
  All error messages, each one is null terminated.
  --------------------------------------------------------------
  
  PROBLEM1) With the current file format, the length of SECTION3 is stored in
  errmsg.sys file header byte 6 and 7. These 2 bytes can hold maximum
  size of section till 2^16 = 64k. If the SECTION3 increases in size more
  than 64K, then these two bytes in header are not enough to hold the size.
  
  PROBLEM2) As the number of error message increase, the SECTION3 grows.
  Consequently, error messages could be places at offset greater than 2^16=64K.
  SECTION2 contains offsets that point to start of each error messages in
  SECTION3. If the error message is stored past 64K size in SECTION3, then the
  2 bytes element in offset array of SECTION2 will not be sufficient to
  store the offset.
  
  Above two problems might cause server to read invalid 'length'/'offset'. Due
  to which the code would write bytes more than allocated.
  
  FIX:
  ----
  Both of above mentioned problems, demand increase in number of bytes to hold
  the length (also count) of SECTION3 and offsets in SECTION2. Following changes
  in existing file format would solve the problem. Note that the header currently
  has many unused bytes, so using more bytes for length and count is not a problem.
  
  --------------------------------------------------------------
  New errmsg.sys File Format:
  --------------------------------------------------------------
  SECTION1:
  Header=32 bytes,
     length = (uint32) of byte 6 to 10
     count  = (uint32) of byte 10 to 14
  
  SECTION2:
  Array of offset pointer to messages= count*4 bytes
     Every 4 bytes [after header, until header_size+count*4]
     contains offset of error message in the errmsg.sys file.
     These offsets point to SECTION3.
  
  SECTION3:
  All error messages, each one is null terminated.
  --------------------------------------------------------------
  
  With the new changes to file format, the length, count in header and offset
  array in SECTION2 are now 4bytes instead of 2bytes. Hence, the errmsg.sys can
  can now grow upto 4GB (currently its 64K), which seem to be too-much-of-memory
  for error messages.
  
  Each errmsg.sys has version associated with it. Version is stored at
  3rd byte from begining of errmsg.sys. The current version of file is '2' and
  the new version will be '3'. If new mysql binary tries to use old errmsg.sys,
  we report an error.
  
  TESTING:
  --------
  This bug depends on number of messages in sql/share/errmsg-utf8.txt.
  As the size of errmsg.sys keeps changing over time, its hard to write
  test case based on it.
------------------------------------------------------------
revno: 3749
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-04-27 21:40:38 +0300
message:
  Bug#12400313
  
  Post-push fixes a PB2 failure refining rpl_stm_relay_ign_space
  to make it passed in MTS.
  See the file comments for rpl_stm_relay_ign_space.test.
------------------------------------------------------------
revno: 3748
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk
timestamp: Fri 2012-04-27 22:09:15 +0400
message:
  Yet another follow-up for Bug#12762885 - 61713: MYSQL WILL NOT BIND
  TO "LOCALHOST" IF LOCALHOST IS BOTH IPV4/IPV6 ENABLED.
  
  Update test result file.
------------------------------------------------------------
revno: 3747 [merge]
committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
branch nick: trunk
timestamp: Fri 2012-04-27 21:16:36 +0400
message:
  Null merge from 5.5.
    ------------------------------------------------------------
    revno: 2875.376.29
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: 5.5
    timestamp: Fri 2012-04-27 21:14:35 +0400
    message:
      Third attempt to do a follow-up for Bug#12762885 - 61713: MYSQL WILL NOT BIND
      TO "LOCALHOST" IF LOCALHOST IS BOTH IPV4/IPV6 ENABLED.
      
      Previous commit comments were wrong. The default value has always been NULL.
      The original patch for Bug#12762885 just makes it visible in the logs.
      
      This patch uses "0.0.0.0" string if bind-address is not set.
    ------------------------------------------------------------
    revno: 2875.376.28
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: 5.5
    timestamp: Fri 2012-04-27 21:07:53 +0400
    message:
      Revert two follow-ups for Bug#12762885:
        - alexander.nozdrin@oracle.com-20120427151428-7llk1mlwx8xmbx0t
        - alexander.nozdrin@oracle.com-20120427144227-kltwiuu8snds4j3l.
------------------------------------------------------------
revno: 3746 [merge]
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-04-27 19:39:02 +0300
message:
  Merge mysql-trunk from myrepo into my local tree
    ------------------------------------------------------------
    revno: 3743.1.15 [merge]
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: trunk
    timestamp: Fri 2012-04-27 19:23:58 +0400
    message:
      Manual merge from 5.5.
        ------------------------------------------------------------
        revno: 2875.376.27
        committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
        branch nick: 5.5
        timestamp: Fri 2012-04-27 19:14:28 +0400
        message:
          Proper follow-up for Bug#12762885 - 61713: MYSQL WILL NOT BIND TO "LOCALHOST"
          IF LOCALHOST IS BOTH IPV4/IPV6 ENABLED.
          
          The original patch removed default value of the bind-address option.
          So, the default value became NULL. By coincedence NULL resolves
          to 0.0.0.0 and ::, and since the server chooses first IPv4-address, 
          0.0.0.0 is choosen. So, there was no change in the behaviour.
          
          This patch restores default value of the bind-address option to "0.0.0.0".
    ------------------------------------------------------------
    revno: 3743.1.14 [merge]
    committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
    branch nick: trunk
    timestamp: Fri 2012-04-27 18:45:47 +0400
    message:
      Auto-merge from 5.5.
        ------------------------------------------------------------
        revno: 2875.376.26
        committer: Alexander Nozdrin <alexander.nozdrin@oracle.com>
        branch nick: 5.5
        timestamp: Fri 2012-04-27 18:42:27 +0400
        message:
          Follow-up for Bug#12762885 - 61713: MYSQL WILL NOT BIND TO "LOCALHOST"
          IF LOCALHOST IS BOTH IPV4/IPV6 ENABLED.
          
          The original patch removed default value of the bind-address option.
          So, the default value became NULL. By coincedence NULL resolves
          to 0.0.0.0 and ::, and since the server chooses first IPv4-address, 
          0.0.0.0 is choosen. So, there was no change in the behaviour.
          
          This patch restores default value of the bind-address option to "0.0.0.0".
    ------------------------------------------------------------
    revno: 3743.1.13
    committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
    branch nick: mysql-trunk-bug13945257
    timestamp: Fri 2012-04-27 13:57:38 +0200
    message:
      Bug#13945257 NEW COMPILATION ERRORS/WARNINGS WITH XCODE 4.3.2
      
      Fix various new compiler warnings and one compiler error
      reported by Clang 3.1 / XCode 4.3.2 of Mac OSX.
      
      See per-file messages for details.
    ------------------------------------------------------------
    revno: 3743.1.12
    committer: sayantan.dutta@oracle.com
    branch nick: mysql-trunk
    timestamp: Fri 2012-04-27 17:18:17 +0530
    message:
      Bug #13979491 - MTR HANGS FOREVER ON WINDOWS AFTER "TOO MANY TESTS FAILED"
    ------------------------------------------------------------
    revno: 3743.1.11
    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
    branch nick: b11761652-t2
    timestamp: Fri 2012-04-27 11:38:27 +0200
    message:
      bug#11761652,
      pre-push fix of result file, due to changed error code.
    ------------------------------------------------------------
    revno: 3743.1.10
    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
    branch nick: b11761652-t2
    timestamp: Thu 2012-04-26 12:33:24 +0200
    message:
      Bug#11761652: 54166: HA_RND_INIT() RESULT CODE NOT CHECKED
      Bug#11746399: 26040: RETURN VALUES OF HA_INDEX_INIT() AND
                                             INDEX_INIT() IGNORED
      
      Added checks for ha_rnd_init and ha_index_init return codes.
      
      Also added DBUG_ASSERT's to spot SE API violations.
      
      Changed InnoDB to return a more correct error in index_init.
      
      All this changes are done to enforce correct locking and cursor/handler
      usage by the server in debug mode.
      
      Updated according to reviewers comments.
    ------------------------------------------------------------
    revno: 3743.1.9 [merge]
    committer: Yasufumi Kinoshita <yasufumi.kinoshita@oracle.com>
    branch nick: mysql-trunk
    timestamp: Fri 2012-04-27 19:42:38 +0900
    message:
      Bug#11758510 (#50723): INNODB CHECK TABLE FATAL SEMAPHORE WAIT TIMEOUT POSSIBLY TOO SHORT FOR BI
      Fixed not to check timeout during the check table.
        ------------------------------------------------------------
        revno: 2875.376.25 [merge]
        committer: Yasufumi Kinoshita <yasufumi.kinoshita@oracle.com>
        branch nick: mysql-5.5
        timestamp: Fri 2012-04-27 19:40:12 +0900
        message:
          Bug#11758510 (#50723): INNODB CHECK TABLE FATAL SEMAPHORE WAIT TIMEOUT POSSIBLY TOO SHORT FOR BI
          Fixed not to check timeout during the check table.
            ------------------------------------------------------------
            revno: 2661.840.5
            committer: Yasufumi Kinoshita <yasufumi.kinoshita@oracle.com>
            branch nick: mysql-5.1
            timestamp: Fri 2012-04-27 19:38:13 +0900
            message:
              Bug#11758510 (#50723): INNODB CHECK TABLE FATAL SEMAPHORE WAIT TIMEOUT POSSIBLY TOO SHORT FOR BI
              Fixed not to check timeout during the check table.
    ------------------------------------------------------------
    revno: 3743.1.8
    committer: Jon Olav Hauglid <jon.hauglid@oracle.com>
    branch nick: mysql-trunk-test
    timestamp: Fri 2012-04-27 10:41:49 +0200
    message:
      Fix new compiler error from gcc 4.6.3:
        error: ?__malloc_hook? is deprecated
        [-Werror=deprecated-declarations]
      
      Remove two offending tests from stdcxx-t.cc
    ------------------------------------------------------------
    revno: 3743.1.7 [merge]
    committer: magnus.blaudd@oracle.com
    branch nick: trunk
    timestamp: Fri 2012-04-27 10:11:57 +0200
    message:
      Merge trunk-wl5960 -> trunk
        ------------------------------------------------------------
        revno: 3690.30.4
        committer: magnus.blaudd@oracle.com
        branch nick: trunk-wl5960
        timestamp: Fri 2012-04-27 09:50:48 +0200
        message:
          WL#5960 Start memcached from mysql-test-run.pl
           - Merge in removal of hardcoded port for memcached
            plus some review fixes.
        ------------------------------------------------------------
        revno: 3690.30.3
        committer: Bjorn Munch <bjorn.munch@oracle.com>
        branch nick: wl5960
        timestamp: Thu 2012-04-19 10:31:11 +0200
        message:
          Removed some trailing whitespace
        ------------------------------------------------------------
        revno: 3690.30.2
        committer: magnus.blaudd@oracle.com
        branch nick: trunk-wl5960
        timestamp: Wed 2012-04-18 16:56:21 +0200
        message:
          Merge in WL#5960 final review fixes
        ------------------------------------------------------------
        revno: 3690.30.1
        committer: magnus.blaudd@oracle.com
        branch nick: trunk-wl5960
        timestamp: Wed 2012-04-18 16:41:57 +0200
        message:
          WL#5960 Start memcached from mtr
           - Cherrypick the relevant patch from trunk-cluster
    ------------------------------------------------------------
    revno: 3743.1.6
    committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
    branch nick: mysql-trunk-13735712
    timestamp: Fri 2012-04-27 08:33:39 +0200
    message:
      Bug#13735712 SELECT W/ SUBQUERY PRODUCES MORE ROWS WHEN USING
      VARIABLES
      
      Outer join queries with ALL may return incorrect results because the
      optimizer incorrectly rewrites them to use inner join. E.g.:
      
      SELECT *
      FROM t2 RIGHT JOIN t3 ON(t3.c = t2.b)
      WHERE t2.b < ALL(SELECT t1.a FROM t1 WHERE t1.a <= 7);
      
      is first rewritten by Item_in_subselect::single_value_transformer()
      into:
      
      SELECT *
      FROM t2 RIGHT JOIN t3 ON(t3.c = t2.b)
      WHERE <not>(t2.b >= (SELECT MIN(t1.a) FROM t1 WHERE t1.a <= 7));
      
      When simplify_joins() checks not_null_tables() on the <not> condition
      to find out if the outer join can be transformed into an inner join,
      Item_func::not_null_tables() returns its arguments'
      not_null_tables(). This means that simplify_joins() is told that the
      condition will be false if t2.b is NULL. But the condition is actually
      true if t1 has no rows where t1.a <= 7. This leads to the optimizer
      incorrectly rewriting the query to use inner join.
      
      Fix: Let Item_func_not_all::not_null_tables() return a zero table map.
    ------------------------------------------------------------
    revno: 3743.1.5
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Fri 2012-04-27 14:39:08 +1000
    message:
      Bug#14004341 - REDUCE MEMCPY() OVERHEAD IN ROW_SEARCH_FOR_MYSQL()
      
      InnoDB uses a read ahead cache for rows that can potentially be accessed in a 
      batch. This is to avoid the overhead of mini-transactions. Currently, all 
      records are copied to this fetch cache and when we exit from the function 
      we copy the first record from this queue to the MySQL buffer. Avoid this copy 
      to the fetch cache queue and back on normal exit from the function by doing the 
      changes directly in the MySQL recod buffer for the first record. 
      
      This eliminates two memcpy() calls but is only done for non-ICP code paths.
      
      rb://1046 Approved by Jimmy.
    ------------------------------------------------------------
    revno: 3743.1.4 [merge]
    committer: irana <irana@dscczz01.us.oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-04-26 08:33:48 -0700
    message:
      Merge from 5.5
        ------------------------------------------------------------
        revno: 2875.376.24 [merge]
        committer: irana <irana@dscczz01.us.oracle.com>
        branch nick: mysql-5.5
        timestamp: Thu 2012-04-26 08:21:25 -0700
        message:
          merge from 5.1
            ------------------------------------------------------------
            revno: 2661.840.4
            committer: irana <irana@dscczz01.us.oracle.com>
            branch nick: mysql-5.1
            timestamp: Thu 2012-04-26 08:17:14 -0700
            message:
              InnoDB: Adjust error message when a dropped tablespace is accessed.
    ------------------------------------------------------------
    revno: 3743.1.3 [merge]
    committer: Manish Kumar<manish.4.kumar@oracle.com>
    branch nick: mysql-trunk-bug13812374
    timestamp: Thu 2012-04-26 19:36:54 +0530
    message:
      merging mysql-5.5 -> mysql-trunk
        ------------------------------------------------------------
        revno: 2875.376.23
        committer: Manish Kumar<manish.4.kumar@oracle.com>
        branch nick: mysql
        timestamp: Thu 2012-04-26 19:34:03 +0530
        message:
          BUG#13812374 - RPL.RPL_REPORT_PORT FAILS OCCASIONALLY ON PB2
          
          Problem - The failure on PB2 is possbily due to the port number being still in
                    use even after the server restarts which is not reflected in the
                    server restart.
                
          Fix - The problem is fixed by starting the servers forcefully using the option
                file and also the parameters for the server restart is passed correctly.
    ------------------------------------------------------------
    revno: 3743.1.2
    committer: Sergey Glukhov <sergey.glukhov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-04-26 16:18:53 +0400
    message:
      test for bug13723054 is moved into separate file as
      it does not work with Innodb with 4k Page size 
    ------------------------------------------------------------
    revno: 3743.1.1
    committer: Jimmy Yang <jimmy.yang@oracle.com>
    branch nick: trunk4
    timestamp: Thu 2012-04-26 18:13:37 +0800
    message:
      Fix Bug #13867871 - ROW_INS_CHECK_FOREIGN_CONSTRAINT() ACCESSES FREED
      DICT_INDEX_T
                        
      rb://1045 approved by Marko
------------------------------------------------------------
revno: 3745
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-04-26 12:48:58 +0300
message:
  Change dict_table_t::stat_n_rows to unsigned.
  
  It cannot become negative anymore after all decrements are done
  via dict_table_n_rows_dec().
------------------------------------------------------------
revno: 3744
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-04-26 12:23:20 +0300
message:
  Change dict_table_t::stat_modified_counter from ulint to ib_uint64_t
  and remove the > 2G check for wrap-around.
  
  The reason for that check was that on 32 bit machines, where ulint is 32 bit,
  a big table could have so many rows that even 1/16 of the table is more than
  2 billion and so the condition "counter > table->stat_n_rows / 16" may never
  become true because counter would wrap over.
  
  With 64 bit unsigned counter the table would need 2^64 * 16 rows for that to
  happen and even if each row is just 1 byte, that would mean the table is
  274877906944 GB.
  
  Reviewed by:	Jimmy (over IM)
------------------------------------------------------------
revno: 3743
committer: Marko M?kel? <marko.makela@oracle.com>
branch nick: mysql-trunk
timestamp: Thu 2012-04-26 10:51:48 +0300
message:
  Restore tree_name to mysql-trunk.
------------------------------------------------------------
revno: 3742
committer: Marko M?kel? <marko.makela@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-04-25 18:46:45 +0300
message:
  Bug#14000415 BOGUS CHECK ON SYS_COLUMNS IN INNOBASE_RENAME_COLUMN()
------------------------------------------------------------
revno: 3741 [merge]
committer: Marko M?kel? <marko.makela@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-04-25 18:46:11 +0300
message:
  Merge mysql-trunk-wl5545 to mysql-trunk.
    ------------------------------------------------------------
    revno: 3690.29.40
    committer: Matthias.Leich <Matthias.Leich@oracle.com>
    branch nick: mysql-trunk-wl5545_debug
    timestamp: Tue 2012-04-24 11:13:01 +0200
    message:
      WL5545 Implement simple in-place ALTER TABLE operations
      Improve the formatting of the test case.
    ------------------------------------------------------------
    revno: 3690.29.39
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-23 21:38:18 +0300
    message:
      WL#5526: Fix the error handling of failed clustered index creation.
      
      ha_innobase::commit_inplace_alter_table(): After dropping the
      created table after rename failure, commit (and do not roll back)
      the data dictionary transaction. Otherwise, the entry for the tablename#1
      would remain in SYS_TABLES, causing a failure of
      mtr --repeat 2 innodb.innodb-index-online.
    ------------------------------------------------------------
    revno: 3690.29.38
    committer: Matthias.Leich <Matthias.Leich@oracle.com>
    branch nick: mysql-trunk-wl5545_debug
    timestamp: Mon 2012-04-23 17:07:20 +0200
    message:
      WL5545 Implement simple in-place ALTER TABLE operations
      Improve the formatting of the test case.
    ------------------------------------------------------------
    revno: 3690.29.37
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-23 16:09:15 +0300
    message:
      WL#5545 error handling improvements.
      
      innodb.innodb-alter-debug: Error injection testing for DROP FOREIGN KEY
      and renaming columns.
      
      innobase_drop_foreign(), innobase_rename_column(): Take the TABLE_SHARE
      as a parameter, so that the user-visible table name can be reported
      in an error message.
    ------------------------------------------------------------
    revno: 3690.29.36
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-23 15:27:05 +0300
    message:
      WL#5545/WL#5526 code coverage fixes.
      
      row_merge_dict_table_get_index(): Remove. There never can be duplicate
      index names. Use plain dict_table_get_index_on_name() instead.
      
      When doing ADD INDEX and DROP INDEX in a single statement, the new index
      will carry the TEMP_INDEX_PREFIX and the old one (to be dropped)
      will lack it.
      
      Approved by Jimmy Yang.
    ------------------------------------------------------------
    revno: 3690.29.35
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-23 15:18:12 +0300
    message:
      Fix a bug introduced in
      revision-id marko.makela@oracle.com-20120423120920-iq0y336k0o1ssnaq
    ------------------------------------------------------------
    revno: 3690.29.34
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-23 15:09:20 +0300
    message:
      WL#5545 test coverage improvements.
      
      Test if incompletely created indexes will be dropped when there is
      a table name#2 clash when creating a clustered index.
      
      ha_innobase::commit_inplace_alter_table(): Fix broken error handling.
      Do not decrement MONITOR_PENDING_ALTER_TABLE if an error is being
      returned for commit=true. In this case, the method will be re-invoked
      with commit=false. This bug was introduced in WL#5526.
    ------------------------------------------------------------
    revno: 3690.29.33
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-23 14:26:37 +0300
    message:
      WL#5526/WL#5545 test coverage: Show that a failure
      to create a clustered index will do the lazy drop index.
    ------------------------------------------------------------
    revno: 3690.29.32
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-23 13:48:35 +0300
    message:
      WL#5545: Clean up innodb-index-online.test
      according to suggestions from Matthias Leich.
    ------------------------------------------------------------
    revno: 3690.29.31
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-23 13:30:08 +0300
    message:
      WL#5545 testing: Mix column renaming and online index creation.
      
      Fix Bug#13990602 BOGUS DUPLICATE KEY ERROR FOR NULL REPORTED
      DURING ONLINE INDEX CREATION
      
      row_log_apply_op_low(): Do not report duplicates if the row contains
      NULL values. (Online index creation applies to secondary indexes only,
      and the primary key columns never contain NULL values.)
      
      Approved by Jimmy Yang.
    ------------------------------------------------------------
    revno: 3690.29.30 [merge]
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-23 10:49:16 +0300
    message:
      Merge mysql-trunk to mysql-trunk-wl5545.
    ------------------------------------------------------------
    revno: 3690.29.29 [merge]
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Thu 2012-04-19 12:09:01 +0300
    message:
      Merge mysql-trunk to mysql-trunk-wl5545.
    ------------------------------------------------------------
    revno: 3690.29.28
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Thu 2012-04-19 11:55:28 +0300
    message:
      WL#5545: Test the maximum column length of 64 characters.
      Test renaming columns to 3-byte and 4-byte UTF-8.
    ------------------------------------------------------------
    revno: 3690.29.27
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Thu 2012-04-19 10:38:31 +0300
    message:
      WL#5545 review changes.
      
      dict_mem_table_col_rename_low(): Remove the parameter "from".
      When renaming in foreign->referenced_col_names[], overwrite the
      old name unless it is shorter than the new name.
    ------------------------------------------------------------
    revno: 3690.29.26
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Wed 2012-04-18 11:58:55 +0300
    message:
      Fix a bogus compiler warning of uninitialized variable.
    ------------------------------------------------------------
    revno: 3690.29.25 [merge]
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Wed 2012-04-18 09:53:18 +0300
    message:
      Merge mysql-trunk to mysql-trunk-wl5545.
    ------------------------------------------------------------
    revno: 3690.29.24
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Tue 2012-04-17 23:05:39 +0300
    message:
      Bug#13972248 ORPHAN HIDDEN FTS_DOC_ID_INDEX LEFT AFTER DROPPING FULLTEXT INDEX
      
      ha_innobase::prepare_inplace_alter_table(): When the table would
      contain fulltext indexes before dropping indexes, and no fulltext
      indexes thereafter, drop the FTS_DOC_ID_INDEX if it does not exist
      in the MySQL table definition (it had been created internally in InnoDB).
    ------------------------------------------------------------
    revno: 3690.29.23
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Tue 2012-04-17 17:06:01 +0300
    message:
      recv_recovery_from_checkpoint_start_func(): Remove a compiler warning.
    ------------------------------------------------------------
    revno: 3690.29.22
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Tue 2012-04-17 17:04:11 +0300
    message:
      WL#5545 Allow multiple columns to be renamed to each other.
      Fix clashes with FTS_DOC_ID.
      
      merge_index_field_t: Replace field_name with col_no, so that
      column renaming will not interfere with index creation.
      
      dict_mem_table_col_rename(): Add the parameter nth_col, and remove the
      return status.
      
      innobase_create_key_defs(), prepare_inplace_alter_table_dict():
      Add the parameter fts_doc_id_col.
      
      innobase_fulltext_exist(): New predicated, for checking if a fulltext
      index exists on a table.
      
      ha_innobase::prepare_inplace_alter_table(): Prohibit renaming FTS_DOC_ID
      when fulltext indexes exist on the table. Prohibit renaming columns to
      internal column names defined in the InnoDB table object.
      
      innobase_rename_column(): Add the parameter nth_col. Rename the columns
      in the data dictionary based on old name and position.
      
      ha_innobase::commit_inplace_alter_table(): If an operation fails, roll
      back the data dictionary transaction.
      
      dict_table_get_index_by_max_id(): Merge with row_merge_dict_table_get_index(),
      and look up the columns by number, not by name.
    ------------------------------------------------------------
    revno: 3690.29.21
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Tue 2012-04-17 16:50:39 +0300
    message:
      Remove an extra initialization and add a debug assertion.
    ------------------------------------------------------------
    revno: 3690.29.20
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Tue 2012-04-17 16:18:50 +0300
    message:
      Remove unused function innobase_create_fts_doc_id_idx().
    ------------------------------------------------------------
    revno: 3690.29.19
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-16 21:24:57 +0300
    message:
      WL#5545: Test renaming to the reserved column names
      DB_ROW_ID, DB_TRX_ID, DB_ROLL_PTR.
    ------------------------------------------------------------
    revno: 3690.29.18 [merge]
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-16 18:13:26 +0300
    message:
      Merge mysql-trunk to mysql-trunk-wl5545.
    ------------------------------------------------------------
    revno: 3690.29.17
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-16 18:11:08 +0300
    message:
      WL#5545 column renaming: Properly rename columns when creating a new
      clustered index. Prohibit renaming conflicts with the internal column
      name FTS_DOC_ID.
      
      innobase_create_index_field_def(): Add the parameter altered_table for
      resolving the column names when creating a new clustered index.
      
      innobase_create_index_def(), innobase_create_key_defs(): Add the
      parameter altered_table.
      
      innobase_fts_check_doc_id_col(): Add the parameter altered_table for
      looking up other column names than internal ones. Do not write
      anything to the standard error output. Issue errors by my_error().
      
      prepare_inplace_alter_table(): Prohibit renaming columns to something
      that already exists in the table.
      
      ha_innobase::commit_inplace_alter_table(): Skip the renaming of
      columns if a clustered index was created.
      
      TODO: Fix the renaming of c1 to c2 and c2 to c1 in one go. It
      currently does not work unless creating a clustered index.
    ------------------------------------------------------------
    revno: 3690.29.16
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Wed 2012-04-11 14:17:57 +0300
    message:
      WL#5545 review cleanup: refactor column renaming.
      
      dict_mem_table_col_rename_low(), dict_mem_table_col_rename(): Refactored from
      innobase_rename_column().
    ------------------------------------------------------------
    revno: 3690.29.15 [merge]
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Wed 2012-04-11 13:46:39 +0300
    message:
      Merge mysql-trunk to mysql-trunk-wl5545.
    ------------------------------------------------------------
    revno: 3690.29.14 [merge]
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Tue 2012-04-10 11:08:13 +0300
    message:
      Merge mysql-trunk to mysql-trunk-wl5534.
    ------------------------------------------------------------
    revno: 3690.29.13
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Sat 2012-04-07 17:02:47 +0300
    message:
      WL#5534/WL#5526 minor bug fix: When LOCK=EXCLUSIVE is specified,
      do not allocate the modification log for online index creation.
    ------------------------------------------------------------
    revno: 3690.29.12 [merge]
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Wed 2012-04-04 10:42:51 +0300
    message:
      Merge mysql-trunk to mysql-trunk-wl5545.
    ------------------------------------------------------------
    revno: 3690.29.11
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Wed 2012-04-04 10:11:50 +0300
    message:
      WL#6046/WL#5534 bug fix: Set trx->will_lock in in-place ALTER operations.
    ------------------------------------------------------------
    revno: 3690.29.10
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Wed 2012-04-04 09:54:09 +0300
    message:
      WL#5534 optimization for InnoDB: Do not require a prepare phase
      for changes that require no action until the commit phase.
    ------------------------------------------------------------
    revno: 3690.29.9
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Wed 2012-04-04 09:43:55 +0300
    message:
      Clean-up done in WL#5545 ALTER_RENAME.
      
      innobase_rename_table(): Remove the unused parameter lock_and_commit.
      Change the return type to db_err. Add DBUG_ENTER/DBUG_RETURN.
      
      ha_innobase::rename_table(): Flag the transaction as a data dictionary
      transaction, to avoid deadlocks after crash recovery.
    ------------------------------------------------------------
    revno: 3690.29.8
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Wed 2012-04-04 09:25:28 +0300
    message:
      WL#5545 Implement simple in-place ALTER TABLE operations: ALTER_RENAME
      
      The renaming will take place in ha_innobase::rename_table(), as usual.
      The only code change is that ha_innobase::check_if_supported_inplace_alter()
      will tolerate the ALTER_RENAME flag.
    ------------------------------------------------------------
    revno: 3690.29.7
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Tue 2012-04-03 13:47:08 +0300
    message:
      WL#5545 Implement simple in-place ALTER TABLE operations: DROP_FOREIGN_KEY
      
      Alter_info::drop_type: New enum value FOREIGN_KEY for the names of
      FOREIGN KEY constraints that are to be dropped.
      
      mysql_prepare_alter_table(): Preserve FOREIGN_KEY in alter_info->drop_list.
      
      dict_foreign_remove_from_cache(): Make global.
      
      ha_innobase_inplace_ctx: Add drop_fk, num_to_drop_fk.
      
      prepare_inplace_alter_table_dict(): Add drop_foreign, n_drop_foreign.
      
      innobase_dropping_foreign(): New predicate, for determining if a
      foreign key constraint has been requested to be dropped.
      
      ha_innobase::prepare_inplace_alter_table(): Resolve any foreign key
      constraints that are requested to be dropped. Allow indexes to be
      dropped if there all foreign key constraints that depend on them are
      requested to be dropped.
      
      innobase_drop_foreign(): New function, for dropping a FOREIGN KEY
      constraint both from the data dictionary and from the data dictionary
      cache.
      
      ha_innobase::commit_inplace_alter_table(): Invoke
      innobase_drop_foreign() before renaming columns.
    ------------------------------------------------------------
    revno: 3690.29.6
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Tue 2012-04-03 13:25:55 +0300
    message:
      dict_foreign_replace_index(): Relax bogus debug assertions
      that were added in WL#5526.
    ------------------------------------------------------------
    revno: 3690.29.5
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Tue 2012-04-03 12:52:21 +0300
    message:
      WL#5545 ALTER_COLUMN_NAME bug fix:
      
      innobase_rename_column(): Keep the column names in table->referenced_list
      as copies of the table->col_names, because the column names could otherwise
      be orphaned (point to freed memory) when the parent table is dropped.
      The parent table can be dropped when foreign_key_checks=0.
    ------------------------------------------------------------
    revno: 3690.29.4
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Tue 2012-04-03 09:45:06 +0300
    message:
      Test that column name comparsions are case-insensitive
      and accent-sensitive.
    ------------------------------------------------------------
    revno: 3690.29.3
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-02 16:51:31 +0300
    message:
      WL#5545 Implement simple in-place ALTER TABLE operations: ALTER_COLUMN_NAME
      
      innobase_rename_column(): New function, for renaming a column in both
      the InnoDB data dictionary and the data dictionary cache. If the column
      name becomes longer, allocate a new table->col_names from table->heap.
      Otherwise, overwrite the existing table->col_names.
      
      ha_innobase::commit_inplace_alter_table(): Invoke innobase_rename_column()
      when needed.
      
      The performance could be improved by doing the rename in one step.
      Currently, we perform the operation on every renamed column separately.
      A bigger performance improvement would be gained if the InnoDB data
      dictionary were eliminated altogether and replaced by something that
      plays well with InnoDB crash recovery.
    ------------------------------------------------------------
    revno: 3690.29.2
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Mon 2012-04-02 16:45:53 +0300
    message:
      Add a missing CLOSE of an InnoDB SQL cursor.
    ------------------------------------------------------------
    revno: 3690.29.1
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk-wl5545
    timestamp: Thu 2012-03-29 11:42:26 +0300
    message:
      Branch mysql-trunk-wl5545.
------------------------------------------------------------
revno: 3740
committer: Mattias Jonsson <mattias.jonsson@oracle.com>
branch nick: b13008220-trunk
timestamp: Mon 2012-04-23 10:44:47 +0200
message:
  Bug#13008220: HANDLER SQL STATEMENT CAN MISS TO
  INITIALIZE FOR RANDOM READ
  
  When doing index scans and then swithing to
  random scans, without restart, ha_rnd_init
  is not called, when using the HANDLER SQL
  interface.
  
  Fixed by ensuring that when switching between
  index and random scans there will always be a call to
  ha_index/rnd_end and then ha_index/rnd_init.
  
  Also checking return values from ha_index/rnd_init/end.
  
  (updated with DBUG_ASSERT from reviewers suggestion).
------------------------------------------------------------
revno: 3739
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-04-25 15:10:56 +0300
message:
  Non-functional change: fix the names of DICT_STAT_PERSISTEN_ON/OFF macros
------------------------------------------------------------
revno: 3738
committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
branch nick: B13966514-trunk
timestamp: Mon 2012-04-23 11:19:36 +0300
message:
  Bug #13966514: CRASH IN GET_SCHEMA_TABLES_RESULT WITH 
  MIN/MAX, LEFT/RIGHT JOIN ON I_S TABLE
  
  When there's a MIN/MAX that's reduced to a constant due to the 
  presence of an unique index over the aggregated column the
  tables from the query are optimized away.
  If one of these removed tables happens to be a I_S table 
  the materialization check will still run due to the fact that the 
  the select_lex flag OPTION_SCHEMA_TABLE is not cleared up.
  Fixed by adding a check in get_schema_tables_result() for the 
  presence of join tables (join_tab) before an attempt is made to 
  iterate over them (which leads to a null pointer dereference crash).
  Test suite added.
------------------------------------------------------------
revno: 3737
committer: Tor Didriksen <tor.didriksen@oracle.com>
branch nick: trunk-bug13982125maketime
timestamp: Wed 2012-04-25 09:55:02 +0200
message:
  Bug#13982125 BUFFER OVERFLOW OF VARIABLE BUF IN ITEM_FUNC_MAKETIME::GET_TIME
  
  Add space for null-terminator, which is always added by sprintf.
------------------------------------------------------------
revno: 3736
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Wed 2012-04-25 09:11:42 +0300
message:
  Followup to vasil.dimov@oracle.com-20120424154407-ygkvb4xa21perswh,
  adjust a few .result files.
------------------------------------------------------------
revno: 3735
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-04-24 18:44:07 +0300
message:
  Non-functional followup to vasil.dimov@oracle.com-20120424062111-hplttae7ss0igz7f
  
  Obey alphabetical order in the lists in sql/lex.h and sql/sql_yacc.yy and
  fix quotes inside a comment in sql/handler.h.
------------------------------------------------------------
revno: 3734
committer: Sergey Glukhov <sergey.glukhov@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-04-24 12:27:22 +0400
message:
  Bug#13723054 CRASH WITH MIN/MAX AFTER QUICK_GROUP_MIN_MAX_SELECT::NEXT_MIN
  The crash is caused by arbitrary memory area owerwriting in case of
  BLOB fields during attempt to copy BLOB field key image into record
  buffer(record buffer is too small to get BLOB key part image).
  note:
  QUICK_GROUP_MIN_MAX_SELECT can not work with BLOB fields
  because it uses record buffer as temporary buffer for key values
  however this case is filtered out by covering_keys() check
  in get_best_group_min_max() as BLOBs always require key length
  modificator in the key declaration and if the key has a BLOB
  then it can not be covered key.
  The fix is to use 'max_used_key_length' key length instead of 0.
------------------------------------------------------------
revno: 3733
committer: Sergey Glukhov <sergey.glukhov@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-04-24 12:04:39 +0400
message:
  Bug#13011553 CRASH IN SORTCMP OR CACHED_ITEM_STR::CMP IF GROUP BY SUBQUERY WITH ROLLUP
  During of comparing of grouped values
  DATETIME values are compared as STRING
  rather than INT. It leads to crash in the
  case of NULL value comparison because val_str()
  method could return zero pointer to the string
  and further comparison fails. The fix is to
  compare DATETIME grouped values for ROLLAUP as INT.
------------------------------------------------------------
revno: 3732
committer: Marko M?kel? <marko.makela@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-04-24 10:54:46 +0300
message:
  Catch Bug#13992653 a little earlier in debug builds.
------------------------------------------------------------
revno: 3731
committer: Sergey Glukhov <sergey.glukhov@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-04-24 11:35:13 +0400
message:
  Bug#13581962 HIGH MEMORY USAGE ATTEMPT, THEN CRASH WITH LONGTEXT, UNION, USER VARIABLE
  In Item_func_signed::fix_length_and_dec max_length is inherited
  from the max length of the argument. It can be huge value in case
  of LONGTEXT, for example, and leads to OOM in some situations.
  The fix is to use the minimum of args[0]->length and max possible
  number of digits for the int type.
------------------------------------------------------------
revno: 3730
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-04-24 09:21:11 +0300
message:
  Implement WL#6175 Introduce persistent statistics ON/OFF switch
  
  A new table_option is added, similarly to e.g. DELAY_KEY_WRITE. Modified files are:
    include/my_base.h
    sql/handler.h
    sql/lex.h
    sql/sql_show.cc
    sql/sql_table.cc
    sql/sql_yacc.yy
  The addition of the new option is purely mechanical - copy every occurence of
  DELAY_KEY_WRITE and rename it to the new STATS_PERSISTENT option. The .frm file
  format is not changed.
  
  In the code before this WL the logic was: every time stats would be updated in
  pre-PS MySQL (e.g. MySQL 5.5) do this: try to fetch stats for that table from
  persistent stats tables (e.g. check if PS is ON for that table), if fetch
  succeeds, then this is it. If fetch fails (due to e.g. no rows for that table in
  the stats storage, PS is OFF) then calculate the stats using the old transient
  statistics method.
  
  Below by "PS enabled table" or "table has PS set to ON" we mean that either it
  been explicitly flagged as STATS_PERSISTENT=1 by CREATE/ALTER TABLE or that its
  STATS_PERSISTENT= flag is not set ('default') and the global
  innodb_stats_persistent is ON.
  
  With this WL we change the logic to: every time stats would be updated in pre-PS
  MySQL do this: check if the table has PS flag set to ON, if yes, then do nothing
  (except if the stats are not initialized (e.g. first open table), in which case
  fetch them from disk), else calculate the stats using the old transient method.
  
  So we introduce a new per-table flag and store it in the .frm file. Upon open
  table we copy that flag into dict_table_t::stat_persistent to ease
  checking the value from InnoDB internal code.
  
  We introduce a new state for a table and its indexes' stats: 'unknown' which
  means that stats have not been calculated after opening the table and should not
  be accessed when in this state. It is also unknown whether the table's
  persistent stats flag is ON or OFF. This idea comes from Marko and is based on
  the fact that stats are only needed by MySQL and are requested after a call to
  ::open(). So whenever we open a table internally in InnoDB (table not being
  opened by MySQL) we leave the stats in 'unknown' state. When ::open() is called,
  then we peek the value of the PS flag from table->s->db_create_options, save it
  in the newly introduced table->stat_persistent and do the
  corresponding action to initialize the stats -
  either fetch them from disk if PS=ON or recalc them if PS=OFF. This is done by
  the newly introduced function dict_stats_init(). The new 'unknown' state is
  designated by table->stat_initialized being FALSE.
  
  When the PS flag is changed by the user with ALTER TABLE, we need to set the new
  value in table->stat_persistent - this is done by the new function
  dict_stats_set_persistent() which is also used to set the value of the flag
  initially from inside dict_stats_init() (called from ::open() and ::create()).
  
  A new function is introduced: dict_stats_is_persistent_enabled(table) which
  checks whether PS is switched ON/OFF for the given table. This function is very
  fast because it just checks if the bits are set in
  table->stat_persistent (compared to the slow SELECTing from the stats tables
  that was done before).
  
  In row_update_statistics_if_needed() if this is PS-enabled table, then do
  nothing. This function may be called very often. Also do nothing if the stats
  are in 'unknown' state - this may happen when the table has been opened
  internally from within InnoDB (e.g. SYS_TABLES or a foreign key table, not
  opened by MySQL) and heavy DML is being done on it.
  
  ha_innobase::info() -> ::info_low() indirection is no loner needed and is
  removed. With this WL we have just one method - ::info() which checks if the
  executed command is ANALYZE and does its logic internally.
  
  Given that stats initialization is now done in ::open() and ::create() after a
  call to dict_table_open_on_name() and not in that latter function, this means
  that this function becomes the same as dict_table_open_on_name_low() and
  dict_table_open_on_name_no_stats() is no longer needed. Thus, remove
  dict_table_open_on_name() and dict_table_open_on_name_no_stats() and rename
  dict_table_open_on_name_low() to dict_table_open_on_name().
  
  The option innodb_analyze_is_persistent is no longer needed and is removed.
  
  Approved by:	Jimmy (rb:912)
------------------------------------------------------------
revno: 3729
committer: Jimmy Yang <jimmy.yang@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-04-24 11:09:34 +0800
message:
  Fix a compilation warning introduced by Bug #13907075 fix.
------------------------------------------------------------
revno: 3728
committer: Sunny Bains <Sunny.Bains@Oracle.Com>
branch nick: trunk
timestamp: Tue 2012-04-24 12:48:19 +1000
message:
  Bug#13993661 - GET RID OF STATIC COUNTER IN TRX_START_LOW(), USE THE TRX_T::ID AS THE COUNTER
        
  In trx_start_low() we use a static counter to control the number of 
  gettimeofday() calls we make to set the trx_t::start_time. The trx_t::id is 
  also a monotonically increasing counter and is local to the thread. Use that 
  instead. This should reduce potential cache coherency issues.
        
  Approved by Inaam over IM.
------------------------------------------------------------
revno: 3727 [merge]
committer: Inaam Rana <inaam.rana@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-23 22:19:48 -0400
message:
  merge from 5.5
    ------------------------------------------------------------
    revno: 2875.376.22
    committer: Inaam Rana <inaam.rana@oracle.com>
    branch nick: mysql-5.5
    timestamp: Mon 2012-04-23 22:15:29 -0400
    message:
      Bug#13990648: 65061: LRU FLUSH RATE CALCULATION IS BASED ON INVALID VALUES
      
      rb://1043
      approved by: Sunny Bains
      
      Two internal counters were incremented twice for a single
      operations. The counters are:
      srv_buf_pool_flushed
      buf_lru_flush_page_count
------------------------------------------------------------
revno: 3726
committer: Jimmy Yang <jimmy.yang@oracle.com>
branch nick: mysql-trunk
timestamp: Tue 2012-04-24 10:00:52 +0800
message:
  Fix Bug #13907075 - DIFFERENT RESULTS FOR DIFFERENT TERM ORDER WITH INNODB
  BOOLEAN FULLTEXT SEARCH
        
  rb://1001 approved by Sunny Bains
------------------------------------------------------------
revno: 3725
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-23 21:20:01 +0300
message:
  post-push fixes bug11754117-45670: fixing a race of RLI cleanup before delete thd.
------------------------------------------------------------
revno: 3724 [merge]
committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-23 17:21:05 +0300
message:
  merge
    ------------------------------------------------------------
    revno: 2875.376.21
    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
    branch nick: mysql-5.5
    timestamp: Mon 2012-04-23 17:18:55 +0300
    message:
      Fixed a cmake compile problem because of the 2.8.8 fix.
------------------------------------------------------------
revno: 3723 [merge]
committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-23 16:35:00 +0300
message:
  merge
    ------------------------------------------------------------
    revno: 2875.376.20
    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
    branch nick: mysql-5.5
    timestamp: Mon 2012-04-23 16:26:22 +0300
    message:
      Bug #59148 - made tests experimental
      Fixed a cmake 2.8.8 compilation problem.
    ------------------------------------------------------------
    revno: 2875.376.19 [merge]
    committer: Kent Boortz <kent.boortz@oracle.com>
    branch nick: mysql-5.5
    timestamp: Mon 2012-04-23 13:03:42 +0200
    message:
      Merge
------------------------------------------------------------
revno: 3722 [merge]
committer: Kent Boortz <kent.boortz@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-23 15:22:46 +0200
message:
  Merge
    ------------------------------------------------------------
    revno: 3720.1.1 [merge]
    committer: Inaam Rana <inaam.rana@oracle.com>
    branch nick: mysql-trunk
    timestamp: Mon 2012-04-23 06:50:22 -0400
    message:
      Merge from 5.5
        ------------------------------------------------------------
        revno: 2875.377.1
        committer: Inaam Rana <inaam.rana@oracle.com>
        branch nick: mysql-5.5
        timestamp: Mon 2012-04-23 06:39:16 -0400
        message:
          Bug#12677594 - 61575: INNODB: WARNING: IO_SETUP() FAILED WITH EAGAIN.
          
          rb://1033
          approved by: Marko Makela
          
          Check return value from os_aio_init() and refuse to start if it fails.
------------------------------------------------------------
revno: 3721 [merge]
committer: Kent Boortz <kent.boortz@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-23 13:00:29 +0200
message:
  Merge
    ------------------------------------------------------------
    revno: 2875.376.18
    committer: Kent Boortz <kent.boortz@oracle.com>
    branch nick: mysql-5.5
    timestamp: Mon 2012-04-23 12:52:14 +0200
    message:
      Allow Windows absolute paths in N:\ formatfor the --vardir option
------------------------------------------------------------
revno: 3720 [merge]
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-23 12:10:41 +0300
message:
  merge from 5.5 (null)
    ------------------------------------------------------------
    revno: 2875.376.17 [merge]
    committer: Andrei Elkin <andrei.elkin@oracle.com>
    branch nick: mysql-5.5
    timestamp: Mon 2012-04-23 12:08:24 +0300
    message:
      merge from 5.1 (null)
        ------------------------------------------------------------
        revno: 2661.840.3 [merge]
        committer: Andrei Elkin <andrei.elkin@oracle.com>
        branch nick: 5.1-bug11754117-45670-insert_id_gets_through
        timestamp: Mon 2012-04-23 12:05:05 +0300
        message:
          merge from 5.1 repo
------------------------------------------------------------
revno: 3719 [merge]
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-23 12:02:13 +0300
message:
  null merge from 5.5.
    ------------------------------------------------------------
    revno: 2875.376.16 [merge]
    committer: Andrei Elkin <andrei.elkin@oracle.com>
    branch nick: mysql-5.5
    timestamp: Mon 2012-04-23 11:56:23 +0300
    message:
      null merge from 5.1.
        ------------------------------------------------------------
        revno: 2661.840.2
        committer: Andrei Elkin <andrei.elkin@oracle.com>
        branch nick: 5.1-bug11754117-45670-insert_id_gets_through
        timestamp: Mon 2012-04-23 11:51:19 +0300
        message:
          BUG#11754117 
          
          rpl_auto_increment_bug45679.test is refined due to not fixed in 5.1 Bug11749859-39934.
------------------------------------------------------------
revno: 3718
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-23 11:14:28 +0300
message:
  merge bug11754117-45670 fixes from 5.5: fixing error codes shift.
------------------------------------------------------------
revno: 3717 [merge]
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Mon 2012-04-23 10:59:23 +0300
message:
  merge from 5.5 repo
    ------------------------------------------------------------
    revno: 3690.28.8
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk
    timestamp: Mon 2012-04-23 10:25:46 +0300
    message:
      Bug#13875241 NONDETERMINISM IN INNODB-INDEX-ONLINE.TEST
      
      The index cardinality statistics would sometimes show one more entry
      for the PRIMARY KEY, depending on whether the row affected by the
      DELETE statement was purged. Adjust the statistics and results.
      
      Remove the generation of the DBUG trace (ds.trace), as it is no longer
      needed.
    ------------------------------------------------------------
    revno: 3690.28.7
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk
    timestamp: Mon 2012-04-23 10:25:30 +0300
    message:
      Correct a typo in a comment.
    ------------------------------------------------------------
    revno: 3690.28.6
    committer: Mayank Prasad <mayank.prasad@oracle.com>
    branch nick: show_table_trunk
    timestamp: Mon 2012-04-23 09:47:04 +0530
    message:
      finxing test case bug12427262 result file.
    ------------------------------------------------------------
    revno: 3690.28.5
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Mon 2012-04-23 13:15:37 +1000
    message:
      Bug#13989037 - AVOID CONTEXT SWITCH DURING TRX_COMMIT() REMOVE THE VIEW EARLY
      
      Fix debug build code. Move the debug functions to read0read.ic too.
    ------------------------------------------------------------
    revno: 3690.28.4
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Mon 2012-04-23 11:48:43 +1000
    message:
      Bug#13989037 - AVOID CONTEXT SWITCH DURING TRX_COMMIT() REMOVE THE VIEW EARLY
      
      Currently when committing a transaction we release and reacquire the 
      trx_sys_t::mutex when we remove the transaction's read view from the global 
      view list. This will cause unnecessary context switching. It is an O(1) 
      operation on a linked list. Better to do it where we have have already 
      acquired the trx_sys_t::mutex. 
      
      Approved by Jimmy, rb://1040
    ------------------------------------------------------------
    revno: 3690.28.3
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Mon 2012-04-23 11:46:59 +1000
    message:
      Bug#13989037 - AVOID CONTEXT SWITCH DURING TRX_COMMIT() REMOVE THE VIEW EARLY
      
      Some additional changes committed by mistake. Revert the patch and do a recommit
    ------------------------------------------------------------
    revno: 3690.28.2
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Mon 2012-04-23 11:41:27 +1000
    message:
      Bug# 13989037 - AVOID CONTEXT SWITCH DURING TRX_COMMIT() REMOVE THE VIEW EARLY
      
      Currently when committing a transaction we release and reacquire the 
      trx_sys_t::mutex when we remove the transaction's read view from the global 
      view list. This will cause unnecessary context switching. It is an O(1) 
      operation on a linked list. Better to do it where we have have already 
      acquired the trx_sys_t::mutex. 
      
      Approved by Jimmy rb://1040
    ------------------------------------------------------------
    revno: 3690.28.1 [merge]
    committer: Sunny Bains <Sunny.Bains@Oracle.Com>
    branch nick: trunk
    timestamp: Sun 2012-04-22 10:24:15 +1000
    message:
      WL#5522 - Merge from mysql-trunk.
------------------------------------------------------------
revno: 3716
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Sat 2012-04-21 15:22:14 +0300
message:
  merge bug11754117-45670 fixes from 5.5: fixing result files.
------------------------------------------------------------
revno: 3715 [merge]
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Sat 2012-04-21 15:14:15 +0300
message:
  merge bug11754117-45670 fixes from 5.5: null merge for sql/sql_lex.h.
    ------------------------------------------------------------
    revno: 2875.376.15
    committer: Andrei Elkin <andrei.elkin@oracle.com>
    branch nick: mysql-5.5
    timestamp: Sat 2012-04-21 15:06:06 +0300
    message:
      merge bug11754117-45670 fixes from 5.1: fixing comments in sql_lex.h.
------------------------------------------------------------
revno: 3714 [merge]
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Sat 2012-04-21 15:11:15 +0300
message:
  merge bug11754117-45670 fixes from 5.5.
    ------------------------------------------------------------
    revno: 2875.376.14
    committer: Andrei Elkin <andrei.elkin@oracle.com>
    branch nick: mysql-5.5
    timestamp: Sat 2012-04-21 14:19:06 +0300
    message:
      merge bug11754117-45670 fixes from 5.1: fixing result files.
    ------------------------------------------------------------
    revno: 2875.376.13 [merge]
    committer: Andrei Elkin <andrei.elkin@oracle.com>
    branch nick: mysql-5.5
    timestamp: Sat 2012-04-21 13:24:39 +0300
    message:
      merge bug11754117-45670 fixes from 5.1.
        ------------------------------------------------------------
        revno: 2661.840.1
        committer: Andrei Elkin <andrei.elkin@oracle.com>
        branch nick: 5.1-bug11754117-45670-insert_id_gets_through
        timestamp: Fri 2012-04-20 19:41:20 +0300
        message:
          BUG#11754117 incorrect logging of INSERT into auto-increment 
          BUG#11761686 insert_id event is not filtered.
            
          Two issues are covered.
            
          INSERT into autoincrement field which is not the first part in the composed primary key 
          is unsafe by autoincrement logging design. The case is specific to MyISAM engine
          because Innodb does not allow such table definition.
            
          However no warnings and row-format logging in the MIXED mode was done, and
          that is fixed.
            
          Int-, Rand-, User-var log-events were not filtered along with their parent
          query that made possible them to screw up execution context of the following
          query.
            
          Fixed with deferring their execution until the parent query.
          
          ******
          Bug#11754117 
          
          Post review fixes.
------------------------------------------------------------
revno: 3713 [merge]
committer: Mayank Prasad <mayank.prasad@oracle.com>
branch nick: show_table_trunk
timestamp: Sat 2012-04-21 05:30:38 +0530
message:
  BUG#12427262 : 60961: SHOW TABLES VERY SLOW WHEN NOT IN SYSTEM DISK CACHE
  
  Details:
   - Merge: mysql-5.5 -> mysql-trunk
   - Test case result modification.
   - enabling test case on windows.
    ------------------------------------------------------------
    revno: 2875.376.12
    committer: Mayank Prasad <mayank.prasad@oracle.com>
    branch nick: show_table_5.5
    timestamp: Sat 2012-04-21 05:23:09 +0530
    message:
      BUG#12427262 : 60961: SHOW TABLES VERY SLOW WHEN NOT IN SYSTEM DISK CACHE
      
      Details:
       - test case bug12427262.test was failing on windows because
         on windows '/' was not recognized. And this was used in
         LIKE clause of the query being run in this test case.
      
      Fix:
       - Windows needs '\\\\' for path seperater in mysql. I was 
         not sure how to keep a single query with two different 
         syntax based on platform. So modifying query to make sure
         it runs correctly on both platform.
------------------------------------------------------------
revno: 3712 [merge]
committer: Nuno Carvalho <nuno.carvalho@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-04-20 23:39:38 +0100
message:
  BUG#13979418: SHOW BINLOG EVENTS MAY CRASH THE SERVER
  
  Merge from 5.5 into 5.6.
  
  Conflicts:
   * sql/binlog.cc
   * mysql-test/suite/rpl/r/rpl_parallel_show_binlog_events_purge_logs.result
    ------------------------------------------------------------
    revno: 2875.376.11 [merge]
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-5.5
    timestamp: Fri 2012-04-20 23:35:53 +0100
    message:
      BUG#13979418: SHOW BINLOG EVENTS MAY CRASH THE SERVER
      
      Merge from 5.1 into 5.5.
      
      Conflicts:
       * sql/log.h
       * sql/sql_repl.cc
        ------------------------------------------------------------
        revno: 2661.830.36
        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
        branch nick: mysql-5.1
        timestamp: Fri 2012-04-20 22:25:59 +0100
        message:
          BUG#13979418: SHOW BINLOG EVENTS MAY CRASH THE SERVER
          
          The function mysql_show_binlog_events has a local stack variable
          'LOG_INFO linfo;', which is assigned to thd->current_linfo, however
          this variable goes out of scope and is destroyed before clean
          thd->current_linfo.
          
          The problem is solved by moving 'LOG_INFO linfo;' to function scope.
------------------------------------------------------------
revno: 3711
committer: Andrei Elkin <andrei.elkin@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-04-20 19:10:18 +0300
message:
  BUG#13893310
  
  Using the recent push's bug id to tag fixing a race condition in
  rpl_parallel_change_master.
------------------------------------------------------------
revno: 3710
committer: Mattias Jonsson <mattias.jonsson@oracle.com>
branch nick: b13907676-t
timestamp: Fri 2012-04-20 11:40:48 +0200
message:
  Bug#13907676: HA_ARCHIVE::INFO
  In WL#4305 the refactoring of the archive writer,
  it could flush the writer when it was not yet open.
  
  This was due to if bulk insert was used but no
  rows was actually inserted (write_row was never called),
  the writer was marked dirty even if it was not open.
  
  Fix was to only mark it as dirty if it was opened.
------------------------------------------------------------
revno: 3709
committer: Norvald H. Ryeng <norvald.ryeng@oracle.com>
branch nick: mysql-trunk-12888306
timestamp: Fri 2012-04-20 15:01:26 +0200
message:
  Bug#12888306 MISSING ROWS FOR SELECT >ALL (SUBQUERY WITHOUT ROWS)
  
  Problem: Subqueries with implicit grouping may return incorrect
  results due to not evaluating the WHERE clause.
  
  Queries with ALL/ANY are rewritten to use MIN/MAX. The rewritten form
  of the query has no GROUP BY clause, so these queries fit the pattern
  for triggering this bug.
  
  JOIN::optimize() calls opt_sum_query() to replace aggregation
  functions with constant fields for implicitly grouped queries. If the
  aggregation function is MIN or MAX, it checks the argument to the
  aggregation function. If it is a constant, the constant is selected as
  the minimum/maximum value if the table has rows, and NULL if it
  doesn't. However, the WHERE clause is not checked, so the MIN/MAX may
  be evaluated to a constant when it should have been NULL.
  
  Fix: Don't replace MIN/MAX of constants if there is a WHERE clause.
------------------------------------------------------------
revno: 3708
committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-04-20 17:02:32 +0530
message:
  making main.bug12427262 test experimental on windows.
------------------------------------------------------------
revno: 3707
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-04-20 14:17:39 +0300
message:
  Fix Bug#13946118 STATS RELATED, ASSERT (RW_LATCH == 1) || (RW_LATCH == 2) || (RW_LATCH == 3)
  
  This bug was introduced in vasil.dimov@oracle.com-20120322170754-3mdqjdq93nuzqb04
  
  In btr_pcur_open_low() we shold clear the newly added flag
  BTR_ALREADY_S_LATCHED from latch_mode because later in buf_page_get_gen()
  we assert that latch_mode is one of RW_S_LATCH, RW_X_LATCH or RW_NO_LATCH.
  
  This was discussed with Marko and is fixed in WL#6175 (which is not pushed
  yet). I am not sure why it was fixed there instead of mysql-trunk, since
  the problem exists in mysql-trunk.
------------------------------------------------------------
revno: 3706
committer: Alexander Barkov <alexander.barkov@oracle.com>
branch nick: mysql-trunk.b13976233
timestamp: Fri 2012-04-20 15:05:43 +0400
message:
  Bug#13976233 ASSERTION FAILED: !CHECK_TIME_MMSSFF_RANGE(LTIME), FILE SQL_TIME.CC, LINE 304
        
  Problem: double2lldiv_t() could errorneously return 1,000,000,000 value
  in "lld->rem" due to limited presicion of "double" arithmetics.
  
  Fix: Catch this corner case and put the reminder back into
  the expecter 0..999,999,999 range.
------------------------------------------------------------
revno: 3705
committer: Hemant Kumar <hemant.hk.kumar@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-04-20 15:08:11 +0530
message:
  Added "rpl_binlog_n_mix_MTS" to mysql-trunk per push run.
------------------------------------------------------------
revno: 3704
committer: Vasil Dimov <vasil.dimov@oracle.com>
branch nick: mysql-trunk
timestamp: Fri 2012-04-20 12:01:35 +0300
message:
  Assert that a transaction which is being freed is not on
  trx->in_mysql_list.
  
  This assertion is added to help track down:
  
  Bug#13966453 CONCURRENT DML AND READS FROM I_S TABLES CRASH
    FETCH_DATA_INTO_CACHE_LOW
  Bug#13980608 CRASH OF SERVER IN THE TEST RQG_INFO_SCHEMA ON WIN
  
  but it should be there anyway, so it will be left even after the bugs
  are fixed.
  
  Suggested by:	Sunny
------------------------------------------------------------
revno: 3703
committer: Tor Didriksen <tor.didriksen@oracle.com>
branch nick: mysql-trunk-commercial
timestamp: Fri 2012-04-20 10:55:22 +0200
message:
  Bug#12790933 MULTIPLE DEADLOCKS / BOTTLENECKS INVOLVING LOCK_THREAD_COUNT
  
  LOCK_thread_count should protect the list of THD only,
  not the internal state of a THD.
------------------------------------------------------------
revno: 3702 [merge]
committer: Oystein Grovlen <oystein.grovlen@oracle.com>
branch nick: mysql-wl6043
timestamp: Fri 2012-04-20 08:48:15 +0200
message:
  Final merge mysql-trunk => mysql-wl#6043.
  No issues.
    ------------------------------------------------------------
    revno: 3690.26.30
    committer: Bjorn Munch <bjorn.munch@oracle.com>
    branch nick: main-tr
    timestamp: Fri 2012-04-20 07:23:24 +0200
    message:
      Some more debugging of running cdb from MTR
    ------------------------------------------------------------
    revno: 3690.26.29
    committer: Andrei Elkin <andrei.elkin@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-04-19 19:30:09 +0300
    message:
      BUG#13893310
      
      fixing two post-push issues:
      1. Valgrind report
      
      ==26329==    by 0xA3AE2E: my_malloc (my_malloc.c:38)
      ==26329==    by 0xA1A881: init_io_cache (mf_iocache.c:232)
      ==26329==    by 0xA0D883: Rpl_info_file::do_init_info(unsigned long const*, unsigned int) (rpl_info_file.cc:95)
      ==26329==    by 0x9FC69D: Rpl_info_handler::init_info(unsigned long const*, unsigned int) (rpl_info_handler.h:45)
      ==26329==    by 0x9FBE37: Master_info::init_info() (rpl_mi.cc:303)
      ==26329==    by 0x9F6278: init_info(Master_info*, bool, int) (rpl_slave.cc:459)
      ==26329==    by 0x9F96F9: init_slave() (rpl_slave.cc:316)
      
      2. A race condition in rpl_parallel_change_master indicated with
         mysqltest: At line 86: query 'CHANGE MASTER TO RELAY_LOG_FILE='$relay_file', RELAY_LOG_POS=$relay_pos' succeeded - should have failed with errno 1801.
    ------------------------------------------------------------
    revno: 3690.26.28
    committer: Alexander Barkov <alexander.barkov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-04-19 15:30:44 +0400
    message:
      Additional fix for the previous commit changing
      data type for m_lenth in SimpleCString from uint to size_t.
    ------------------------------------------------------------
    revno: 3690.26.27
    committer: magnus.blaudd@oracle.com
    branch nick: trunk
    timestamp: Thu 2012-04-19 13:20:54 +0200
    message:
      binlog
      - fix trivial .result file  mismatch, apparently the .test file or one
        of teh include files it uses has been changed to use
        "show_binlog_events.inc" instead of the raw "show binlog events" command
    ------------------------------------------------------------
    revno: 3690.26.26
    committer: magnus.blaudd@oracle.com
    branch nick: trunk
    timestamp: Thu 2012-04-19 13:13:17 +0200
    message:
      ndb
       - fix comipilation error in ha_ndbcluster_binlog.cc due to recent proper
         interface to the global threads list in MySQl Server fix
    ------------------------------------------------------------
    revno: 3690.26.25
    committer: Alexander Barkov <alexander.barkov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-04-19 14:49:27 +0400
    message:
      Changing data type of m_length in SimpleCString and descendants
      from uint to size_t, for better LEX_STRING compatibility.
    ------------------------------------------------------------
    revno: 3690.26.24 [merge]
    committer: Mayank Prasad <mayank.prasad@oracle.com>
    branch nick: show_table_trunk
    timestamp: Thu 2012-04-19 16:03:14 +0530
    message:
      BUG#12427262 : 60961: SHOW TABLES VERY SLOW WHEN NOT IN SYSTEM DISK CACHE
            
      Details:
       - Merge : 5.5 -> trunk
        ------------------------------------------------------------
        revno: 2875.376.10 [merge]
        committer: Mayank Prasad <mayank.prasad@oracle.com>
        branch nick: show_table_5.5
        timestamp: Thu 2012-04-19 15:59:46 +0530
        message:
          BUG#12427262 : 60961: SHOW TABLES VERY SLOW WHEN NOT IN SYSTEM DISK CACHE
          
          Details:
          - Merge : 5.1 -> 5.5
          - Addded a new test case which was not added in 5.1 because PS was
            not there in 5.1.
            ------------------------------------------------------------
            revno: 2661.830.35
            committer: Mayank Prasad <mayank.prasad@oracle.com>
            branch nick: show_table
            timestamp: Thu 2012-04-19 14:57:34 +0530
            message:
              BUG#12427262 : 60961: SHOW TABLES VERY SLOW WHEN NOT IN SYSTEM DISK CACHE
              
              Reason:
               This is a regression happened because of changes done in code refactoring 
               in 5.1 from 5.0.
              
              Issue: 
               While doing "Show tables" lex->verbose was being checked to avoid opening
               FRM files to get table type. In case of "Show full table", lex->verbose
               is true to indicate table type is required. In 5.0, this check was
               present which got missing in >=5.5.
              
              Fix:
               Added the required check to avoid opening FRM files unnecessarily in case
               of "Show tables".
    ------------------------------------------------------------
    revno: 3690.26.23
    committer: Erlend Dahl <erlend.dahl@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-04-19 12:18:34 +0200
    message:
      Bump the milestone version number.
    ------------------------------------------------------------
    revno: 3690.26.22
    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
    branch nick: topush-trunk
    timestamp: Thu 2012-04-19 09:02:54 +0200
    message:
      Bug#11940249: post push fix, removed incorrect DBUG_ASSERT.
    ------------------------------------------------------------
    revno: 3690.26.21
    committer: Jimmy Yang <jimmy.yang@oracle.com>
    branch nick: trunk4
    timestamp: Thu 2012-04-19 15:01:16 +0800
    message:
      Fix Bug #13881758 - 64745: INNODB INTERNAL SQL DOES NOT HANDLE EMPTY
      SPACE IN DATABASE/TABLENAME
            
      rb://1029 approved by Sunny Bains
    ------------------------------------------------------------
    revno: 3690.26.20
    committer: Marko M?kel? <marko.makela@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-04-19 09:49:15 +0300
    message:
      Try to fix a innodb.innodb-index-online test failure on Windows.
      
      Apparently, the $ anchor in the mtr.add_suppression regular expression
      does not always match the end of line on Windows. Remove it.
    ------------------------------------------------------------
    revno: 3690.26.19
    committer: Nuno Carvalho <nuno.carvalho@oracle.com>
    branch nick: mysql-trunk
    timestamp: Thu 2012-04-19 02:10:19 +0100
    message:
      BUG#13680651: RPL_CORRUPTION TEST FAILS WITH SLAVE STOPPED WITH WRONG ERROR CODE ON VALGRIND
      
      Errors numbers shifted and include/wait_for_slave_io_error.inc does not
      supports error names, so changed 1741 to new
      ER_NETWORK_READ_EVENT_CHECKSUM_FAILURE number (1742).
    ------------------------------------------------------------
    revno: 3690.26.18 [merge]
    committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-04-18 19:46:13 +0100
    message:
      auto-merge
        ------------------------------------------------------------
        revno: 3690.27.1
        committer: Tatjana Azundris Nuernberg <tatjana.nuernberg@oracle.com>
        branch nick: mysql-trunk
        timestamp: Wed 2012-04-18 19:38:45 +0100
        message:
          BUG#13958454 - GENERAL QUERY LOG MUST NOT BE REWRITING QUERIES UNLESS NEEDED
          
          Code for self-printing of user-variable assignments was shared between
          statement rewriting and EXPLAIN EXTENDED.  The former cannot have ()
          around the assignment in SET, while the latter needs it to avoid
          ambiguity in SELECT (a:=1)+2.
          
          We now make that distinction depending on what query_type we have.
    ------------------------------------------------------------
    revno: 3690.26.17
    committer: Mattias Jonsson <mattias.jonsson@oracle.com>
    branch nick: b11940249-t
    timestamp: Tue 2012-04-17 14:45:04 +0200
    message:
      Bug#11940249: RBR: MYISAM TABLE CORRUPTION AFTER FIRST LARGE INSERT
                                 ON SLAVE
      
      Problem was during repair of myisam (as a part of bulk insert optimization)
      it unlocked the table, which results in when the statement used multiple
      rpl row events for its new rows,  the following events was not properly
      locked.
      
      Fixed by not taking/release locks in ha_myisam::repair if already
      holding a write lock.
      
      Updated with reviewers comments.
    ------------------------------------------------------------
    revno: 3690.26.16
    committer: Alexander Barkov <alexander.barkov@oracle.com>
    branch nick: mysql-trunk
    timestamp: Wed 2012-04-18 21:52:08 +0400
    message:
      Fixing "conversion from 'size_t' to 'uint', possible loss of data"
      warnings on Windows.
    ------------------------------------------------------------
    revno: 3690.26.15
    committer: Georgi Kodinov <Georgi.Kodinov@Oracle.com>
    branch nick: B13859866-trunk
    timestamp: Tue 2012-04-17 17:20:00 +0300
    message:
      Bug #13859866: VERSION_COMPILE_MACHINE SHOWS X86 FOR 
      64-BIT BINARIES ON 64-BIT WINDOWS MACHINE
      
      Added a workaround for a cmake deficiency that caused 
      the problem.
      Now the mysql cmake files will set the compile_machine
      to x86_64 when compiling a 64 bit windows binary.
    ------------------------------------------------------------
    revno: 3690.26.14
    committer: Andrei Elkin <andrei.elkin@oracle.com>
    branch nick: bug12995174-part3-checkpoint_group
    timestamp: Wed 2012-04-18 16:33:46 +0300
    message:
      BUG#13893310
      
      a push-push issue is fixed. 
      The path to slave info file was handled incorrectly to make the file slip deletion
      what PB2 diagnosed to catch Error 6 Error on delete on multiple rpl tests.
      
      Fixed with simplifying Rpl_info_file::do_reset_info() to use
      the well-formed file name argument instead of compose one with fn_format.
    ------------------------------------------------------------
    revno: 3690.26.13 [merge]
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-newmerge
    timestamp: Wed 2012-04-18 15:06:39 +0200
    message:
      local merge
        ------------------------------------------------------------
        revno: 3690.16.80 [merge]
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: trunk-merge
        timestamp: Wed 2012-04-18 14:15:21 +0200
        message:
          empty merge 5.5 => trunk
            ------------------------------------------------------------
            revno: 2875.376.9 [merge]
            committer: Tor Didriksen <tor.didriksen@oracle.com>
            branch nick: 5.5-merge
            timestamp: Wed 2012-04-18 14:14:20 +0200
            message:
              NULL merge 5.1 => 5.5
                ------------------------------------------------------------
                revno: 2661.830.34
                committer: Tor Didriksen <tor.didriksen@oracle.com>
                branch nick: 5.1
                timestamp: Wed 2012-04-18 14:13:13 +0200
                message:
                  new header file must be listed in Makefile.am
        ------------------------------------------------------------
        revno: 3690.16.79
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk
        timestamp: Wed 2012-04-18 14:29:02 +0300
        message:
          Remove nondeterminism in innodb-index-online.test again.
        ------------------------------------------------------------
        revno: 3690.16.78
        committer: Marko M?kel? <marko.makela@oracle.com>
        branch nick: mysql-trunk
        timestamp: Wed 2012-04-18 14:28:09 +0300
        message:
          Disable innodb.innodb-alter-discard on --embedded.
          It does not support restart.
        ------------------------------------------------------------
        revno: 3690.16.77 [merge]
        committer: Tor Didriksen <tor.didriksen@oracle.com>
        branch nick: trunk-merge
        timestamp: Wed 2012-04-18 13:17:16 +0200
        message:
          empty merge 5.5 => trunk
            ------------------------------------------------------------
            revno: 2875.376.8 [merge]
            committer: Tor Didriksen <tor.didriksen@oracle.com>
            branch nick: 5.5-merge
            timestamp: Wed 2012-04-18 13:15:27 +0200
            message:
              NULL merge 5.1 => 5.5
                ------------------------------------------------------------
                revno: 2661.830.33
                committer: Tor Didriksen <tor.didriksen@oracle.com>
                branch nick: 5.1
                timestamp: Wed 2012-04-18 13:14:05 +0200
                message:
                  Backport 5.5=>5.1 Patch for Bug#13805127: 
                  Stored program cache produces wrong result in same THD.
        ------------------------------------------------------------
        revno: 3690.16.76 [merge]
        committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
        branch nick: mysql-trunk-bug12902967
        timestamp: Wed 2012-04-18 15:20:36 +0530
        message:
          Null merge from mysql-5.5 to mysql-trunk. 
            ------------------------------------------------------------
            revno: 2875.376.7
            committer: Annamalai Gurusami <annamalai.gurusami@oracle.com>
            branch nick: mysql-5.5-bug12902967
            timestamp: Wed 2012-04-18 15:16:11 +0530
            message:
              Bug #12902967 Creating self referencing fk on same index unhandled,
              confusing error. Updated the test script to work properly on
              windows platform. 
        ------------------------------------------------------------
        revno: 3690.16.75
        committer: Chaithra Gopalareddy <chaithra.gopalareddy@oracle.com>
        branch nick: mysql-5.6
        timestamp: Wed 2012-04-18 15:16:51 +0530
        message:
          PROBLEM:
          This is a follow up patch on 5.6 for the bug#12713907.
          This bug is not reproducible on 5.6 as changes for WL#5558
          hides the problem.
          
          In 5.6, since keyread is set to true in test_if_skip_sot_order
          for both 'QUICK_RANGE_SELECT' and 'JT_INDEX_SCAN', we need
          to move the call for set_keyread to join_init_read_record.
          Access function for JT_INDEX_SCAN already has the call to
          'set_keyread'.
          
          Note that a Work log is being created to clean up the
          set_keyread calls from places other than access functions.
          For now, we are only removing the call from
          test_if_skip_sort_order and moving it to
          join_init_read_record.
        ------------------------------------------------------------
        revno: 3690.16.74 [merge]
        committer: Nuno Carvalho <nuno.carvalho@oracle.com>
        branch nick: mysql-trunk
        timestamp: Wed 2012-04-18 10:18:20 +0100
        message:
          WL#6236: Allow SHOW MASTER LOGS and SHOW BINARY LOGS with REPLICATION CLIENT
          
          Merge from 5.5 into 5.6.
            ------------------------------------------------------------
            revno: 2875.376.6 [merge]
            committer: Nuno Carvalho <nuno.carvalho@oracle.com>
            branch nick: mysql-5.5
            timestamp: Wed 2012-04-18 10:12:19 +0100
            message:
              WL#6236: Allow SHOW MASTER LOGS and SHOW BINARY LOGS with REPLICATION CLIENT
              
              Merge from 5.1 into 5.5.
                ------------------------------------------------------------
                revno: 2661.830.32
                committer: Nuno Carvalho <nuno.carvalho@oracle.com>
                branch nick: mysql-5.1
                timestamp: Wed 2012-04-18 10:08:01 +0100
                message:
                  WL#6236: Allow SHOW MASTER LOGS and SHOW BINARY LOGS with REPLICATION CLIENT
                  
                  Currently SHOW MASTER LOGS and SHOW BINARY LOGS require the SUPER
                  privilege. Monitoring tools (such as MEM) often want to check this 
                  output - for instance MEM generates the SUM of the sizes of the logs 
                  reported here, and puts that in the Replication overview within the MEM
                  Dashboard.
                  However, because of the SUPER requirement, these tools often have an 
                  account that holds open the connection whilst monitoring, and can lock
                  out administrators when the server gets overloaded and reaches
                  max_connections - there is already another SUPER privileged account
                  connected, the "monitor". 
                  
                  As SHOW MASTER STATUS, and all other replication related statements,
                  return with either REPLICATION CLIENT or SUPER privileges, this worklog 
                  is to make SHOW MASTER LOGS and SHOW BINARY LOGS be consistent with this
                  as well, and allow both of these commands with either SUPER or 
                  REPLICATION CLIENT. 
                  This allows monitoring tools to not require a SUPER privilege any more,
                  so is safer in overloaded situations, as well as being more secure, as 
                  lighter privileges can be given to users of such tools or scripts.
    ------------------------------------------------------------
    revno: 3690.26.12
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-newmerge
    timestamp: Wed 2012-04-18 13:57:55 +0200
    message:
      Resolve conflicting changes in trunk and mysql-5.6.5-m8-release
      BUG#13504281 vs BUG#13820370
      
      The problem is that rpl_gtid_mode assumed that the server should abort
      if replication fails during startup.
      However, rpl_parallel_change_master assumed the opposite.
    ------------------------------------------------------------
    revno: 3690.26.11
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-newmerge
    timestamp: Tue 2012-04-17 07:56:53 +0200
    message:
      Try to resolve separate changes in trunk and mysql-5.6.5-m8-release
    ------------------------------------------------------------
    revno: 3690.26.10 [merge]
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-newmerge
    timestamp: Mon 2012-04-16 11:26:56 +0200
    message:
      NULL merge mysql-5.6.5-m8-release => trunk
        ------------------------------------------------------------
        revno: 3690.25.13
        tags: mysql-5.6.5
        committer: Mattias Jonsson <mattias.jonsson@oracle.com>
        branch nick: 5.6.5-m8
        timestamp: Thu 2012-03-29 10:11:03 +0200
        message:
          Revert of WL#4305 due to bug#13838761.
          Manual revert of:
          revid:mattias.jonsson@oracle.com-20120227103042-bs14kskt8zy6j3yj
    ------------------------------------------------------------
    revno: 3690.26.9 [merge]
    committer: Tor Didriksen <tor.didriksen@oracle.com>
    branch nick: trunk-newmerge
    timestamp: Mon 2012-04-16 11:23:19 +0200
    message:
      NULL merge mysql-5.6.5-m8-release => trunk
